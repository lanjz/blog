<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hook | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.b7c2e9f6.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.f4878c9a.js" as="script"><link rel="preload" href="/lanjz/assets/js/8.06e66aa1.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.8c2b4195.js"><link rel="prefetch" href="/lanjz/assets/js/100.af7fbabb.js"><link rel="prefetch" href="/lanjz/assets/js/101.30bf9d8a.js"><link rel="prefetch" href="/lanjz/assets/js/102.738bfa64.js"><link rel="prefetch" href="/lanjz/assets/js/103.11e685a4.js"><link rel="prefetch" href="/lanjz/assets/js/104.fafe42ea.js"><link rel="prefetch" href="/lanjz/assets/js/105.289916e3.js"><link rel="prefetch" href="/lanjz/assets/js/106.b9218f23.js"><link rel="prefetch" href="/lanjz/assets/js/107.e03b1725.js"><link rel="prefetch" href="/lanjz/assets/js/108.5815e5b4.js"><link rel="prefetch" href="/lanjz/assets/js/109.3664699c.js"><link rel="prefetch" href="/lanjz/assets/js/11.6ae36a61.js"><link rel="prefetch" href="/lanjz/assets/js/110.9813f814.js"><link rel="prefetch" href="/lanjz/assets/js/111.efbf1039.js"><link rel="prefetch" href="/lanjz/assets/js/112.17956596.js"><link rel="prefetch" href="/lanjz/assets/js/113.518f8426.js"><link rel="prefetch" href="/lanjz/assets/js/114.6ca075b1.js"><link rel="prefetch" href="/lanjz/assets/js/115.438c2fd3.js"><link rel="prefetch" href="/lanjz/assets/js/116.41dc29ee.js"><link rel="prefetch" href="/lanjz/assets/js/117.94ec88e5.js"><link rel="prefetch" href="/lanjz/assets/js/118.bbcf818c.js"><link rel="prefetch" href="/lanjz/assets/js/119.3e62b0a0.js"><link rel="prefetch" href="/lanjz/assets/js/12.8f3f6951.js"><link rel="prefetch" href="/lanjz/assets/js/120.0d0769b3.js"><link rel="prefetch" href="/lanjz/assets/js/121.afdedcd0.js"><link rel="prefetch" href="/lanjz/assets/js/122.ac31ed2c.js"><link rel="prefetch" href="/lanjz/assets/js/123.4a406ceb.js"><link rel="prefetch" href="/lanjz/assets/js/124.be9e9beb.js"><link rel="prefetch" href="/lanjz/assets/js/125.084e569f.js"><link rel="prefetch" href="/lanjz/assets/js/126.5a1b923d.js"><link rel="prefetch" href="/lanjz/assets/js/127.9452cd05.js"><link rel="prefetch" href="/lanjz/assets/js/128.3dbf0227.js"><link rel="prefetch" href="/lanjz/assets/js/129.79d6582a.js"><link rel="prefetch" href="/lanjz/assets/js/13.bbd8df8e.js"><link rel="prefetch" href="/lanjz/assets/js/130.a6290697.js"><link rel="prefetch" href="/lanjz/assets/js/131.92993419.js"><link rel="prefetch" href="/lanjz/assets/js/132.cc5d038b.js"><link rel="prefetch" href="/lanjz/assets/js/133.c36371d3.js"><link rel="prefetch" href="/lanjz/assets/js/134.6f57a326.js"><link rel="prefetch" href="/lanjz/assets/js/135.539a8752.js"><link rel="prefetch" href="/lanjz/assets/js/136.a3edd4e5.js"><link rel="prefetch" href="/lanjz/assets/js/137.f7954d2f.js"><link rel="prefetch" href="/lanjz/assets/js/138.bd82fe91.js"><link rel="prefetch" href="/lanjz/assets/js/139.b8dc0470.js"><link rel="prefetch" href="/lanjz/assets/js/14.2a82515b.js"><link rel="prefetch" href="/lanjz/assets/js/140.fa69688d.js"><link rel="prefetch" href="/lanjz/assets/js/141.b6c75a2e.js"><link rel="prefetch" href="/lanjz/assets/js/142.a1d461d6.js"><link rel="prefetch" href="/lanjz/assets/js/143.2a804ef5.js"><link rel="prefetch" href="/lanjz/assets/js/144.4fac9f2b.js"><link rel="prefetch" href="/lanjz/assets/js/145.34e65013.js"><link rel="prefetch" href="/lanjz/assets/js/146.beda29c7.js"><link rel="prefetch" href="/lanjz/assets/js/147.ebacf89c.js"><link rel="prefetch" href="/lanjz/assets/js/148.a36e3bf9.js"><link rel="prefetch" href="/lanjz/assets/js/149.7d80f796.js"><link rel="prefetch" href="/lanjz/assets/js/15.2f65244d.js"><link rel="prefetch" href="/lanjz/assets/js/150.73446aae.js"><link rel="prefetch" href="/lanjz/assets/js/151.d38b8762.js"><link rel="prefetch" href="/lanjz/assets/js/152.68326a84.js"><link rel="prefetch" href="/lanjz/assets/js/153.a2a596eb.js"><link rel="prefetch" href="/lanjz/assets/js/154.d20d7947.js"><link rel="prefetch" href="/lanjz/assets/js/155.9da67769.js"><link rel="prefetch" href="/lanjz/assets/js/156.ee66d75d.js"><link rel="prefetch" href="/lanjz/assets/js/157.a96429a0.js"><link rel="prefetch" href="/lanjz/assets/js/158.d1d47346.js"><link rel="prefetch" href="/lanjz/assets/js/159.802f7e4a.js"><link rel="prefetch" href="/lanjz/assets/js/16.ab5989a1.js"><link rel="prefetch" href="/lanjz/assets/js/160.dcc6face.js"><link rel="prefetch" href="/lanjz/assets/js/161.4962b6d2.js"><link rel="prefetch" href="/lanjz/assets/js/162.303d9a1c.js"><link rel="prefetch" href="/lanjz/assets/js/163.ae9fdf02.js"><link rel="prefetch" href="/lanjz/assets/js/164.cb55d0c5.js"><link rel="prefetch" href="/lanjz/assets/js/165.69149128.js"><link rel="prefetch" href="/lanjz/assets/js/166.56a32eab.js"><link rel="prefetch" href="/lanjz/assets/js/167.135584e5.js"><link rel="prefetch" href="/lanjz/assets/js/168.2f035a7f.js"><link rel="prefetch" href="/lanjz/assets/js/169.0f29c0a1.js"><link rel="prefetch" href="/lanjz/assets/js/17.49359df4.js"><link rel="prefetch" href="/lanjz/assets/js/170.c771052a.js"><link rel="prefetch" href="/lanjz/assets/js/171.15fd8145.js"><link rel="prefetch" href="/lanjz/assets/js/172.713dad10.js"><link rel="prefetch" href="/lanjz/assets/js/173.de431e59.js"><link rel="prefetch" href="/lanjz/assets/js/174.c73fb415.js"><link rel="prefetch" href="/lanjz/assets/js/175.b838d4fa.js"><link rel="prefetch" href="/lanjz/assets/js/176.4cd83f9b.js"><link rel="prefetch" href="/lanjz/assets/js/177.fae36781.js"><link rel="prefetch" href="/lanjz/assets/js/178.2753073a.js"><link rel="prefetch" href="/lanjz/assets/js/179.ed6cb6fd.js"><link rel="prefetch" href="/lanjz/assets/js/18.4ef4981d.js"><link rel="prefetch" href="/lanjz/assets/js/180.4bb7f6fe.js"><link rel="prefetch" href="/lanjz/assets/js/181.90cc6510.js"><link rel="prefetch" href="/lanjz/assets/js/182.d91a936e.js"><link rel="prefetch" href="/lanjz/assets/js/183.419e2f03.js"><link rel="prefetch" href="/lanjz/assets/js/184.d902abf7.js"><link rel="prefetch" href="/lanjz/assets/js/185.f550a99b.js"><link rel="prefetch" href="/lanjz/assets/js/186.a9180286.js"><link rel="prefetch" href="/lanjz/assets/js/187.32b6c9c7.js"><link rel="prefetch" href="/lanjz/assets/js/188.7cd6fc45.js"><link rel="prefetch" href="/lanjz/assets/js/189.c3083f0e.js"><link rel="prefetch" href="/lanjz/assets/js/19.7a21092b.js"><link rel="prefetch" href="/lanjz/assets/js/190.c1860877.js"><link rel="prefetch" href="/lanjz/assets/js/191.24628ee9.js"><link rel="prefetch" href="/lanjz/assets/js/192.0540c06a.js"><link rel="prefetch" href="/lanjz/assets/js/193.a40364cd.js"><link rel="prefetch" href="/lanjz/assets/js/194.0a9c1a97.js"><link rel="prefetch" href="/lanjz/assets/js/195.9228df07.js"><link rel="prefetch" href="/lanjz/assets/js/196.a3441363.js"><link rel="prefetch" href="/lanjz/assets/js/197.efee24f6.js"><link rel="prefetch" href="/lanjz/assets/js/198.1b7604ec.js"><link rel="prefetch" href="/lanjz/assets/js/199.bc73b6ee.js"><link rel="prefetch" href="/lanjz/assets/js/20.3e57612e.js"><link rel="prefetch" href="/lanjz/assets/js/200.3e2e6fd1.js"><link rel="prefetch" href="/lanjz/assets/js/201.b9cfe18f.js"><link rel="prefetch" href="/lanjz/assets/js/202.b2f833c6.js"><link rel="prefetch" href="/lanjz/assets/js/203.46b90344.js"><link rel="prefetch" href="/lanjz/assets/js/204.db92c7db.js"><link rel="prefetch" href="/lanjz/assets/js/205.a0349765.js"><link rel="prefetch" href="/lanjz/assets/js/206.f3a32e98.js"><link rel="prefetch" href="/lanjz/assets/js/207.585c0608.js"><link rel="prefetch" href="/lanjz/assets/js/208.70ed6180.js"><link rel="prefetch" href="/lanjz/assets/js/209.3eeb1974.js"><link rel="prefetch" href="/lanjz/assets/js/21.31b11d48.js"><link rel="prefetch" href="/lanjz/assets/js/210.ef149428.js"><link rel="prefetch" href="/lanjz/assets/js/211.574ff7ad.js"><link rel="prefetch" href="/lanjz/assets/js/212.c703b3d1.js"><link rel="prefetch" href="/lanjz/assets/js/213.276e3342.js"><link rel="prefetch" href="/lanjz/assets/js/214.1aa648fd.js"><link rel="prefetch" href="/lanjz/assets/js/215.27504c77.js"><link rel="prefetch" href="/lanjz/assets/js/216.cd969bf8.js"><link rel="prefetch" href="/lanjz/assets/js/22.c229ff6b.js"><link rel="prefetch" href="/lanjz/assets/js/23.4733fdcf.js"><link rel="prefetch" href="/lanjz/assets/js/24.8319a573.js"><link rel="prefetch" href="/lanjz/assets/js/25.e51a5122.js"><link rel="prefetch" href="/lanjz/assets/js/26.c27b8cc5.js"><link rel="prefetch" href="/lanjz/assets/js/27.df59c01d.js"><link rel="prefetch" href="/lanjz/assets/js/28.a9c2e0ba.js"><link rel="prefetch" href="/lanjz/assets/js/29.df3f51d4.js"><link rel="prefetch" href="/lanjz/assets/js/3.2483c384.js"><link rel="prefetch" href="/lanjz/assets/js/30.b9003c69.js"><link rel="prefetch" href="/lanjz/assets/js/31.789f22d5.js"><link rel="prefetch" href="/lanjz/assets/js/32.e60e5599.js"><link rel="prefetch" href="/lanjz/assets/js/33.e6cb5bcd.js"><link rel="prefetch" href="/lanjz/assets/js/34.43cbb2a2.js"><link rel="prefetch" href="/lanjz/assets/js/35.2da981fd.js"><link rel="prefetch" href="/lanjz/assets/js/36.ea732ea3.js"><link rel="prefetch" href="/lanjz/assets/js/37.71d78621.js"><link rel="prefetch" href="/lanjz/assets/js/38.b30e60e0.js"><link rel="prefetch" href="/lanjz/assets/js/39.e90007e5.js"><link rel="prefetch" href="/lanjz/assets/js/4.4e609b58.js"><link rel="prefetch" href="/lanjz/assets/js/40.d5a68336.js"><link rel="prefetch" href="/lanjz/assets/js/41.570bd100.js"><link rel="prefetch" href="/lanjz/assets/js/42.8f428d3e.js"><link rel="prefetch" href="/lanjz/assets/js/43.85cdd734.js"><link rel="prefetch" href="/lanjz/assets/js/44.52c99cbe.js"><link rel="prefetch" href="/lanjz/assets/js/45.c22b20de.js"><link rel="prefetch" href="/lanjz/assets/js/46.99c8a17c.js"><link rel="prefetch" href="/lanjz/assets/js/47.0c8cce90.js"><link rel="prefetch" href="/lanjz/assets/js/48.00d92992.js"><link rel="prefetch" href="/lanjz/assets/js/49.f1a2acfb.js"><link rel="prefetch" href="/lanjz/assets/js/5.d7c0cc80.js"><link rel="prefetch" href="/lanjz/assets/js/50.a9f34d85.js"><link rel="prefetch" href="/lanjz/assets/js/51.379910f5.js"><link rel="prefetch" href="/lanjz/assets/js/52.34861346.js"><link rel="prefetch" href="/lanjz/assets/js/53.310b73b1.js"><link rel="prefetch" href="/lanjz/assets/js/54.1cfc3be0.js"><link rel="prefetch" href="/lanjz/assets/js/55.9d16e60c.js"><link rel="prefetch" href="/lanjz/assets/js/56.8846ccd8.js"><link rel="prefetch" href="/lanjz/assets/js/57.11f15d95.js"><link rel="prefetch" href="/lanjz/assets/js/58.e8ee07bf.js"><link rel="prefetch" href="/lanjz/assets/js/59.14c56c4a.js"><link rel="prefetch" href="/lanjz/assets/js/6.0d356d4b.js"><link rel="prefetch" href="/lanjz/assets/js/60.dc03df8f.js"><link rel="prefetch" href="/lanjz/assets/js/61.2a25e297.js"><link rel="prefetch" href="/lanjz/assets/js/62.8c3225b9.js"><link rel="prefetch" href="/lanjz/assets/js/63.a9301728.js"><link rel="prefetch" href="/lanjz/assets/js/64.196ee770.js"><link rel="prefetch" href="/lanjz/assets/js/65.8a15f39f.js"><link rel="prefetch" href="/lanjz/assets/js/66.2f6af6d0.js"><link rel="prefetch" href="/lanjz/assets/js/67.a2f3847e.js"><link rel="prefetch" href="/lanjz/assets/js/68.a6b2da22.js"><link rel="prefetch" href="/lanjz/assets/js/69.97f6dd8e.js"><link rel="prefetch" href="/lanjz/assets/js/7.fa8f1577.js"><link rel="prefetch" href="/lanjz/assets/js/70.41636996.js"><link rel="prefetch" href="/lanjz/assets/js/71.f7f929cb.js"><link rel="prefetch" href="/lanjz/assets/js/72.f63316f9.js"><link rel="prefetch" href="/lanjz/assets/js/73.2bb721b6.js"><link rel="prefetch" href="/lanjz/assets/js/74.8016d212.js"><link rel="prefetch" href="/lanjz/assets/js/75.02dbd56d.js"><link rel="prefetch" href="/lanjz/assets/js/76.47ee7c3c.js"><link rel="prefetch" href="/lanjz/assets/js/77.e52d41c8.js"><link rel="prefetch" href="/lanjz/assets/js/78.ce90b6be.js"><link rel="prefetch" href="/lanjz/assets/js/79.12a91356.js"><link rel="prefetch" href="/lanjz/assets/js/80.6bb2e746.js"><link rel="prefetch" href="/lanjz/assets/js/81.316b697c.js"><link rel="prefetch" href="/lanjz/assets/js/82.edb764e2.js"><link rel="prefetch" href="/lanjz/assets/js/83.8810c9af.js"><link rel="prefetch" href="/lanjz/assets/js/84.74089406.js"><link rel="prefetch" href="/lanjz/assets/js/85.58bc27c7.js"><link rel="prefetch" href="/lanjz/assets/js/86.f08d8f08.js"><link rel="prefetch" href="/lanjz/assets/js/87.473ae0cc.js"><link rel="prefetch" href="/lanjz/assets/js/88.1289bbe8.js"><link rel="prefetch" href="/lanjz/assets/js/89.859e8fcd.js"><link rel="prefetch" href="/lanjz/assets/js/9.2f329c2f.js"><link rel="prefetch" href="/lanjz/assets/js/90.1c220b3c.js"><link rel="prefetch" href="/lanjz/assets/js/91.74d8b647.js"><link rel="prefetch" href="/lanjz/assets/js/92.0bd8883f.js"><link rel="prefetch" href="/lanjz/assets/js/93.126797d7.js"><link rel="prefetch" href="/lanjz/assets/js/94.51ca2dd3.js"><link rel="prefetch" href="/lanjz/assets/js/95.a497c812.js"><link rel="prefetch" href="/lanjz/assets/js/96.95329035.js"><link rel="prefetch" href="/lanjz/assets/js/97.9692ae9e.js"><link rel="prefetch" href="/lanjz/assets/js/98.46a418a5.js"><link rel="prefetch" href="/lanjz/assets/js/99.69a9c393.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lanjz/React/vsVue.html" class="sidebar-link">vsVue</a></li><li><a href="/lanjz/React/ReactDOM.render.html" class="sidebar-link">ReactDOM.render</a></li><li><a href="/lanjz/React/Fiber.html" class="sidebar-link">Fiber</a></li><li><a href="/lanjz/React/时间切片.html" class="sidebar-link">时间切片</a></li><li><a href="/lanjz/React/Diff.html" class="sidebar-link">React16 Diff</a></li><li><a href="/lanjz/React/高阶组件.html" class="sidebar-link">memo</a></li><li><a href="/lanjz/React/React16新特性.html" class="sidebar-link">React16新特性</a></li><li><a href="/lanjz/React/Hook.html" aria-current="page" class="active sidebar-link">Hook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#类组件vs函数组件" class="sidebar-link">类组件VS函数组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#类组件" class="sidebar-link">类组件</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#函数组件" class="sidebar-link">函数组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#q-a" class="sidebar-link">Q&amp;A</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#为什么-usestate-要使用数组而不是对象" class="sidebar-link">为什么 useState 要使用数组而不是对象</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#react-hooks-解决了哪些问题" class="sidebar-link">React Hooks 解决了哪些问题</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#useeffect-与-uselayouteffect-的区别" class="sidebar-link">useEffect 与 useLayoutEffect 的区别</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#react-hooks在平时开发中需要注意的问题和原因" class="sidebar-link">React Hooks在平时开发中需要注意的问题和原因</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#react-hooks-和生命周期的关系" class="sidebar-link">React Hooks 和生命周期的关系？</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#usestate" class="sidebar-link">useState</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#手写usestate" class="sidebar-link">手写useState</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#源码解析" class="sidebar-link">源码解析</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#effect-hook" class="sidebar-link">Effect Hook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#清除effect" class="sidebar-link">清除Effect</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#只在特定条件下执行-effecthook" class="sidebar-link">只在特定条件下执行 effectHook</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#usememo" class="sidebar-link">useMemo</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#usecallback" class="sidebar-link">useCallback</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#usememo和usecallback的区别" class="sidebar-link">useMemo和useCallback的区别</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#useref" class="sidebar-link">useRef</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#保存dom" class="sidebar-link">保存dom</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#保存事件程序" class="sidebar-link">保存事件程序</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#存储以前的值" class="sidebar-link">存储以前的值</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#uselayouteffect" class="sidebar-link">useLayoutEffect</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#useimperativehandle" class="sidebar-link">useImperativeHandle</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#自定义hook" class="sidebar-link">自定义Hook</a></li><li class="sidebar-sub-header"><a href="/lanjz/React/Hook.html#hook使用规则" class="sidebar-link">Hook使用规则</a></li></ul></li><li><a href="/lanjz/React/性能优化.html" class="sidebar-link">虚拟化长列表</a></li><li><a href="/lanjz/React/React高级指引.html" class="sidebar-link">高级指引</a></li><li><a href="/lanjz/React/服务端渲染.html" class="sidebar-link">React SSR</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hook"><a href="#hook" class="header-anchor">#</a> Hook</h1> <p>Hook 是 React16 引入的新特性， 是 React 团队在 React 组件开发实践中，逐渐认知到的一个改进点，这背后其实涉及对类组件和函数组件两种组件形式的思考和侧重。</p> <h2 id="类组件vs函数组件"><a href="#类组件vs函数组件" class="header-anchor">#</a> 类组件VS函数组件</h2> <h3 id="类组件"><a href="#类组件" class="header-anchor">#</a> 类组件</h3> <p>所谓类组件，就是基于 ES6 Class 这种写法，通过继承 <code>React.Component</code> 得来的 React 组件。以下是一个类组件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DemoClass</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">changeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newText</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      text<span class="token operator">:</span> newText
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;demoClass&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeText<span class="token punctuation">}</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看出，React 类组件内部预置了相当多的“现成的东西”等着我们去调度/定制，<code>state</code> 和生命周期就是这些“现成东西”中的典型。要想得到这些东西，难度也不大，只需要继承一个 <code>React.Component</code> 即可。<br>
当然，这也是类组件的一个不便，它太繁杂了，对于解决许多问题来说，编写一个类组件实在是一个过于复杂的姿势。复杂的姿势必然带来高昂的理解成本，这也是我们所不想看到的。除此之外，由于开发者编写的逻辑在封装后是和组件粘在一起的，这就使得类组件内部的逻辑难以实现拆分和复用</p> <h3 id="函数组件"><a href="#函数组件" class="header-anchor">#</a> 函数组件</h3> <p>函数组件就是以函数的形态存在的 React 组件。早期并没有 React-Hooks，函数组件内部无法定义和维护 state，因此它还有一个别名叫“无状态组件”。以下是一个函数组件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">DemoFunction</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;demoFunction&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">函数组件接收的内容：[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>相比于类组件，函数组件肉眼可见的特质自然包括轻量、灵活、易于组织和维护、较低的学习成本等。</p> <p>通过对比，从形态上可以对两种组件做区分，它们之间的区别如下：</p> <ul><li><p>类组件需要继承<code>class</code>，函数组件不需要</p></li> <li><p>类组件可以访问生命周期方法，函数组件不能</p></li> <li><p>类组件中可以获取到实例化后的 <code>this</code>，并基于这个 <code>this</code> 做各种各样的事情，而函数组件不可以</p></li> <li><p>类组件中可以定义并维护状态 （state），而函数组件不可以</p></li></ul> <p>所以在 React-Hooks 出现之前，类组件的能力边界明显强于函数组件</p> <p>组件本身的定位就是函数，一个输入数据、输出 UI 的函数。作为开发者，我们编写的是声明式的代码，而 React 框架的主要工作，就是及时地把声明式的代码转换为命令式的 DOM 操作，把数据层面的描述映射到用户可见的 UI 变化中去。<br>
但函数组件比起类组件少了很多东西，比如生命周期、对 <code>state</code> 的管理等。这就给函数组件的使用带来了非常多的局限性，导致我们并不能使用函数这种形式，写出一个真正的全功能的组件。而 React-Hooks 的出现，就是为了帮助函数组件补齐这些（相对于类组件来说）缺失的能力。</p> <p>React-Hooks 是一套能够使函数组件更强大、更灵活的“钩子”。</p> <h2 id="q-a"><a href="#q-a" class="header-anchor">#</a> Q&amp;A</h2> <h3 id="为什么-usestate-要使用数组而不是对象"><a href="#为什么-usestate-要使用数组而不是对象" class="header-anchor">#</a> 为什么 useState 要使用数组而不是对象</h3> <p>useState 的用法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>数组的解构赋值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">]</span> <span class="token operator">=</span> foo<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>three<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 3</span>
</code></pre></div><p><strong>对象的解构赋值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">888</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&quot;xiaoxin&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 888</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// &quot;xiaoxin&quot;</span>
</code></pre></div><p>看完这两个例子，答案应该就出来了：</p> <ul><li><p>如果 useState 返回的是数组，那么使用者可以对数组中的元素命名，代码看起来也比较干净</p></li> <li><p>如果 useState 返回的是对象，在解构对象的时候必须要和 <code>useState</code> 内部实现返回的对象同名，想要使用多次的话，必须得设置别名才能使用返回值</p></li></ul> <p>下面来看看如果 useState 返回对象的情况：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一次使用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第二次使用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token operator">:</span> counter<span class="token punctuation">,</span> setState<span class="token operator">:</span> setCounter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 

</code></pre></div><p>这里可以看到，返回对象的使用方式还是挺麻烦的，更何况实际项目中会使用的更频繁。<br>
总结：<code>useState</code> 返回的是 <code>array</code> 而不是 <code>object</code> 的原因就是为了降低使用的复杂度，返回数组的话可以直接根据顺序解构，而返回对象的话要想使用多次就需要定义别名了</p> <h3 id="react-hooks-解决了哪些问题"><a href="#react-hooks-解决了哪些问题" class="header-anchor">#</a> React Hooks 解决了哪些问题</h3> <p>React Hooks 主要解决了以下问题：</p> <p><strong>在组件之间复用状态逻辑很难</strong></p> <p>React 没有提供将可复用性行为“附加”到组件的途径（例如，把组件连接到 <code>store</code> ）解决此类问题可以使用<code>render</code> <code>props</code> 和 高阶组件。但是这类方案需要重新组织组件结构，这可能会很麻烦，并且会使代码难以理解。由 <code>providers</code>，<code>consumers</code>，高阶组件，<code>render</code> <code>props</code> 等其他抽象层组成的组件会形成“嵌套地狱”。尽管可以在 DevTools 过滤掉它们，但这说明了一个更深层次的问题：React 需要为共享状态逻辑提供更好的原生途径。</p> <p>可以使用 Hook 从组件中提取状态逻辑，使得这些逻辑可以单独测试并复用。Hook 使我们在无需修改组件结构的情况下复用状态逻辑。 这使得在组件间或社区内共享 Hook 变得更便捷。</p> <p><strong>复杂组件变得难以理解</strong></p> <p>在组件中，每个生命周期常常包含一些不相关的逻辑。例如，组件常常在 <code>componentDidMount</code> 和 <code>componentDidUpdate</code> 中获取数据。但是，同一个 <code>componentDidMount</code> 中可能也包含很多其它的逻辑，如设置事件监听，而之后需在 <code>componentWillUnmount</code> 中清除。相互关联且需要对照修改的代码被进行了拆分，而完全不相关的代码却在同一个方法中组合在一起。</p> <p>为了解决这个问题，Hook 将组件中相互关联的部分拆分成更小的函数（比如设置订阅或请求数据），而并非强制按照生命周期划分。你还可以使用 <code>reducer</code> 来管理组件的内部状态，使其更加可预测。</p> <p><strong>难以理解的 class</strong></p> <p>除了代码复用和代码管理会遇到困难外，class 是学习 React 的一大屏障。我们必须去理解 JavaScript 中 <code>this</code> 的工作方式，这与其他语言存在巨大差异。还不能忘记绑定事件处理器。没有稳定的语法提案，这些代码非常冗余。</p> <p>从概念上讲，React 组件一直更像是函数。而 Hook 则拥抱了函数，同时也没有牺牲 React 的精神原则。Hook 提供了问题的解决方案，无需学习复杂的函数式或响应式编程技术</p> <h3 id="useeffect-与-uselayouteffect-的区别"><a href="#useeffect-与-uselayouteffect-的区别" class="header-anchor">#</a> useEffect 与 useLayoutEffect 的区别</h3> <p><strong>共同点</strong></p> <ul><li><p>运用效果： <code>useEffect</code> 与 <code>useLayoutEffect</code> 两者都是用于处理副作用，这些副作用包括改变 DOM、设置订阅、操作定时器等。在函数组件内部操作副作用是不被允许的，所以需要使用这两个函数去处理。</p></li> <li><p>使用方式：<code>useEffect</code> 与 <code>useLayoutEffect</code> 两者底层的函数签名是完全一致的，都是调用的 <code>mountEffectImpl</code> 方法，在使用上也没什么差异，基本可以直接替换。</p></li></ul> <p><strong>不同点</strong></p> <p>使用场景： <code>useEffect</code> 在 React 的渲染过程中是被异步调用的，用于绝大多数场景；而 <code>useLayoutEffect</code> 会在所有的 DOM 变更之后同步调用，主要用于处理 DOM 操作、调整样式、避免页面闪烁等问题。也正因为是同步处理，所以需要避免在 <code>useLayoutEffect</code> 做计算量较大的耗时任务从而造成阻塞。</p> <p>使用效果： <code>useEffect</code> 是按照顺序执行代码的，改变屏幕像素之后执行（先渲染，后改变DOM），当改变屏幕内容时可能会产生闪烁；<code>useLayoutEffect</code> 是改变屏幕像素之前就执行了（会推迟页面显示的事件，先改变DOM后渲染），不会产生闪烁。<code>useLayoutEffect</code> 总是比 <code>useEffect</code> 先执行。</p> <p>在未来的趋势上，两个 API 是会长期共存的，暂时没有删减合并的计划，需要开发者根据场景去自行选择。React 团队的建议非常实用，如果实在分不清，先用 <code>useEffect</code>，一般问题不大；如果页面有异常，再直接替换为 <code>useLayoutEffect</code> 即可</p> <h3 id="react-hooks在平时开发中需要注意的问题和原因"><a href="#react-hooks在平时开发中需要注意的问题和原因" class="header-anchor">#</a> React Hooks在平时开发中需要注意的问题和原因</h3> <p><strong>不要在循环，条件或嵌套函数中调用Hook，必须始终在 React函数的顶层使用Hook</strong></p> <p>这是因为 React 需要利用调用顺序来正确更新相应的状态，以及调用相应的钩子函数。一旦在循环或条件分支语句中调用 Hook，就容易导致调用顺序的不一致性，从而产生难以预料到的后果</p> <p><strong>使用useState时候，使用push，pop，splice等直接更改数组对象的坑</strong></p> <p>使用push直接更改数组无法获取到新值，应该采用析构方式，但是在class里面不会有这个问题。代码示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Indicatorfilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span>setNums<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里坑是直接采用push去更新num</span>
    <span class="token comment">// setNums(num)是无法更新num的</span>
    <span class="token comment">// 必须使用num = [...num ,1]</span>
    num<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// num = [...num ,1]</span>
    <span class="token function">setNums</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'filter'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>test<span class="token punctuation">}</span><span class="token operator">&gt;</span>测试<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>num<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Indicatorfilter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>any<span class="token punctuation">,</span>any<span class="token operator">&gt;</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span>any</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
          nums<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// class采用同样的方式是没有问题的</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>nums<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          nums<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>nums
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>nums<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
      <span class="token keyword">return</span><span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>test<span class="token punctuation">}</span><span class="token operator">&gt;</span>测试<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                      <span class="token punctuation">{</span>nums<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token operator">:</span>any<span class="token punctuation">,</span>index<span class="token operator">:</span>number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                          <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="react-hooks-和生命周期的关系"><a href="#react-hooks-和生命周期的关系" class="header-anchor">#</a> React Hooks 和生命周期的关系？</h3> <p>函数组件 的本质是函数，没有 <code>state</code> 的概念的，因此不存在生命周期一说，仅仅是一个 <code>render</code> 函数而已。但是引入 Hooks 之后就变得不同了，它能让组件在不使用 <code>class</code> 的情况下拥有 <code>state</code>，所以就有了生命周期的概念，所谓的生命周期其实就是 <code>useState</code>、 <code>useEffect()</code> 和 <code>useLayoutEffect()</code></p> <p>即：Hooks 组件（使用了Hooks的函数组件）有生命周期，而函数组件（未使用Hooks的函数组件）是没有生命周期的</p> <p>下面是具体的 class 与 Hooks 的生命周期对应关系：</p> <p><strong>constructor</strong></p> <p>函数组件不需要构造函数，可以通过调用 <strong>useState 来初始化 state</strong></p> <p><code>const [num, UpdateNum] = useState(0)</code></p> <p><strong><a href="https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromprops" target="_blank" rel="noopener noreferrer">getDerivedStateFromProps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p>一般情况下，我们不需要使用它，可以在渲染过程中更新 <code>state</code>，以达到实现 <code>getDerivedStateFromProps</code> 的目的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ScrollView</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>row<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>isScrollingDown<span class="token punctuation">,</span> setIsScrollingDown<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>prevRow<span class="token punctuation">,</span> setPrevRow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">!==</span> prevRow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Row 自上次渲染以来发生过改变。更新 isScrollingDown。</span>
    <span class="token function">setIsScrollingDown</span><span class="token punctuation">(</span>prevRow <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> row <span class="token operator">&gt;</span> prevRow<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setPrevRow</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Scrolling down: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isScrollingDown<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>shouldComponentUpdate</strong></p> <p><code>shouldComponentUpdate(nextProps, nextState)</code></p> <p>根据 <code>shouldComponentUpdate()</code> 的返回值，判断 React 组件的输出是否受当前 <code>state</code> 或 <code>props</code> 更改的影响。默认行为是 <code>state</code> 每次发生变化组件都会重新渲染</p> <p>可以用 <strong>React.memo</strong> 包裹一个组件来对它的 <code>props</code> 进行浅比较</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Button <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// 具体的组件});</span>
</code></pre></div><p>注意：<code>React.memo 等效于</code> <code>PureComponent</code>，它只浅比较 <code>props</code></p> <p><strong>componentWillUnmount</strong></p> <p>相当于 <code>useEffect</code> 里面返回的 <code>cleanup</code> 函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// componentDidMount/componentWillUnmount</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 需要在 componentDidMount 执行的内容</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要在 componentWillUnmount 执行的内容      </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>componentDidCatch and getDerivedStateFromError：目前还没有这些方法的 Hook 等价写法</strong></p> <h2 id="usestate"><a href="#usestate" class="header-anchor">#</a> useState</h2> <p>使用官方的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明一个叫 &quot;count&quot; 的 state 变量</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面使用Hook例子 <code>const [count, setCount] = useState(0)</code> 包含以下信息：</p> <ul><li><p>声明一个叫 <code>count</code> 的 <code>state</code> 变量</p></li> <li><p>这个 <code>count</code> 的初始值是 <code>0</code></p></li> <li><p>使用 <code>setCount</code> 方法进行修改这个 <code>count</code> 的值</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>更新 <code>state</code> 变量的方法，并不会像 <code>this.setState</code> 一样，合并 <code>state</code> 。而是替换 <code>state</code> 变量</p></div> <h3 id="手写usestate"><a href="#手写usestate" class="header-anchor">#</a> 手写useState</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> lastState
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastState <span class="token operator">=</span> lastState <span class="token operator">||</span> initState<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lastState <span class="token operator">=</span> newState
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>lastState<span class="token punctuation">,</span>setState<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>button
                onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&gt;</span>
                增加
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 新增方法</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>如代码所示，我们自己创建了一个 <code>useState</code> 方法</p> <ul><li><p>如果是第一次使用，则取 <code>initState</code> 的值，否则就取上一次的值 <code>laststate</code></p></li> <li><p>内部创建了一个 <code>setState</code> 方法，该方法用于更新 <code>state</code> 的值和触发 <code>render</code> 更新</p></li> <li><p>最后返回一个 <code>lastSate</code> 属性和 <code>setState</code> 方法</p></li></ul> <p>这里只是用了一个 <code>useState</code>，要是我们使用了很多个呢？难道要声明很多个全局变量吗？这显然是不行的，所以，我们可以设计一个全局数组来保存这些 <code>state</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> lastState <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> stateIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastState<span class="token punctuation">[</span>stateIndex<span class="token punctuation">]</span> <span class="token operator">=</span> lastState<span class="token punctuation">[</span>stateIndex<span class="token punctuation">]</span> <span class="token operator">||</span> initState<span class="token punctuation">;</span>
    <span class="token keyword">const</span> currentIndex <span class="token operator">=</span> stateIndex
    <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lastState<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> newState
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>lastState<span class="token punctuation">[</span>stateIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span>setState<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里的 <code>currentIndex</code> 是利用了闭包的思想，将某个 <code>state</code> 相应的 <code>index</code> 记录下来了</p> <h3 id="源码解析"><a href="#源码解析" class="header-anchor">#</a> 源码解析</h3> <p>首先看下 <code>useState</code> 怎么定义的：</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// useState</span>
  <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> dispatcher <span class="token operator">=</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dispatcher<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">resolveDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> dispatcher <span class="token operator">=</span> ReactCurrentDispatcher<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
    <span class="token keyword">return</span> dispatcher<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>从上面代码发现 <code>useStata(initialState)</code> = <code>ReactCurrentDispatcher.current.userSata(initialState)</code>，所以接下来就是找找 <code>ReactCurrentDispatcher.current</code> 是什么东西</p> <p>看下执行到 <code>useState</code> 方法时的执行栈</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>于是在 <code>renderWithHooks</code> 方法发现了这么几行代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> current<span class="token punctuation">.</span>memoizedState <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 更新渲染</span>
    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> HooksDispatcherOnUpdateInDEV<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hookTypesDev <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 忽略</span>
    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> HooksDispatcherOnMountWithHookTypesInDEV<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 首次渲染</span>
    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> HooksDispatcherOnMountInDEV<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HooksDispatcherOnUpdateInDEV</code>、<code>HooksDispatcherOnMountWithHookTypesInDEV</code>、 <code>HooksDispatcherOnMountInDEV</code> 是长得差不多的对象，以 <code>HooksDispatcherOnMountInDEV</code> 为例：</p> <div class="language-js extra-class"><pre class="language-js"><code>    HooksDispatcherOnMountInDEV <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">readContext</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useCallback</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useContext</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useEffect</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useImperativeHandle</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useLayoutEffect</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useMemo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useReducer</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useRef</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useState</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useDebugValue</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useResponder</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useDeferredValue</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useTransition</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> observedBits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>三个对象的 <code>key</code> 是一样的，不同的是具体方法的实现，比如 <code>HooksDispatcherOnMountInDEV.useState</code> 内容为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">useState</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentHookNameInDev <span class="token operator">=</span> <span class="token string">'useState'</span><span class="token punctuation">;</span>
  <span class="token function">mountHookTypesDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> prevDispatcher <span class="token operator">=</span> ReactCurrentDispatcher<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> InvalidNestedHooksDispatcherOnMountInDEV<span class="token punctuation">;</span>
  
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">mountState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> prevDispatcher<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HooksDispatcherOnMountWithHookTypesInDEV.useState</code></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function-variable function">useState</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentHookNameInDev <span class="token operator">=</span> <span class="token string">'useState'</span><span class="token punctuation">;</span>
    <span class="token function">warnInvalidHookAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateHookTypesDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> prevDispatcher <span class="token operator">=</span> ReactCurrentDispatcher<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
    ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> InvalidNestedHooksDispatcherOnUpdateInDEV<span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">updateState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span> prevDispatcher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="首次渲染"><a href="#首次渲染" class="header-anchor">#</a> 首次渲染</h4> <p>先看首次渲染时做的事情。在执行 <code>renderWithHooks(current, workInProgress, Component, props, secondArg, nextRenderExpirationTime)</code> 方法时，首次渲染时 <code>current=null</code> 做的事情， <code>ReactCurrentDispatcher.current</code> 将赋值 <code>HooksDispatcherOnMountInDEV</code>，之后会执行 <code>var children = Component(props, secondArg)</code>， 这个 <code>Component</code> 就是我们的函数组件，在执行函数组件的过程中将会执行 <code>useState()</code> 方法，此时的 <code>useState()</code> 执行代码为：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">mountState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> initialState <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      initialState <span class="token operator">=</span> <span class="token function">initialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> initialState<span class="token punctuation">;</span>
    <span class="token keyword">var</span> queue <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 更新队列</span>
      pending<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 待更新</span>
      dispatch<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 更新函数</span>
      lastRenderedReducer<span class="token operator">:</span> basicStateReducer<span class="token punctuation">,</span> <span class="token comment">// 当更新 state 时会通过这个方法得到最新的state</span>
      lastRenderedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span> <span class="token comment">// 最后一次的state</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// dispatchAction负责更新 state 的函数</span>
    <span class="token keyword">var</span> dispatch <span class="token operator">=</span> queue<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token function">dispatchAction</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> currentlyRenderingFiber$<span class="token number">1</span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>mountWorkInProgressHook</code> 方法定义如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> hook <span class="token operator">=</span> <span class="token punctuation">{</span>
      memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 不同的hook保存的不同值， useState保存的是state； useEffect保存的是effect对象</span>
      baseState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 最新的值</span>
      baseQueue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 最新的队列</span>
      queue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 待更新队列</span>
      next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 指向下一个hook对象</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
   
    <span class="token comment">// react hooks的数据结构是链表的方式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressHook <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 函数内的第一个hooks就会走到这里</span>
      currentlyRenderingFiber$<span class="token number">1.</span>memoizedState <span class="token operator">=</span> workInProgressHook <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 接下来每个hook都会被添加到链接到未尾</span>
      workInProgressHook <span class="token operator">=</span> workInProgressHook<span class="token punctuation">.</span>next <span class="token operator">=</span> hook<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> workInProgressHook<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>每次 <code>useState</code> 都会执行一个 <code>mountState</code> 函数，做以下事情：</p> <ol><li><p>都会调用 <code>mountWorkInProgressHook</code> 方法来创建一个 hook 对象</p></li> <li><p>如果首次创建 hook 则将当前 hook 对象保存到 <code>currentlyRenderingFiber$1.memoizedState</code> 中，<code>currentlyRenderingFiber$1</code> 代表即将更新的 Fiber 节点；如果非首次创建 hook，则保存到上一 hook的 <code>next</code> 属性中，<strong>这样多个 hook 就形成了一个链表的结构</strong></p></li> <li><p>同时 hook 对象保存 <code>initialState</code> (useState 的值) 到 <code>hook.memoizedState = hook.baseState = initialState</code></p></li> <li><p>给 <code>hook.queue</code> 赋值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> queue <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 更新队列</span>
  pending<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 待更新</span>
  dispatch<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 更新函数</span>
  lastRenderedReducer<span class="token operator">:</span> basicStateReducer<span class="token punctuation">,</span> <span class="token comment">// 当更新 state 时会通过这个方法得到最新的state</span>
  lastRenderedState<span class="token operator">:</span> initialState<span class="token punctuation">,</span> <span class="token comment">// 最后一次的保存的state（不是正在更新的 state）</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>最后创建更新 <code>state</code> 的函数 <code>dispatch</code></p> <p><code>var dispatch = queue.dispatch = dispatchAction.bind(null, currentlyRenderingFiber$1, queue);</code></p> <p><code>dispatchAction</code> 有一些和 <code>fiber</code> 相关的逻辑。但在这里关于 hooks 的就是会创建一个 <code>update</code> 对象然后添加到 <code>queue</code> 链表上面，然后会判断当前是否处于渲染阶段，不是的话就会去获取上一个 <code>state</code> 和当前的 <code>state</code> 进行浅对比，相等就会 <code>return</code> 不会执行更新，不相等就会执行 <code>scheduleUpdateOnFiber</code> 进行更新</p> <h4 id="dispatch阶段"><a href="#dispatch阶段" class="header-anchor">#</a> dispatch阶段</h4> <p>当执行 <code>hook</code> 更新的时候，会执行上面所说的 <code>dispatchAction(fiber, queue, action)</code> 方法，先看下参数</p> <ul><li><p>fiber：当前 Fiber 节点</p></li> <li><p>queue：旧的 hook state 的信息</p></li> <li><p>action：新值</p></li></ul> <p>函组内会使用 <code>action</code> 创建一个 <code>update</code> 对象，执行以下代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> pending <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>pending <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This is the first update. Create a circular list.</span>
  update<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  update<span class="token punctuation">.</span>next <span class="token operator">=</span> pending<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
  pending<span class="token punctuation">.</span>next <span class="token operator">=</span> update<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> update<span class="token punctuation">;</span>
</code></pre></div><p>这段代码看例子来理解,假设我们有以下代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span>
<span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span>
<span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'third'</span><span class="token punctuation">)</span>
</code></pre></div><p>在第一次 <code>setData</code> 后， hooks 的结构如下图：</p> <p><img src="/lanjz/assets/img/queue_1.861202ec.png" alt=""></p> <p>在第二次 <code>setData</code> 后， hooks的结构如下图：</p> <p><img src="/lanjz/assets/img/queue_2.689bd362.png" alt=""></p> <p>在第三次 <code>setData</code> 后， hooks的结构如下图：</p> <p><img src="/lanjz/assets/img/queue_3.54ab4511.png" alt=""></p> <p>然后将新的状态和旧的状态进行对比，相同则退出重渲染，不同则执行 <code>scheduleWork(fiber, expirationTime)</code> 开启重渲染任务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> lastRenderedReducer <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedReducer
<span class="token comment">// ...省略</span>
<span class="token keyword">var</span> currentState <span class="token operator">=</span> queue<span class="token punctuation">.</span>lastRenderedState<span class="token punctuation">;</span> <span class="token comment">// 取之前的 state</span>
<span class="token keyword">var</span> eagerState <span class="token operator">=</span> <span class="token function">lastRenderedReducer</span><span class="token punctuation">(</span>currentState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token comment">// 取当前要更新的 state</span>
update<span class="token punctuation">.</span>eagerState <span class="token operator">=</span> eagerState<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is</span><span class="token punctuation">(</span>eagerState<span class="token punctuation">,</span> currentState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...省略</span>
<span class="token function">scheduleWork</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> expirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>重渲染时  <code>ReactCurrentDispatcher.current</code> 将等于 <code>HooksDispatcherOnMountWithHookTypesInDEV</code>，更新阶段赋值 <code>HooksDispatcherOnMountWithHookTypesInDEV.useState</code> 实际上调用的是 <code>updateState</code></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">updateState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">updateReducer</span><span class="token punctuation">(</span>basicStateReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">updateReducer</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//这里是获取当前的hooks，每一次函数更新的时候都会执行到hook，这个方法会保证每次更新状态不丢失</span>
    <span class="token keyword">var</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> queue <span class="token operator">=</span> hook<span class="token punctuation">.</span>queue<span class="token punctuation">;</span>
  <span class="token comment">// 调用lastRenderedReducer可获取到state</span>
    queue<span class="token punctuation">.</span>lastRenderedReducer <span class="token operator">=</span> reducer<span class="token punctuation">;</span>
    <span class="token comment">// 拿到当前的函数内的hook</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> currentHook<span class="token punctuation">;</span> 

    <span class="token keyword">var</span> baseQueue <span class="token operator">=</span> current<span class="token punctuation">.</span>baseQueue<span class="token punctuation">;</span> <span class="token comment">// The last pending update that hasn't been processed yet.</span>
    <span class="token comment">// 要更新的 hook 状态</span>
    <span class="token keyword">var</span> pendingQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里主要是把baseQueue和pendingQueue做了交换，然后赋值到current上。</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>baseQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Merge the pending queue and the base queue.</span>
        <span class="token keyword">var</span> baseFirst <span class="token operator">=</span> baseQueue<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token keyword">var</span> pendingFirst <span class="token operator">=</span> pendingQueue<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        baseQueue<span class="token punctuation">.</span>next <span class="token operator">=</span> pendingFirst<span class="token punctuation">;</span>
        pendingQueue<span class="token punctuation">.</span>next <span class="token operator">=</span> baseFirst<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      current<span class="token punctuation">.</span>baseQueue <span class="token operator">=</span> baseQueue <span class="token operator">=</span> pendingQueue<span class="token punctuation">;</span>
      queue<span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>baseQueue <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// We have a queue to process.</span>
      <span class="token keyword">var</span> first <span class="token operator">=</span> baseQueue<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
      <span class="token keyword">var</span> newState <span class="token operator">=</span> current<span class="token punctuation">.</span>baseState<span class="token punctuation">;</span>
      <span class="token keyword">var</span> newBaseState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> newBaseQueueFirst <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> newBaseQueueLast <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> update <span class="token operator">=</span> first<span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>updateExpirationTime <span class="token operator">&lt;</span> renderExpirationTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 忽略 ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 忽略 ...</span>
          <span class="token comment">// 处理更新</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span>eagerReducer <span class="token operator">===</span> reducer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 如果更新被提前处理了且reducer跟当前reducer匹配，可以复用eagerState</span>
            newState <span class="token operator">=</span> update<span class="token punctuation">.</span>eagerState<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 循环调用reducer</span>
            <span class="token keyword">var</span> action <span class="token operator">=</span> update<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
            newState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        update <span class="token operator">=</span> update<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>update <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> update <span class="token operator">!==</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>newBaseQueueLast <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newBaseState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        newBaseQueueLast<span class="token punctuation">.</span>next <span class="token operator">=</span> newBaseQueueFirst<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
       <span class="token comment">// 只有在前后state变了才会标记</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">objectIs</span><span class="token punctuation">(</span>newState<span class="token punctuation">,</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markWorkInProgressReceivedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
      hook<span class="token punctuation">.</span>baseState <span class="token operator">=</span> newBaseState<span class="token punctuation">;</span>
      hook<span class="token punctuation">.</span>baseQueue <span class="token operator">=</span> newBaseQueueLast<span class="token punctuation">;</span>
      queue<span class="token punctuation">.</span>lastRenderedState <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> dispatch <span class="token operator">=</span> queue<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>首先获取了当前正在工作的hook，然后把 <code>queue.pending</code> 合并到 <code>baseQueue</code>，这样做其实是有可能新的更新还没有处理，一次更新中可能会有多个 <code>setName</code>，所以需要把 <code>queue.pending</code> 中的 <code>update</code> 合并到 <code>baseQueue</code> 内。接着会通过循环遍历链表，执行每一次更新去得到最新的 <code>state</code> ，把 hook 对象的值更新到最新。然后返回最新的 <code>memoizedState</code> 和 <code>dispatch</code> 。这里的 <code>dispatch</code> 其实就是 <code>dispatchAction</code>，<code>dispatchAction</code> 主要是负责更新界面的函数</p> <p><a href="https://cloud.tencent.com/developer/article/1784501?from=article.detail.1843869" target="_blank" rel="noopener noreferrer">react hooks源码分析：useState<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><img src="/lanjz/assets/img/hook.e09a0a89.jpeg" alt=""></p> <p>来看个例子，看看为什么不能在条件语句中申明 hook</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Damon'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">!==</span> <span class="token number">23</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>当这个App组件被渲染的时候，<code>workInProgressHook.memoizedState</code> 中会以链表的形式来保存这些 hook</p> <p><img src="/lanjz/assets/img/useState_2.9ae67c4a.png" alt=""></p> <p>如果在条件语句中申明 hook，那么在更新阶段链表结构会被破坏，Fiber树上缓存的 hooks信息就会和当前的 <code>workInProgressHook</code> 不一致，不一致的情况下读取数据可能就会出现异常</p> <h2 id="effect-hook"><a href="#effect-hook" class="header-anchor">#</a> Effect Hook</h2> <p>Effect Hook 可以让你在函数组件中执行副作用操作</p> <blockquote><p>数据获取，设置订阅以及手动更改 React 组件中的 DOM 都属于副作用</p></blockquote> <p>官方例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Click me
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>useEffect</code> 的作用：</p> <ul><li><p>告诉 React 组件需要在渲染后执行某些操作</p></li> <li><p>并且在执行 DOM 更新之后调用它</p></li></ul> <p>从这里可以看出，<code>useEffect</code> 的作用相当同时定义了 <code>componentDidMount</code> 和 <code>conponetDidUpdate</code> 两个生命周期函数，例子中我们点击按钮增加计数
的同时，页面的 <code>title</code> 也会发生变化，说明每次都会执行 <code>useEffect</code> 中的方法</p> <h3 id="清除effect"><a href="#清除effect" class="header-anchor">#</a> 清除Effect</h3> <p>即希望有 <code>componentWillUnMount</code> 的功能，在Hook中的实现方式是在 <code>useEffect</code> 方法中添置一个 <code>return function(){}</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 组件渲染完成时执行</span>
        <span class="token comment">// do something</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unMount'</span><span class="token punctuation">)</span> <span class="token comment">// // 组件将御载时执行</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="只在特定条件下执行-effecthook"><a href="#只在特定条件下执行-effecthook" class="header-anchor">#</a> 只在特定条件下执行 effectHook</h3> <p>在某些情况下，每次渲染后都执行清理或者执行 <code>effect</code> 可能会导致性能问题, 在 class 组件中，我们可以使用 <code>componentDidMount</code> 方法定义组件在
渲染完成时要做的事情，使用 <code>componentDidUpdate</code> 方法控制组件更新时要做的事情</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">.</span>count <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <code>useEffect</code> 中，通过传入第二个参数来实现上面的功能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 仅在 count 更改时更新</span>
</code></pre></div><p>第二个参数是个数组，数组中元素可以是 <code>props</code> 或 <code>state</code>,添加这个参数后表示当前这个 <code>effect</code> 只在这个数组中的元素发生变化后才执行，
例子中则是 <code>count</code> 发生变化后才会执行 <code>effect</code></p> <p>第二个参数也可以是 <code>props</code> 中的属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 仅在 count 更改时更新</span>
</code></pre></div><p>那如何实现 <code>componentDidMount</code> 钩子只在组件渲染时执行一次的功能？ 只需要把第二个参数设为一个空数组就可以了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 只在组件渲染时执行一次</span>
</code></pre></div><h2 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h2> <p><code>const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b]);</code></p> <p>返回一个 <code>memoized</code> 值</p> <p>把“创建”函数和依赖项数组作为参数传入 <code>useMemo</code>，它仅会在某个依赖项改变时才重新计算 <code>memoized</code> 值。
这种优化有助于避免在每次渲染时都进行高开销的计算</p> <p>例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明一个叫 &quot;count&quot; 的 state 变量</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doSomething'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                Click me
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的例子中，每次点击更新 <code>count</code> 的时候，都会触发组件渲染，然后 <code>doSomething</code> 每次都会执行，如果这个函数有非常耗时的计算，那无疑会影响组件
性能，接下来我们使用<code>useMemo</code>优化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明一个叫 &quot;count&quot; 的 state 变量</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doSomething'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token string">'abc'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> abc <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times <span class="token punctuation">{</span>abc<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                Click me
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 <code>useMemo</code> 包装 <code>doSomething</code> 方法，第二参数是一个数组，存放的是当前 <code>doSomething</code> 方法依赖的属性，上面传入的空数组，意味着 <code>doSomething</code>
只会在组件首次渲染的时候才会执行。</p> <p>如果我们改为：<code>const abc = useMemo(() =&gt; doSomething(), [count])</code>,那么只在 <code>count</code> 改变时，<code>doSomething</code> 才会执行</p> <h2 id="usecallback"><a href="#usecallback" class="header-anchor">#</a> useCallback</h2> <p>由于React的更新机制是当组件的 <code>state</code> 更新时，当前组件以及子组件都会重新渲染，即使这些子组件的 <code>props</code> 没有更新也会渲染。<code>React.memo</code>
的作用就是包装子组件，这样只有当依赖的 <code>props</code> 更新的时候才会去重新渲染子组件, 如果 <code>props</code> 包含 <code>useState</code> 或 <code>useContext</code> 的 Hook,
当 <code>context</code> 发生变化时，它仍会重新渲染</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ChildrenComponent <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cab <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ChildrenComponent rending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ChildrenComponent<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明一个叫 &quot;count&quot; 的 state 变量</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">callBack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                Click me
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ChildrenComponent cab<span class="token operator">=</span><span class="token punctuation">{</span>callBack<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ChildrenComponent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上面例子中 <code>ChildrenComponent</code> 每次都会重新渲染，是 <code>memo</code> 不起作用嘛？并不是，当子组件用 <code>memo</code> 包装之后，这个子组件只有在 <code>props</code>
更新之后才会渲染，而上面 <code>const callBack = () =&gt; setCount(100)</code> ，在当前组件更新后都会重新赋值一个方法，赋值后地址就变了，那么
子组件自然会被重新渲染</p> <p>使用 <code>useCallback</code> 解决这个问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ChildrenComponent <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> cab <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ChildrenComponent rending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ChildrenComponent<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明一个叫 &quot;count&quot; 的 state 变量</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> callBack <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                Click me
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ChildrenComponent cab<span class="token operator">=</span><span class="token punctuation">{</span>callBack<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ChildrenComponent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把内联回调函数及依赖项数组作为参数传入 <code>useCallback</code>，它将返回该回调函数的 <code>memoized</code> 版本，该回调函数仅在某个依赖项改变时才会更新</p> <h2 id="usememo和usecallback的区别"><a href="#usememo和usecallback的区别" class="header-anchor">#</a> useMemo和useCallback的区别</h2> <p><code>useMemo</code> 和 <code>useCallback</code> 接收的参数都是一样，都是在其依赖项发生变化后才执行，都是返回缓存的值，区别在于 <code>useMemo</code>  返回的是函数运行的结果，
<code>useCallback</code> 返回的是函数</p> <p><a href="https://jancat.github.io/post/2019/translation-usememo-and-usecallback/" target="_blank" rel="noopener noreferrer">什么时候使用 useMemo 和 useCallback<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="useref"><a href="#useref" class="header-anchor">#</a> useRef</h2> <p><code>const refContainer = useRef(initialValue);</code></p> <p><code>useRef</code> 返回一个可变的 <code>ref 对象</code>，其 <code>.current</code> 属性被初始化为传入的参数（initialValue）。<strong>返回的 <code>ref</code> 对象在组件的整个生命周期内保持不变</strong></p> <p>它的作用总结如下：</p> <h3 id="保存dom"><a href="#保存dom" class="header-anchor">#</a> 保存dom</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inputEl <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inputEl'</span><span class="token punctuation">,</span> inputEl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>inputEl<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            你个弟弟
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="保存事件程序"><a href="#保存事件程序" class="header-anchor">#</a> 保存事件程序</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">l</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handleClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>start<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClear<span class="token punctuation">}</span><span class="token operator">&gt;</span>clear<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="存储以前的值"><a href="#存储以前的值" class="header-anchor">#</a> 存储以前的值</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;ajanuw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span>current <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prevName <span class="token operator">=</span> t<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>prevName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="uselayouteffect"><a href="#uselayouteffect" class="header-anchor">#</a> useLayoutEffect</h2> <p>作用与 <code>useEffect</code> 相同类似，可以使用它来读取 DOM 布局并同步触发重渲染。
在浏览器执行绘制之前，<code>useLayoutEffect</code> 内部的更新计划将被同步刷新</p> <p>**<code>useLayoutEffect</code>和<code>useEffect</code>**的区别</p> <p>在区分之前，我们先了解React 组件的更新过程:</p> <ol><li><p>初始化,变更<code>state</code> 或者 <code>props</code> 时都会触发组件更新</p></li> <li><p>当前组件就会调用 <code>render</code> 函数</p></li> <li><p>React 会执行 <code>useLayoutEffect</code>，直到该函数逻辑执行完毕</p></li> <li><p>虚拟<code>dom元素</code>真实地更新到屏幕上</p></li> <li><p>执行 <code>useEffect</code> 表示更新完毕</p></li></ol> <p>可以看到 <code>useEffect</code> 是在Dom完成渲染之后执行，<code>useLayoutEffect</code> 则在Dom最终渲染前执行</p> <h2 id="useimperativehandle"><a href="#useimperativehandle" class="header-anchor">#</a> useImperativeHandle</h2> <p><code>useImperativeHandle(ref, createHandle, [deps])</code></p> <p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时自定义暴露给父组件的实例值。在大多数情况下，应当避免使用 <code>ref</code> 这样的命令式代码。
<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">FancyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">focus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">...</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
FancyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>FancyInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在本例中，渲染 <code>&lt;FancyInput ref={inputRef} /&gt;</code> 的父组件可以调用 <code>inputRef.current.focus()</code></p> <h2 id="自定义hook"><a href="#自定义hook" class="header-anchor">#</a> 自定义Hook</h2> <p>自定义Hook就是将<code>useState</code>和<code>useEffect</code>放在一个公共函数中，这个函数就成了一个<code>Hook</code>，这样就可以让多个组件使用这个<code>Hook</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token parameter">init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// setCount(count+10)</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> count
<span class="token punctuation">}</span>

</code></pre></div><p>使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useCount <span class="token keyword">from</span> <span class="token string">'./helper/hook/useCount'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> isOnline <span class="token operator">=</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>自定义Hook<span class="token operator">:</span><span class="token punctuation">{</span>isOnline<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p><strong>自定义hook的注意点</strong></p> <ul><li><p>自定义 Hook 必须以 “use” 开头</p></li> <li><p>在两个组件中使用相同的 Hook 不会共享 state</p></li> <li><p>组合更新时，自定义 Hook中的<code>effect</code>的执行规则也是一样的，我们可以利用这种做 hook 通信</p> <div class="language- extra-class"><pre class="language-text"><code>// 自定义hook
import { useState, useEffect } from 'react';

export default function useCount(init) {
    const [count, setCount] = useState(init);
    useEffect(function () {
        console.log(init) // 接收新的init
        return
    })
    return count
}
-------------------------------------------------
//
 import React, { useState, useEffect } from 'react';
 import logo from './logo.svg';
 import useCount from './helper/hook/useCount'
 import './App.css';
 import Inbox from './pages/Inbox'
 
 function App() {
     // 声明一个叫 &quot;count&quot; 的 state 变量
     const [count, setCount] = useState(0);
     const count2 = useCount(count)
     function f() {
         setCount(count + 1)
     }
     return (
         &lt;div&gt;
             &lt;p&gt;You clicked {count} times&lt;/p&gt;
             &lt;button onClick={f}&gt;
                 Click me
             &lt;/button&gt;
             {
                 count%2 === 0 &amp;&amp; &lt;Inbox&gt;&lt;/Inbox&gt;
             }
         &lt;/div&gt;
     );
 }
 
 export default App;


</code></pre></div></li></ul> <h2 id="hook使用规则"><a href="#hook使用规则" class="header-anchor">#</a> Hook使用规则</h2> <ul><li><p>不要在循环，条件或嵌套函数中调用 Hook， 确保总是在你的 React 函数的最顶层调用他们。</p></li> <li><p>只在 React 函数中调用 Hook</p> <ul><li><p>不要在循环，条件或嵌套函数中调用 Hook， 确保总是在你的 React 函数的最顶层调用他们。</p></li> <li><p>在自定义 Hook 中调用其他 Hook</p></li></ul></li></ul> <p>https://juejin.cn/post/6940942549305524238#heading-22</p> <p>https://github.com/7kms/react-illustration-series</p> <p><a href="https://jancat.github.io/post/2019/translation-usememo-and-usecallback/" target="_blank" rel="noopener noreferrer">什么时候使用 useMemo 和 useCallback<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6844903799119675406" target="_blank" rel="noopener noreferrer">useState源码浅析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>https://developer.aliyun.com/article/784027</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lanjz/React/React16新特性.html" class="prev">
        React16新特性
      </a></span> <span class="next"><a href="/lanjz/React/性能优化.html">
        虚拟化长列表
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.b7c2e9f6.js" defer></script><script src="/lanjz/assets/js/2.f4878c9a.js" defer></script><script src="/lanjz/assets/js/8.06e66aa1.js" defer></script>
  </body>
</html>
