<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Generator | 前端知识体系</title><meta name="description" content="前端总结与记录">
    <link rel="preload" href="/lanjz/assets/style-W1-NA_tl.css" as="style"><link rel="stylesheet" href="/lanjz/assets/style-W1-NA_tl.css">
    <link rel="modulepreload" href="/lanjz/assets/app-tEWqIxV0.js"><link rel="modulepreload" href="/lanjz/assets/Generator.html-2fibjqFM.js"><link rel="modulepreload" href="/lanjz/assets/Generator.html-sFAMZkMt.js">
    <link rel="prefetch" href="/lanjz/assets/index.html-OKLsYfUs.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-8X6Gn_dR.js" as="script"><link rel="prefetch" href="/lanjz/assets/剑指offer二.html-WuuHcca7.js" as="script"><link rel="prefetch" href="/lanjz/assets/动态规划.html-FYOwi7jV.js" as="script"><link rel="prefetch" href="/lanjz/assets/回文串.html-sZj8fzR7.js" as="script"><link rel="prefetch" href="/lanjz/assets/回溯.html-OTzwVnNu.js" as="script"><link rel="prefetch" href="/lanjz/assets/字节前端.html-aJnl2BXk.js" as="script"><link rel="prefetch" href="/lanjz/assets/小题.html-oAPKhl5T.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间_空间复杂度.html-cpw6PHgf.js" as="script"><link rel="prefetch" href="/lanjz/assets/树.html-DlNaOEyi.js" as="script"><link rel="prefetch" href="/lanjz/assets/简单排序.html-qj6rvziN.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML渲染过程.html-MqCTtizO.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-KcJopvR7.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器中的进程与线程.html-0NWg9RK7.js" as="script"><link rel="prefetch" href="/lanjz/assets/BFC和IFC.html-gDZHazSe.js" as="script"><link rel="prefetch" href="/lanjz/assets/CSS3新特性.html-hCtlmmjp.js" as="script"><link rel="prefetch" href="/lanjz/assets/Flex.html-VPqo4IfP.js" as="script"><link rel="prefetch" href="/lanjz/assets/Image.html-EloIwh2U.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-m2vKCOFv.js" as="script"><link rel="prefetch" href="/lanjz/assets/多列.html-uE8D5pZx.js" as="script"><link rel="prefetch" href="/lanjz/assets/换肤.html-or6uFXIc.js" as="script"><link rel="prefetch" href="/lanjz/assets/样式实现.html-Yq5giY9c.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端一像素问题.html-upOE3TVC.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端适配方案.html-lzOh90xZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/适配iponeX.html-weYCOmVL.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class.html-g_twp1QW.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class继承.html-DLlKsXiw.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generater应用.html-TcxK0KnX.js" as="script"><link rel="prefetch" href="/lanjz/assets/Iterator.html-ESy8vP6R.js" as="script"><link rel="prefetch" href="/lanjz/assets/Map和WeakMap.html-sx3TQeS-.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module.html-CpKTE6ck.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module的加载实现.html-EK6MF-yu.js" as="script"><link rel="prefetch" href="/lanjz/assets/Promise.html-8eXd5uC4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Proxy.html-oGKI7rrX.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-BZ-9q558.js" as="script"><link rel="prefetch" href="/lanjz/assets/Set和WeakSet.html-3doNuQhX.js" as="script"><link rel="prefetch" href="/lanjz/assets/Symbol.html-bEKbNDpd.js" as="script"><link rel="prefetch" href="/lanjz/assets/async函数.html-2SVpw80o.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数的扩展.html-OCZyqGw3.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象.html-Q8re0C-o.js" as="script"><link rel="prefetch" href="/lanjz/assets/数组.html-DhPmiGdR.js" as="script"><link rel="prefetch" href="/lanjz/assets/装饰器.html-HWa7OZeT.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML5新特性.html-LHrnszhN.js" as="script"><link rel="prefetch" href="/lanjz/assets/IntersectionObserver.html-Uq109U8U.js" as="script"><link rel="prefetch" href="/lanjz/assets/Preload和Prefetch.html-89m7iXst.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-iPTLhhPd.js" as="script"><link rel="prefetch" href="/lanjz/assets/SVG.html-SUVUCQ17.js" as="script"><link rel="prefetch" href="/lanjz/assets/Worker.html-RVgy8f_V.js" as="script"><link rel="prefetch" href="/lanjz/assets/requestIdleCallback和requestAnimationFrame.html-CVJVKXIT.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-3GijvS9B.js" as="script"><link rel="prefetch" href="/lanjz/assets/DOM.html-swdItt3G.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS基础.html-HKu1WBdx.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS核心.html-rN6Y5ZAQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS面象对象.html-AcZKH1iN.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-06weLThU.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件.html-P3RKcKjF.js" as="script"><link rel="prefetch" href="/lanjz/assets/代码实现.html-wqOmW-An.js" as="script"><link rel="prefetch" href="/lanjz/assets/全面解析Module模式.html-yQC2OYEG.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数.html-Zkigca9C.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-lUI38hyc.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱二.html-0himmU3O.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象创建设计模式.html-7CjfVlLe.js" as="script"><link rel="prefetch" href="/lanjz/assets/正则.html-D3kRbPWB.js" as="script"><link rel="prefetch" href="/lanjz/assets/编写高质量JavaScript代码的基本要点.html-jLfWC4UN.js" as="script"><link rel="prefetch" href="/lanjz/assets/设计模式.html-JI_EgcTt.js" as="script"><link rel="prefetch" href="/lanjz/assets/闭包.html-PUf1oT5l.js" as="script"><link rel="prefetch" href="/lanjz/assets/JSBridge.html-3Z1lNopm.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Rjh4Lj4o.js" as="script"><link rel="prefetch" href="/lanjz/assets/uniapp.html-08QfkElD.js" as="script"><link rel="prefetch" href="/lanjz/assets/微信小程序.html-bGesRaiS.js" as="script"><link rel="prefetch" href="/lanjz/assets/Component.html-arJFjyCK.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-oChuih5X.js" as="script"><link rel="prefetch" href="/lanjz/assets/Fiber.html-PVPvEBTK.js" as="script"><link rel="prefetch" href="/lanjz/assets/Hook.html-2hN0c-wN.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-FJGs3LaD.js" as="script"><link rel="prefetch" href="/lanjz/assets/React-router5.html-AyChB_De.js" as="script"><link rel="prefetch" href="/lanjz/assets/React.html-tFOPcQcJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/React16新特性.html-uaNCWGTX.js" as="script"><link rel="prefetch" href="/lanjz/assets/ReactDOM.render.html-PdefvRYs.js" as="script"><link rel="prefetch" href="/lanjz/assets/React高级指引.html-jLxfOFxq.js" as="script"><link rel="prefetch" href="/lanjz/assets/VirtualDom.html-DXXVaCpl.js" as="script"><link rel="prefetch" href="/lanjz/assets/vsVue.html-J7S318Ul.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-zpKMZZ_h.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能优化.html-194LVODv.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间切片.html-rGQUFica.js" as="script"><link rel="prefetch" href="/lanjz/assets/更新机制.html-jhpj3v6E.js" as="script"><link rel="prefetch" href="/lanjz/assets/服务端渲染.html-GrfkxCWL.js" as="script"><link rel="prefetch" href="/lanjz/assets/渲染过程.html-kIWUYi3b.js" as="script"><link rel="prefetch" href="/lanjz/assets/高阶组件.html-78F-b3Tt.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-wSJ_RQth.js" as="script"><link rel="prefetch" href="/lanjz/assets/Computed.html-pQWUSuWZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Extend.html-ovSd6oky.js" as="script"><link rel="prefetch" href="/lanjz/assets/Paas应用.html-eyMi3Puu.js" as="script"><link rel="prefetch" href="/lanjz/assets/PatchNode.html-CnayedBg.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-65wy4qkL.js" as="script"><link rel="prefetch" href="/lanjz/assets/Render.html-PyjAvDw_.js" as="script"><link rel="prefetch" href="/lanjz/assets/SSR.html-fvPZfDfA.js" as="script"><link rel="prefetch" href="/lanjz/assets/VueRouter.html-GcVK1WNK.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vuex.html-75iGiWOr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vue性能优化.html-z0gzEQ8b.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watch.html-ymEZsAut.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watcher更新顺序.html-m2IwKlpP.js" as="script"><link rel="prefetch" href="/lanjz/assets/nextTick.html-xxL1KugE.js" as="script"><link rel="prefetch" href="/lanjz/assets/set.html-798pvO_i.js" as="script"><link rel="prefetch" href="/lanjz/assets/v-model.html-EpIM44dx.js" as="script"><link rel="prefetch" href="/lanjz/assets/共享状态思想.html-U0YZx6DG.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-hwbwgBO_.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-L29Wa884.js" as="script"><link rel="prefetch" href="/lanjz/assets/数据代理.html-j6Q9KSFh.js" as="script"><link rel="prefetch" href="/lanjz/assets/模板到DOM.html-fSsKLnqx.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件通信.html-JwAdGss1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-UaG8L9up.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-pWr6v7UM.js" as="script"><link rel="prefetch" href="/lanjz/assets/SFC还是JSX.html-GL9fGgkf.js" as="script"><link rel="prefetch" href="/lanjz/assets/V3升级目的.html-dmbFZpRZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/createApp.html-Y7HIo1eH.js" as="script"><link rel="prefetch" href="/lanjz/assets/setup.html-M8cWDNfi.js" as="script"><link rel="prefetch" href="/lanjz/assets/watch.html-7znf1kKJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用区别.html-njatemIX.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式API.html-qIShLpN2.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-UJlslnWg.js" as="script"><link rel="prefetch" href="/lanjz/assets/预渲染.html-2s14uJvx.js" as="script"><link rel="prefetch" href="/lanjz/assets/CDN.html-Lz_qIWgt.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie.html-mtpgazCc.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie、Session、Token、JWT.html-t9NGsfWY.js" as="script"><link rel="prefetch" href="/lanjz/assets/DNS.html-VBxWnRNS.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTPS.html-afCHJggV.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTP及演变.html-U4LoR-gI.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-bl7VDj8r.js" as="script"><link rel="prefetch" href="/lanjz/assets/Socket.html-83U8aP93.js" as="script"><link rel="prefetch" href="/lanjz/assets/TCP.html-fpO5M63Y.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebSocket.html-IX3ieyJ6.js" as="script"><link rel="prefetch" href="/lanjz/assets/keep-alive.html-S4Lms9iQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器缓存.html-hG4zIXtd.js" as="script"><link rel="prefetch" href="/lanjz/assets/网络层的优化.html-C6L5gjtk.js" as="script"><link rel="prefetch" href="/lanjz/assets/跨域.html-M7pEbu6Q.js" as="script"><link rel="prefetch" href="/lanjz/assets/MD.html-OiiyGtny.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-GJH--UXU.js" as="script"><link rel="prefetch" href="/lanjz/assets/importHtmlEntry.html-1Yab92w-.js" as="script"><link rel="prefetch" href="/lanjz/assets/qiankun原理.html-Kbhm9aDc.js" as="script"><link rel="prefetch" href="/lanjz/assets/微前端.html-nberL2an.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-pRKulVy4.js" as="script"><link rel="prefetch" href="/lanjz/assets/FE重构.html-92rPQBm3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Performance.html-5jaPc4vs.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack构建优化.html-zZDD2cX-.js" as="script"><link rel="prefetch" href="/lanjz/assets/che.html-MaHp5EGh.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理分享.html-1wV9Uauk.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点分享.html-_NLwC51y.js" as="script"><link rel="prefetch" href="/lanjz/assets/评审.html-24iB1hYq.js" as="script"><link rel="prefetch" href="/lanjz/assets/Git.html-GGTp0c5I.js" as="script"><link rel="prefetch" href="/lanjz/assets/Mac.html-_qszzN-b.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ovCSePGF.js" as="script"><link rel="prefetch" href="/lanjz/assets/公共模块管理.html-nU0_8z3p.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄漏.html-DNic5eGN.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端优化总结.html-rFP7gIKx.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端异常捕获.html-DnmMN91h.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点方案.html-tHmKXk3D.js" as="script"><link rel="prefetch" href="/lanjz/assets/开发与调试技巧.html-P5NCnieS.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能定位.html-qrogmxdV.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能指标.html-ehvm7ncX.js" as="script"><link rel="prefetch" href="/lanjz/assets/疑难杂症.html-s16-NmNs.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件设计的基本原则.html-t-x72Zma.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动化部署.html-RKLhZ6RH.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动引入组和ICON.html-HgWE4pPQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/重构改善既有代码的设计.html-0Vo0LxNv.js" as="script"><link rel="prefetch" href="/lanjz/assets/预加载_预解析.html-8rGoaOMy.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebStorage.html-M5A7kD-o.js" as="script"><link rel="prefetch" href="/lanjz/assets/svgMap.html-b7MHsF2N.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-4m_wxtGZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/README2.html-J2Ef_tNU.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用小记.html-OQpEdh_v.js" as="script"><link rel="prefetch" href="/lanjz/assets/Buffer.html-9wYikBpA.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node中的进程和线程.html-QRy_5ME0.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-NGQPrEI8.js" as="script"><link rel="prefetch" href="/lanjz/assets/流.html-ubf4U1Go.js" as="script"><link rel="prefetch" href="/lanjz/assets/待看.html-MRX_DC-o.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-1pkEyuT1.js" as="script"><link rel="prefetch" href="/lanjz/assets/NPM.html-sr3K9qix.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-_JTaL962.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-RJDeSwt0.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vite是啥.html-MGsQjf2m.js" as="script"><link rel="prefetch" href="/lanjz/assets/Babel-Loader.html-QR6DQyw-.js" as="script"><link rel="prefetch" href="/lanjz/assets/Loader.html-hDtgZQIw.js" as="script"><link rel="prefetch" href="/lanjz/assets/ModuleFederation.html-OvoZn8UM.js" as="script"><link rel="prefetch" href="/lanjz/assets/Plugin.html-S7lcNAkN.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-bZ0ozmYt.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack5新特性.html-Mc29iKI9.js" as="script"><link rel="prefetch" href="/lanjz/assets/css-loader_style-loader.html-7u2Up6Z0.js" as="script"><link rel="prefetch" href="/lanjz/assets/library.html-Z2Q0216L.js" as="script"><link rel="prefetch" href="/lanjz/assets/优化实践之Vue-Cli.html-sKneJYy_.js" as="script"><link rel="prefetch" href="/lanjz/assets/构建优化方案.html-ZYj1qRE_.js" as="script"><link rel="prefetch" href="/lanjz/assets/配置小记.html-jalf8AN_.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node模块.html-IOwcQaDY.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-CfkCuAJP.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件循环.html-oCwvexZO.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄露.html-2_nNH_kh.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html--oJZYwt9.js" as="script"><link rel="prefetch" href="/lanjz/assets/基础使用.html-pfLpMb8l.js" as="script"><link rel="prefetch" href="/lanjz/assets/守护服务.html-qOlpfi1G.js" as="script"><link rel="prefetch" href="/lanjz/assets/认识Node.html-USnaTxs7.js" as="script"><link rel="prefetch" href="/lanjz/assets/进程和线程.html-aZF9eHLT.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-oKm1G4iO.js" as="script"><link rel="prefetch" href="/lanjz/assets/setState.html-yLftGUR2.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端规范.html-uYj5FQHh.js" as="script"><link rel="prefetch" href="/lanjz/assets/项目模板.html-KP7TGai6.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Zp0OQLze.js" as="script"><link rel="prefetch" href="/lanjz/assets/登录系统.html-0cXWtQLX.js" as="script"><link rel="prefetch" href="/lanjz/assets/页面鉴权.html-6ePcfDub.js" as="script"><link rel="prefetch" href="/lanjz/assets/code-split.html-iREZuo4b.js" as="script"><link rel="prefetch" href="/lanjz/assets/tree-shaking.html-JBj3jaHJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/模块热替换.html-b8JXFTSJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-vsYUjVat.js" as="script"><link rel="prefetch" href="/lanjz/assets/404.html-r6aI8Oiv.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-mCecxEgb.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-GQqYt6H5.js" as="script"><link rel="prefetch" href="/lanjz/assets/剑指offer二.html-01rxpxmP.js" as="script"><link rel="prefetch" href="/lanjz/assets/动态规划.html-i9GuX7AS.js" as="script"><link rel="prefetch" href="/lanjz/assets/回文串.html-vGthtLWo.js" as="script"><link rel="prefetch" href="/lanjz/assets/回溯.html-vHADOK4u.js" as="script"><link rel="prefetch" href="/lanjz/assets/字节前端.html-GoQiSCFB.js" as="script"><link rel="prefetch" href="/lanjz/assets/小题.html-9moVCQkH.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间_空间复杂度.html-G69PrTvw.js" as="script"><link rel="prefetch" href="/lanjz/assets/树.html-mtYKfMTM.js" as="script"><link rel="prefetch" href="/lanjz/assets/简单排序.html-iLIjWdxm.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML渲染过程.html-3xyjCzyb.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-EIBEuIhS.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器中的进程与线程.html-NtBPvF-d.js" as="script"><link rel="prefetch" href="/lanjz/assets/BFC和IFC.html-9c4qt9Pt.js" as="script"><link rel="prefetch" href="/lanjz/assets/CSS3新特性.html-vGjB4YFS.js" as="script"><link rel="prefetch" href="/lanjz/assets/Flex.html-YoUd5XXs.js" as="script"><link rel="prefetch" href="/lanjz/assets/Image.html-yDyp8iLt.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-RhYlzRDh.js" as="script"><link rel="prefetch" href="/lanjz/assets/多列.html-9MPAOZeb.js" as="script"><link rel="prefetch" href="/lanjz/assets/换肤.html-sw0-laZs.js" as="script"><link rel="prefetch" href="/lanjz/assets/样式实现.html-jckuq8Jt.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端一像素问题.html-DU3hNiM7.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端适配方案.html-YF1xTLm5.js" as="script"><link rel="prefetch" href="/lanjz/assets/适配iponeX.html-MCajTrNy.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class.html-bd4V1AR3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class继承.html-3KHKUN2_.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generater应用.html-Zjd0OxbW.js" as="script"><link rel="prefetch" href="/lanjz/assets/Iterator.html-CTaX3gm6.js" as="script"><link rel="prefetch" href="/lanjz/assets/Map和WeakMap.html-K8Hs1kLf.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module.html-xAxFdYQJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module的加载实现.html-AV7XDqIY.js" as="script"><link rel="prefetch" href="/lanjz/assets/Promise.html-Kvqo5FFn.js" as="script"><link rel="prefetch" href="/lanjz/assets/Proxy.html-XHcSiDJp.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ooRWbVhc.js" as="script"><link rel="prefetch" href="/lanjz/assets/Set和WeakSet.html-LrExXj-W.js" as="script"><link rel="prefetch" href="/lanjz/assets/Symbol.html-d1AQk7c6.js" as="script"><link rel="prefetch" href="/lanjz/assets/async函数.html-g_OK393a.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数的扩展.html-nuXkAqNp.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象.html-RPxQH7-c.js" as="script"><link rel="prefetch" href="/lanjz/assets/数组.html-QCNmmzEd.js" as="script"><link rel="prefetch" href="/lanjz/assets/装饰器.html-Sa7B8o_4.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML5新特性.html-Heka3QQc.js" as="script"><link rel="prefetch" href="/lanjz/assets/IntersectionObserver.html-pHegCQDr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Preload和Prefetch.html-d57juFoy.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-SA3zjyfX.js" as="script"><link rel="prefetch" href="/lanjz/assets/SVG.html-88b0uX8Y.js" as="script"><link rel="prefetch" href="/lanjz/assets/Worker.html-RQWNUMFd.js" as="script"><link rel="prefetch" href="/lanjz/assets/requestIdleCallback和requestAnimationFrame.html-Og3QYDc7.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-3lErFbgs.js" as="script"><link rel="prefetch" href="/lanjz/assets/DOM.html-fZDMAMBI.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS基础.html-4kuaKMB6.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS核心.html-wZPRlSZH.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS面象对象.html-7Ils_ckA.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-62d2KQtD.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件.html-jf5qA2iy.js" as="script"><link rel="prefetch" href="/lanjz/assets/代码实现.html-XgdKxZwE.js" as="script"><link rel="prefetch" href="/lanjz/assets/全面解析Module模式.html-UMrAtPJG.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数.html-SrxmVdEZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-euAbR8hB.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱二.html-mY2sYPkH.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象创建设计模式.html-v2he1A-S.js" as="script"><link rel="prefetch" href="/lanjz/assets/正则.html-X2K2DWwQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/编写高质量JavaScript代码的基本要点.html-1tutj_h3.js" as="script"><link rel="prefetch" href="/lanjz/assets/设计模式.html-CCLMbg3p.js" as="script"><link rel="prefetch" href="/lanjz/assets/闭包.html-ZATGagoX.js" as="script"><link rel="prefetch" href="/lanjz/assets/JSBridge.html-sEbjQAfL.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-TZwo4Nc5.js" as="script"><link rel="prefetch" href="/lanjz/assets/uniapp.html-zEUSWTmi.js" as="script"><link rel="prefetch" href="/lanjz/assets/微信小程序.html--VWFRuSR.js" as="script"><link rel="prefetch" href="/lanjz/assets/Component.html-IZ9IsdXU.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-vVO7JZ-x.js" as="script"><link rel="prefetch" href="/lanjz/assets/Fiber.html-bzBso6O5.js" as="script"><link rel="prefetch" href="/lanjz/assets/Hook.html-lpGavINr.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-rSqNxMtp.js" as="script"><link rel="prefetch" href="/lanjz/assets/React-router5.html-JJUshqSW.js" as="script"><link rel="prefetch" href="/lanjz/assets/React.html-ka1u8biU.js" as="script"><link rel="prefetch" href="/lanjz/assets/React16新特性.html-Ala11Nu4.js" as="script"><link rel="prefetch" href="/lanjz/assets/ReactDOM.render.html-NhJQSu_c.js" as="script"><link rel="prefetch" href="/lanjz/assets/React高级指引.html-XKPooFEi.js" as="script"><link rel="prefetch" href="/lanjz/assets/VirtualDom.html-olM4hbAA.js" as="script"><link rel="prefetch" href="/lanjz/assets/vsVue.html-iXUsu9Ej.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-YY9GsFF7.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能优化.html-1dMjG8wy.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间切片.html-drRseWK3.js" as="script"><link rel="prefetch" href="/lanjz/assets/更新机制.html-LVEdJA0A.js" as="script"><link rel="prefetch" href="/lanjz/assets/服务端渲染.html-S_3kVkzj.js" as="script"><link rel="prefetch" href="/lanjz/assets/渲染过程.html-TApuQM1u.js" as="script"><link rel="prefetch" href="/lanjz/assets/高阶组件.html-inAxYSHI.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ScCUgRco.js" as="script"><link rel="prefetch" href="/lanjz/assets/Computed.html-3b8q3uV7.js" as="script"><link rel="prefetch" href="/lanjz/assets/Extend.html-DY2f4wzz.js" as="script"><link rel="prefetch" href="/lanjz/assets/Paas应用.html-hfYPIKZL.js" as="script"><link rel="prefetch" href="/lanjz/assets/PatchNode.html-I2tiZhaj.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-JYmdoJxG.js" as="script"><link rel="prefetch" href="/lanjz/assets/Render.html-dqJpvqgh.js" as="script"><link rel="prefetch" href="/lanjz/assets/SSR.html-Z8EYVYUt.js" as="script"><link rel="prefetch" href="/lanjz/assets/VueRouter.html-nZNSK0pQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vuex.html-PQmHTKM5.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vue性能优化.html-sFz--4g6.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watch.html-RxfCBNHe.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watcher更新顺序.html-eU6zzkJZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/nextTick.html-Bg8E1TfS.js" as="script"><link rel="prefetch" href="/lanjz/assets/set.html-V7f5gDgm.js" as="script"><link rel="prefetch" href="/lanjz/assets/v-model.html-vBb7mL1D.js" as="script"><link rel="prefetch" href="/lanjz/assets/共享状态思想.html-jrY0Xjed.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-K3thLBfV.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-6ZU4m6Q1.js" as="script"><link rel="prefetch" href="/lanjz/assets/数据代理.html-6Y1HWa4s.js" as="script"><link rel="prefetch" href="/lanjz/assets/模板到DOM.html-oqTMXkaI.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件通信.html-6k3GvrOh.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-AJbInTbc.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Gk4P-7Fj.js" as="script"><link rel="prefetch" href="/lanjz/assets/SFC还是JSX.html-POAyhMLO.js" as="script"><link rel="prefetch" href="/lanjz/assets/V3升级目的.html-BwytewbX.js" as="script"><link rel="prefetch" href="/lanjz/assets/createApp.html-jSjL0htX.js" as="script"><link rel="prefetch" href="/lanjz/assets/setup.html-iZBA4E_J.js" as="script"><link rel="prefetch" href="/lanjz/assets/watch.html-avtyVzdO.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用区别.html-3B3LEyJv.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式API.html-D6AG3Aqq.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-fTITUji9.js" as="script"><link rel="prefetch" href="/lanjz/assets/预渲染.html-UKPD_Hud.js" as="script"><link rel="prefetch" href="/lanjz/assets/CDN.html-k3V37398.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie.html-stF9qk0D.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie、Session、Token、JWT.html-NPm0LGEL.js" as="script"><link rel="prefetch" href="/lanjz/assets/DNS.html-n_nFqWss.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTPS.html-zpEpxnHy.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTP及演变.html-mMFpCmIb.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-64rKNqkh.js" as="script"><link rel="prefetch" href="/lanjz/assets/Socket.html-Nmp9OtY0.js" as="script"><link rel="prefetch" href="/lanjz/assets/TCP.html-L6HpPOvH.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebSocket.html-mzKOvLv1.js" as="script"><link rel="prefetch" href="/lanjz/assets/keep-alive.html-ZHFPPJO_.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器缓存.html-TBtoyq-j.js" as="script"><link rel="prefetch" href="/lanjz/assets/网络层的优化.html-7mnVRb8W.js" as="script"><link rel="prefetch" href="/lanjz/assets/跨域.html-qzyIev2T.js" as="script"><link rel="prefetch" href="/lanjz/assets/MD.html-tOCmfl4s.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-E9Ji1PVd.js" as="script"><link rel="prefetch" href="/lanjz/assets/importHtmlEntry.html-glk9mCIt.js" as="script"><link rel="prefetch" href="/lanjz/assets/qiankun原理.html-10pn98kR.js" as="script"><link rel="prefetch" href="/lanjz/assets/微前端.html-YQ9vUwJI.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-wd9ZFdP9.js" as="script"><link rel="prefetch" href="/lanjz/assets/FE重构.html-xzg40l7T.js" as="script"><link rel="prefetch" href="/lanjz/assets/Performance.html-XQKyqbWl.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack构建优化.html-NbXvYsxo.js" as="script"><link rel="prefetch" href="/lanjz/assets/che.html-U4MyGRo9.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理分享.html-3cvKTam_.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点分享.html-F_O03MTn.js" as="script"><link rel="prefetch" href="/lanjz/assets/评审.html-F5LqY7fj.js" as="script"><link rel="prefetch" href="/lanjz/assets/Git.html-ArIkt6gr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Mac.html-w1GFytMK.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ABuRFJdW.js" as="script"><link rel="prefetch" href="/lanjz/assets/公共模块管理.html-Et81naP2.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄漏.html-LXxrFNb_.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端优化总结.html-LxHX3PWb.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端异常捕获.html-sHKF3wkA.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点方案.html-W9PJ3GWZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/开发与调试技巧.html-Itt4NB5C.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能定位.html-pl7eKFRa.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能指标.html-odMm_qly.js" as="script"><link rel="prefetch" href="/lanjz/assets/疑难杂症.html-1P4tNWLb.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件设计的基本原则.html-WzGRiIp8.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动化部署.html-xmB-ZLSX.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动引入组和ICON.html--7iBEt-o.js" as="script"><link rel="prefetch" href="/lanjz/assets/重构改善既有代码的设计.html-c4To_p8z.js" as="script"><link rel="prefetch" href="/lanjz/assets/预加载_预解析.html-nT4wElX6.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebStorage.html-4JEeOLI1.js" as="script"><link rel="prefetch" href="/lanjz/assets/svgMap.html-18_7Qm2x.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-v5CKLbUS.js" as="script"><link rel="prefetch" href="/lanjz/assets/README2.html-AC3dVvXw.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用小记.html-zA8mNBYg.js" as="script"><link rel="prefetch" href="/lanjz/assets/Buffer.html-Vopp3fta.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node中的进程和线程.html-Indy63YX.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-_-TByNO7.js" as="script"><link rel="prefetch" href="/lanjz/assets/流.html-XJdmzprS.js" as="script"><link rel="prefetch" href="/lanjz/assets/待看.html-qCUE2A4D.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-6lGYrdAT.js" as="script"><link rel="prefetch" href="/lanjz/assets/NPM.html-AsZX_5RY.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-1LmC9fw6.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-RQxkHGdi.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vite是啥.html-89imNZ00.js" as="script"><link rel="prefetch" href="/lanjz/assets/Babel-Loader.html-rwcqP-Sr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Loader.html-tXmHgou0.js" as="script"><link rel="prefetch" href="/lanjz/assets/ModuleFederation.html-DeurDrYU.js" as="script"><link rel="prefetch" href="/lanjz/assets/Plugin.html-mAXrIdf7.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-_rqGYViG.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack5新特性.html-7grFQ4c4.js" as="script"><link rel="prefetch" href="/lanjz/assets/css-loader_style-loader.html-1etpFQ4a.js" as="script"><link rel="prefetch" href="/lanjz/assets/library.html-VMQ1k1k3.js" as="script"><link rel="prefetch" href="/lanjz/assets/优化实践之Vue-Cli.html-_R1SzVbm.js" as="script"><link rel="prefetch" href="/lanjz/assets/构建优化方案.html-wfmq6i46.js" as="script"><link rel="prefetch" href="/lanjz/assets/配置小记.html-IBdZmeCS.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node模块.html-igioqj-k.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-oe-kIejg.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件循环.html-7g2l-jOv.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄露.html-65v9hmfP.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-x61-KcfG.js" as="script"><link rel="prefetch" href="/lanjz/assets/基础使用.html-UPFy8vVy.js" as="script"><link rel="prefetch" href="/lanjz/assets/守护服务.html-zhzUw_V8.js" as="script"><link rel="prefetch" href="/lanjz/assets/认识Node.html-WS7yalx-.js" as="script"><link rel="prefetch" href="/lanjz/assets/进程和线程.html-LlLW8xwL.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-y-r1bfYN.js" as="script"><link rel="prefetch" href="/lanjz/assets/setState.html-qSRUzKiq.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端规范.html--a-e4oHL.js" as="script"><link rel="prefetch" href="/lanjz/assets/项目模板.html-BBQeKpjz.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-BcS74UVZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/登录系统.html-suAe5bFl.js" as="script"><link rel="prefetch" href="/lanjz/assets/页面鉴权.html-4npY8jp2.js" as="script"><link rel="prefetch" href="/lanjz/assets/code-split.html-75CtLqfz.js" as="script"><link rel="prefetch" href="/lanjz/assets/tree-shaking.html-ukuuyXyF.js" as="script"><link rel="prefetch" href="/lanjz/assets/模块热替换.html-BoILCmb2.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-czsSk7oa.js" as="script"><link rel="prefetch" href="/lanjz/assets/404.html-poUKd9E4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Home-mUvN-BwM.js" as="script"><link rel="prefetch" href="/lanjz/assets/My-b5h_wlja.js" as="script"><link rel="prefetch" href="/lanjz/assets/NavSvg-RruP3KIr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Resume-hTF4RtUO.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/lanjz/" class=""><!----><span class="site-name">前端知识体系</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/lanjz/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/JavaScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/ES6/" class="router-link-active" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/HTML5/" class="" aria-label="HTML5"><!--[--><!--]--> HTML5 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/CSS/" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Browser/" class="" aria-label="Browser"><!--[--><!--]--> Browser <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/secure/" class="" aria-label="Web安全"><!--[--><!--]--> Web安全 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/React/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/qiankun/" class="" aria-label="qiankun"><!--[--><!--]--> qiankun <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/NA/" class="" aria-label="跨平台"><!--[--><!--]--> 跨平台 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Node"><span class="title">Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Node"><span class="title">Node</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Node/基础/" class="" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Package/" class="" aria-label="yarn&amp;npm"><!--[--><!--]--> yarn&amp;npm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/ESBuild/" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/数据库/" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端优化总结.md" class="" aria-label="前端优化总结"><!--[--><!--]--> 前端优化总结 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/系统设计/" class="" aria-label="系统设计"><!--[--><!--]--> 系统设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/预加载&amp;预解析.md" class="" aria-label="预加载&amp;预解析"><!--[--><!--]--> 预加载&amp;预解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/重构改善既有代码的设计.md" class="" aria-label="重构代码原则"><!--[--><!--]--> 重构代码原则 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/开发与调试技巧.md" class="" aria-label="开发与调试"><!--[--><!--]--> 开发与调试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/组件设计的基本原则.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/公共模块管理.md" class="" aria-label="公共模块管理"><!--[--><!--]--> 公共模块管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/内存泄漏.md" class="" aria-label="内存泄漏"><!--[--><!--]--> 内存泄漏 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端异常捕获.md" class="" aria-label="前端异常捕获"><!--[--><!--]--> 前端异常捕获 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/自动化部署.md" class="" aria-label="自动化部署"><!--[--><!--]--> 自动化部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/疑难杂症.md" class="" aria-label="问题小计"><!--[--><!--]--> 问题小计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能指标.md" class="" aria-label="性能指标"><!--[--><!--]--> 性能指标 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能定位.md" class="" aria-label="性能定位"><!--[--><!--]--> 性能定位 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/" class="" aria-label="规范"><!--[--><!--]--> 规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/前端规范.md" class="" aria-label="前端规范"><!--[--><!--]--> 前端规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/项目模板.md" class="" aria-label="项目模板"><!--[--><!--]--> 项目模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/埋点方案.md" class="" aria-label="埋点"><!--[--><!--]--> 埋点 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="利其器"><span class="title">利其器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="利其器"><span class="title">利其器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Mac.md" class="" aria-label="Mac"><!--[--><!--]--> Mac <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Git.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小工具"><span class="title">小工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小工具"><span class="title">小工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/online-tools/MD.md" class="" aria-label="MD"><!--[--><!--]--> MD <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/lanjz/Im/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/lanjz/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/JavaScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/ES6/" class="router-link-active" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/HTML5/" class="" aria-label="HTML5"><!--[--><!--]--> HTML5 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/CSS/" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Browser/" class="" aria-label="Browser"><!--[--><!--]--> Browser <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/secure/" class="" aria-label="Web安全"><!--[--><!--]--> Web安全 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/React/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/qiankun/" class="" aria-label="qiankun"><!--[--><!--]--> qiankun <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/NA/" class="" aria-label="跨平台"><!--[--><!--]--> 跨平台 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Node"><span class="title">Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Node"><span class="title">Node</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Node/基础/" class="" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Package/" class="" aria-label="yarn&amp;npm"><!--[--><!--]--> yarn&amp;npm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/ESBuild/" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/数据库/" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端优化总结.md" class="" aria-label="前端优化总结"><!--[--><!--]--> 前端优化总结 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/系统设计/" class="" aria-label="系统设计"><!--[--><!--]--> 系统设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/预加载&amp;预解析.md" class="" aria-label="预加载&amp;预解析"><!--[--><!--]--> 预加载&amp;预解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/重构改善既有代码的设计.md" class="" aria-label="重构代码原则"><!--[--><!--]--> 重构代码原则 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/开发与调试技巧.md" class="" aria-label="开发与调试"><!--[--><!--]--> 开发与调试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/组件设计的基本原则.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/公共模块管理.md" class="" aria-label="公共模块管理"><!--[--><!--]--> 公共模块管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/内存泄漏.md" class="" aria-label="内存泄漏"><!--[--><!--]--> 内存泄漏 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端异常捕获.md" class="" aria-label="前端异常捕获"><!--[--><!--]--> 前端异常捕获 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/自动化部署.md" class="" aria-label="自动化部署"><!--[--><!--]--> 自动化部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/疑难杂症.md" class="" aria-label="问题小计"><!--[--><!--]--> 问题小计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能指标.md" class="" aria-label="性能指标"><!--[--><!--]--> 性能指标 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能定位.md" class="" aria-label="性能定位"><!--[--><!--]--> 性能定位 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/" class="" aria-label="规范"><!--[--><!--]--> 规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/前端规范.md" class="" aria-label="前端规范"><!--[--><!--]--> 前端规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/项目模板.md" class="" aria-label="项目模板"><!--[--><!--]--> 项目模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/埋点方案.md" class="" aria-label="埋点"><!--[--><!--]--> 埋点 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="利其器"><span class="title">利其器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="利其器"><span class="title">利其器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Mac.md" class="" aria-label="Mac"><!--[--><!--]--> Mac <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Git.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小工具"><span class="title">小工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小工具"><span class="title">小工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/online-tools/MD.md" class="" aria-label="MD"><!--[--><!--]--> MD <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/lanjz/Im/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/lanjz/ES6/%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A9%E5%B1%95.html" class="sidebar-item sidebar-heading" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Symbol.html" class="sidebar-item sidebar-heading" aria-label="Symbol"><!--[--><!--]--> Symbol <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/%E6%95%B0%E7%BB%84.html" class="sidebar-item sidebar-heading" aria-label="数组"><!--[--><!--]--> 数组 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/%E5%AF%B9%E8%B1%A1.html" class="sidebar-item sidebar-heading" aria-label="对象"><!--[--><!--]--> 对象 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Set%E5%92%8CWeakSet.html" class="sidebar-item sidebar-heading" aria-label="Set和WeakSet"><!--[--><!--]--> Set和WeakSet <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Map%E5%92%8CWeakMap.html" class="sidebar-item sidebar-heading" aria-label="Map和WeakMap"><!--[--><!--]--> Map和WeakMap <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Promise.html" class="sidebar-item sidebar-heading" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Iterator.html" class="sidebar-item sidebar-heading" aria-label="Iterator"><!--[--><!--]--> Iterator <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Generator"><!--[--><!--]--> Generator <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/ES6/Generator.html#协程" class="router-link-active router-link-exact-active sidebar-item" aria-label="协程"><!--[--><!--]--> 协程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator函数"><!--[--><!--]--> Generator函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#yield" class="router-link-active router-link-exact-active sidebar-item" aria-label="yield"><!--[--><!--]--> yield <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#next" class="router-link-active router-link-exact-active sidebar-item" aria-label="next"><!--[--><!--]--> next <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/ES6/Generator.html#首次next" class="router-link-active router-link-exact-active sidebar-item" aria-label="首次next()"><!--[--><!--]--> 首次next() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#for-of-循环" class="router-link-active router-link-exact-active sidebar-item" aria-label="for...of 循环"><!--[--><!--]--> for...of 循环 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-prototype-throw" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator.prototype.throw()"><!--[--><!--]--> Generator.prototype.throw() <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/ES6/Generator.html#使用throw的注意点" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用throw的注意点"><!--[--><!--]--> 使用throw的注意点 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-prototype-return" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator.prototype.return()"><!--[--><!--]--> Generator.prototype.return() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#yield-表达式" class="router-link-active router-link-exact-active sidebar-item" aria-label="yield* 表达式"><!--[--><!--]--> yield* 表达式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#作为对象属性的-generator-函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="作为对象属性的 Generator 函数"><!--[--><!--]--> 作为对象属性的 Generator 函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-函数的this" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator 函数的this"><!--[--><!--]--> Generator 函数的this <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-与状态机" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator 与状态机"><!--[--><!--]--> Generator 与状态机 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-的上下文" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator 的上下文"><!--[--><!--]--> Generator 的上下文 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="应用"><!--[--><!--]--> 应用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/ES6/Generator.html#异步操作的同步化表达" class="router-link-active router-link-exact-active sidebar-item" aria-label="异步操作的同步化表达"><!--[--><!--]--> 异步操作的同步化表达 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#控制流管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="控制流管理"><!--[--><!--]--> 控制流管理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#部署-iterator-接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="部署 Iterator 接口"><!--[--><!--]--> 部署 Iterator 接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/ES6/Generator.html#generator-的异步应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Generator 的异步应用"><!--[--><!--]--> Generator 的异步应用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/lanjz/ES6/async%E5%87%BD%E6%95%B0.html" class="sidebar-item sidebar-heading" aria-label="async 函数"><!--[--><!--]--> async 函数 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Proxy.html" class="sidebar-item sidebar-heading" aria-label="Proxy"><!--[--><!--]--> Proxy <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Class.html" class="sidebar-item sidebar-heading" aria-label="Class"><!--[--><!--]--> Class <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Class%E7%BB%A7%E6%89%BF.html" class="sidebar-item sidebar-heading" aria-label="Class继承"><!--[--><!--]--> Class继承 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Module.html" class="sidebar-item sidebar-heading" aria-label="Module"><!--[--><!--]--> Module <!--[--><!--]--></a><!----></li><li><a href="/lanjz/ES6/Module%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0.html" class="sidebar-item sidebar-heading" aria-label="Module 的加载实现"><!--[--><!--]--> Module 的加载实现 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="generator" tabindex="-1"><a class="header-anchor" href="#generator" aria-hidden="true">#</a> Generator</h1><p>传统的编程语言，早有异步编程的解决方案（其实是多任务的解决方案）。其中有一种叫做“协程”（coroutine），意思是多个线程互相协作，完成异步任务。</p><h2 id="协程" tabindex="-1"><a class="header-anchor" href="#协程" aria-hidden="true">#</a> 协程</h2><p>协程有点像函数，又有点像线程，它的运行流程大致如下：</p><ol><li><p>第一步，协程 A 开始执行；</p></li><li><p>第二步，协程 A 执行到一半，进入暂停，执行权转移到协程 B；</p></li><li><p>第三步，（一段时间后）协程 B 交还执行权；</p></li><li><p>第四步，协程 A 恢复执行；</p></li></ol><p><strong>Generator 函数是类似协程的一种实现，最大特点就是可以交出函数的执行权（即暂停执行）。</strong></p><h2 id="generator函数" tabindex="-1"><a class="header-anchor" href="#generator函数" aria-hidden="true">#</a> Generator函数</h2><p>Generator 函数是 ES6 提供的一种异步编程解决方案, 语法上，首先可以把它理解成一个状态机，封装了多个内部状态</p><p>执行 Generator 函数会返回一个遍历器对象，然后可以依次遍历 Generator 函数内部的每一个状态</p><p>Generator 函数是一个普通函数，但是有两个特征</p><ol><li><p><code>function</code> 关键字与函数名之间有一个星号</p></li><li><p>函数体内部使用 <code>yield</code> 表达式，定义不同的内部状态（ <code>yield</code> 在英语里的意思就是“产出”）</p></li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;world&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&#39;ending&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> hw <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: &#39;hello&#39;, done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: &#39;world&#39;, done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: &#39;ending&#39;, done: true }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与普通函数相比， 调用 Generator 函数并不会立马执行函数代码内容，返回的也不是函数运行结果，而是一个指向内部状态的指针对象(遍历器对象)</p><p>然后调用遍历器对象的 <code>next</code> 方法，使得指针移向下一个状态。也就是说，每次调用 <code>next</code> 方法，内部指针就从函数头部或上一次停下来的地方开始执行，直到遇到下一个 <code>yield</code> 表达式（或 <code>return</code> 语句）为止。换言之，Generator 函数是分段执行的， <code>yield</code> 表达式是暂停执行的标记，而 <code>next</code> 方法可以恢复执行</p><p>使用 Generator 有两个重要的关键字 <code>yield</code> 和 <code>next</code></p><h2 id="yield" tabindex="-1"><a class="header-anchor" href="#yield" aria-hidden="true">#</a> yield</h2><p>Generator 函数类似一种可以暂停执行的函数,<code>yield</code> 表达式就是暂停的标志</p><p>遍历器对象的 <code>next</code> 方法的运行逻辑如下</p><ol><li><p>遇到 <code>yield</code> 表达式，就暂停执行后面的操作，并将紧跟在 <code>yield</code> 后面的那个表达式的值，作为返回的对象的 <code>value</code> 属性值</p></li><li><p>下一次调用 <code>next</code> 方法时，再继续往下执行，直到遇到下一个 <code>yield</code> 表达式</p></li><li><p>如果没有再遇到新的 <code>yield</code> 表达式，就一直运行到函数结束，直到 <code>return语</code> 句为止，并将 <code>return</code> 语句后面的表达式的值，作为返回的对象的 <code>value </code>属性值。</p></li><li><p>如果该函数没有 <code>return</code> 语句，则返回的对象的 <code>value</code> 属性值为 <code>undefined</code></p></li></ol><p><strong>使用yield的注意点</strong></p><ul><li><p><code>yield</code> 表达式只能用在 Generator 函数里面，用在其他地方都会报错。</p></li><li><p><code>yield</code> 表达式如果用在另一个表达式之中，必须放在圆括号里面</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span> <span class="token operator">+</span> <span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SyntaxError</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span> <span class="token operator">+</span> <span class="token keyword">yield</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SyntaxError</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>yield</code> 表达式用作函数参数或放在赋值表达式的右边，可以不加括号</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
  <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="next" tabindex="-1"><a class="header-anchor" href="#next" aria-hidden="true">#</a> next</h2><p>调用 Generator 函数后，返回的遍历器对象，需要通过 <code>next</code> 方法依次执行内部代码，每次调用 <code>next</code> 方法，内部指针就从函数头部或上一次停下来的地方开始执行，直到遇到下一个 <code>yield</code> 表达式（或 <code>return</code> 语句）为止</p><p><strong>next 方法的参数</strong></p><p><code>next</code> 方法可以带一个参数，该参数就会被当作上一个 <code>yield</code> 表达式的返回值</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token boolean">true</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reset <span class="token operator">=</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token punctuation">{</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 0, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 1, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// { value: 0, done: false }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码先定义了一个可以无限运行的 Generator 函数 <code>f</code>，如果 <code>next</code> 方法没有参数，每次运行到 <code>yield</code> 表达式，变量 <code>reset </code>的值总是 <code>undefined </code>。当 <code>next</code> 方法带一个参数 <code>true</code> 时，变量 <code>reset</code> 就被重置为这个参数（即 <code>true</code> ），因此 <code>i</code> 会等于 <code>-1</code> ，下一轮循环就会从 <code>-1</code> 开始递增。</p><p>再看一个例子</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span>y <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Object{value:6, done:false}</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Object{value:NaN, done:false}</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Object{value:NaN, done:true}</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value:6, done:false }</span>
b<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment">// { value:8, done:false }</span>
b<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token comment">// { value:42(13+24+5), done:true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，第二次运行 <code>next</code> 方法的时候不带参数，导致 <code>y</code> 的值等于 <code>2 * undefined</code>（即 <code>NaN</code> ），除以 <code>3</code> 以后还是 <code>NaN</code> ，因此返回对象的 <code>value</code> 属性也等于 <code>NaN</code> 。第三次运行 <code>Next</code> 方法的时候不带参数，所以 <code>z</code> 等于 <code>undefined</code> ，返回对象的 <code>value</code> 属性等于 <code>5 + NaN + undefined</code> ，即 <code>NaN</code> 。</p><p>如果向 <code>next</code> 方法提供参数，返回结果就完全不一样了。上面代码第一次调用 <code>b</code> 的 <code>next</code> 方法时，返回 <code>x+1</code> 的值 <code>6</code> ；第二次调用 <code>next</code> 方法，将上一次 <code>yield</code> 表达式的值设为 <code>12</code> ，因此 <code>y</code> 等于 <code>24</code> ，返回 <code>y / 3</code> 的值 <code>8</code> ；第三次调用 <code>next</code> 方法，将上一次 <code>yield</code> 表达式的值设为 <code>13</code> ，因此 <code>z</code> 等于 <code>13</code> ，这时 <code>x</code> 等于 <code>5</code> ，<code>y</code> 等于 <code>24</code> ，所以 <code>return</code> 语句的值等于 <code>42</code> 。</p><h3 id="首次next" tabindex="-1"><a class="header-anchor" href="#首次next" aria-hidden="true">#</a> 首次next()</h3><p>由于 <code>next</code> 方法的参数表示上一个 <code>yield</code> 表达式的返回值，所以在第一次使用 <code>next</code> 方法时，传递参数是无效的。V8 引擎直接忽略第一次使用 <code>next</code> 方法时的参数，只有从第二次使用 <code>next</code> 方法开始，参数才是有效的。</p><p>所以实质上第一个 <code>next</code> 方法用来启动遍历器对象，所以不用带有参数</p><p>如果想要第一次调用 <code>next</code> 方法时，就能够输入值，可以在 Generator 函数外面再包一层</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token parameter">generatorFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> generatorObject <span class="token operator">=</span> <span class="token function">generatorFunction</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    generatorObject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> generatorObject<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> wrapped <span class="token operator">=</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">First input: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">yield</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&#39;DONE&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">wrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;hello!&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// First input: hello!</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="for-of-循环" tabindex="-1"><a class="header-anchor" href="#for-of-循环" aria-hidden="true">#</a> for...of 循环</h3><p><code>for...of</code> 循环可以自动遍历 Generator 函数运行时生成的 Iterator对象，且此时不再需要调用 <code>next</code> 方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 3 4 5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是一个利用 Generator 函数和 <code>for...of</code> 循环，实现斐波那契数列的例子</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>prev<span class="token punctuation">,</span> curr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> curr<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>prev<span class="token punctuation">,</span> curr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>curr<span class="token punctuation">,</span> prev <span class="token operator">+</span> curr<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原生的 JavaScript 对象没有遍历接口，无法使用 <code>for...of</code> 循环，通过 Generator 函数为它加上这个接口，就可以用了</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">objectEntries</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> propKeys <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> propKey <span class="token keyword">of</span> propKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token punctuation">[</span>propKey<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> jane <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">&#39;Jane&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">&#39;Doe&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">objectEntries</span><span class="token punctuation">(</span>jane<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// first: Jane</span>
<span class="token comment">// last: Doe</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加上遍历器接口的另一种写法是，将 Generator 函数加到对象的 <code>Symbol.iterator</code> 属性上面</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">objectEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> propKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> propKey <span class="token keyword">of</span> propKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token punctuation">[</span>propKey<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>propKey<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> jane <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">&#39;Jane&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">&#39;Doe&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

jane<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> objectEntries<span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> jane<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// first: Jane</span>
<span class="token comment">// last: Doe</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了 <code>for...of</code> 循环以外，扩展运算符（<code>...</code>）、解构赋值和 <code>Array.from</code> 方法内部调用的，都是遍历器接口。这意味着，它们都可以将 Generator 函数返回的 Iterator 对象，作为参数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">numbers</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span>
  <span class="token keyword">yield</span> <span class="token number">2</span>
  <span class="token keyword">return</span> <span class="token number">3</span>
  <span class="token keyword">yield</span> <span class="token number">4</span>
<span class="token punctuation">}</span>

<span class="token comment">// 扩展运算符</span>
<span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// [1, 2]</span>

<span class="token comment">// Array.from 方法</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2]</span>

<span class="token comment">// 解构赋值</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
x <span class="token comment">// 1</span>
y <span class="token comment">// 2</span>

<span class="token comment">// for...of 循环</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token keyword">of</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generator-prototype-throw" tabindex="-1"><a class="header-anchor" href="#generator-prototype-throw" aria-hidden="true">#</a> Generator.prototype.throw()</h2><p>Generator 函数返回的遍历器对象，都有一个 <code>throw</code> 方法，可以在函数体外抛出错误，然后在 Generator 函数体内捕获</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">g</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;内部捕获&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;外部捕获&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 内部捕获 a</span>
<span class="token comment">// 外部捕获 b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，遍历器对象i连续抛出两个错误。第一个错误被 Generator 函数体内的 <code>catch</code> 语句捕获。<code>i</code> 第二次抛出错误，由于 Generator 函数内部的 <code>catch</code> 语句已经执行过了，不会再捕捉到这个错误了，所以这个错误就被抛出了 Generator 函数体，被函数体外的 <code>catch</code> 语句捕获</p><p>如果 Generator 函数内部没有部署 <code>try...catch</code> 代码块，那么 <code>throw</code> 方法抛出的错误，将被外部 <code>try...catch</code> 代码块捕获</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">g</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;内部捕获&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;外部捕获&#39;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 外部捕获 a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 Generator 函数内部和外部，都没有部署 <code>try...catch</code> 代码块，那么程序将报错，直接中断执行</p><h3 id="使用throw的注意点" tabindex="-1"><a class="header-anchor" href="#使用throw的注意点" aria-hidden="true">#</a> 使用throw的注意点</h3><p><strong><code>throw</code> 方法抛出的错误要被内部捕获，前提是必须至少执行过一次 <code>next</code> 方法</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;内部捕获&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Uncaught 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，<code>g.throw(1)</code> 执行时，<code>next</code> 方法一次都没有执行过。这时，抛出的错误不会被内部捕获，而是直接在外部抛出，导致程序出错。</p><p>这种行为其实很好理解，因为第一次执行 <code>next</code> 方法，等同于启动执行 Generator 函数的内部代码，否则 Generator 函数还没有开始执行，这时 <code>throw</code> 方法抛错只可能抛出在函数外部</p><p><strong>throw方法被捕获以后，会附带执行下一条yield表达式。也就是说，会附带执行一次next方法</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
g<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// b</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// c</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，<code>g.throw</code> 方法被捕获以后，自动执行了一次 <code>next</code> 方法，所以会打印 <code>b</code>。另外，也可以看到，只要 Generator 函数内部部署了<code>try...catch</code> 代码块，那么遍历器的 <code>throw</code> 方法抛出的错误，不影响下一次遍历</p><p>Generator 函数体外抛出的错误，可以在函数体内捕获；反过来，Generator 函数体内抛出的错误，也可以被函数体外的 <code>catch</code> 捕获</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value:3, done:false }</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generator-prototype-return" tabindex="-1"><a class="header-anchor" href="#generator-prototype-return" aria-hidden="true">#</a> Generator.prototype.return()</h2><p>Generator 函数返回的遍历器对象，还有一个 <code>return</code> 方法，可以返回给定的值，并且终结遍历 Generator 函数</p><p>如果 <code>return</code> 有传入参数，则该参数会作为 <strong>终结遍历 Generator 函数</strong> 时的 <code>value</code> 值</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// { value: 1, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span> <span class="token comment">// { value: &quot;foo&quot;, done: true }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// { value: undefined, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，遍历器对象 <code>g</code> 调用 <code>return</code> 方法后，返回值的 <code>value</code> 属性就是 <code>return</code> 方法的参数 <code>foo</code> 。并且，Generator 函数的遍历就终止了，返回值的 <code>done</code> 属性为 <code>true</code> ，以后再调用 <code>next</code> 方法，<code>done</code> 属性总是返回 <code>true</code></p><p>如果 <code>return</code> 方法调用时，不提供参数，则返回值的 <code>value</code> 属性为 <code>undefined</code></p><p>如果 Generator 函数内部有 <code>try...finally</code> 代码块，且正在执行 <code>try</code> 代码块，那么 <code>return</code> 方法会导致立刻进入 <code>finally</code> 代码块，执行完以后，整个函数才会结束</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">numbers</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 1, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 2, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">// { value: 4, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 5, done: false }</span>
g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 7, done: true }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="yield-表达式" tabindex="-1"><a class="header-anchor" href="#yield-表达式" aria-hidden="true">#</a> yield* 表达式</h2><p>如果在 Generator 函数内部，调用另一个 Generator 函数。需要在前者的函数体内部，自己手动完成遍历</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// 手动遍历 foo()</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// x</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>
<span class="token comment">// y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ES6 提供了 <code>yield*</code> 表达式，用来解决一个 Generator 函数里面执行另一个 Generator 函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;x&quot;</span>
<span class="token comment">// &quot;a&quot;</span>
<span class="token comment">// &quot;b&quot;</span>
<span class="token comment">// &quot;y&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另个例子</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;hello!&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">outer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;open&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;close&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">outer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &quot;open&quot;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// 返回一个遍历器对象</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &quot;close&quot;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">outer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;open&#39;</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">yield</span> <span class="token string">&#39;close&#39;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">outer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &quot;open&quot;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &quot;hello!&quot;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &quot;close&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面例子中，<code>outer2</code> 使用了 <code>yield*</code> ，<code>outer1</code>没使用。结果就是，<code>outer1</code> 返回一个遍历器对象，<code>outer2</code> 返回该遍历器对象的内部值</p><h2 id="作为对象属性的-generator-函数" tabindex="-1"><a class="header-anchor" href="#作为对象属性的-generator-函数" aria-hidden="true">#</a> 作为对象属性的 Generator 函数</h2><p>如果一个对象的属性是 Generator 函数，可以简写成下面的形式:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span> <span class="token function">myGeneratorMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ···
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 等价于</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">myGeneratorMethod</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ···</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，<code>myGeneratorMethod</code> 属性前面有一个星号，表示这个属性是一个 Generator 函数</p><h2 id="generator-函数的this" tabindex="-1"><a class="header-anchor" href="#generator-函数的this" aria-hidden="true">#</a> Generator 函数的this</h2><p>Generator 函数总是返回一个遍历器，ES6 规定这个遍历器是 Generator 函数的实例，也继承了 Generator 函数的 <code>prototype</code> 对象上的方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

g<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&#39;hi!&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj <span class="token keyword">instanceof</span> <span class="token class-name">g</span> <span class="token comment">// true</span>
obj<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &#39;hi!&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果把 <code>g</code> 当作普通的构造函数，并不会生效，因为g返回的总是遍历器对象，而不是 <code>this</code> 对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>a <span class="token comment">// undefined</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Generator 函数也不能跟 <code>new</code> 命令一起用，会报错</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: F is not a constructor</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面是一个变通方法。首先，生成一个空对象，使用 <code>call</code> 方法绑定 Generator 函数内部的 <code>this</code> 。这样，构造函数调用以后，这个空对象就是 Generator 函数的实例对象了</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

f<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Object {value: 2, done: false}</span>
f<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Object {value: 3, done: false}</span>
f<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Object {value: undefined, done: true}</span>

obj<span class="token punctuation">.</span>a <span class="token comment">// 1</span>
obj<span class="token punctuation">.</span>b <span class="token comment">// 2</span>
obj<span class="token punctuation">.</span>c <span class="token comment">// 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generator-与状态机" tabindex="-1"><a class="header-anchor" href="#generator-与状态机" aria-hidden="true">#</a> Generator 与状态机</h2><p>Generator 是实现状态机的最佳结构。比如，下面的 <code>clock</code> 函数就是一个状态机</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> ticking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">clock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ticking<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Tick!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Tock!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ticking <span class="token operator">=</span> <span class="token operator">!</span>ticking<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码的 <code>clock</code> 函数一共有两种状态（ <code>Tick</code> 和 <code>Tock</code> ），每运行一次，就改变一次状态。这个函数如果用 Generator 实现，就是下面这样</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">clock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Tick!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Tock!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generator-的上下文" tabindex="-1"><a class="header-anchor" href="#generator-的上下文" aria-hidden="true">#</a> Generator 的上下文</h2><p>JavaScript 代码运行时，会产生一个全局的上下文环境（ context，又称运行环境），包含了当前所有的变量和对象。然后，执行函数（或块级代码）的时候，又会在当前上下文环境的上层，产生一个函数运行的上下文，变成当前（active）的上下文，由此形成一个上下文环境的堆栈（context stack）。</p><p>这个堆栈是“后进先出”的数据结构，最后产生的上下文环境首先执行完成，退出堆栈，然后再执行完成它下层的上下文，直至所有代码执行完成，堆栈清空。</p><p>Generator 函数不是这样，它执行产生的上下文环境，一旦遇到 <code>yield</code> 命令，就会暂时退出堆栈，但是并不消失，里面的所有变量和对象会冻结在当前状态。等到对它执行 <code>next</code> 命令时，这个上下文环境又会重新加入调用栈，冻结的变量和对象恢复执行</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，第一次执行 <code>g.next()</code> 时，Generator 函数 <code>gen</code> 的上下文会加入堆栈，即开始运行 <code>gen</code> 内部的代码。等遇到 <code>yield 1</code> 时， <code>gen</code> 上下文退出堆栈，内部状态冻结。第二次执行 <code>g.next()</code> 时，<code>gen</code> 上下文重新加入堆栈，变成当前的上下文，重新恢复执行</p><h2 id="应用" tabindex="-1"><a class="header-anchor" href="#应用" aria-hidden="true">#</a> 应用</h2><h3 id="异步操作的同步化表达" tabindex="-1"><a class="header-anchor" href="#异步操作的同步化表达" aria-hidden="true">#</a> 异步操作的同步化表达</h3><p><strong>同步化AJAX</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;http://some.url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">makeAjaxCall</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>逐行读取文本文件</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;numbers.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span>eof<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="控制流管理" tabindex="-1"><a class="header-anchor" href="#控制流管理" aria-hidden="true">#</a> 控制流管理</h3><p>如果有一个多步操作非常耗时，采用回调函数，可能会写成下面这样</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">step1</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">step2</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">step3</span><span class="token punctuation">(</span>value2<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">step4</span><span class="token punctuation">(</span>value3<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Do something with value4</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>采用 Promise 改写上面的代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>step1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step4<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with value4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any error from step1 through step4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码已经把回调函数，改成了直线执行的形式，但是加入了大量 Promise 的语法。Generator 函数可以进一步改善代码运行流程</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">longRunningTask</span><span class="token punctuation">(</span><span class="token parameter">value1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step1</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step2</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value4 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step3</span><span class="token punctuation">(</span>value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value5 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step4</span><span class="token punctuation">(</span>value4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do something with value4</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any error from step1 through step4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，使用一个函数，按次序自动执行所有步骤</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token function">longRunningTask</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">scheduler</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> taskObj <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果Generator函数未结束，就继续调用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>taskObj<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    task<span class="token punctuation">.</span>value <span class="token operator">=</span> taskObj<span class="token punctuation">.</span>value
    <span class="token function">scheduler</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，上面这种做法，只适合同步操作，即所有的 <code>task</code> 都必须是同步的，不能有异步操作。因为这里的代码一得到返回值，就继续往下执行，没有判断异步操作何时完成。如果要控制异步的操作流程</p><h3 id="部署-iterator-接口" tabindex="-1"><a class="header-anchor" href="#部署-iterator-接口" aria-hidden="true">#</a> 部署 Iterator 接口</h3><p>利用 Generator 函数，可以在任意对象上部署 Iterator 接口</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">iterEntries</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">iterEntries</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// foo 3</span>
<span class="token comment">// bar 7</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码中，<code>myObj</code> 是一个普通对象，通过 <code>iterEntries</code> 函数，就有了 Iterator 接口。也就是说，可以在任意对象上部署next方法。</p><p>下面是一个对数组部署 Iterator 接口的例子，尽管数组原生具有这个接口</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">makeSimpleGenerator</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> nextIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span><span class="token punctuation">(</span>nextIndex <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">yield</span> array<span class="token punctuation">[</span>nextIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">makeSimpleGenerator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;yo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ya&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &#39;yo&#39;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment">// &#39;ya&#39;</span>
gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done  <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="generator-的异步应用" tabindex="-1"><a class="header-anchor" href="#generator-的异步应用" aria-hidden="true">#</a> Generator 的异步应用</h3><h4 id="thunk-函数" tabindex="-1"><a class="header-anchor" href="#thunk-函数" aria-hidden="true">#</a> Thunk 函数</h4><p>将参数放到一个临时函数之中，再将这个临时函数传入函数体。这个临时函数就叫做 Thunk 函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> m <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>

<span class="token keyword">var</span> <span class="token function-variable function">thunk</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">thunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">thunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，函数 <code>f</code> 的参数 <code>x + 5</code> 被一个函数替换了。凡是用到原参数的地方，对 Thunk函数求值即可。</p><p>这就是 Thunk 函数的定义，它是“传名调用”的一种实现策略，用来替换某个表达式</p><h4 id="co-模块" tabindex="-1"><a class="header-anchor" href="#co-模块" aria-hidden="true">#</a> co 模块</h4><p>co 模块用于 Generator 函数的自动执行</p><p>下面是一个 Generator 函数，用于依次读取两个文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;/etc/fstab&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;/etc/shells&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>co 模块可以让你不用编写 Generator 函数的执行器。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;co&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">co</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，Generator 函数只要传入 co 函数，就会自动执行。</p><p>co 函数返回一个 <code>Promise</code> 对象，因此可以用 <code>then</code> 方法添加回调函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">co</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Generator 函数执行完成&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="co-模块的原理" tabindex="-1"><a class="header-anchor" href="#co-模块的原理" aria-hidden="true">#</a> co 模块的原理</h4><p>Generator 就是一个异步操作的容器。它的自动执行需要一种机制，当异步操作有了结果，能够自动交回执行权</p><p>两种方法可以做到这一点</p><ol><li><p>回调函数。将异步操作包装成 Thunk 函数，在回调函数里面交回执行权</p></li><li><p>Promise 对象。将异步操作包装成 Promise 对象，用then方法交回执行权</p></li></ol><p>co 模块其实就是将两种自动执行器（Thunk 函数和 Promise 对象），包装成一个模块。使用 co 的前提条件是，Generator 函数的yield命令后面，只能是 Thunk 函数或 Promise 对象.如果数组或对象的成员，全部都是 Promise 对象，也可以使用 co</p><p><strong>基于 Promise 对象的自动执行</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> sue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> callback <span class="token operator">=</span> sue <span class="token operator">?</span> resolve <span class="token operator">:</span> reject
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面是一个手动执行的例子，手动执行其实就是用 <code>then</code> 方法，层层添加回调函数。理解了这一点，就可以写出一个自动执行器</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token keyword">var</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> gg <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>gg<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> gg<span class="token punctuation">.</span>value
      gg<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">co</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>co 模块的源码</strong></p><p>首先，co 函数接受 Generator 函数作为参数，返回一个 Promise 对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在返回的 Promise 对象里面，co 先检查参数 <code>gen</code> 是否为 Generator 函数。如果是，就执行该函数，得到一个内部指针对象；如果不是就返回，并将 Promise 对象的状态改为 <code>resolved</code> 。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> gen <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gen <span class="token operator">||</span> <span class="token keyword">typeof</span> gen<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着，co 将 Generator 函数的内部指针对象的 <code>next</code> 方法，包装成 <code>onFulfilled</code> 函数。这主要是为了能够捕捉抛出的错误</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> gen <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gen <span class="token operator">||</span> <span class="token keyword">typeof</span> gen<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，就是关键的 <code>next</code> 函数，它会反复调用自身</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">toPromise</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token function">isPromise</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>
      <span class="token string">&#39;You may only yield a function, promise, generator, array, or object, &#39;</span>
      <span class="token operator">+</span> <span class="token string">&#39;but the following object was passed: &quot;&#39;</span>
      <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中，<code>next</code> 函数的内部代码，一共只有四行命令。</p><p>第一行，检查当前是否为 Generator 函数的最后一步，如果是就返回。</p><p>第二行，确保每一步的返回值，是 Promise 对象。</p><p>第三行，使用 <code>then</code> 方法，为返回值加上回调函数，然后通过 <code>onFulfilled</code> 函数再次调用 <code>next</code> 函数。</p><p>第四行，在参数不符合要求的情况下（参数非 Thunk 函数和 Promise 对象），将 Promise 对象的状态改为 <code>rejected</code>，从而终止执行</p><p><strong>处理并发的异步操作</strong></p><p>co 支持并发的异步操作，即允许某些操作同时进行，等到它们全部完成，才进行下一步。</p><p>这时，要把并发的操作都放在数组或对象里面，跟在 <code>yield</code> 语句后面</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 数组的写法</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">[</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对象的写法</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">{</span>
    <span class="token number">1</span><span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下面是另一个例子</span>

<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token punctuation">[</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> n3<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>somethingAsync<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">somethingAsync</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something async</span>
  <span class="token keyword">return</span> y
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码允许并发三个 <code>somethingAsync</code> 异步操作，等到它们全部完成，才会进行下一步</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 156081289@qq.com">156081289@qq.com</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/lanjz/ES6/Iterator.html" class="" aria-label="Iterator"><!--[--><!--]--> Iterator <!--[--><!--]--></a></span><span class="next"><a href="/lanjz/ES6/async%E5%87%BD%E6%95%B0.html" class="" aria-label="async 函数"><!--[--><!--]--> async 函数 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/lanjz/assets/app-tEWqIxV0.js" defer></script>
  </body>
</html>
