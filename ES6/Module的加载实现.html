<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Module 的加载实现 | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.74a95399.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.b6657784.js" as="script"><link rel="preload" href="/lanjz/assets/js/79.7156c60c.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.135dac49.js"><link rel="prefetch" href="/lanjz/assets/js/100.eb56f625.js"><link rel="prefetch" href="/lanjz/assets/js/101.1b7d4ae5.js"><link rel="prefetch" href="/lanjz/assets/js/102.cac79d0b.js"><link rel="prefetch" href="/lanjz/assets/js/103.696746c8.js"><link rel="prefetch" href="/lanjz/assets/js/104.d44d0eb4.js"><link rel="prefetch" href="/lanjz/assets/js/105.0c96482a.js"><link rel="prefetch" href="/lanjz/assets/js/106.c48fedcc.js"><link rel="prefetch" href="/lanjz/assets/js/107.0536b833.js"><link rel="prefetch" href="/lanjz/assets/js/108.97b5ca82.js"><link rel="prefetch" href="/lanjz/assets/js/109.e050fbda.js"><link rel="prefetch" href="/lanjz/assets/js/11.5101de3b.js"><link rel="prefetch" href="/lanjz/assets/js/110.c3bf1ab7.js"><link rel="prefetch" href="/lanjz/assets/js/111.27338cc0.js"><link rel="prefetch" href="/lanjz/assets/js/112.516de2d7.js"><link rel="prefetch" href="/lanjz/assets/js/113.a4b9a5e1.js"><link rel="prefetch" href="/lanjz/assets/js/114.53c3461d.js"><link rel="prefetch" href="/lanjz/assets/js/115.e05abe58.js"><link rel="prefetch" href="/lanjz/assets/js/116.3f9445d8.js"><link rel="prefetch" href="/lanjz/assets/js/117.3b3ac408.js"><link rel="prefetch" href="/lanjz/assets/js/118.5154e18a.js"><link rel="prefetch" href="/lanjz/assets/js/119.ecfbe313.js"><link rel="prefetch" href="/lanjz/assets/js/12.ea6dcc01.js"><link rel="prefetch" href="/lanjz/assets/js/120.093ef03a.js"><link rel="prefetch" href="/lanjz/assets/js/121.4edc033a.js"><link rel="prefetch" href="/lanjz/assets/js/122.26429379.js"><link rel="prefetch" href="/lanjz/assets/js/123.8d769974.js"><link rel="prefetch" href="/lanjz/assets/js/124.99c9f5d2.js"><link rel="prefetch" href="/lanjz/assets/js/125.9abaca25.js"><link rel="prefetch" href="/lanjz/assets/js/126.eb6c391a.js"><link rel="prefetch" href="/lanjz/assets/js/127.1944893c.js"><link rel="prefetch" href="/lanjz/assets/js/128.755539ed.js"><link rel="prefetch" href="/lanjz/assets/js/129.08705399.js"><link rel="prefetch" href="/lanjz/assets/js/13.b07729d4.js"><link rel="prefetch" href="/lanjz/assets/js/130.b4306584.js"><link rel="prefetch" href="/lanjz/assets/js/131.ac0a82cc.js"><link rel="prefetch" href="/lanjz/assets/js/132.2bf6ad9a.js"><link rel="prefetch" href="/lanjz/assets/js/133.56baa10c.js"><link rel="prefetch" href="/lanjz/assets/js/134.82c7c157.js"><link rel="prefetch" href="/lanjz/assets/js/135.e5391a13.js"><link rel="prefetch" href="/lanjz/assets/js/136.e5d6872c.js"><link rel="prefetch" href="/lanjz/assets/js/137.4edbcf2d.js"><link rel="prefetch" href="/lanjz/assets/js/138.b725bdd7.js"><link rel="prefetch" href="/lanjz/assets/js/139.05d8f323.js"><link rel="prefetch" href="/lanjz/assets/js/14.6518c95e.js"><link rel="prefetch" href="/lanjz/assets/js/140.fb85e793.js"><link rel="prefetch" href="/lanjz/assets/js/141.4d1825df.js"><link rel="prefetch" href="/lanjz/assets/js/142.4dea11c2.js"><link rel="prefetch" href="/lanjz/assets/js/143.8ba5373d.js"><link rel="prefetch" href="/lanjz/assets/js/144.b1a9c6c1.js"><link rel="prefetch" href="/lanjz/assets/js/145.6eb832a4.js"><link rel="prefetch" href="/lanjz/assets/js/146.5920b575.js"><link rel="prefetch" href="/lanjz/assets/js/147.64e51213.js"><link rel="prefetch" href="/lanjz/assets/js/148.1ae48948.js"><link rel="prefetch" href="/lanjz/assets/js/149.c4b009e6.js"><link rel="prefetch" href="/lanjz/assets/js/15.2e0422dc.js"><link rel="prefetch" href="/lanjz/assets/js/150.098eb624.js"><link rel="prefetch" href="/lanjz/assets/js/151.7d5aa39f.js"><link rel="prefetch" href="/lanjz/assets/js/152.2cf262bd.js"><link rel="prefetch" href="/lanjz/assets/js/153.e2ef256f.js"><link rel="prefetch" href="/lanjz/assets/js/154.368d65e7.js"><link rel="prefetch" href="/lanjz/assets/js/155.521f3ba3.js"><link rel="prefetch" href="/lanjz/assets/js/156.6adf1b34.js"><link rel="prefetch" href="/lanjz/assets/js/157.162ee580.js"><link rel="prefetch" href="/lanjz/assets/js/158.9bfd1aa1.js"><link rel="prefetch" href="/lanjz/assets/js/159.ce73f74d.js"><link rel="prefetch" href="/lanjz/assets/js/16.9302b413.js"><link rel="prefetch" href="/lanjz/assets/js/160.32f84638.js"><link rel="prefetch" href="/lanjz/assets/js/161.9d24db6c.js"><link rel="prefetch" href="/lanjz/assets/js/162.028353fb.js"><link rel="prefetch" href="/lanjz/assets/js/163.ba655b4e.js"><link rel="prefetch" href="/lanjz/assets/js/164.fbaeda88.js"><link rel="prefetch" href="/lanjz/assets/js/165.ac8efaaa.js"><link rel="prefetch" href="/lanjz/assets/js/166.0ff447cd.js"><link rel="prefetch" href="/lanjz/assets/js/167.eabf202b.js"><link rel="prefetch" href="/lanjz/assets/js/168.4daed6f0.js"><link rel="prefetch" href="/lanjz/assets/js/169.dfc9f41d.js"><link rel="prefetch" href="/lanjz/assets/js/17.59131120.js"><link rel="prefetch" href="/lanjz/assets/js/170.899515d4.js"><link rel="prefetch" href="/lanjz/assets/js/171.72a427a8.js"><link rel="prefetch" href="/lanjz/assets/js/172.063eb6f3.js"><link rel="prefetch" href="/lanjz/assets/js/173.810b770c.js"><link rel="prefetch" href="/lanjz/assets/js/174.1b09aab4.js"><link rel="prefetch" href="/lanjz/assets/js/175.dc54ec84.js"><link rel="prefetch" href="/lanjz/assets/js/176.f56a227f.js"><link rel="prefetch" href="/lanjz/assets/js/177.11095447.js"><link rel="prefetch" href="/lanjz/assets/js/178.b5089b71.js"><link rel="prefetch" href="/lanjz/assets/js/179.b54c84b1.js"><link rel="prefetch" href="/lanjz/assets/js/18.6c85105b.js"><link rel="prefetch" href="/lanjz/assets/js/180.3023a3c3.js"><link rel="prefetch" href="/lanjz/assets/js/181.5be0bb13.js"><link rel="prefetch" href="/lanjz/assets/js/182.2604f6c1.js"><link rel="prefetch" href="/lanjz/assets/js/183.faf8c9c0.js"><link rel="prefetch" href="/lanjz/assets/js/184.4c783c7f.js"><link rel="prefetch" href="/lanjz/assets/js/185.83221fb1.js"><link rel="prefetch" href="/lanjz/assets/js/186.c732db5c.js"><link rel="prefetch" href="/lanjz/assets/js/187.b04a38f5.js"><link rel="prefetch" href="/lanjz/assets/js/188.74b0dffe.js"><link rel="prefetch" href="/lanjz/assets/js/189.00534ed0.js"><link rel="prefetch" href="/lanjz/assets/js/19.0608e710.js"><link rel="prefetch" href="/lanjz/assets/js/190.c6ceaa14.js"><link rel="prefetch" href="/lanjz/assets/js/191.00d2b550.js"><link rel="prefetch" href="/lanjz/assets/js/192.6b388a9c.js"><link rel="prefetch" href="/lanjz/assets/js/193.9d8b590d.js"><link rel="prefetch" href="/lanjz/assets/js/194.976323b2.js"><link rel="prefetch" href="/lanjz/assets/js/195.75a3f950.js"><link rel="prefetch" href="/lanjz/assets/js/196.81a9b350.js"><link rel="prefetch" href="/lanjz/assets/js/197.660f2a40.js"><link rel="prefetch" href="/lanjz/assets/js/198.1e42d031.js"><link rel="prefetch" href="/lanjz/assets/js/199.aae3e134.js"><link rel="prefetch" href="/lanjz/assets/js/20.8b212eff.js"><link rel="prefetch" href="/lanjz/assets/js/200.fac21847.js"><link rel="prefetch" href="/lanjz/assets/js/201.309142ab.js"><link rel="prefetch" href="/lanjz/assets/js/202.f50bc7d8.js"><link rel="prefetch" href="/lanjz/assets/js/203.c2fb5573.js"><link rel="prefetch" href="/lanjz/assets/js/204.1428f6ad.js"><link rel="prefetch" href="/lanjz/assets/js/205.9ea80447.js"><link rel="prefetch" href="/lanjz/assets/js/206.32a32afa.js"><link rel="prefetch" href="/lanjz/assets/js/207.05cd004c.js"><link rel="prefetch" href="/lanjz/assets/js/208.7124e12d.js"><link rel="prefetch" href="/lanjz/assets/js/209.8207c65c.js"><link rel="prefetch" href="/lanjz/assets/js/21.2d02f796.js"><link rel="prefetch" href="/lanjz/assets/js/210.9a6cb13a.js"><link rel="prefetch" href="/lanjz/assets/js/211.6be65534.js"><link rel="prefetch" href="/lanjz/assets/js/212.8d1e5b1a.js"><link rel="prefetch" href="/lanjz/assets/js/213.0e0c1b0c.js"><link rel="prefetch" href="/lanjz/assets/js/214.8c93faf8.js"><link rel="prefetch" href="/lanjz/assets/js/215.ccc8248c.js"><link rel="prefetch" href="/lanjz/assets/js/216.124b10a7.js"><link rel="prefetch" href="/lanjz/assets/js/22.bbcef400.js"><link rel="prefetch" href="/lanjz/assets/js/23.720604cc.js"><link rel="prefetch" href="/lanjz/assets/js/24.1d5d6d37.js"><link rel="prefetch" href="/lanjz/assets/js/25.31c1a56d.js"><link rel="prefetch" href="/lanjz/assets/js/26.7d3b33e4.js"><link rel="prefetch" href="/lanjz/assets/js/27.38cde5eb.js"><link rel="prefetch" href="/lanjz/assets/js/28.77316bbb.js"><link rel="prefetch" href="/lanjz/assets/js/29.8b95365f.js"><link rel="prefetch" href="/lanjz/assets/js/3.1a7ae87d.js"><link rel="prefetch" href="/lanjz/assets/js/30.f4bb5db6.js"><link rel="prefetch" href="/lanjz/assets/js/31.62a5862d.js"><link rel="prefetch" href="/lanjz/assets/js/32.81e98900.js"><link rel="prefetch" href="/lanjz/assets/js/33.526a3f73.js"><link rel="prefetch" href="/lanjz/assets/js/34.b8c98ad0.js"><link rel="prefetch" href="/lanjz/assets/js/35.6fbc44d5.js"><link rel="prefetch" href="/lanjz/assets/js/36.d43375ea.js"><link rel="prefetch" href="/lanjz/assets/js/37.239c9b8b.js"><link rel="prefetch" href="/lanjz/assets/js/38.3433e4c4.js"><link rel="prefetch" href="/lanjz/assets/js/39.432bfb27.js"><link rel="prefetch" href="/lanjz/assets/js/4.a1077323.js"><link rel="prefetch" href="/lanjz/assets/js/40.01eb46fc.js"><link rel="prefetch" href="/lanjz/assets/js/41.861c744a.js"><link rel="prefetch" href="/lanjz/assets/js/42.cbb45802.js"><link rel="prefetch" href="/lanjz/assets/js/43.3c696336.js"><link rel="prefetch" href="/lanjz/assets/js/44.2706e92d.js"><link rel="prefetch" href="/lanjz/assets/js/45.c888c842.js"><link rel="prefetch" href="/lanjz/assets/js/46.e258f996.js"><link rel="prefetch" href="/lanjz/assets/js/47.8cdcf187.js"><link rel="prefetch" href="/lanjz/assets/js/48.d0a725f7.js"><link rel="prefetch" href="/lanjz/assets/js/49.24be0f58.js"><link rel="prefetch" href="/lanjz/assets/js/5.5f19ad53.js"><link rel="prefetch" href="/lanjz/assets/js/50.78ed49f1.js"><link rel="prefetch" href="/lanjz/assets/js/51.deaa1248.js"><link rel="prefetch" href="/lanjz/assets/js/52.37fd4d5d.js"><link rel="prefetch" href="/lanjz/assets/js/53.ec0f49d5.js"><link rel="prefetch" href="/lanjz/assets/js/54.a1cacee3.js"><link rel="prefetch" href="/lanjz/assets/js/55.00c7669f.js"><link rel="prefetch" href="/lanjz/assets/js/56.7e6a0de8.js"><link rel="prefetch" href="/lanjz/assets/js/57.746e4d78.js"><link rel="prefetch" href="/lanjz/assets/js/58.c853cd1c.js"><link rel="prefetch" href="/lanjz/assets/js/59.9f5b3a9d.js"><link rel="prefetch" href="/lanjz/assets/js/6.fdc66e0f.js"><link rel="prefetch" href="/lanjz/assets/js/60.01e3d999.js"><link rel="prefetch" href="/lanjz/assets/js/61.e5953f90.js"><link rel="prefetch" href="/lanjz/assets/js/62.703d60d8.js"><link rel="prefetch" href="/lanjz/assets/js/63.612eb261.js"><link rel="prefetch" href="/lanjz/assets/js/64.69c8f137.js"><link rel="prefetch" href="/lanjz/assets/js/65.2b9041f2.js"><link rel="prefetch" href="/lanjz/assets/js/66.61fc0cda.js"><link rel="prefetch" href="/lanjz/assets/js/67.9dda22dd.js"><link rel="prefetch" href="/lanjz/assets/js/68.84e9349c.js"><link rel="prefetch" href="/lanjz/assets/js/69.b1983758.js"><link rel="prefetch" href="/lanjz/assets/js/7.9e9aae8b.js"><link rel="prefetch" href="/lanjz/assets/js/70.17553029.js"><link rel="prefetch" href="/lanjz/assets/js/71.b20ba6a3.js"><link rel="prefetch" href="/lanjz/assets/js/72.e65dc138.js"><link rel="prefetch" href="/lanjz/assets/js/73.3848da20.js"><link rel="prefetch" href="/lanjz/assets/js/74.52276359.js"><link rel="prefetch" href="/lanjz/assets/js/75.430cdc21.js"><link rel="prefetch" href="/lanjz/assets/js/76.15e01b1b.js"><link rel="prefetch" href="/lanjz/assets/js/77.00c7247c.js"><link rel="prefetch" href="/lanjz/assets/js/78.b7cd2a8c.js"><link rel="prefetch" href="/lanjz/assets/js/8.842188e7.js"><link rel="prefetch" href="/lanjz/assets/js/80.a82899e9.js"><link rel="prefetch" href="/lanjz/assets/js/81.7f6fd440.js"><link rel="prefetch" href="/lanjz/assets/js/82.1db14728.js"><link rel="prefetch" href="/lanjz/assets/js/83.f18faec8.js"><link rel="prefetch" href="/lanjz/assets/js/84.b6191e36.js"><link rel="prefetch" href="/lanjz/assets/js/85.bea673ae.js"><link rel="prefetch" href="/lanjz/assets/js/86.1cdfbc59.js"><link rel="prefetch" href="/lanjz/assets/js/87.0f7d7d97.js"><link rel="prefetch" href="/lanjz/assets/js/88.276e617c.js"><link rel="prefetch" href="/lanjz/assets/js/89.ab5377dd.js"><link rel="prefetch" href="/lanjz/assets/js/9.00641529.js"><link rel="prefetch" href="/lanjz/assets/js/90.6389fb75.js"><link rel="prefetch" href="/lanjz/assets/js/91.9faf26ed.js"><link rel="prefetch" href="/lanjz/assets/js/92.bc7e668f.js"><link rel="prefetch" href="/lanjz/assets/js/93.88e67c34.js"><link rel="prefetch" href="/lanjz/assets/js/94.511497e9.js"><link rel="prefetch" href="/lanjz/assets/js/95.d0f8ca9b.js"><link rel="prefetch" href="/lanjz/assets/js/96.562b8b30.js"><link rel="prefetch" href="/lanjz/assets/js/97.80e88f1b.js"><link rel="prefetch" href="/lanjz/assets/js/98.f05f00d1.js"><link rel="prefetch" href="/lanjz/assets/js/99.4fa9e160.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link router-link-active">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link router-link-active">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lanjz/ES6/函数的扩展.html" class="sidebar-link">ES6</a></li><li><a href="/lanjz/ES6/Symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/lanjz/ES6/数组.html" class="sidebar-link">数组</a></li><li><a href="/lanjz/ES6/对象.html" class="sidebar-link">对象</a></li><li><a href="/lanjz/ES6/Set和WeakSet.html" class="sidebar-link">Set和WeakSet</a></li><li><a href="/lanjz/ES6/Map和WeakMap.html" class="sidebar-link">Map和WeakMap</a></li><li><a href="/lanjz/ES6/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/lanjz/ES6/Iterator.html" class="sidebar-link">Iterator</a></li><li><a href="/lanjz/ES6/Generator.html" class="sidebar-link">Generator</a></li><li><a href="/lanjz/ES6/async函数.html" class="sidebar-link">async 函数</a></li><li><a href="/lanjz/ES6/Proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/lanjz/ES6/Class.html" class="sidebar-link">Class</a></li><li><a href="/lanjz/ES6/Class继承.html" class="sidebar-link">Class继承</a></li><li><a href="/lanjz/ES6/Module.html" class="sidebar-link">Module</a></li><li><a href="/lanjz/ES6/Module的加载实现.html" class="active sidebar-link">Module 的加载实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#浏览器加载" class="sidebar-link">浏览器加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#传统加载" class="sidebar-link">传统加载</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#浏览器加载-es6-模块" class="sidebar-link">浏览器加载 ES6 模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#es6-模块与-commonjs-模块的差异" class="sidebar-link">ES6 模块与 CommonJS 模块的差异</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#node-js-加载" class="sidebar-link">Node.js 加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#main-字段" class="sidebar-link">main 字段</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#exports-字段" class="sidebar-link">exports 字段</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#es6-模块加载-commonjs-模块" class="sidebar-link">ES6 模块加载 CommonJS 模块</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#commonjs-模块加载-es6-模块" class="sidebar-link">CommonJS 模块加载 ES6 模块</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#node-js-的内置模块" class="sidebar-link">Node.js 的内置模块</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#加载路径" class="sidebar-link">加载路径</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#内部变量" class="sidebar-link">内部变量</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#commonjs-模块的加载原理" class="sidebar-link">CommonJS 模块的加载原理</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#commonjs-模块的循环加载" class="sidebar-link">CommonJS 模块的循环加载</a></li><li class="sidebar-sub-header"><a href="/lanjz/ES6/Module的加载实现.html#es6-模块的循环加载" class="sidebar-link">ES6 模块的循环加载</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="module-的加载实现"><a href="#module-的加载实现" class="header-anchor">#</a> Module 的加载实现</h1> <h2 id="浏览器加载"><a href="#浏览器加载" class="header-anchor">#</a> 浏览器加载</h2> <h3 id="传统加载"><a href="#传统加载" class="header-anchor">#</a> 传统加载</h3> <p>HTML 网页中，浏览器通过 <code>&lt;script&gt;</code> 标签加载 JavaScript 脚本</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 页面内嵌的脚本 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;application/javascript&quot;</span><span class="token operator">&gt;</span>
  <span class="token comment">// module code</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 外部脚本 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;application/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>上面代码中，由于浏览器脚本的默认语言是 JavaScript，因此 <code>type=&quot;application/javascript&quot;</code> 可以省略</p> <p>默认情况下，浏览器是同步加载 JavaScript 脚本，即渲染引擎遇到 <code>&lt;script&gt;</code> 标签就会停下来，等到执行完脚本，再继续向下渲染。如果是外部脚本，还必须加入脚本下载的时间</p> <p><code>defer</code> 和 <code>async</code> 两个属性可以让脚本异步加载</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> async<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><code>defer</code> 与 <code>async</code> 的区别是：</p> <ul><li><p><code>defer</code> 属性脚本的执行是在所有元素解析完成之后，DOMContentLoaded 事件触发之前完成，并且当包含多个 <code>defer</code> 标签的传本时，它是按照加载顺序执行脚本的</p></li> <li><p><code>async</code> 的脚本并不保证按照指定它们的先后顺序执行。对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行</p></li></ul> <h3 id="浏览器加载-es6-模块"><a href="#浏览器加载-es6-模块" class="header-anchor">#</a> 浏览器加载 ES6 模块</h3> <p>浏览器加载 ES6 模块，也使用 <code>&lt;script&gt;</code> 标签，但是要加入 <code>type=&quot;module&quot;</code> 属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./foo.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span>
  <span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;./jquery/src/jquery.js&quot;</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Hi from jQuery!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>浏览器对于带有 <code>type=&quot;module&quot;</code> 的 <code>&lt;script&gt;</code> ，都是异步加载，不会造成堵塞浏览器，即等到整个页面渲染完，再执行模块脚本，等同于打开了 <code>&lt;script&gt;</code> 标签的 <code>defer</code> 属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./foo.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 等同于 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./foo.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>如果网页有多个 <code>&lt;script type=&quot;module&quot;&gt;</code> ，它们会按照在页面出现的顺序依次执行</p> <p>对于外部的模块脚本（上例是foo.js），有几点需要注意:</p> <ul><li><p>代码是在模块作用域之中运行，而不是在全局作用域运行。模块内部的顶层变量，外部不可见</p></li> <li><p>模块脚本自动采用严格模式，不管有没有声明 <code>use strict</code></p></li> <li><p>模块之中，可以使用 <code>import</code> 命令加载其他模块（ <code>.js</code> 后缀不可省略，需要提供绝对 URL 或相对 URL），也可以使用 <code>export</code> 命令输出对外接口</p></li> <li><p>模块之中，顶层的 <code>this</code> 关键字返回 <code>undefined</code> ，而不是指向 <code>window</code> 。也就是说，在模块顶层使用 <code>this</code> 关键字，是无意义的</p></li> <li><p>同一个模块如果加载多次，将只执行一次</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">'https://example.com/js/utils.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x <span class="token operator">===</span> window<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>利用顶层的 <code>this</code> 等于 <code>undefined</code> 这个语法点，可以侦测当前代码是否在 ES6 模块之中</p> <h2 id="es6-模块与-commonjs-模块的差异"><a href="#es6-模块与-commonjs-模块的差异" class="header-anchor">#</a> ES6 模块与 CommonJS 模块的差异</h2> <ul><li><p>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用。</p></li> <li><p>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口</p></li></ul> <p><strong>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用</strong></p> <p>CommonJS 模块输出的是值的拷贝，也就是说，一旦输出一个值，模块内部的变化就影响不到这个值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token operator">:</span> counter<span class="token punctuation">,</span>
  incCounter<span class="token operator">:</span> incCounter<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>引用这个模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">var</span> mod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
mod<span class="token punctuation">.</span><span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><p>上面代码说明，<code>lib.js</code> 模块加载以后，它的内部变化就影响不到输出的 <code>mod.counter</code> 了。这是因为 <code>mod.counter</code> 是一个原始类型的值，会被缓存。除非写成一个函数，才能得到内部变动后的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> counter
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  incCounter<span class="token operator">:</span> incCounter<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>通过取值器函数就可以正确读取内部变量 <code>counter</code> 的变动了</p> <div class="language-js extra-class"><pre class="language-js"><code>node main<span class="token punctuation">.</span>js
<span class="token number">3</span>
<span class="token number">4</span>
</code></pre></div><p>ES6 模块的运行机制与 CommonJS 不一样。JS 引擎对脚本静态分析的时候，遇到模块加载命令 <code>import</code>，就会生成一个只读引用.等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值</p> <p>因此，ES6 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> counter<span class="token punctuation">,</span> incCounter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lib'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre></div><p>由于 ES6 输入的模块变量，只是一个“符号连接”，所以这个变量是只读的，对它进行重新赋值会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> obj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lib'</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre></div><p>上面代码中，<code>main.js</code> 从 <code>lib.js</code> 输入变量 <code>obj</code>，可以对 <code>obj</code> 添加属性，但是重新赋值就会报错。因为变量 <code>obj</code> 指向的地址是只读的，不能重新赋值，这就好比 <code>main.js</code> 创造了一个名为 <code>obj</code> 的 <code>const</code> 变量</p> <p><strong>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口</strong></p> <p>第二个差异是因为 CommonJS 加载的是一个对象（即 <code>module.exports</code> 属性），该对象只有在脚本运行完才会生成。而 ES6 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成</p> <h2 id="node-js-加载"><a href="#node-js-加载" class="header-anchor">#</a> Node.js 加载</h2> <p>Node.js 对 ES6 模块的处理比较麻烦，因为它有自己的 CommonJS 模块格式，与 ES6 模块格式是不兼容的。目前的解决方案是，将两者分开，ES6 模块和 CommonJS 采用各自的加载方案。从 v13.2 版本开始，Node.js 已经默认打开了 ES6 模块支持</p> <p>Node.js 要求 ES6 模块采用 <code>.mjs</code> 后缀文件名。也就是说，只要脚本文件里面使用 <code>import</code> 或者 <code>export</code> 命令，那么就必须采用 <code>.mjs</code> 后缀名。Node.js 遇到 <code>.mjs</code> 文件，就认为它是 ES6 模块，默认启用严格模式，不必在每个模块文件顶部指定&quot;use strict&quot;</p> <p>如果不希望将后缀名改成 <code>.mjs</code> ，可以在项目的 <code>package.json</code> 文件中，指定 <code>type</code> 字段为 <code>module</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果这时还要使用 CommonJS 模块，那么需要将 CommonJS 脚本的后缀名都改成 <code>.cjs</code> 。如果没有 <code>type</code> 字段，或者 <code>type</code> 字段为 <code>commonjs</code> ，则 <code>.js</code> 脚本会被解释成 CommonJS 模块</p> <p>总结为一句话：<code>.mjs</code> 文件总是以 ES6 模块加载，<code>.cjs</code> 文件总是以 CommonJS 模块加载，<code>.js</code> 文件的加载取决于 <code>package.json</code> 里面 <code>type</code> 字段的设置</p> <p>注意，ES6 模块与 CommonJS 模块尽量不要混用。<code>require</code> 命令不能加载 <code>.mjs</code> 文件，会报错，只有 <code>import</code> 命令才可以加载 <code>.mjs</code> 文件。反过来，<code>.mjs</code> 文件里面也不能使用 <code>require</code> 命令，必须使用 <code>import</code></p> <h3 id="main-字段"><a href="#main-字段" class="header-anchor">#</a> main 字段</h3> <p><code>package.json</code> 文件有两个字段可以指定模块的入口文件：<code>main</code> 和 <code>exports</code> 。比较简单的模块，可以只使用 <code>main</code> 字段，指定模块加载的入口文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./node_modules/es-module-package/package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码指定项目的入口脚本为 <code>./src/index.js</code> ，它的格式为 ES6 模块。如果没有 <code>type</code> 字段，<code>index.js</code> 就会被解释为 CommonJS 模块</p> <p>然后，<code>import</code> 命令就可以加载这个模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./my-app.mjs</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> something <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'es-module-package'</span><span class="token punctuation">;</span>
<span class="token comment">// 实际加载的是 ./node_modules/es-module-package/src/index.js</span>
</code></pre></div><p>上面代码中，运行该脚本以后，Node.js 就会到 <code>./node_modules</code> 目录下面，寻找 <code>es-module-package</code> 模块，然后根据该模块 <code>package.json</code> 的 <code>main</code> 字段去执行入口文件。</p> <p>这时，如果用 CommonJS 模块的 <code>require()</code> 命令去加载 <code>es-module-package</code> 模块会报错，因为 CommonJS 模块不能处理 <code>export</code> 命令</p> <h3 id="exports-字段"><a href="#exports-字段" class="header-anchor">#</a> exports 字段</h3> <p><code>exports</code> 字段的优先级高于 <code>main</code> 字段。它有多种用法。</p> <p><strong>子目录别名</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./node_modules/es-module-package/package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;./submodule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/submodule.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码指定 <code>src/submodule.js</code> 别名为 <code>submodule</code> ，然后就可以从别名加载这个文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> submodule <span class="token keyword">from</span> <span class="token string">'es-module-package/submodule'</span><span class="token punctuation">;</span>
<span class="token comment">// 加载 ./node_modules/es-module-package/src/submodule.js</span>
</code></pre></div><p><strong>main 的别名</strong></p> <p><code>exports</code> 字段的别名如果是 <code>.</code> ，就代表模块的主入口，优先级高于 <code>main</code> 字段，并且可以直接简写成 <code>exports</code> 字段的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;.&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于 <code>exports</code> 字段只有支持 ES6 的 Node.js 才认识，所以可以用来兼容旧版本的 Node.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main-legacy.cjs&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;.&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main-modern.cjs&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，老版本的 Node.js （不支持 ES6 模块）的入口文件是 <code>main-legacy.cjs</code> ，新版本的 Node.js 的入口文件是<code>main-modern.cjs</code></p> <p><strong>条件加载</strong></p> <p>利用 <code>.</code> 这个别名，可以为 ES6 模块和 CommonJS 指定不同的入口。目前，这个功能需要在 Node.js 运行的时候，打开 <code>--experimental-conditional-exports</code> 标志</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.cjs&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，别名 <code>.</code> 的 <code>require</code> 条件指定 <code>require()</code> 命令的入口文件（即 CommonJS 的入口），<code>default</code> 条件指定其他情况的入口（即 ES6 的入口）。</p> <p>上面的写法可以简写如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.cjs&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，如果同时还有其他别名，就不能采用简写，否则或报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// 报错</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;./feature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/feature.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.cjs&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./main.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="es6-模块加载-commonjs-模块"><a href="#es6-模块加载-commonjs-模块" class="header-anchor">#</a> ES6 模块加载 CommonJS 模块</h2> <p>目前，一个模块同时支持 ES6 和 CommonJS 两种格式的常见方法是，<code>package.json</code> 文件的 <code>main</code> 字段指定 CommonJS 入口，给 Node.js 使用；<code>module</code> 字段指定 ES6 模块入口，给打包工具使用，因为 Node.js 不认识 <code>module</code> 字段。</p> <p>有了上一节的条件加载以后，Node.js 本身就可以同时处理两种模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./node_modules/pkg/package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.cjs&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./index.cjs&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./wrapper.mjs&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码指定了 CommonJS 入口文件 <code>index.cjs</code> ，下面是这个文件的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./node_modules/pkg/index.cjs</span>
exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'value'</span><span class="token punctuation">;</span>
</code></pre></div><p>然后，ES6 模块可以加载这个文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./node_modules/pkg/wrapper.mjs</span>
<span class="token keyword">import</span> cjsModule <span class="token keyword">from</span> <span class="token string">'./index.cjs'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> cjsModule<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p>注意，<code>import</code> 命令加载 CommonJS 模块，只能整体加载，不能只加载单一的输出项</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 正确</span>
<span class="token keyword">import</span> packageMain <span class="token keyword">from</span> <span class="token string">'commonjs-package'</span><span class="token punctuation">;</span>

<span class="token comment">// 报错</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'commonjs-package'</span><span class="token punctuation">;</span>
</code></pre></div><p>还有一种变通的加载方法，就是使用 Node.js 内置的 <code>module.createRequire()</code> 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// cjs.cjs</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'cjs'</span><span class="token punctuation">;</span>

<span class="token comment">// esm.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRequire <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'module'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cjs.cjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cjs <span class="token operator">===</span> <span class="token string">'cjs'</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>上面代码中，ES6 模块通过 <code>module.createRequire()</code> 方法可以加载 CommonJS 模块</p> <h2 id="commonjs-模块加载-es6-模块"><a href="#commonjs-模块加载-es6-模块" class="header-anchor">#</a> CommonJS 模块加载 ES6 模块</h2> <p>CommonJS 的 <code>require</code> 命令不能加载 ES6 模块，会报错，只能使用 <code>import()</code> 这个方法加载</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./my-app.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码可以在 CommonJS 模块中运行</p> <h2 id="node-js-的内置模块"><a href="#node-js-的内置模块" class="header-anchor">#</a> Node.js 的内置模块</h2> <p>Node.js 的内置模块可以整体加载，也可以加载指定的输出项</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 整体加载</span>
<span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'events'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载指定的输出项</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./foo.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="加载路径"><a href="#加载路径" class="header-anchor">#</a> 加载路径</h2> <p>ES6 模块的加载路径必须给出脚本的完整路径，不能省略脚本的后缀名。<code>import</code> 命令和 <code>package.json</code> 文件的 <code>main</code> 字段如果省略脚本的后缀名，会报错。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES6 模块中将报错</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> something <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./index'</span><span class="token punctuation">;</span>
</code></pre></div><p>为了与浏览器的 <code>import</code> 加载规则相同，Node.js 的 <code>.mjs</code> 文件支持 URL 路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./foo.mjs?query=1'</span><span class="token punctuation">;</span> <span class="token comment">// 加载 ./foo 传入参数 ?query=1</span>
</code></pre></div><p>上面代码中，脚本路径带有参数 <code>?query=1</code> ，Node 会按 URL 规则解读。同一个脚本只要参数不同，就会被加载多次，并且保存成不同的缓存。由于这个原因，只要文件名中含有 <code>:</code> 、<code>%</code> 、 <code>#</code> 、<code>?</code> 等特殊字符，最好对这些字符进行转义。</p> <p>目前，Node.js 的 <code>import</code> 命令只支持加载本地模块（<code>file:</code>协议）和 <code>data:</code> 协议，不支持加载远程模块。另外，脚本路径只支持相对路径，不支持绝对路径（即以 <code>/</code> 或 <code>//</code> 开头的路径）。</p> <p>最后，Node 的 <code>import</code> 命令是异步加载，这一点与浏览器的处理方法相同</p> <h2 id="内部变量"><a href="#内部变量" class="header-anchor">#</a> 内部变量</h2> <p>ES6 模块之中，顶层的 <code>this</code> 指向 <code>undefined</code></p> <p>CommonJS 模块的顶层 <code>this</code> 指向当前模块，这是两者的一个重大差异</p> <p>其次，以下这些顶层变量在 ES6 模块之中都是不存在的</p> <ul><li><p><code>arguments</code></p></li> <li><p><code>require</code></p></li> <li><p><code>module</code></p></li> <li><p><code>exports</code></p></li> <li><p><code>__filename</code></p></li> <li><p><code>__dirname</code></p></li></ul> <h2 id="commonjs-模块的加载原理"><a href="#commonjs-模块的加载原理" class="header-anchor">#</a> CommonJS 模块的加载原理</h2> <p>CommonJS 的一个模块，就是一个脚本文件。<code>require</code> 命令第一次加载该脚本，就会执行整个脚本，然后在内存生成一个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  loaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码就是 Node 内部加载模块后生成的一个对象</p> <ul><li><p><code>id</code>: 表示模块名</p></li> <li><p><code>exports</code>: 模块输出的各个接口</p></li> <li><p><code>loaded</code>: 一个布尔值，表示该模块的脚本是否执行完毕</p></li></ul> <p>以后需要用到这个模块的时候，就会到 <code>exports</code> 属性上面取值。即使再次执行 <code>require</code> 命令，也不会再次执行该模块，而是到缓存之中取值。也就是说，CommonJS 模块无论加载多少次，都只会在第一次加载时运行一次，以后再加载，就返回第一次运行的结果，除非手动清除系统缓存</p> <h2 id="commonjs-模块的循环加载"><a href="#commonjs-模块的循环加载" class="header-anchor">#</a> CommonJS 模块的循环加载</h2> <p>CommonJS 模块的重要特性是加载时执行，即脚本代码在 <code>require</code> 的时候，就会全部执行。一旦出现某个模块被&quot;循环加载&quot;，就只输出已经执行的部分，还未执行的部分不会输出</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./b.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'在 a.js 之中，b.done = %j'</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a.js 执行完毕'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// b.js</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'在 b.js 之中，a.done = %j'</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b.js 执行完毕'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码之中，<code>a.js</code> 脚本先输出一个 <code>done</code> 变量，然后加载另一个脚本文件 <code>b.js</code> 。注意，此时 <code>a.js</code> 代码就停在这里，等待 <code>b.js</code> 执行完毕，再往下执行</p> <p><code>b.js</code> 执行到第二行，就会去加载 <code>a.js</code> ，这时，就发生了“循环加载”。系统会去 <code>a.js</code> 模块对应对象的 <code>exports</code> 属性取值，可是此时 <code>a.js</code> 只执行了 <code>exports.done = false</code>，所以从 <code>a.js</code> 只输入一个变量 <code>done</code> ，值为 <code>false</code></p> <p>然后，<code>b.js</code> 接着往下执行，等到全部执行完毕，再把执行权交还给 <code>a.js</code> 。于是，<code>a.js</code> 接着往下执行，直到执行完毕</p> <h2 id="es6-模块的循环加载"><a href="#es6-模块的循环加载" class="header-anchor">#</a> ES6 模块的循环加载</h2> <p>ES6 处理“循环加载”与 CommonJS 有本质的不同。ES6 模块是动态引用，如果使用 <code>import</code> 从一个模块加载变量（即 <code>import foo from 'foo'</code> ），那些变量不会被缓存，而是成为一个指向被加载模块的引用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>

<span class="token comment">// b.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>a.mjs</code> 加载 <code>b.mjs</code> ，<code>b.mjs</code> 又加载 <code>a.mjs</code>，构成循环加载。执行 <code>a.mjs</code> ，结果如下:</p> <div class="language-js extra-class"><pre class="language-js"><code>$ node <span class="token operator">--</span>experimental<span class="token operator">-</span>modules a<span class="token punctuation">.</span>mjs
b<span class="token punctuation">.</span>mjs
ReferenceError<span class="token operator">:</span> foo is not defined
</code></pre></div><p>首先，执行 <code>a.mjs</code> 以后，引擎发现它加载了 <code>b.mjs</code> ，因此会优先执行 <code>b.mjs</code></p> <p>执行 <code>b.mjs</code> 的时候，已知它从 <code>a.mjs</code> 输入了 <code>foo</code> 接口，这时不会去执行 <code>a.mjs</code>，而是认为这个接口已经存在了，继续往下执行</p> <p>执行到第三行 <code>console.log(foo)</code> 的时候，才发现这个接口根本没定义，因此报错</p> <p>解决这个问题的方法，就是让 <code>b.mjs</code> 运行的时候，<code>foo</code> 已经有定义了。这可以通过将 <code>foo</code> 写成函数来解决</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// b.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./a'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这时再执行 <code>a.mjs</code> 就可以得到预期结果</p> <div class="language-js extra-class"><pre class="language-js"><code>$ node <span class="token operator">--</span>experimental<span class="token operator">-</span>modules a<span class="token punctuation">.</span>mjs
b<span class="token punctuation">.</span>mjs
foo
a<span class="token punctuation">.</span>mjs
bar
</code></pre></div><p>这是因为函数具有提升作用，在执行 <code>import {bar} from './b'</code> 时，函数 <code>foo</code> 就已经有定义了，所以 <code>b.mjs</code> 加载的时候不会报错。这也意味着，如果把函数 <code>foo</code> 改写成函数表达式，也会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./b'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码的第四行，改成了函数表达式，就不具有提升作用，执行就会报错。</p> <p>我们再来看 ES6 模块加载器 <code>SystemJS</code> 给出的一个例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// even.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> odd <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./odd'</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">even</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">odd</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// odd.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> even <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./even'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">odd</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">even</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，<code>even.js</code> 里面的函数 <code>even</code> 有一个参数 <code>n</code>，只要不等于 <code>0</code>，就会减去 <code>1</code>，传入加载的 <code>odd()</code>。<code>odd.js</code> 也会做类似操作</p> <div class="language-js extra-class"><pre class="language-js"><code>$ babel<span class="token operator">-</span>node
<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m <span class="token keyword">from</span> <span class="token string">'./even.js'</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> m<span class="token punctuation">.</span><span class="token function">even</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> m<span class="token punctuation">.</span>counter
<span class="token number">6</span>
<span class="token operator">&gt;</span> m<span class="token punctuation">.</span><span class="token function">even</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> m<span class="token punctuation">.</span>counter
<span class="token number">17</span>
</code></pre></div><p>上面代码中，参数 <code>n</code> 从 <code>10</code> 变为 <code>0</code> 的过程中，<code>even()</code> 一共会执行 <code>6</code> 次，所以变量 <code>counter</code> 等于 <code>6</code>。第二次调用 <code>even()</code> 时，参数 <code>n</code> 从 <code>20</code> 变为 <code>0</code> ，<code>even()</code> 一共会执行 <code>11</code> 次，加上前面的 <code>6</code> 次，所以变量 <code>counter</code> 等于 <code>17</code></p> <p>这个例子要是改写成 CommonJS，就根本无法执行，会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// even.js</span>
<span class="token keyword">var</span> odd <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./odd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>counter <span class="token operator">=</span> counter<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">even</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">odd</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// odd.js</span>
<span class="token keyword">var</span> even <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./even'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>even<span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">even</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，<code>even.js</code> 加载 <code>odd.js</code> ，而 <code>odd.js</code> 又去加载 <code>even.js</code> ，形成“循环加载”。这时，执行引擎就会输出<code>even.js</code> 已经执行的部分（不存在任何结果），所以在 <code>odd.js</code> 之中，变量 <code>even</code> 等于 <code>undefined</code> ，等到后面调用 <code>even(n - 1)</code> 就会报错</p> <div class="language-js extra-class"><pre class="language-js"><code>$ node
<span class="token operator">&gt;</span> <span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./even'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> m<span class="token punctuation">.</span><span class="token function">even</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
TypeError<span class="token operator">:</span> even is not a <span class="token keyword">function</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lanjz/ES6/Module.html" class="prev">
        Module
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.74a95399.js" defer></script><script src="/lanjz/assets/js/2.b6657784.js" defer></script><script src="/lanjz/assets/js/79.7156c60c.js" defer></script>
  </body>
</html>
