<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置小记 | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.4b56cc3e.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.ea21c1e3.js" as="script"><link rel="preload" href="/lanjz/assets/js/25.b6ae0388.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.b162b0fd.js"><link rel="prefetch" href="/lanjz/assets/js/100.ab0fcea6.js"><link rel="prefetch" href="/lanjz/assets/js/101.901df11c.js"><link rel="prefetch" href="/lanjz/assets/js/102.58705b9c.js"><link rel="prefetch" href="/lanjz/assets/js/103.1bdf8fd6.js"><link rel="prefetch" href="/lanjz/assets/js/104.1f751940.js"><link rel="prefetch" href="/lanjz/assets/js/105.cec56750.js"><link rel="prefetch" href="/lanjz/assets/js/106.381eb240.js"><link rel="prefetch" href="/lanjz/assets/js/107.ecc0cf83.js"><link rel="prefetch" href="/lanjz/assets/js/108.bbd2e86e.js"><link rel="prefetch" href="/lanjz/assets/js/109.16ab13cb.js"><link rel="prefetch" href="/lanjz/assets/js/11.1567089a.js"><link rel="prefetch" href="/lanjz/assets/js/110.80a1c649.js"><link rel="prefetch" href="/lanjz/assets/js/111.bace6f83.js"><link rel="prefetch" href="/lanjz/assets/js/112.e7ea7d4a.js"><link rel="prefetch" href="/lanjz/assets/js/113.380f6fb5.js"><link rel="prefetch" href="/lanjz/assets/js/114.775cb75a.js"><link rel="prefetch" href="/lanjz/assets/js/115.ea1ac1e5.js"><link rel="prefetch" href="/lanjz/assets/js/116.52801dd5.js"><link rel="prefetch" href="/lanjz/assets/js/117.6ddbb86d.js"><link rel="prefetch" href="/lanjz/assets/js/118.1a21c63a.js"><link rel="prefetch" href="/lanjz/assets/js/119.c4d8c77f.js"><link rel="prefetch" href="/lanjz/assets/js/12.5f6db14e.js"><link rel="prefetch" href="/lanjz/assets/js/120.0823d75c.js"><link rel="prefetch" href="/lanjz/assets/js/121.3c5dde8d.js"><link rel="prefetch" href="/lanjz/assets/js/122.292d9112.js"><link rel="prefetch" href="/lanjz/assets/js/123.bf06f913.js"><link rel="prefetch" href="/lanjz/assets/js/124.8d60b4c7.js"><link rel="prefetch" href="/lanjz/assets/js/125.4cd1b0ba.js"><link rel="prefetch" href="/lanjz/assets/js/126.8dbc9568.js"><link rel="prefetch" href="/lanjz/assets/js/127.7f278ca6.js"><link rel="prefetch" href="/lanjz/assets/js/128.d077b132.js"><link rel="prefetch" href="/lanjz/assets/js/129.10cc8c15.js"><link rel="prefetch" href="/lanjz/assets/js/13.c68aff31.js"><link rel="prefetch" href="/lanjz/assets/js/130.28e06c1b.js"><link rel="prefetch" href="/lanjz/assets/js/131.a3636ddb.js"><link rel="prefetch" href="/lanjz/assets/js/132.3c42c08f.js"><link rel="prefetch" href="/lanjz/assets/js/133.3cf1ede0.js"><link rel="prefetch" href="/lanjz/assets/js/134.e3487998.js"><link rel="prefetch" href="/lanjz/assets/js/135.2e5d0f7b.js"><link rel="prefetch" href="/lanjz/assets/js/136.a959d8c8.js"><link rel="prefetch" href="/lanjz/assets/js/137.49427bd7.js"><link rel="prefetch" href="/lanjz/assets/js/138.6cbcdd84.js"><link rel="prefetch" href="/lanjz/assets/js/139.bf05fa78.js"><link rel="prefetch" href="/lanjz/assets/js/14.df22332f.js"><link rel="prefetch" href="/lanjz/assets/js/140.671b0e85.js"><link rel="prefetch" href="/lanjz/assets/js/141.63f7225e.js"><link rel="prefetch" href="/lanjz/assets/js/142.083096e4.js"><link rel="prefetch" href="/lanjz/assets/js/143.c026a368.js"><link rel="prefetch" href="/lanjz/assets/js/144.f1825da7.js"><link rel="prefetch" href="/lanjz/assets/js/145.cd2da502.js"><link rel="prefetch" href="/lanjz/assets/js/146.33854136.js"><link rel="prefetch" href="/lanjz/assets/js/147.384ff715.js"><link rel="prefetch" href="/lanjz/assets/js/148.80688379.js"><link rel="prefetch" href="/lanjz/assets/js/149.f51e1b0e.js"><link rel="prefetch" href="/lanjz/assets/js/15.2d42f847.js"><link rel="prefetch" href="/lanjz/assets/js/150.63c4188b.js"><link rel="prefetch" href="/lanjz/assets/js/151.1594cc20.js"><link rel="prefetch" href="/lanjz/assets/js/152.1b438e39.js"><link rel="prefetch" href="/lanjz/assets/js/153.bd707d97.js"><link rel="prefetch" href="/lanjz/assets/js/154.8acbf622.js"><link rel="prefetch" href="/lanjz/assets/js/155.c5f42631.js"><link rel="prefetch" href="/lanjz/assets/js/156.83337a31.js"><link rel="prefetch" href="/lanjz/assets/js/157.07018155.js"><link rel="prefetch" href="/lanjz/assets/js/158.da8a0b2c.js"><link rel="prefetch" href="/lanjz/assets/js/159.eca00084.js"><link rel="prefetch" href="/lanjz/assets/js/16.5c11d706.js"><link rel="prefetch" href="/lanjz/assets/js/160.d00034f4.js"><link rel="prefetch" href="/lanjz/assets/js/161.8a18a26b.js"><link rel="prefetch" href="/lanjz/assets/js/162.d1232af4.js"><link rel="prefetch" href="/lanjz/assets/js/163.941a58bc.js"><link rel="prefetch" href="/lanjz/assets/js/164.53cdfd06.js"><link rel="prefetch" href="/lanjz/assets/js/165.7aca8119.js"><link rel="prefetch" href="/lanjz/assets/js/166.43ce54c5.js"><link rel="prefetch" href="/lanjz/assets/js/167.d31d8e16.js"><link rel="prefetch" href="/lanjz/assets/js/168.61cde730.js"><link rel="prefetch" href="/lanjz/assets/js/169.263ee687.js"><link rel="prefetch" href="/lanjz/assets/js/17.65e35547.js"><link rel="prefetch" href="/lanjz/assets/js/170.e73a7468.js"><link rel="prefetch" href="/lanjz/assets/js/171.c4831c32.js"><link rel="prefetch" href="/lanjz/assets/js/172.bce85bdc.js"><link rel="prefetch" href="/lanjz/assets/js/173.4942c3d0.js"><link rel="prefetch" href="/lanjz/assets/js/174.82ed9b8d.js"><link rel="prefetch" href="/lanjz/assets/js/175.ab287b39.js"><link rel="prefetch" href="/lanjz/assets/js/176.6763efd6.js"><link rel="prefetch" href="/lanjz/assets/js/177.c67ca352.js"><link rel="prefetch" href="/lanjz/assets/js/178.6a8cbd72.js"><link rel="prefetch" href="/lanjz/assets/js/179.04038fd7.js"><link rel="prefetch" href="/lanjz/assets/js/18.961a87ac.js"><link rel="prefetch" href="/lanjz/assets/js/180.87791d67.js"><link rel="prefetch" href="/lanjz/assets/js/181.7f7d474f.js"><link rel="prefetch" href="/lanjz/assets/js/182.ebbbbf02.js"><link rel="prefetch" href="/lanjz/assets/js/183.19dc91b9.js"><link rel="prefetch" href="/lanjz/assets/js/184.ec134410.js"><link rel="prefetch" href="/lanjz/assets/js/185.afed2365.js"><link rel="prefetch" href="/lanjz/assets/js/186.04f9836e.js"><link rel="prefetch" href="/lanjz/assets/js/187.f44f938e.js"><link rel="prefetch" href="/lanjz/assets/js/188.c177201e.js"><link rel="prefetch" href="/lanjz/assets/js/189.cd12a03c.js"><link rel="prefetch" href="/lanjz/assets/js/19.839e0f48.js"><link rel="prefetch" href="/lanjz/assets/js/190.67be153b.js"><link rel="prefetch" href="/lanjz/assets/js/191.0f79266e.js"><link rel="prefetch" href="/lanjz/assets/js/192.74013501.js"><link rel="prefetch" href="/lanjz/assets/js/193.79ea98f3.js"><link rel="prefetch" href="/lanjz/assets/js/194.a667eab8.js"><link rel="prefetch" href="/lanjz/assets/js/195.7b82278a.js"><link rel="prefetch" href="/lanjz/assets/js/196.0046b013.js"><link rel="prefetch" href="/lanjz/assets/js/197.4b9c64f3.js"><link rel="prefetch" href="/lanjz/assets/js/198.9cb9a9ca.js"><link rel="prefetch" href="/lanjz/assets/js/199.2bf66fbe.js"><link rel="prefetch" href="/lanjz/assets/js/20.0228df16.js"><link rel="prefetch" href="/lanjz/assets/js/200.c7232cb3.js"><link rel="prefetch" href="/lanjz/assets/js/201.bde95419.js"><link rel="prefetch" href="/lanjz/assets/js/202.9b355576.js"><link rel="prefetch" href="/lanjz/assets/js/203.124fe87d.js"><link rel="prefetch" href="/lanjz/assets/js/204.b6bb2045.js"><link rel="prefetch" href="/lanjz/assets/js/205.621d63b8.js"><link rel="prefetch" href="/lanjz/assets/js/206.b5c9adaf.js"><link rel="prefetch" href="/lanjz/assets/js/207.242313fe.js"><link rel="prefetch" href="/lanjz/assets/js/208.e71ae5c2.js"><link rel="prefetch" href="/lanjz/assets/js/209.390bd070.js"><link rel="prefetch" href="/lanjz/assets/js/21.19f9d367.js"><link rel="prefetch" href="/lanjz/assets/js/210.59410a6b.js"><link rel="prefetch" href="/lanjz/assets/js/211.1ccb58ec.js"><link rel="prefetch" href="/lanjz/assets/js/212.d6c50bc1.js"><link rel="prefetch" href="/lanjz/assets/js/213.213899c6.js"><link rel="prefetch" href="/lanjz/assets/js/214.04c2f129.js"><link rel="prefetch" href="/lanjz/assets/js/215.d9a806be.js"><link rel="prefetch" href="/lanjz/assets/js/216.a339e8cb.js"><link rel="prefetch" href="/lanjz/assets/js/22.e87a140b.js"><link rel="prefetch" href="/lanjz/assets/js/23.5bf45126.js"><link rel="prefetch" href="/lanjz/assets/js/24.12793b7d.js"><link rel="prefetch" href="/lanjz/assets/js/26.edc53c6f.js"><link rel="prefetch" href="/lanjz/assets/js/27.d4ca9c2f.js"><link rel="prefetch" href="/lanjz/assets/js/28.1b1a97f3.js"><link rel="prefetch" href="/lanjz/assets/js/29.dff7a0ae.js"><link rel="prefetch" href="/lanjz/assets/js/3.0488d552.js"><link rel="prefetch" href="/lanjz/assets/js/30.59863ecf.js"><link rel="prefetch" href="/lanjz/assets/js/31.3aa11e92.js"><link rel="prefetch" href="/lanjz/assets/js/32.81844ae4.js"><link rel="prefetch" href="/lanjz/assets/js/33.ab854d7c.js"><link rel="prefetch" href="/lanjz/assets/js/34.af168a45.js"><link rel="prefetch" href="/lanjz/assets/js/35.7428a341.js"><link rel="prefetch" href="/lanjz/assets/js/36.675bb796.js"><link rel="prefetch" href="/lanjz/assets/js/37.a361033b.js"><link rel="prefetch" href="/lanjz/assets/js/38.acc4eed5.js"><link rel="prefetch" href="/lanjz/assets/js/39.1a26c0a0.js"><link rel="prefetch" href="/lanjz/assets/js/4.8968208a.js"><link rel="prefetch" href="/lanjz/assets/js/40.ffc70802.js"><link rel="prefetch" href="/lanjz/assets/js/41.3b5cf937.js"><link rel="prefetch" href="/lanjz/assets/js/42.a83cad7b.js"><link rel="prefetch" href="/lanjz/assets/js/43.e69952b9.js"><link rel="prefetch" href="/lanjz/assets/js/44.430a22d0.js"><link rel="prefetch" href="/lanjz/assets/js/45.c2410c6e.js"><link rel="prefetch" href="/lanjz/assets/js/46.8c3843c6.js"><link rel="prefetch" href="/lanjz/assets/js/47.7d378665.js"><link rel="prefetch" href="/lanjz/assets/js/48.ae5ec667.js"><link rel="prefetch" href="/lanjz/assets/js/49.f66a97d6.js"><link rel="prefetch" href="/lanjz/assets/js/5.55636f5f.js"><link rel="prefetch" href="/lanjz/assets/js/50.67d41fff.js"><link rel="prefetch" href="/lanjz/assets/js/51.29041d4b.js"><link rel="prefetch" href="/lanjz/assets/js/52.eb553661.js"><link rel="prefetch" href="/lanjz/assets/js/53.de80e238.js"><link rel="prefetch" href="/lanjz/assets/js/54.13be3d07.js"><link rel="prefetch" href="/lanjz/assets/js/55.38374107.js"><link rel="prefetch" href="/lanjz/assets/js/56.4a828366.js"><link rel="prefetch" href="/lanjz/assets/js/57.3937e579.js"><link rel="prefetch" href="/lanjz/assets/js/58.e8ee07bf.js"><link rel="prefetch" href="/lanjz/assets/js/59.e304fe4d.js"><link rel="prefetch" href="/lanjz/assets/js/6.9c2f2780.js"><link rel="prefetch" href="/lanjz/assets/js/60.043f25f5.js"><link rel="prefetch" href="/lanjz/assets/js/61.b96c916c.js"><link rel="prefetch" href="/lanjz/assets/js/62.281742ee.js"><link rel="prefetch" href="/lanjz/assets/js/63.f6edabab.js"><link rel="prefetch" href="/lanjz/assets/js/64.5ce4fcfc.js"><link rel="prefetch" href="/lanjz/assets/js/65.c4d315ab.js"><link rel="prefetch" href="/lanjz/assets/js/66.87bc1c53.js"><link rel="prefetch" href="/lanjz/assets/js/67.48c29f81.js"><link rel="prefetch" href="/lanjz/assets/js/68.9fbd66ec.js"><link rel="prefetch" href="/lanjz/assets/js/69.6ade114c.js"><link rel="prefetch" href="/lanjz/assets/js/7.245fb327.js"><link rel="prefetch" href="/lanjz/assets/js/70.6eb1e640.js"><link rel="prefetch" href="/lanjz/assets/js/71.d549862f.js"><link rel="prefetch" href="/lanjz/assets/js/72.7b38f365.js"><link rel="prefetch" href="/lanjz/assets/js/73.dc88e343.js"><link rel="prefetch" href="/lanjz/assets/js/74.5b6070f7.js"><link rel="prefetch" href="/lanjz/assets/js/75.bd938402.js"><link rel="prefetch" href="/lanjz/assets/js/76.6b83bb5b.js"><link rel="prefetch" href="/lanjz/assets/js/77.d27d80aa.js"><link rel="prefetch" href="/lanjz/assets/js/78.823c1765.js"><link rel="prefetch" href="/lanjz/assets/js/79.70a3f078.js"><link rel="prefetch" href="/lanjz/assets/js/8.2488d0a0.js"><link rel="prefetch" href="/lanjz/assets/js/80.bafd46a4.js"><link rel="prefetch" href="/lanjz/assets/js/81.9cc9414e.js"><link rel="prefetch" href="/lanjz/assets/js/82.745d7dbe.js"><link rel="prefetch" href="/lanjz/assets/js/83.8fd9ed4d.js"><link rel="prefetch" href="/lanjz/assets/js/84.3bb27820.js"><link rel="prefetch" href="/lanjz/assets/js/85.2f7d28d5.js"><link rel="prefetch" href="/lanjz/assets/js/86.a9a3f2ce.js"><link rel="prefetch" href="/lanjz/assets/js/87.75c6f3a0.js"><link rel="prefetch" href="/lanjz/assets/js/88.98581dcc.js"><link rel="prefetch" href="/lanjz/assets/js/89.23e54aee.js"><link rel="prefetch" href="/lanjz/assets/js/9.12534a43.js"><link rel="prefetch" href="/lanjz/assets/js/90.36a656c0.js"><link rel="prefetch" href="/lanjz/assets/js/91.c681f566.js"><link rel="prefetch" href="/lanjz/assets/js/92.047cc181.js"><link rel="prefetch" href="/lanjz/assets/js/93.d86bf44c.js"><link rel="prefetch" href="/lanjz/assets/js/94.1d4da164.js"><link rel="prefetch" href="/lanjz/assets/js/95.fd4fa177.js"><link rel="prefetch" href="/lanjz/assets/js/96.f8d66fde.js"><link rel="prefetch" href="/lanjz/assets/js/97.d548d550.js"><link rel="prefetch" href="/lanjz/assets/js/98.6362f785.js"><link rel="prefetch" href="/lanjz/assets/js/99.9faf0d2a.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lanjz/Node/Webpack/Plugin.html" class="sidebar-link">Plugin</a></li><li><a href="/lanjz/Node/Webpack/Loader.html" class="sidebar-link">Loader</a></li><li><a href="/lanjz/Node/Webpack/Babel-Loader.html" class="sidebar-link">Babel</a></li><li><a href="/lanjz/Node/Webpack/css-loader&amp;style-loader.html" class="sidebar-link">CSS/Style-Loader</a></li><li><a href="/lanjz/Node/Webpack/library.html" class="sidebar-link">library</a></li><li><a href="/lanjz/Node/Webpack/原理/tree-shaking.html" class="sidebar-link">tree-shaking</a></li><li><a href="/lanjz/Node/Webpack/原理/code-split.html" class="sidebar-link">code-split</a></li><li><a href="/lanjz/Node/Webpack/原理/模块热替换.html" class="sidebar-link">HotModulePlacement</a></li><li><a href="/lanjz/Node/Webpack/构建优化方案.html" class="sidebar-link">构建优化方案</a></li><li><a href="/lanjz/Node/Webpack/配置小记.html" class="active sidebar-link">配置小记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#多页面配置" class="sidebar-link">多页面配置</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#less" class="sidebar-link">Less</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#scss" class="sidebar-link">scss</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#支持react" class="sidebar-link">支持React</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#支持vue" class="sidebar-link">支持Vue</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#cdn-配置" class="sidebar-link">CDN 配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#webpack实现cdn的接入" class="sidebar-link">Webpack实现CDN的接入</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#webpack中提取公共代码的配置" class="sidebar-link">Webpack中提取公共代码的配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#splitchunksplugin" class="sidebar-link">SplitChunksPlugin</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#prepack使用" class="sidebar-link">Prepack使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#prepack-运行原理" class="sidebar-link">Prepack 运行原理</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#webpack接入prepack" class="sidebar-link">Webpack接入Prepack</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#关于静态资源的输出路径" class="sidebar-link">关于静态资源的输出路径</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#文件指纹" class="sidebar-link">文件指纹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#chunkhash的问题" class="sidebar-link">chunkhash的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#输出不换行" class="sidebar-link">输出不换行</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#删除console-log" class="sidebar-link">删除console.log</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#引入全局less变量" class="sidebar-link">引入全局less变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#lessoptions" class="sidebar-link">lessOptions</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#style-resources-loader" class="sidebar-link">style-resources-loader</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#常规的-label-配置" class="sidebar-link">常规的 label 配置</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#react-实现样式-scoped" class="sidebar-link">React 实现样式 scoped</a></li><li class="sidebar-sub-header"><a href="/lanjz/Node/Webpack/配置小记.html#qa" class="sidebar-link">QA</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="配置小记"><a href="#配置小记" class="header-anchor">#</a> 配置小记</h1> <h2 id="多页面配置"><a href="#多页面配置" class="header-anchor">#</a> 多页面配置</h2> <p>实现多页面配置需要修改的地方：</p> <ul><li><p>入口配置</p></li> <li><p>模板插件 <code>HtmlWebpackPlugin</code></p></li> <li><p>自定义服务启动</p></li> <li><p>实现页面自动更新</p></li></ul> <p><strong>入口配置</strong></p> <p>假设当前的页面目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">-</span> src
  <span class="token operator">-</span> views
     <span class="token operator">-</span> page1
       <span class="token operator">-</span> index<span class="token punctuation">.</span>js
     <span class="token operator">-</span> page1
       <span class="token operator">-</span> index<span class="token punctuation">.</span>js
</code></pre></div><p>规定 <code>/src/views</code> 下的目录代表一个页面，需要在 Webpack <code>entry</code> 属配置多入口：</p> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    page1<span class="token operator">:</span> <span class="token string">'./src/views/page1/index.js'</span><span class="token punctuation">,</span>
    page2<span class="token operator">:</span> <span class="token string">'./src/views/page2/index.js'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面是自动根据目录添加 <code>entry</code> 配置的辅助方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">multyEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//读取src目录所有page入口</span>
    glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">'./src/views/*/index.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filePath'</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span>
            <span class="token keyword">var</span> name <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/src\/views\/(.+)\/index.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            entry<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>filePath<span class="token punctuation">,</span> <span class="token string">'webpack-hot-middleware/client?reload=true'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'entry'</span><span class="token punctuation">,</span> entry<span class="token punctuation">)</span>
    <span class="token keyword">return</span> entry<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token function">multyEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>模板插件 <code>HtmlWebpackPlugin</code></strong></p> <p>跟入口文件一样，一个页面需要添加一个 <code>HtmlWebpackPlugin</code>, 那么怎么跟入口文件对应呢？ 通过 <code>chunt</code>。<code>chunt</code> 就是上面例子的 <code>entry</code> 的 <code>key</code> : <code>page1</code>和 <code>page2</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">multyHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> htmlPlugin <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">'./src/views/*/index.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> name <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/src\/views\/(.+)\/index.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            htmlPlugin<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token string">'Output Management'</span><span class="token punctuation">,</span>
                    filename<span class="token operator">:</span> <span class="token string">'./'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
                    template<span class="token operator">:</span> <span class="token string">'./index.html'</span><span class="token punctuation">,</span>
                    inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    chunks<span class="token operator">:</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span>
                    
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> htmlPlugin<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>自定义服务启动</strong></p> <p>Webpack 本质是通过 <code>Webpack-dev-server</code> 来启动服务的，配置多页面多后如果直接使用 <code>Webpack-dev-server</code> ，在访问页面的时候需要输入完整的页面地址才能访问，比如要访问上例中的 <code>page1</code>， 我们需要输入 <code>localhost:8080/page1.html</code>。通过自己搭个服务可以通过创建路由的方式方便我们访问页面</p> <p>先了解下 <code>Webpack-dev-server</code> 中主要用到了两个核心模块：</p> <ul><li><p><code>webpack-dev-middleware</code>: 是一个处理静态资源的 <code>middleware</code></p></li> <li><p><code>webpack-hot-middleware</code>: 结合 <code>webpack-dev-middleware</code> 使用的 <code>middleware</code> ，它可以实现浏览器的无刷新更新（hot reload）。这也是 Webpack 文档里常说的 HMR（Hot Module Replacement）</p></li></ul> <p>所以自定义搭建的服务如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dev-server.js</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpackHotMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-hot-middleware'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> WebpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> multyWebpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.multy'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token function">multyWebpack</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack_config'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// webpack编译器</span>
<span class="token keyword">var</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// webpack-dev-server中间件</span>
<span class="token keyword">var</span> devMiddleware <span class="token operator">=</span> <span class="token function">WebpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token comment">// publicPath: webpackConfig.output.publicPath,</span>
    stats<span class="token operator">:</span> <span class="token punctuation">{</span>
        colors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    progress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    inline<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>devMiddleware<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">webpackHotMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pageKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">.</span>entry<span class="token punctuation">)</span>
    <span class="token keyword">const</span> pageList <span class="token operator">=</span> pageKeys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h2&gt;&lt;a href=&quot;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.html&lt;/a&gt;&lt;/h2&gt;</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>pageList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listening at http://localhost:'</span> <span class="token operator">+</span> <span class="token string">'8000'</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当前输入的地址没有匹配到我们多页面的文件时，将会进入上面的路由配置，上面的将根据入口文件返回页面列页列表</p> <p><strong>实现页面自动更新</strong></p> <p>用自己的服务服务启动项目后，发现当修改代码时，控制台重新编译了，但是页面并没有自动更新。所以我需要额外实现模块热更新功能</p> <p>给每个页面注入热更新插件 <code>webpack-hot-middleware/client?reload=true</code>，所以优化上文的获取入口的函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">multyEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//读取src目录所有page入口</span>
    glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">'./src/views/*/index.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filePath'</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span>
            <span class="token keyword">var</span> name <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/src\/views\/(.+)\/index.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            entry<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>filePath<span class="token punctuation">,</span> <span class="token string">'webpack-hot-middleware/client?reload=true'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> entry<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token function">multyEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完整的热更新还需要实现两点：</p> <ul><li><p>在 Webpack 配置中添加 <code>plugin</code> 插件 <code>new webpack.HotModuleReplacementPlugin()</code></p></li> <li><p>在 Express 服务中添加中间件 <code>webpack-hot-middleware</code></p></li></ul> <h2 id="less"><a href="#less" class="header-anchor">#</a> Less</h2> <p><code>yarn add less less-loader</code></p> <div class="language-js extra-class"><pre class="language-js"><code>  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(css|less)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              lessOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                strictMath<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre></div><h2 id="scss"><a href="#scss" class="header-anchor">#</a> scss</h2> <p><code>yarn add node-sass sass-loader</code></p> <div class="language-js extra-class"><pre class="language-js"><code>  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
</code></pre></div><p>如果在 vue 项目，还需要添加以下配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>     <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          loaders<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'scss'</span><span class="token operator">:</span> <span class="token string">'style-loader!css-loader!sass-loader'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="支持react"><a href="#支持react" class="header-anchor">#</a> 支持React</h2> <p>需要添加的依赖：<code>react</code>, <code>react-dom</code>, <code>@babel/preset-react</code>,</p> <p><strong>.babelrc配置</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span><span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-react&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="支持vue"><a href="#支持vue" class="header-anchor">#</a> 支持Vue</h2> <p>需要添加的依赖：<code>vue</code>, <code>vue-loader</code>, <code>vue-template-compiler</code></p> <p><strong>webpack 添加Loader规则</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">&quot;vue-loader&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">]</span>
</code></pre></div><p><strong>webpack 添加Vue插件</strong></p> <p><code>Vue-loader</code> 在 <code>15.*</code> 之后的版本 <code>vue-loader</code> 的使用都是需要添加插件 <code>VueLoaderPlugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueLoaderPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-loader/lib/plugin'</span><span class="token punctuation">)</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre></div><p>如果运行时提示这个报错：You are using the runtime-only build of Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build(您正在使用仅在运行时构建的Vue，其中模板编译器不可用。要么将模板预编译为呈现函数，要么使用包含编译器的构建)</p> <p>添加 webpack 配置显式改变运行时引用包</p> <div class="language-js extra-class"><pre class="language-js"><code>  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'vue$'</span><span class="token operator">:</span> <span class="token string">'vue/dist/vue.esm.js'</span> <span class="token comment">// 'vue/dist/vue.common.js' for webpack 1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://godbasin.github.io/2017/08/19/webpack-multi-project-6-hot-reload/" target="_blank" rel="noopener noreferrer">webpack多页面配置6--热加载刷新<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="https://imweb.io/topic/5d1091abf7b5692b080f25a4" target="_blank" rel="noopener noreferrer">多端多页面项目webpack打包实践与优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="cdn-配置"><a href="#cdn-配置" class="header-anchor">#</a> CDN 配置</h2> <p>要注意的是CDN服务一般都会为资源开启很长时间的缓存，例如用户在获取 <code>index.html</code> 这个文件后，即使之后的发布操作将 <code>index.html</code> 文件重新覆盖了，但是用户在很长一段时间内还是会运行之前的版本，这会导致新的发布不能立即生效。</p> <ul><li><p>针对 HTML 文件：不开启缓存，将 HTML 放在自己的服务器上，而不是 CDN 服务上，同时关闭自己服务器的缓存。自己的服务器只提供HTML文件和数据接口。</p></li> <li><p>针对静态的 <code>JS</code>，<code>CSS</code>，图片等文件：开启 CDN 和缓存，上传到 CDN 服务上，同时为每个文件名带上由文件内容算出的 Hash 值。</p></li></ul> <p>如果对形如 <code>//cdn.com/id/app_a....css</code> 这样的 URL 感到陌生，则我们需要知道这种 URL 省掉了前端的 <code>http:</code> 或者 <code>https:</code> 前缀。这样做的好处是，在访问这些资源时会自动根据当前的 HTML 的 URL 采用什么模式去决定是采用 HTTP 还是 HTTPS 模式。</p> <h3 id="webpack实现cdn的接入"><a href="#webpack实现cdn的接入" class="header-anchor">#</a> Webpack实现CDN的接入</h3> <ul><li><p>静态资源的导入 <code>URL</code> 需要变成指向 CDN 服务的绝对路径的URL，而不是相对于 HTML 文件的 URL</p></li> <li><p>静态资源的文件名需要带上由文件内容算出来的 <code>Hash</code> 值，以防止被缓存</p></li> <li><p>将不类型的资源放在不同域名的 CDN 服务上，以防止资源的并行加载被阻塞。</p></li></ul> <p>Webapck的配置如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> WebPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'web-webpack-plugin'</span><span class="token punctuation">)</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      publishpath<span class="token operator">:</span> <span class="token string">'//js.cdn.com/id/'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token operator">:</span> <span class="token punctuation">{</span>
      rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 压缩css代码</span>
            use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'css-loader?minimize'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">// 指定存放css中导入的资源（例如图片）的CDN目录URL</span>
            publishPath<span class="token operator">:</span> <span class="token string">'//img.cdn.com/id/'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 压缩css代码</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'file-loader?name=[name]_[hssh:8].[ext]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">WebPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        template<span class="token operator">:</span> <span class="token string">'./template.html'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
        stylePublishPath<span class="token operator">:</span> <span class="token string">'//css.cdn.com/id/'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 为输出的css文件名加上Hash值 </span>
        filename<span class="token operator">:</span> <span class="token string">'[name]_[contenthash:8].css'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>在以上代码中最核心的部分是通过 <code>publicPath</code>，参数设置存放静态资源的 CDN 目录 URL 。为了让不同类型的资源输出不同的 CDN，需要分别进行如下设置。</p> <ul><li><p>在 <code>output.publicPath</code> 中设置 JavaScript 的地址</p></li> <li><p><code>css-loader.publicPath</code> 中设置被 CSS 导入的资源的地址</p></li> <li><p><code>WebPlugin-stylePublishPath</code> 中设置 CSS 文件的地址</p></li></ul> <p>设置好 <code>publishPath</code> 后，<code>WebPlugin</code> 在生成 HTML 文件并将 <code>css-loader</code> 转换 CSS 代码时，会使用配置中的 <code>publishPath</code> ,用对应的线上替换原来的相对地址</p> <h2 id="webpack中提取公共代码的配置"><a href="#webpack中提取公共代码的配置" class="header-anchor">#</a> Webpack中提取公共代码的配置</h2> <p>Webapck 内置了专门用提取多个 <code>Chunk</code> 中的公共部分的插件 <code>CommonsChunkPlugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> CommonChunkPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/optimize/CommonsChunkPlugin'</span><span class="token punctuation">)</span>
  <span class="token keyword">new</span> <span class="token class-name">CommonChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 从哪些Chunk中提取仅供代码</span>
    chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 提取公共部分成型一个新的Chunk</span>
    name<span class="token operator">:</span> <span class="token string">'common'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>通过以上配置就能从网页A 到网页B 中抽离出公共部分，放到 <code>common</code> 中</p> <p>每个 <code>CommonChunkPlugin</code> 实例都会生成一个新的 <code>Chunk</code>，在这个 <code>Chunk</code> 中包含了被提取的代码，配置中的参数说明：</p> <ul><li><p><code>name</code>：告诉插件新生成的 Chunk 的名称</p></li> <li><p><code>chunks</code>: 指明从哪些已有的 Chunk 中提取，如果不填该属性，则默认会从所有已知的 Chunk 中提取</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>webpack4后删除了 CommonsChunkPlugin，改用 SplitChunksPlugin</p></div> <h3 id="splitchunksplugin"><a href="#splitchunksplugin" class="header-anchor">#</a> SplitChunksPlugin</h3> <p>若不加以配置，webpack4 会自动使用 splitChunks 对资源块进行拆分，默认拆分规则如下：</p> <ul><li><p>块被多处引用或者来自 node_modules 目录</p></li> <li><p>块大小大于 30kb（压缩前）</p></li> <li><p>按需加载的块并行请求数不能大于 5 个</p></li> <li><p>初始化加载的块并行请求数不能大于 3 个</p></li></ul> <p>也就是说 splitChunks 只会拆分被多次引用的块，或者该块来自于 node_modules 目录；并且该块在压缩前的大小应大于 30kb，否则不拆离。同时，最后两个条件对并行请求数做出了限制，这就意味着为了满足后两个条件，可能会产生体积较大的块</p> <p>splitChunksPlugin 插件提供了配置参数，使得开发者能够对包进行自定义配置和拆分块。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>  <span class="token comment">// all async initial     选择对哪些块进行优化</span>
            minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>  <span class="token comment">// 被拆分的最小大小（压缩前）</span>
            minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 被共享的最小次数</span>
            maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token comment">// 最大按需求并行请次数</span>
            maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">// 最大初始化并行请求数</span>
            automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>  <span class="token comment">// 自动命名分隔符</span>
            name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动为块命名</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
                vendor<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// key 为entry中定义的 入口名称</span>
                    chunks<span class="token operator">:</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 必须三选一： &quot;initial&quot; | &quot;all&quot; | &quot;async&quot;(默认就是异步)</span>
                    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">react|lodash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则规则验证，如果符合就提取 chunk</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 要缓存的 分隔出来的 chunk 名称</span>
                    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    enforce<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    maxAsyncRequests<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 最大异步请求数， 默认1</span>
                    maxInitialRequests <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 最大初始化请求书，默认1</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 可设置是否重用该chunk（查看源码没有发现默认值）</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                    reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="prepack使用"><a href="#prepack使用" class="header-anchor">#</a> Prepack使用</h2> <p><code>Prepack</code> 优化原理：</p> <p>编译代码时提前将计算结果放在编译后的代码中，而不是在代码运行时才去求值</p> <p>以如下代码为例：</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/server'</span>
  <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'hello'</span> <span class="token operator">+</span> name
    
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button name<span class="token operator">=</span><span class="token string">'webpack'</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>被Prepack转换后竟然直接输出：</p> <p><code>console.log('hello webpack')</code></p> <p>可以看出Prepack通过在编译阶段预先执行源码来得到执行结果 ，再直接运行结果输出以提升性能</p> <h3 id="prepack-运行原理"><a href="#prepack-运行原理" class="header-anchor">#</a> Prepack 运行原理</h3> <ul><li><p>通过Babel将JavaScript源码解析成语法树(AST)，以更细粒度分析源码</p></li> <li><p>Prepack 实现了一个 JavaScript 解释器，用于执行源码。借助这个解释器，<code>Prepack</code>才能理解源码具体如何执行的，并将执行过程中的结果返回到输出中。</p></li></ul> <p><code>Prepack</code> 还处于初期也仅仅是 ，所以还有一些局限性：</p> <ul><li><p>不能识别 DOM API 和部分 Node.js，如果在源码中有调用依赖运行环境的 API，就会导致 <code>Prepack</code> 报错</p></li> <li><p>代码在优化的性能可能更差</p></li> <li><p>代码在优化后，文件的尺寸可会大大增加</p></li></ul> <h3 id="webpack接入prepack"><a href="#webpack接入prepack" class="header-anchor">#</a> Webpack接入Prepack</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> PrepackWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'prepack-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">PrepackWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="关于静态资源的输出路径"><a href="#关于静态资源的输出路径" class="header-anchor">#</a> 关于静态资源的输出路径</h2> <p>关于路径先分清楚在路径名前有没有带 <code>/</code> 的情况下他们的区别：</p> <p>假设我们的HTML页面有引入一张 <code>bg.png</code> 的图片</p> <ul><li><p><code>/assets/bg.png</code>: 相对于启动服务(server-relative)</p></li> <li><p><code>assets/bg.png</code>: 相对于 HTML 页面</p></li> <li><p><code>./assets/</code>: 相对于 HTML 页面</p></li></ul> <p><a href="https://www.webpackjs.com/configuration/output/#output-publicpath" target="_blank" rel="noopener noreferrer">官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>对于 <code>output.publicPath</code> 的解释：</p> <ul><li>参数：<code>string</code>|<code>function</code>,在多数情况下此选项的值都会以/结束</li></ul> <p>对于按需加载(on-demand-load)或加载外部资源(external resources)（如JS文件、图片、文件等）来说，<code>output.publicPath</code> 是很重要的选项。如果指定了一个错误的值，则在加载这些资源时会收到 <code>404</code> 错误。</p> <p>从这里可以知道一个信息，这个配置影响的是按需加载和静态资源的引入路径</p> <p>来一个没有配置 <code>output.publicPath</code> 的例子和打包结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.deploy.config.js</span>
entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre></div><p>打包后引入的JS文件地址是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>HTML打开也是能正常加这个JS文件，接下我们加入 <code>output.publicPath</code></p> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		publicPath<span class="token operator">:</span> <span class="token string">'/out/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>打包后会发现这个JS加载失败了，因为他们引入路径是 <code>src=&quot;/out/index.js&quot;</code> ，可以看到路径前多了 <code>output.publicPath</code> 配置的路径</p> <p>所以 <code>output.publicPath</code> 一般用于生产环境中，假如生产环境我们需要将静态资源放在其它目录或者放入 CDN 时，就需要配置<code>output.publicPath</code>，这样才能正确访问到真正的资源</p> <p>打包静态资源的路径除了受 <code>output.publicPath</code> 影响，也会被 Loader 的配置影响，比如 <code>file-loader</code> , <code>file-loader</code> 的配置中有两个配置属性 <code>outputPath</code> 和 <code>publicPath</code>,</p> <ul><li><p><code>outputPath</code>: 指定输出文件放在哪个路径下，这个路径是会生成在输出目录中的</p></li> <li><p><code>publicPath</code>: 跟 <code>output.publicPath</code> 类似，会在资源路径前加上 <code>publicPath</code> ，一般也是用于生产</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.deploy.config.js</span>
 <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|svg|jpg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                name<span class="token operator">:</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span>
                outputPath<span class="token operator">:</span> <span class="token string">'images/'</span><span class="token punctuation">,</span>
                publicPath<span class="token operator">:</span> <span class="token string">'assets/'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 给body添加样式</span>

body<span class="token punctuation">{</span>
    background<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;../imgs/bg.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>打包后，图片的路径为 <code>url(/assets/bg.png)</code></p> <p>并且 <code>file-loader</code> 中的 <code>publicPath</code> 和 <code>output.publicPath</code> 同时存在时， <code>file-loader</code> 中的 <code>publicPath</code> 会覆盖 <code>output.publicPath</code>，如果 <code>file-loader</code> 中的 <code>publicPath</code> 没设置，则使用 <code>output.publicPath</code></p> <h2 id="文件指纹"><a href="#文件指纹" class="header-anchor">#</a> 文件指纹</h2> <p><a href="https://juejin.im/entry/59cf5e3d6fb9a00a627161df?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com" target="_blank" rel="noopener noreferrer">Webpack中的静态资源文件指纹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Webpack 提供了两种方式给输出的文件设置文件指纹</p> <ul><li><p><code>hash</code>:  就是每个构建过程生成的唯一 <code>hash</code></p></li> <li><p><code>chunkhash</code>: 基于每个 <code>chunk</code> 的内容而生成的 <code>hash</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    print<span class="token operator">:</span> <span class="token string">'./src/print.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].[hash].js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>第一次build的结果：</p> <p><img src="/lanjz/assets/img/chunkhash_2.6cad16de.png" alt=""></p> <p>第二次build的结果:</p> <p><img src="/lanjz/assets/img/chunkhash_3.238ce4fd.png" alt=""></p> <p>即使没有修改文件，也会输出不同的 <code>hash</code> 文件</p> <p>所以我们加入 <code>chunkFilename</code></p> <p><code>output.filename</code> 不会影响那些「按需加载 chunk」的输出文件。对于这些文件，需要使用 <code>output.chunkFilename</code> 选项来控制输出</p> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name][hash].js'</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[name][chunkhash].js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/lanjz/assets/img/chunkhash_1.89e2d665.png" alt=""></p> <p>每个文件的 <code>hash</code> 指纹都不相同，上线后无改动的文件不会失去缓存</p> <h3 id="chunkhash的问题"><a href="#chunkhash的问题" class="header-anchor">#</a> chunkhash的问题</h3> <p>webpack 的理念是一切都是模块：把所有类型的文件都以 js 为汇聚点，不支持 js 文件以外的文件为编译入口。所以如果我们要编译 <code>style</code> 文件，唯一的办法是在 js 文件中引入 <code>style</code> 文件。如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack 默认将 js、image、css文件统统编译到一个 js 文件中，</p> <p>这样的模式下有个很严重的问题，当我们希望将 css 单独编译输出并且打上 <code>hash</code> 指纹，按照前文所述的使用 <code>chunkhash</code> 配置输出文件名时，编译的结果是 js 和 css 文件的 <code>hash</code> 指纹完全相同</p> <p>即使借助 <code>extract-text-webpack-plugin</code> 将 <code>style</code> 文件单独编译输出，webpack 也仍将 css 文件视为 js 的一部分，
所以不论是单独修改了 js 代码还是 css 代码，编译输出的 <code>js/css</code> 文件都会打上全新的相同的 <code>hash</code> 指纹</p> <p>好在 <code>extract-text-webpack-plugin</code> 提供了另外一种 <code>hash</code> 值：<code>contenthash</code>。顾名思义，<code>contenthash</code> 代表的是文本文件内容的<code>hash</code> 值，也就是只有 <code>style</code> 文件的 <code>hash</code> 值。这个 <code>hash</code> 值就是解决上述问题的银弹。修改配置如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">'[name].[contenthash].css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此时不修改样式只修改 js 部分的话，样式文件输出的 <code>contenthash</code> 是一样的，但是只修改了 <code>style</code> 文件，未修改 <code>index.js</code> 文件，编译输出的 js 文件的 <code>hash</code> 指纹还是会改变的</p> <p>这是因为<strong>webpack计算<code>chunkhash</code>时，以index.js文件为编译入口，整个chunk的内容会将style.css的内容也计算在内</strong></p> <p>如果要解决这个问题可以使用插件 <code>webpack-md5-hash</code> 来解决</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.deploy.config.js</span>

<span class="token keyword">var</span> WebpackMd5Hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-md5-hash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
        chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[chunkhash].[id].chunk.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">WebpackMd5Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="输出不换行"><a href="#输出不换行" class="header-anchor">#</a> 输出不换行</h2> <p>为了方便看打包输出的代码，有时候希望输出文件能换行，此时就需要通过覆盖默认 <code>TerserPlugin</code> 的配置来实现</p> <div class="language-js extra-class"><pre class="language-js"><code>  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          output<span class="token operator">:</span> <span class="token punctuation">{</span>
            beautify<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="删除console-log"><a href="#删除console-log" class="header-anchor">#</a> 删除console.log</h2> <div class="language-js extra-class"><pre class="language-js"><code>  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span>
           pure_funcs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;console.log&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="引入全局less变量"><a href="#引入全局less变量" class="header-anchor">#</a> 引入全局less变量</h2> <h3 id="lessoptions"><a href="#lessoptions" class="header-anchor">#</a> lessOptions</h3> <div class="language- extra-class"><pre class="language-text"><code>// 另一种办法，不引入全局文件，单独配置全局变量

{
    test: /\.less$/,
    use: [
        'style-loader',
        {
            loader: 'css-loader',
        },
        {
            loader: 'less-loader',
            options: {
                javascriptEnabled: true,
                globalVars: {
                    '@primary-color': 'red',    // ten可以是ten，也可以是@ten，效果一样，下同
                     //或者
                     'hack': `true; @import &quot;your-less-file-path.less&quot;;`, // 引用定义变量的文件，这个文件变量将被应用到全局当中
                },
            }
        },
       
    ]
},
</code></pre></div><h3 id="style-resources-loader"><a href="#style-resources-loader" class="header-anchor">#</a> style-resources-loader</h3> <div class="language- extra-class"><pre class="language-text"><code>// 在这里引入要增加的全局less文件
    {
        loader: 'style-resources-loader',
        options: {
            patterns: path.resolve(__dirname,'../src/pages/count/global.less')
        }
    }`
</code></pre></div><h2 id="常规的-label-配置"><a href="#常规的-label-配置" class="header-anchor">#</a> 常规的 label 配置</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;useBuiltIns&quot;</span><span class="token operator">:</span> <span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;corejs&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>使用 <code>@babel/plugin-transform-runtime</code> 引入新的全局方法</p></li> <li><p>使用 <code>@babel/preset-env</code> 转换新语法</p></li> <li><p>为何还要使用 <code>useBuiltIns</code> 呢？，主是为了某些对象原型上的方法，以 <code>[].includes</code> 为例，<code>transform-runtime</code> 导出的 Array 是没有 <code>includes</code> 方法的，所以还是需要使用 <code>useBuiltIns</code> 进行加持</p></li></ul> <h2 id="react-实现样式-scoped"><a href="#react-实现样式-scoped" class="header-anchor">#</a> React 实现样式 scoped</h2> <p>通过配置 cssLoaderOptions <a href="https://webpack.js.org/loaders/css-loader/#modules" target="_blank" rel="noopener noreferrer">modules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实现样式 scoped</p> <p>我的使用粟子</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      modules<span class="token operator">:</span> <span class="token punctuation">{</span>
        localIdentContext<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 只作用在特定路径下面</span>
        <span class="token function-variable function">mode</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">resourcePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.global.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>resourcePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 只有匹配到文件名为 .global. 时才是全局的</span>
            <span class="token keyword">return</span> <span class="token string">&quot;global&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>resourcePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 这一步应该是多余的操作</span>
            <span class="token keyword">return</span> <span class="token string">'global'</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token string">&quot;local&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 默认启用 scoped</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        localIdentName<span class="token operator">:</span> <span class="token string">&quot;[local]_[hash:base64:5]&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>如下例子</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* index.global.less*/</span>
  <span class="token selector">.addr-panel</span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>直接 <code>import 'index.global.less'</code>，这个文件中的样式是全局影响的</p> <p>对于实现 <code>scoped</code> 的组件的使用方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'./layout.less'</span>
<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>style<span class="token punctuation">.</span>head<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> flex</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      头部
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Header<span class="token punctuation">;</span>

</code></pre></div><p>注意需要用 <code>style[className]</code> 的方式去使用类名</p> <h2 id="qa"><a href="#qa" class="header-anchor">#</a> QA</h2> <p><strong>在运行 DEMO 时，发现打包出来的文件，虽然项目中的 js 语法转换了，但是 webpack 模块化相关的代码还是出现的箭头函数等ES6 代码</strong></p> <p>因为 webpack5 默认使用ecma 6。解决方式，在 webpack 配置需要添加</p> <div class="language-js extra-class"><pre class="language-js"><code>target<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">,</span> <span class="token string">'es5'</span><span class="token punctuation">]</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lanjz/Node/Webpack/构建优化方案.html" class="prev">
        构建优化方案
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.4b56cc3e.js" defer></script><script src="/lanjz/assets/js/2.ea21c1e3.js" defer></script><script src="/lanjz/assets/js/25.b6ae0388.js" defer></script>
  </body>
</html>
