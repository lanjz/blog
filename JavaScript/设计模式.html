<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计模式 | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.ff4b3de9.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.ecbcf784.js" as="script"><link rel="preload" href="/lanjz/assets/js/43.653d78ca.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.37f64262.js"><link rel="prefetch" href="/lanjz/assets/js/100.d50d8ced.js"><link rel="prefetch" href="/lanjz/assets/js/101.9ef5d93e.js"><link rel="prefetch" href="/lanjz/assets/js/102.821e314b.js"><link rel="prefetch" href="/lanjz/assets/js/103.8111ffc5.js"><link rel="prefetch" href="/lanjz/assets/js/104.5651c830.js"><link rel="prefetch" href="/lanjz/assets/js/105.68a2d8b5.js"><link rel="prefetch" href="/lanjz/assets/js/106.c002cbe5.js"><link rel="prefetch" href="/lanjz/assets/js/107.d75a8a2b.js"><link rel="prefetch" href="/lanjz/assets/js/108.c770ba10.js"><link rel="prefetch" href="/lanjz/assets/js/109.2b87c0d8.js"><link rel="prefetch" href="/lanjz/assets/js/11.1eb18a88.js"><link rel="prefetch" href="/lanjz/assets/js/110.6982a5eb.js"><link rel="prefetch" href="/lanjz/assets/js/111.c94da06f.js"><link rel="prefetch" href="/lanjz/assets/js/112.d996d819.js"><link rel="prefetch" href="/lanjz/assets/js/113.71157e92.js"><link rel="prefetch" href="/lanjz/assets/js/114.3b29e2b7.js"><link rel="prefetch" href="/lanjz/assets/js/115.c3a9f246.js"><link rel="prefetch" href="/lanjz/assets/js/116.bca00e4a.js"><link rel="prefetch" href="/lanjz/assets/js/117.529b4fb0.js"><link rel="prefetch" href="/lanjz/assets/js/118.9bfb519e.js"><link rel="prefetch" href="/lanjz/assets/js/119.ba3e8ad9.js"><link rel="prefetch" href="/lanjz/assets/js/12.94fe9a2f.js"><link rel="prefetch" href="/lanjz/assets/js/120.1e997e3c.js"><link rel="prefetch" href="/lanjz/assets/js/121.78a199f4.js"><link rel="prefetch" href="/lanjz/assets/js/122.50b5c6ca.js"><link rel="prefetch" href="/lanjz/assets/js/123.8b08bf3b.js"><link rel="prefetch" href="/lanjz/assets/js/124.d6f5d900.js"><link rel="prefetch" href="/lanjz/assets/js/125.eed2facd.js"><link rel="prefetch" href="/lanjz/assets/js/126.a53642f1.js"><link rel="prefetch" href="/lanjz/assets/js/127.91d5a9b6.js"><link rel="prefetch" href="/lanjz/assets/js/128.7aa614ad.js"><link rel="prefetch" href="/lanjz/assets/js/129.3076435a.js"><link rel="prefetch" href="/lanjz/assets/js/13.84a761a9.js"><link rel="prefetch" href="/lanjz/assets/js/130.388b9c32.js"><link rel="prefetch" href="/lanjz/assets/js/131.f47279b7.js"><link rel="prefetch" href="/lanjz/assets/js/132.50b9c3ca.js"><link rel="prefetch" href="/lanjz/assets/js/133.99333ccf.js"><link rel="prefetch" href="/lanjz/assets/js/134.d912d0a6.js"><link rel="prefetch" href="/lanjz/assets/js/135.a034bccf.js"><link rel="prefetch" href="/lanjz/assets/js/136.1bc91591.js"><link rel="prefetch" href="/lanjz/assets/js/137.bc4f9493.js"><link rel="prefetch" href="/lanjz/assets/js/138.df795d23.js"><link rel="prefetch" href="/lanjz/assets/js/139.4591174d.js"><link rel="prefetch" href="/lanjz/assets/js/14.fb1d128b.js"><link rel="prefetch" href="/lanjz/assets/js/140.78098314.js"><link rel="prefetch" href="/lanjz/assets/js/141.72fff653.js"><link rel="prefetch" href="/lanjz/assets/js/142.8fe33c7a.js"><link rel="prefetch" href="/lanjz/assets/js/143.6ab49a6c.js"><link rel="prefetch" href="/lanjz/assets/js/144.34a4c227.js"><link rel="prefetch" href="/lanjz/assets/js/145.4c51c682.js"><link rel="prefetch" href="/lanjz/assets/js/146.ee64cc6e.js"><link rel="prefetch" href="/lanjz/assets/js/147.925a7687.js"><link rel="prefetch" href="/lanjz/assets/js/148.e155b0d5.js"><link rel="prefetch" href="/lanjz/assets/js/149.d1377c7e.js"><link rel="prefetch" href="/lanjz/assets/js/15.d4d67b7b.js"><link rel="prefetch" href="/lanjz/assets/js/150.35510873.js"><link rel="prefetch" href="/lanjz/assets/js/151.36758ea8.js"><link rel="prefetch" href="/lanjz/assets/js/152.19cdb175.js"><link rel="prefetch" href="/lanjz/assets/js/153.05be6388.js"><link rel="prefetch" href="/lanjz/assets/js/154.2ea4ffa0.js"><link rel="prefetch" href="/lanjz/assets/js/155.681cf871.js"><link rel="prefetch" href="/lanjz/assets/js/156.b64cc117.js"><link rel="prefetch" href="/lanjz/assets/js/157.f1081c67.js"><link rel="prefetch" href="/lanjz/assets/js/158.05443c56.js"><link rel="prefetch" href="/lanjz/assets/js/159.c69517e0.js"><link rel="prefetch" href="/lanjz/assets/js/16.3aa05090.js"><link rel="prefetch" href="/lanjz/assets/js/160.57ee8de9.js"><link rel="prefetch" href="/lanjz/assets/js/161.22383210.js"><link rel="prefetch" href="/lanjz/assets/js/162.f8b060ac.js"><link rel="prefetch" href="/lanjz/assets/js/163.eabb6d16.js"><link rel="prefetch" href="/lanjz/assets/js/164.c3eed18f.js"><link rel="prefetch" href="/lanjz/assets/js/165.8e8a85bc.js"><link rel="prefetch" href="/lanjz/assets/js/166.0c1cea8d.js"><link rel="prefetch" href="/lanjz/assets/js/167.cb9cd6b6.js"><link rel="prefetch" href="/lanjz/assets/js/168.a5787b11.js"><link rel="prefetch" href="/lanjz/assets/js/169.1f7ff834.js"><link rel="prefetch" href="/lanjz/assets/js/17.739d8044.js"><link rel="prefetch" href="/lanjz/assets/js/170.dd4b3299.js"><link rel="prefetch" href="/lanjz/assets/js/171.8fb060b9.js"><link rel="prefetch" href="/lanjz/assets/js/172.aafd29d4.js"><link rel="prefetch" href="/lanjz/assets/js/173.df3b948a.js"><link rel="prefetch" href="/lanjz/assets/js/174.b9888fd7.js"><link rel="prefetch" href="/lanjz/assets/js/175.7407f010.js"><link rel="prefetch" href="/lanjz/assets/js/176.6a2f2dbc.js"><link rel="prefetch" href="/lanjz/assets/js/177.31f4f80d.js"><link rel="prefetch" href="/lanjz/assets/js/178.0ee789d2.js"><link rel="prefetch" href="/lanjz/assets/js/179.d96e2987.js"><link rel="prefetch" href="/lanjz/assets/js/18.10a5ef27.js"><link rel="prefetch" href="/lanjz/assets/js/180.4c99cba1.js"><link rel="prefetch" href="/lanjz/assets/js/181.5b7e035f.js"><link rel="prefetch" href="/lanjz/assets/js/182.a41e8ad3.js"><link rel="prefetch" href="/lanjz/assets/js/183.c7b89953.js"><link rel="prefetch" href="/lanjz/assets/js/184.23aac51b.js"><link rel="prefetch" href="/lanjz/assets/js/185.f9ddd771.js"><link rel="prefetch" href="/lanjz/assets/js/186.593465ef.js"><link rel="prefetch" href="/lanjz/assets/js/187.472c59e3.js"><link rel="prefetch" href="/lanjz/assets/js/188.c4aaa24a.js"><link rel="prefetch" href="/lanjz/assets/js/189.884c4d6a.js"><link rel="prefetch" href="/lanjz/assets/js/19.4dbeb4a3.js"><link rel="prefetch" href="/lanjz/assets/js/190.32c6c0b3.js"><link rel="prefetch" href="/lanjz/assets/js/191.96dfdc1b.js"><link rel="prefetch" href="/lanjz/assets/js/192.029d9547.js"><link rel="prefetch" href="/lanjz/assets/js/193.a5e1a086.js"><link rel="prefetch" href="/lanjz/assets/js/194.47288d17.js"><link rel="prefetch" href="/lanjz/assets/js/195.e2260367.js"><link rel="prefetch" href="/lanjz/assets/js/196.dc862f3d.js"><link rel="prefetch" href="/lanjz/assets/js/197.25514c2f.js"><link rel="prefetch" href="/lanjz/assets/js/198.b7a67753.js"><link rel="prefetch" href="/lanjz/assets/js/199.bc5b4d93.js"><link rel="prefetch" href="/lanjz/assets/js/20.2dcb02c6.js"><link rel="prefetch" href="/lanjz/assets/js/200.2855d276.js"><link rel="prefetch" href="/lanjz/assets/js/201.8a04a85e.js"><link rel="prefetch" href="/lanjz/assets/js/202.5b773c12.js"><link rel="prefetch" href="/lanjz/assets/js/203.99c4df88.js"><link rel="prefetch" href="/lanjz/assets/js/204.4f3aeefa.js"><link rel="prefetch" href="/lanjz/assets/js/205.a4335b23.js"><link rel="prefetch" href="/lanjz/assets/js/206.59aa6bff.js"><link rel="prefetch" href="/lanjz/assets/js/207.81006345.js"><link rel="prefetch" href="/lanjz/assets/js/208.16070e65.js"><link rel="prefetch" href="/lanjz/assets/js/209.2cec3c45.js"><link rel="prefetch" href="/lanjz/assets/js/21.61f63948.js"><link rel="prefetch" href="/lanjz/assets/js/210.ad8ba1f4.js"><link rel="prefetch" href="/lanjz/assets/js/211.a343cf4d.js"><link rel="prefetch" href="/lanjz/assets/js/212.45386a82.js"><link rel="prefetch" href="/lanjz/assets/js/213.d6d8ce70.js"><link rel="prefetch" href="/lanjz/assets/js/214.79883dbd.js"><link rel="prefetch" href="/lanjz/assets/js/22.2b44cdf3.js"><link rel="prefetch" href="/lanjz/assets/js/23.c6494a8f.js"><link rel="prefetch" href="/lanjz/assets/js/24.ec52c233.js"><link rel="prefetch" href="/lanjz/assets/js/25.51a8701f.js"><link rel="prefetch" href="/lanjz/assets/js/26.34350679.js"><link rel="prefetch" href="/lanjz/assets/js/27.87ad5e6b.js"><link rel="prefetch" href="/lanjz/assets/js/28.2c5eccf7.js"><link rel="prefetch" href="/lanjz/assets/js/29.ead9330f.js"><link rel="prefetch" href="/lanjz/assets/js/3.ca07286e.js"><link rel="prefetch" href="/lanjz/assets/js/30.7e165e88.js"><link rel="prefetch" href="/lanjz/assets/js/31.8abe9d3a.js"><link rel="prefetch" href="/lanjz/assets/js/32.d62f3348.js"><link rel="prefetch" href="/lanjz/assets/js/33.cd60acb4.js"><link rel="prefetch" href="/lanjz/assets/js/34.77781c48.js"><link rel="prefetch" href="/lanjz/assets/js/35.08124dbf.js"><link rel="prefetch" href="/lanjz/assets/js/36.ba87a3af.js"><link rel="prefetch" href="/lanjz/assets/js/37.b74b86b5.js"><link rel="prefetch" href="/lanjz/assets/js/38.15a4ab1d.js"><link rel="prefetch" href="/lanjz/assets/js/39.5f0f2586.js"><link rel="prefetch" href="/lanjz/assets/js/4.1188a30a.js"><link rel="prefetch" href="/lanjz/assets/js/40.085a96ef.js"><link rel="prefetch" href="/lanjz/assets/js/41.9b906aee.js"><link rel="prefetch" href="/lanjz/assets/js/42.b5bbcb7f.js"><link rel="prefetch" href="/lanjz/assets/js/44.7fc571e8.js"><link rel="prefetch" href="/lanjz/assets/js/45.be1b697b.js"><link rel="prefetch" href="/lanjz/assets/js/46.822b208b.js"><link rel="prefetch" href="/lanjz/assets/js/47.b755753d.js"><link rel="prefetch" href="/lanjz/assets/js/48.fba9f160.js"><link rel="prefetch" href="/lanjz/assets/js/49.1ba39a06.js"><link rel="prefetch" href="/lanjz/assets/js/5.1facc3f4.js"><link rel="prefetch" href="/lanjz/assets/js/50.b6d2e35d.js"><link rel="prefetch" href="/lanjz/assets/js/51.2566b75a.js"><link rel="prefetch" href="/lanjz/assets/js/52.886e48bd.js"><link rel="prefetch" href="/lanjz/assets/js/53.a09f8d60.js"><link rel="prefetch" href="/lanjz/assets/js/54.660ece3e.js"><link rel="prefetch" href="/lanjz/assets/js/55.2d5d08be.js"><link rel="prefetch" href="/lanjz/assets/js/56.85fb02fc.js"><link rel="prefetch" href="/lanjz/assets/js/57.4890568c.js"><link rel="prefetch" href="/lanjz/assets/js/58.276027a5.js"><link rel="prefetch" href="/lanjz/assets/js/59.427f72ee.js"><link rel="prefetch" href="/lanjz/assets/js/6.12af870b.js"><link rel="prefetch" href="/lanjz/assets/js/60.065eda75.js"><link rel="prefetch" href="/lanjz/assets/js/61.4182cc0b.js"><link rel="prefetch" href="/lanjz/assets/js/62.ab8fc413.js"><link rel="prefetch" href="/lanjz/assets/js/63.ddd7076a.js"><link rel="prefetch" href="/lanjz/assets/js/64.0ddb1883.js"><link rel="prefetch" href="/lanjz/assets/js/65.830691c7.js"><link rel="prefetch" href="/lanjz/assets/js/66.6cf90ff3.js"><link rel="prefetch" href="/lanjz/assets/js/67.9455310e.js"><link rel="prefetch" href="/lanjz/assets/js/68.ccc20256.js"><link rel="prefetch" href="/lanjz/assets/js/69.4cfb0ab5.js"><link rel="prefetch" href="/lanjz/assets/js/7.3e3398d2.js"><link rel="prefetch" href="/lanjz/assets/js/70.c505fae7.js"><link rel="prefetch" href="/lanjz/assets/js/71.22241ede.js"><link rel="prefetch" href="/lanjz/assets/js/72.474c6ec6.js"><link rel="prefetch" href="/lanjz/assets/js/73.a2071fbc.js"><link rel="prefetch" href="/lanjz/assets/js/74.50b2394c.js"><link rel="prefetch" href="/lanjz/assets/js/75.040db2dd.js"><link rel="prefetch" href="/lanjz/assets/js/76.99f7dced.js"><link rel="prefetch" href="/lanjz/assets/js/77.1232b9ea.js"><link rel="prefetch" href="/lanjz/assets/js/78.f18e58e2.js"><link rel="prefetch" href="/lanjz/assets/js/79.eb69a32e.js"><link rel="prefetch" href="/lanjz/assets/js/8.4bf5ec1e.js"><link rel="prefetch" href="/lanjz/assets/js/80.4fa1c780.js"><link rel="prefetch" href="/lanjz/assets/js/81.28bfb694.js"><link rel="prefetch" href="/lanjz/assets/js/82.a8eb107f.js"><link rel="prefetch" href="/lanjz/assets/js/83.df82d3be.js"><link rel="prefetch" href="/lanjz/assets/js/84.b5a10d68.js"><link rel="prefetch" href="/lanjz/assets/js/85.75b9073b.js"><link rel="prefetch" href="/lanjz/assets/js/86.a836ef1e.js"><link rel="prefetch" href="/lanjz/assets/js/87.abb1a65d.js"><link rel="prefetch" href="/lanjz/assets/js/88.783197e5.js"><link rel="prefetch" href="/lanjz/assets/js/89.2bff37d8.js"><link rel="prefetch" href="/lanjz/assets/js/9.f279f841.js"><link rel="prefetch" href="/lanjz/assets/js/90.38304b2d.js"><link rel="prefetch" href="/lanjz/assets/js/91.23ab62c1.js"><link rel="prefetch" href="/lanjz/assets/js/92.54f90182.js"><link rel="prefetch" href="/lanjz/assets/js/93.62bfa7c1.js"><link rel="prefetch" href="/lanjz/assets/js/94.f302973d.js"><link rel="prefetch" href="/lanjz/assets/js/95.edbd9aa3.js"><link rel="prefetch" href="/lanjz/assets/js/96.629479ff.js"><link rel="prefetch" href="/lanjz/assets/js/97.e7463984.js"><link rel="prefetch" href="/lanjz/assets/js/98.30081987.js"><link rel="prefetch" href="/lanjz/assets/js/99.b84f827a.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lanjz/JavaScript/JS基础.html" class="sidebar-link">JS基础</a></li><li><a href="/lanjz/JavaScript/JS核心.html" class="sidebar-link">JS执行机制</a></li><li><a href="/lanjz/JavaScript/编写高质量JavaScript代码的基本要点.html" class="sidebar-link">编写高质量JavaScript代码的基本要点</a></li><li><a href="/lanjz/JavaScript/函数.html" class="sidebar-link">函数</a></li><li><a href="/lanjz/JavaScript/全面解析Module模式.html" class="sidebar-link">全面解析Module模式</a></li><li><a href="/lanjz/JavaScript/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/lanjz/JavaScript/设计模式.html" class="active sidebar-link">设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#单例模式" class="sidebar-link">单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#其它实现方式" class="sidebar-link">其它实现方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#构造函数模式" class="sidebar-link">构造函数模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#构造函数与原型" class="sidebar-link">构造函数与原型</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#只能用new吗" class="sidebar-link">只能用new吗？</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#强制使用new" class="sidebar-link">强制使用new</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#原始包装函数" class="sidebar-link">原始包装函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#建造者模式" class="sidebar-link">建造者模式</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#工厂模式" class="sidebar-link">工厂模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#装饰者模式" class="sidebar-link">装饰者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#总结-2" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#外观模式" class="sidebar-link">外观模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#总结-3" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#迭代器模式" class="sidebar-link">迭代器模式</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#观察者模式" class="sidebar-link">观察者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#自定义观察者模式" class="sidebar-link">自定义观察者模式</a></li><li class="sidebar-sub-header"><a href="/lanjz/JavaScript/设计模式.html#观察者模式和发布订阅模式的区别" class="sidebar-link">观察者模式和发布订阅模式的区别</a></li></ul></li></ul></li><li><a href="/lanjz/JavaScript/对象创建模式.html" class="sidebar-link">对象创建模式</a></li><li><a href="/lanjz/JavaScript/JS面象对象.html" class="sidebar-link">JS 面向对象编程</a></li><li><a href="/lanjz/JavaScript/正则.html" class="sidebar-link">正则</a></li><li><a href="/lanjz/JavaScript/事件.html" class="sidebar-link">事件</a></li><li><a href="/lanjz/JavaScript/吱不吱.html" class="sidebar-link">问答</a></li><li><a href="/lanjz/JavaScript/吱不吱二.html" class="sidebar-link">吱不吱二</a></li><li><a href="/lanjz/JavaScript/代码实现.html" class="sidebar-link">代码实现</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h1> <p>一个模式就是一个可重用的方案，可应用于在软件设计中的常见问题 - 在我们的例子里 - 就是编写JavaScript的web应用程序。模式的另一种解释就是一个我们如何解决问题的模板</p> <h2 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h2> <blockquote><p>保证一个类仅有一个实例，并且提供一个访问它的全局访问点</p></blockquote> <p>在 JavaScript 里，实现单例的方式有很多种，其中最简单的一个方式是使用对象字面量的方法，其字面量里可以包含大量的属性和方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> mySingleton <span class="token operator">=</span> <span class="token punctuation">{</span>
    property1<span class="token operator">:</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">,</span>
    property2<span class="token operator">:</span> <span class="token string">&quot;something else&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">method1</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>如果以后要扩展该对象，你可以添加自己的私有成员和方法，然后使用闭包在其内部封装这些变量和函数声明。只暴露你想暴露的 <code>public</code> 成员和方法，样例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">mySingleton</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">/* 这里声明私有变量和方法 */</span>
    <span class="token keyword">var</span> privateVariable <span class="token operator">=</span> <span class="token string">'something private'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">showPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateVariable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* 公有变量和方法（可以访问私有变量和方法） */</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">publicMethod</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">showPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        publicVar<span class="token operator">:</span> <span class="token string">'the public can see this!'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> single <span class="token operator">=</span> <span class="token function">mySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
single<span class="token punctuation">.</span><span class="token function">publicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出 'something private'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>single<span class="token punctuation">.</span>publicVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 'the public can see this!'</span>
</code></pre></div><p>上面的代码很不错了，但如果我们想做到只有在使用的时候才初始化，那该如何做呢？为了节约资源的目的，我们可以另外一个构造函数里来初始化这些代码，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> instantiated<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/*这里定义单例代码*/</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">publicMethod</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            publicProperty<span class="token operator">:</span> <span class="token string">'test'</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">getInstance</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instantiated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                instantiated <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> instantiated<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*调用公有的方法来获取实例:*/</span>
Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>知道了单例如何实现了，但单例用在什么样的场景比较好呢？其实单例一般是用在系统间各种模式的通信协调上，下面的代码是一个单例的最佳实践：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> SingletonTester <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//参数：传递给单例的一个参数集合</span>
    <span class="token keyword">function</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//设置args变量为接收的参数或者为空（如果没有提供的话）</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> args <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//设置name参数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'SingletonTester'</span><span class="token punctuation">;</span>
        <span class="token comment">//设置pointX的值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pointX <span class="token operator">=</span> args<span class="token punctuation">.</span>pointX <span class="token operator">||</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">//从接收的参数里获取，或者设置为默认值</span>
        <span class="token comment">//设置pointY的值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pointY <span class="token operator">=</span> args<span class="token punctuation">.</span>pointY <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//实例容器</span>
    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>

    <span class="token keyword">var</span> _static <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'SingletonTester'</span><span class="token punctuation">,</span>

        <span class="token comment">//获取实例的方法</span>
        <span class="token comment">//返回Singleton的实例</span>
        <span class="token function-variable function">getInstance</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> _static<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> singletonTest <span class="token operator">=</span> SingletonTester<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pointX<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>singletonTest<span class="token punctuation">.</span>pointX<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 5 </span>

</code></pre></div><h3 id="其它实现方式"><a href="#其它实现方式" class="header-anchor">#</a> 其它实现方式</h3> <p><strong>方法1：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 判断是否存在实例</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Universe<span class="token punctuation">.</span>instance <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Universe<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 其它内容</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 缓存</span>
    Universe<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// 隐式返回this</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试</span>
<span class="token keyword">var</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uni <span class="token operator">===</span> uni2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p><strong>方法2：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 缓存的实例</span>
    <span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// 其它内容</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 重写构造函数</span>
    <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试</span>
<span class="token keyword">var</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
uni<span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uni <span class="token operator">===</span> uni2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uni2<span class="token punctuation">.</span>bang<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>

</code></pre></div><p><strong>方法3：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Universe<span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>

    <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

        <span class="token comment">// 其它内容</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;Big&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//测试代码</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>a <span class="token operator">===</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
a<span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>bang<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>

</code></pre></div><h2 id="构造函数模式"><a href="#构造函数模式" class="header-anchor">#</a> 构造函数模式</h2> <p>在 JavaScript 里，构造函数通常是认为用来实现实例的，JavaScript 没有类的概念，但是有特殊的构造函数,你可以告诉 JavaScript 你要创建一个新对象并且新对象的成员声明都是构造函数里定义的。在构造函数内部，this关键字引用的是新创建的对象。基本用法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">output</span><span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">+</span> <span class="token string">&quot;走了&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">+</span> <span class="token string">&quot;公里&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> tom<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dudu<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;Dudu&quot;</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dudu<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>上面的例子是个非常简单的构造函数模式，但是有点小问题 <code>output()</code> 在每次创建对象的时候都需要重新定义，最好的方法是让所有 <code>Car</code> 类型的实例都共享这个 <code>output()</code> 方法，这样如果有大批量的实例的话，就会节约很多内存</p> <p>解决这个问题，我们可以使用如下方式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>output<span class="token operator">=</span> formatCar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">formatCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">+</span> <span class="token string">&quot;走了&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">+</span> <span class="token string">&quot;公里&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="构造函数与原型"><a href="#构造函数与原型" class="header-anchor">#</a> 构造函数与原型</h3> <p>JavaScript 里函数有个原型属性叫 <code>prototype</code> ，当调用构造函数创建对象的时候，所有该构造函数原型的属性在新创建对象的实例上都可用。按照这样，多个 <code>Car</code> 对象实例可以共享同一个原型，我们再扩展一下上例的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
注意：这里我们使用了Object.prototype.方法名，而不是Object.prototype
主要是用来避免重写定义原型prototype对象
*/</span>
<span class="token class-name">Car</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">output</span><span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">+</span> <span class="token string">&quot;走了&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">+</span> <span class="token string">&quot;公里&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dudu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;Dudu&quot;</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dudu<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里，<code>output()</code> 单实例可以在所有 <code>Car</code> 对象实例里共享使用</p> <h3 id="只能用new吗"><a href="#只能用new吗" class="header-anchor">#</a> 只能用new吗？</h3> <p>上面的例子对函数 <code>car</code> 都是用 <code>new</code> 来创建对象的，只有这一种方式么？其实还有别的方式，我们列举两种：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
    <span class="token comment">// 自定义一个output输出内容</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">output</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">+</span> <span class="token string">&quot;走了&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">+</span> <span class="token string">&quot;公里&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//方法1：作为函数调用</span>
<span class="token function">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//添加到window对象上</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//方法2：在另外一个对象的作用域内调用</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Car</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">&quot;Dudu&quot;</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>该代码的方法1有点特殊，如果不使用 <code>new</code> 直接调用函数的话，<code>this</code> 指向的是全局对象 <code>window</code> ，我们来验证一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//作为函数调用</span>
<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tom<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;大叔走了20000公里&quot;</span>
</code></pre></div><p>这时候对象tom是undefined，而window.output()会正确输出结果，而如果使用new关键字则没有这个问题，验证如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//使用new 关键字</span>
<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tom<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;object&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;大叔走了20000公里&quot;</span>
</code></pre></div><h3 id="强制使用new"><a href="#强制使用new" class="header-anchor">#</a> 强制使用new</h3> <p>上述的例子展示了不使用 <code>new</code> 的问题，那么我们有没有办法让构造函数强制使用 <code>new</code> 关键字呢，答案是肯定的，上代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Car</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">output</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">+</span> <span class="token string">&quot;走了&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">+</span> <span class="token string">&quot;公里&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;大叔&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dudu <span class="token operator">=</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token string">&quot;Dudu&quot;</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tom<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;object&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;大叔走了20000公里&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> dudu<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;object&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dudu<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Dudu走了5000公里&quot;</span>
</code></pre></div><h3 id="原始包装函数"><a href="#原始包装函数" class="header-anchor">#</a> 原始包装函数</h3> <p>JavaScript 里有3中原始包装函数：<code>number</code> , <code>string</code> , <code>boolean</code> ，有时候两种都用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用原始包装函数</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;my string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 推荐这种</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">&quot;my string&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>只有在想保留数值状态的时候使用这些包装函数，关于区别可以参考下面的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 原始string</span>
<span class="token keyword">var</span> greet <span class="token operator">=</span> <span class="token string">&quot;Hello there&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 使用split()方法分割</span>
greet<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hello&quot;</span>
<span class="token comment">// 给原始类型添加新属性不会报错</span>
greet<span class="token punctuation">.</span>smile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 但无法获取这个值（18章ECMAScript实现里我们讲了为什么）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> greet<span class="token punctuation">.</span>smile<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;undefined&quot;</span>

<span class="token comment">// 原始string</span>
<span class="token keyword">var</span> greet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Hello there&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用split()方法分割</span>
greet<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hello&quot;</span>
<span class="token comment">// 给包装函数类型添加新属性不会报错</span>
greet<span class="token punctuation">.</span>smile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 可以正常访问新属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> greet<span class="token punctuation">.</span>smile<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;boolean&quot;</span>
</code></pre></div><h2 id="建造者模式"><a href="#建造者模式" class="header-anchor">#</a> 建造者模式</h2> <p>建造者模式（Builder）可以将一个复杂对象的构建与其表示相分离，使得同样的构建过程可以创建不同的表示。也就是说如果我们用了建造者模式，那么用户只需要指定需要建造的类型就可以得到所需要的东西，而具体建造的过程和细节不需要知道。建造者模式实际，就是一个指挥者，一个建造者和一个用户。用户调用指挥者，指挥者调用具体建造者工作，建造者建造出具体的东西给用户。</p> <p>建造者模式我们在代码中经常用到，比如Jquery中的ajax请求：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//1 用户发送一个请求</span>
<span class="token comment">//2 $.ajax建造者模式（指挥者）</span>
<span class="token comment">//3 具体实现 （建造者）</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   url<span class="token operator">:</span><span class="token string">'www.albertyy.com'</span><span class="token punctuation">,</span>
   <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">argument</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="工厂模式"><a href="#工厂模式" class="header-anchor">#</a> 工厂模式</h2> <p>工厂模式定义一个用于创建对象的接口，这个接口由子类决定实例化哪一个类。该模式使一个类的实例化延迟到了子类。而子类可以重写接口方法以便创建的时候指定自己的对象类型</p> <p>例子一：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Car <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token function-variable function">Car</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>miles <span class="token operator">=</span> miles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> year<span class="token punctuation">,</span> miles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> <span class="token number">2009</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dudu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">&quot;Dudu&quot;</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>举个使用例子：假如我们想在网页面里插入一些元素，而这些元素类型不固定，可能是图片，也有可能是连接，甚至可能是文本，根据工厂模式的定义，我们需要定义工厂类和相应的子类，我们先来定义子类的具体实现（也就是子函数）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> page <span class="token operator">=</span> page <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
page<span class="token punctuation">.</span>dom <span class="token operator">=</span> page<span class="token punctuation">.</span>dom <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//子函数1：处理文本</span>
page<span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function-variable function">Text</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> txt <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        where<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//子函数2：处理链接</span>
page<span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function-variable function">Link</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        link<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
        link<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        where<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//子函数3：处理图片</span>
page<span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function-variable function">Image</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> im <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        im<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
        where<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>那么我们如何定义工厂处理函数呢？其实很简单：</p> <div class="language-js extra-class"><pre class="language-js"><code>page<span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function-variable function">factory</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">page<span class="token punctuation">.</span>dom</span><span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方式如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> o <span class="token operator">=</span> page<span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'Link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'http://www.cnblogs.com'</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>以下几种情景下工厂模式特别有用：</p> <ul><li><p>对象的构建十分复杂</p></li> <li><p>需要依赖具体环境创建不同实例</p></li> <li><p>需要依赖具体环境创建不同实例</p></li></ul> <p><strong>什么时候不该用工厂模式</strong></p> <p>不滥用运用工厂模式，有时候仅仅只是给代码增加了不必要的复杂度，同时使得测试难以运行下去</p> <h2 id="装饰者模式"><a href="#装饰者模式" class="header-anchor">#</a> 装饰者模式</h2> <p>装饰者提供比继承更有弹性的替代方案。 装饰者用用于包装同接口的对象，不仅允许你向方法添加行为，而且还可以将方法设置成原始对象调用（例如装饰者的构造函数）。</p> <p>装饰者用于通过重载方法的形式添加新功能，该模式可以在被装饰者前面或者后面加上自己的行为以达到特定的目的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//需要装饰的类（函数）</span>
<span class="token keyword">function</span> <span class="token function">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Memory</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">75</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">BlurayDrive</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">Insurance</span><span class="token punctuation">(</span><span class="token parameter">macbook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> macbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">250</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 用法</span>
<span class="token keyword">var</span> myMacbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Insurance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlurayDrive</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Macbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMacbook<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面是另一个实例，当我们在装饰者对象上调用 <code>performTask</code> 时，它不仅具有一些装饰者的行为，同时也调用了下层对象的 <code>performTask</code> 函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">performTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">preTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doing something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">AbstractDecorator</span><span class="token punctuation">(</span><span class="token parameter">decorated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">performTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        decorated<span class="token punctuation">.</span><span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ConcreteDecoratorClass</span><span class="token punctuation">(</span><span class="token parameter">decorated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>base <span class="token operator">=</span> AbstractDecorator<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span>decorated<span class="token punctuation">)</span><span class="token punctuation">;</span>

    decorated<span class="token punctuation">.</span><span class="token function-variable function">preTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pre-calling..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    decorated<span class="token punctuation">.</span><span class="token function-variable function">postTask</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'post-calling..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> concrete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> decorator1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteDecoratorClass</span><span class="token punctuation">(</span>concrete<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> decorator2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteDecoratorClass</span><span class="token punctuation">(</span>decorator1<span class="token punctuation">)</span><span class="token punctuation">;</span>
decorator2<span class="token punctuation">.</span><span class="token function">performTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>再来一个彻底的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
tree<span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Make sure the tree won\'t fall'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree<span class="token punctuation">.</span><span class="token function-variable function">getDecorator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deco</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tree<span class="token punctuation">[</span>deco<span class="token punctuation">]</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">[</span>deco<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree<span class="token punctuation">.</span><span class="token function-variable function">RedBalls</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">RedBalls</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第7步：先执行原型（这时候是Angel了）的decorate方法</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Put on some red balls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第8步 再输出 red</span>
        <span class="token comment">// 将这2步作为RedBalls的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree<span class="token punctuation">.</span><span class="token function-variable function">BlueBalls</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">BlueBalls</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第1步：先执行原型的decorate方法，也就是tree.decorate()</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Add blue balls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第2步 再输出blue</span>
        <span class="token comment">// 将这2步作为BlueBalls的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree<span class="token punctuation">.</span><span class="token function-variable function">Angel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">Angel</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第4步：先执行原型（这时候是BlueBalls了）的decorate方法</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An angel on the top'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第5步 再输出angel</span>
        <span class="token comment">// 将这2步作为Angel的decorate方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'BlueBalls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第3步：将BlueBalls对象赋给tree，这时候父原型里的getDecorator依然可用</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'Angel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第6步：将Angel对象赋给tree，这时候父原型的父原型里的getDecorator依然可用</span>
tree <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getDecorator</span><span class="token punctuation">(</span><span class="token string">'RedBalls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第9步：将RedBalls对象赋给tree</span>

tree<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第10步：执行RedBalls对象的decorate方法</span>
</code></pre></div><h3 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h3> <p>装饰者模式是为已有功能动态地添加更多功能的一种方式，把每个要装饰的功能放在单独的函数里，然后用该函数包装所要装饰的已有函数对象，因此，当需要执行特殊行为的时候，调用代码就可以根据需要有选择地、按顺序地使用装饰功能来包装对象。优点是把类（函数）的核心职责和装饰功能区分开了。</p> <h2 id="外观模式"><a href="#外观模式" class="header-anchor">#</a> 外观模式</h2> <p>外观模式（Facade）为子系统中的一组接口提供了一个一致的界面，此模块定义了一个高层接口，处理环境中的差异化部分</p> <p>外观模式不仅简化类中的接口，而且对接口与调用者也进行了解耦。外观模式经常被认为开发者必备，它可以将一些复杂操作封装起来，并创建一个简单的接口用于调用。</p> <p>外观模式经常被用于JavaScript类库里，通过它封装一些接口用于兼容多浏览器，外观模式可以让我们间接调用子系统，从而避免因直接访问子系统而产生不必要的错误。</p> <p>外观模式的优势是易于使用，而且本身也比较轻量级。但也有缺点 外观模式被开发者连续使用时会产生一定的性能问题，因为在每次调用时都要检测功能的可用性。</p> <p>下面是一段未优化过的代码，我们使用了外观模式通过检测浏览器特性的方式来创建一个跨浏览器的使用方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">addMyEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> ev<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> ev<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> ev<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><p>再来一个简单的例子，说白了就是用一个接口封装其它的接口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> mobileEvent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function-variable function">stop</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结-3"><a href="#总结-3" class="header-anchor">#</a> 总结</h3> <p>那么何时使用外观模式呢？一般来说分三个阶段：</p> <p>首先，在设计初期，应该要有意识地将不同的两个层分离，比如经典的三层结构，在数据访问层和业务逻辑层、业务逻辑层和表示层之间建立外观 Facade。</p> <p>其次，在开发阶段，子系统往往因为不断的重构演化而变得越来越复杂，增加外观Facade可以提供一个简单的接口，减少他们之间的依赖。</p> <p>第三，在维护一个遗留的大型系统时，可能这个系统已经很难维护了，这时候使用外观Facade也是非常合适的，为系统开发一个外观Facade类，为设计粗糙和高度复杂的遗留代码提供比较清晰的接口，让新系统和Facade对象交互，Facade与遗留代码交互所有的复杂工作。</p> <h2 id="迭代器模式"><a href="#迭代器模式" class="header-anchor">#</a> 迭代器模式</h2> <p>迭代器模式(Iterator)：提供一种方法顺序一个聚合对象中各个元素，而又不暴露该对象内部表示。</p> <p>迭代器的几个特点是：</p> <ul><li><p>访问一个聚合对象的内容而无需暴露它的内部表示。</p></li> <li><p>为遍历不同的集合结构提供一个统一的接口，从而支持同样的算法在不同的集合结构上进行操作。</p></li> <li><p>遍历的同时更改迭代器所在的集合结构可能会导致问题（比如C#的foreach里不允许修改item）</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> agg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    length <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> element<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            element <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
            index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> element<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token function-variable function">hasNext</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> index <span class="token operator">&lt;</span> length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token function-variable function">rewind</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token function-variable function">current</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>使用方法和平时C#里的方式是一样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 迭代的结果是：1,3,5</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，你也可以通过额外的方法来重置数据，然后再继续其它操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 重置</span>
agg<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

</code></pre></div><p>像数组<code>map</code>方法也是一种迭代器方法</p> <h2 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h2> <p>观察者模式它定义了一种一对多的关系，让多个观察者对象同时监听某一个主题对象，这个主题对象的状态发生变化时就会通知所有的观察者对象，使得它们能够自动更新自己。</p> <p>使用观察者模式的好处：</p> <ul><li><p>支持简单的广播通信，自动通知所有已经订阅过的对象。</p></li> <li><p>目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用</p></li> <li><p>发布者与订阅者耦合性降低，发布者只管发布一条消息出去，它不关心这条消息如何被订阅者使用，同时，订阅者只监听发布者的事件名，只要发布者的事件名不变，它不管发布者如何改变；</p></li></ul> <p>发布订阅模式的缺点：</p> <ol><li><p>创建订阅者需要消耗一定的时间和内存。</p></li> <li><p>虽然可以弱化对象之间的联系，如果过度使用的话，反而使代码不好理解及代码不好维护等等。</p></li></ol> <p>在JavaScript中观察者模式常用于事件绑定中</p> <div class="language-js extra-class"><pre class="language-js"><code>div<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">alert</span> <span class="token punctuation">(</span> <span class="token string">'click'</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们希望用户点击 <code>div</code> 的时候，触发一下 <code>alert ( 'click' )</code> ，但是我们并不确定用户什么时候会触发点击事件，所以在 <code>div</code> 上订阅执行事件，当用户点击了 <code>div</code> ，那么就会执行函数</p> <p>这里订阅者就是执行函数、订阅了 <code>div</code> 的 <code>click</code> 事件</p> <h3 id="自定义观察者模式"><a href="#自定义观察者模式" class="header-anchor">#</a> 自定义观察者模式</h3> <p>这个例子应该属于发布订阅者模式？</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">function</span> <span class="token function">obs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> <span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tmp <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">?</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">:</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      tmp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">成功添加订阅消息</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">one</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _this<span class="token punctuation">.</span><span class="token function">moveAll</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      _this<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">moveAll</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">成功取消所有订阅消息</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">moveOne</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> findIndex <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> fn<span class="token punctuation">)</span>
        obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>findIndex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">成功取消订阅消息</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 取第一个参数</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> obj
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      listen<span class="token punctuation">,</span>
      one<span class="token punctuation">,</span>
      moveOne<span class="token punctuation">,</span>
      moveAll<span class="token punctuation">,</span>
      send<span class="token punctuation">,</span>
      get
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> newObs <span class="token operator">=</span> <span class="token function">obs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">role1Fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是role1，吃饭'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">role2Fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是role2，游泳'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">role2Fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是role2，再来一次游泳'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  newObs<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'role1'</span><span class="token punctuation">,</span> role1Fn<span class="token punctuation">)</span> <span class="token comment">// role1成功添加订阅消息function () {  console.log('我是role1，吃饭') }</span>
  newObs<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'role2'</span><span class="token punctuation">,</span> role2Fn<span class="token punctuation">)</span> <span class="token comment">// role1成功添加订阅消息function () {  console.log('我是role2，游泳') }</span>
  newObs<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'role2'</span><span class="token punctuation">,</span> role2Fn2<span class="token punctuation">)</span><span class="token comment">// role1成功添加订阅消息function () {  console.log('我是role2，再来一次游泳') }</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前订阅：'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  newObs<span class="token punctuation">.</span><span class="token function">moveOne</span><span class="token punctuation">(</span><span class="token string">'role2'</span><span class="token punctuation">,</span> role2Fn2<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当然订阅：'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  newObs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'role2'</span><span class="token punctuation">)</span> <span class="token comment">// 我是role2，游泳, 我是role2，再来一次游泳</span>
</code></pre></div><h3 id="观察者模式和发布订阅模式的区别"><a href="#观察者模式和发布订阅模式的区别" class="header-anchor">#</a> 观察者模式和发布订阅模式的区别</h3> <p>观察者模式和发布订阅模式最大的区别就是发布订阅模式有个事件调度中心</p> <p><img src="/lanjz/assets/img/shejimoshi_1.b4cf3c96.png" alt=""></p> <p>从图中可以看出，观察者模式中观察者和目标直接进行交互，而发布订阅模式中统一由调度中心进行处理，订阅者和发布者互不干扰。这样一方面实现了解耦，还有就是可以实现更细粒度的一些控制。比如发布者发布了很多消息，但是不想所有的订阅者都接收到，就可以在调度中心做一些处理，类似于权限控制之类的。还可以做一些节流操作</p> <p>观察者模式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 观察者</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 观察者列表</span>
<span class="token keyword">class</span> <span class="token class-name">ObserverList</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observerList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observerList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observerList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observerList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">ob</span> <span class="token operator">=&gt;</span> ob <span class="token operator">!==</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observerList<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observerList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 目标</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObserverList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> obCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> obCount<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>发布-订单者模式</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">PubSub</span><span class="token punctuation">{</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>listeners <span class="token operator">||</span> <span class="token operator">!</span>listeners<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token function">publish</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>listeners <span class="token operator">||</span> <span class="token operator">!</span>listeners<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PubSub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ob<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ob<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ob<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ob.unsubscribe('add',a);</span>
        ob<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>从上面代码可以看出，观察者模式由具体目标调度，每个被订阅的目标里面都需要有对观察者的处理，会造成代码的冗余。而发布订阅模式则统一由调度中心处理，消除了发布者和订阅者之间的依赖。</p> <p>观察者模式跟我们平时用的事件也有一定的关系，比如：</p> <p><code>ele.addEventListener('click', () =&gt; {});</code></p> <p><code>addEventListener</code> 就相当于注册了一个观察者，当观察到‘click’事件的时候，作出一些处理</p> <p><a href="https://www.huaweicloud.com/articles/12641018.html" target="_blank" rel="noopener noreferrer">观察者模式和发布订阅模式的区别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lanjz/JavaScript/闭包.html" class="prev">
        闭包
      </a></span> <span class="next"><a href="/lanjz/JavaScript/对象创建模式.html">
        对象创建模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.ff4b3de9.js" defer></script><script src="/lanjz/assets/js/2.ecbcf784.js" defer></script><script src="/lanjz/assets/js/43.653d78ca.js" defer></script>
  </body>
</html>
