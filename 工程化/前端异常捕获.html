<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于前端错误处理 | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.7cd46e43.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.01b6ac5f.js" as="script"><link rel="preload" href="/lanjz/assets/js/31.06c3ba3b.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.ef7d5f95.js"><link rel="prefetch" href="/lanjz/assets/js/100.f28e1a08.js"><link rel="prefetch" href="/lanjz/assets/js/101.586432d4.js"><link rel="prefetch" href="/lanjz/assets/js/102.ef4701e7.js"><link rel="prefetch" href="/lanjz/assets/js/103.18e3ae7a.js"><link rel="prefetch" href="/lanjz/assets/js/104.ad785e25.js"><link rel="prefetch" href="/lanjz/assets/js/105.565f8913.js"><link rel="prefetch" href="/lanjz/assets/js/106.19cca14e.js"><link rel="prefetch" href="/lanjz/assets/js/107.de7d82f9.js"><link rel="prefetch" href="/lanjz/assets/js/108.fd7cad2b.js"><link rel="prefetch" href="/lanjz/assets/js/109.421c03e6.js"><link rel="prefetch" href="/lanjz/assets/js/11.0f3e43a8.js"><link rel="prefetch" href="/lanjz/assets/js/110.74832b48.js"><link rel="prefetch" href="/lanjz/assets/js/111.bbf2f3b4.js"><link rel="prefetch" href="/lanjz/assets/js/112.de282b6e.js"><link rel="prefetch" href="/lanjz/assets/js/113.518f8426.js"><link rel="prefetch" href="/lanjz/assets/js/114.26c705d5.js"><link rel="prefetch" href="/lanjz/assets/js/115.6d9fe4ee.js"><link rel="prefetch" href="/lanjz/assets/js/116.e05befa6.js"><link rel="prefetch" href="/lanjz/assets/js/117.b69d123d.js"><link rel="prefetch" href="/lanjz/assets/js/118.8c428f7b.js"><link rel="prefetch" href="/lanjz/assets/js/119.a9b37641.js"><link rel="prefetch" href="/lanjz/assets/js/12.bbc452ed.js"><link rel="prefetch" href="/lanjz/assets/js/120.cf667989.js"><link rel="prefetch" href="/lanjz/assets/js/121.79569dcf.js"><link rel="prefetch" href="/lanjz/assets/js/122.c38e3718.js"><link rel="prefetch" href="/lanjz/assets/js/123.e2557e66.js"><link rel="prefetch" href="/lanjz/assets/js/124.ffb3ce7a.js"><link rel="prefetch" href="/lanjz/assets/js/125.f6f9fd98.js"><link rel="prefetch" href="/lanjz/assets/js/126.96319153.js"><link rel="prefetch" href="/lanjz/assets/js/127.ecd3a947.js"><link rel="prefetch" href="/lanjz/assets/js/128.5a1d3d7b.js"><link rel="prefetch" href="/lanjz/assets/js/129.94389cf1.js"><link rel="prefetch" href="/lanjz/assets/js/13.bbd8df8e.js"><link rel="prefetch" href="/lanjz/assets/js/130.e4caece3.js"><link rel="prefetch" href="/lanjz/assets/js/131.0aee2880.js"><link rel="prefetch" href="/lanjz/assets/js/132.069f272d.js"><link rel="prefetch" href="/lanjz/assets/js/133.14de2cf3.js"><link rel="prefetch" href="/lanjz/assets/js/134.77001a8c.js"><link rel="prefetch" href="/lanjz/assets/js/135.37f9ec91.js"><link rel="prefetch" href="/lanjz/assets/js/136.a3edd4e5.js"><link rel="prefetch" href="/lanjz/assets/js/137.ed299013.js"><link rel="prefetch" href="/lanjz/assets/js/138.573a123d.js"><link rel="prefetch" href="/lanjz/assets/js/139.98f4b3ae.js"><link rel="prefetch" href="/lanjz/assets/js/14.2a82515b.js"><link rel="prefetch" href="/lanjz/assets/js/140.e5203fed.js"><link rel="prefetch" href="/lanjz/assets/js/141.dac3b412.js"><link rel="prefetch" href="/lanjz/assets/js/142.4670cbad.js"><link rel="prefetch" href="/lanjz/assets/js/143.f3a79051.js"><link rel="prefetch" href="/lanjz/assets/js/144.c178afa4.js"><link rel="prefetch" href="/lanjz/assets/js/145.34e65013.js"><link rel="prefetch" href="/lanjz/assets/js/146.67a11a03.js"><link rel="prefetch" href="/lanjz/assets/js/147.e332eecb.js"><link rel="prefetch" href="/lanjz/assets/js/148.b0f49176.js"><link rel="prefetch" href="/lanjz/assets/js/149.5ab23b63.js"><link rel="prefetch" href="/lanjz/assets/js/15.ca198b20.js"><link rel="prefetch" href="/lanjz/assets/js/150.254cec6d.js"><link rel="prefetch" href="/lanjz/assets/js/151.8708db47.js"><link rel="prefetch" href="/lanjz/assets/js/152.812e51ad.js"><link rel="prefetch" href="/lanjz/assets/js/153.05ec6d75.js"><link rel="prefetch" href="/lanjz/assets/js/154.d87e6106.js"><link rel="prefetch" href="/lanjz/assets/js/155.126a03ed.js"><link rel="prefetch" href="/lanjz/assets/js/156.df4fc68e.js"><link rel="prefetch" href="/lanjz/assets/js/157.90b9800b.js"><link rel="prefetch" href="/lanjz/assets/js/158.de17ca90.js"><link rel="prefetch" href="/lanjz/assets/js/159.57e4141a.js"><link rel="prefetch" href="/lanjz/assets/js/16.686ff8f6.js"><link rel="prefetch" href="/lanjz/assets/js/160.6b353d62.js"><link rel="prefetch" href="/lanjz/assets/js/161.03a04fb6.js"><link rel="prefetch" href="/lanjz/assets/js/162.39341f3a.js"><link rel="prefetch" href="/lanjz/assets/js/163.aec34fe9.js"><link rel="prefetch" href="/lanjz/assets/js/164.d60780c0.js"><link rel="prefetch" href="/lanjz/assets/js/165.ee49ea00.js"><link rel="prefetch" href="/lanjz/assets/js/166.5fe319fa.js"><link rel="prefetch" href="/lanjz/assets/js/167.db957580.js"><link rel="prefetch" href="/lanjz/assets/js/168.e7586563.js"><link rel="prefetch" href="/lanjz/assets/js/169.5e9eaae7.js"><link rel="prefetch" href="/lanjz/assets/js/17.49359df4.js"><link rel="prefetch" href="/lanjz/assets/js/170.1399340e.js"><link rel="prefetch" href="/lanjz/assets/js/171.80fc9060.js"><link rel="prefetch" href="/lanjz/assets/js/172.afc29028.js"><link rel="prefetch" href="/lanjz/assets/js/173.1d17da88.js"><link rel="prefetch" href="/lanjz/assets/js/174.050d84c7.js"><link rel="prefetch" href="/lanjz/assets/js/175.2c16f437.js"><link rel="prefetch" href="/lanjz/assets/js/176.6d5fb49b.js"><link rel="prefetch" href="/lanjz/assets/js/177.1e4239ab.js"><link rel="prefetch" href="/lanjz/assets/js/178.0a423033.js"><link rel="prefetch" href="/lanjz/assets/js/179.79642804.js"><link rel="prefetch" href="/lanjz/assets/js/18.4f59a0fb.js"><link rel="prefetch" href="/lanjz/assets/js/180.ca2aab47.js"><link rel="prefetch" href="/lanjz/assets/js/181.70f1fde1.js"><link rel="prefetch" href="/lanjz/assets/js/182.ffc4862e.js"><link rel="prefetch" href="/lanjz/assets/js/183.be8b1d68.js"><link rel="prefetch" href="/lanjz/assets/js/184.004b4462.js"><link rel="prefetch" href="/lanjz/assets/js/185.274ab328.js"><link rel="prefetch" href="/lanjz/assets/js/186.b01b303a.js"><link rel="prefetch" href="/lanjz/assets/js/187.68f0b5b7.js"><link rel="prefetch" href="/lanjz/assets/js/188.f160d822.js"><link rel="prefetch" href="/lanjz/assets/js/189.a42008a6.js"><link rel="prefetch" href="/lanjz/assets/js/19.1bfabf2b.js"><link rel="prefetch" href="/lanjz/assets/js/190.73a1c0eb.js"><link rel="prefetch" href="/lanjz/assets/js/191.38eb97a2.js"><link rel="prefetch" href="/lanjz/assets/js/192.341f958e.js"><link rel="prefetch" href="/lanjz/assets/js/193.2dd962bb.js"><link rel="prefetch" href="/lanjz/assets/js/194.04059a50.js"><link rel="prefetch" href="/lanjz/assets/js/195.fa5baea1.js"><link rel="prefetch" href="/lanjz/assets/js/196.b9309d21.js"><link rel="prefetch" href="/lanjz/assets/js/197.6355b53d.js"><link rel="prefetch" href="/lanjz/assets/js/198.1b6fe651.js"><link rel="prefetch" href="/lanjz/assets/js/199.691a9273.js"><link rel="prefetch" href="/lanjz/assets/js/20.3e57612e.js"><link rel="prefetch" href="/lanjz/assets/js/200.be26a971.js"><link rel="prefetch" href="/lanjz/assets/js/201.845c1eef.js"><link rel="prefetch" href="/lanjz/assets/js/202.701b95fa.js"><link rel="prefetch" href="/lanjz/assets/js/203.bced5889.js"><link rel="prefetch" href="/lanjz/assets/js/204.805327c6.js"><link rel="prefetch" href="/lanjz/assets/js/205.230f8928.js"><link rel="prefetch" href="/lanjz/assets/js/206.e3cdf5ab.js"><link rel="prefetch" href="/lanjz/assets/js/207.0f84df19.js"><link rel="prefetch" href="/lanjz/assets/js/208.4a4f2706.js"><link rel="prefetch" href="/lanjz/assets/js/209.b5d5d752.js"><link rel="prefetch" href="/lanjz/assets/js/21.31b11d48.js"><link rel="prefetch" href="/lanjz/assets/js/210.ef149428.js"><link rel="prefetch" href="/lanjz/assets/js/211.574ff7ad.js"><link rel="prefetch" href="/lanjz/assets/js/212.c703b3d1.js"><link rel="prefetch" href="/lanjz/assets/js/213.276e3342.js"><link rel="prefetch" href="/lanjz/assets/js/214.1aa648fd.js"><link rel="prefetch" href="/lanjz/assets/js/215.17d8ebec.js"><link rel="prefetch" href="/lanjz/assets/js/216.c400337d.js"><link rel="prefetch" href="/lanjz/assets/js/22.f6a295b8.js"><link rel="prefetch" href="/lanjz/assets/js/23.f15ae585.js"><link rel="prefetch" href="/lanjz/assets/js/24.cdccc4fb.js"><link rel="prefetch" href="/lanjz/assets/js/25.334c3315.js"><link rel="prefetch" href="/lanjz/assets/js/26.41cf2109.js"><link rel="prefetch" href="/lanjz/assets/js/27.a89093f1.js"><link rel="prefetch" href="/lanjz/assets/js/28.8ec021fd.js"><link rel="prefetch" href="/lanjz/assets/js/29.ba0c971c.js"><link rel="prefetch" href="/lanjz/assets/js/3.dd2498e8.js"><link rel="prefetch" href="/lanjz/assets/js/30.60114cdd.js"><link rel="prefetch" href="/lanjz/assets/js/32.6c8dd401.js"><link rel="prefetch" href="/lanjz/assets/js/33.ca724226.js"><link rel="prefetch" href="/lanjz/assets/js/34.4e4642ee.js"><link rel="prefetch" href="/lanjz/assets/js/35.34db1092.js"><link rel="prefetch" href="/lanjz/assets/js/36.faa0136c.js"><link rel="prefetch" href="/lanjz/assets/js/37.3c536709.js"><link rel="prefetch" href="/lanjz/assets/js/38.3a093e08.js"><link rel="prefetch" href="/lanjz/assets/js/39.66332005.js"><link rel="prefetch" href="/lanjz/assets/js/4.5ac2e6c3.js"><link rel="prefetch" href="/lanjz/assets/js/40.ba61d001.js"><link rel="prefetch" href="/lanjz/assets/js/41.641961b9.js"><link rel="prefetch" href="/lanjz/assets/js/42.79dcb19c.js"><link rel="prefetch" href="/lanjz/assets/js/43.80de448a.js"><link rel="prefetch" href="/lanjz/assets/js/44.3effab60.js"><link rel="prefetch" href="/lanjz/assets/js/45.bd1e2214.js"><link rel="prefetch" href="/lanjz/assets/js/46.6974286c.js"><link rel="prefetch" href="/lanjz/assets/js/47.5279b744.js"><link rel="prefetch" href="/lanjz/assets/js/48.fa7f3926.js"><link rel="prefetch" href="/lanjz/assets/js/49.97fc3050.js"><link rel="prefetch" href="/lanjz/assets/js/5.34d56d9c.js"><link rel="prefetch" href="/lanjz/assets/js/50.522c07a4.js"><link rel="prefetch" href="/lanjz/assets/js/51.279d97a3.js"><link rel="prefetch" href="/lanjz/assets/js/52.2a4dba54.js"><link rel="prefetch" href="/lanjz/assets/js/53.2b84adce.js"><link rel="prefetch" href="/lanjz/assets/js/54.50197f24.js"><link rel="prefetch" href="/lanjz/assets/js/55.44f78fc1.js"><link rel="prefetch" href="/lanjz/assets/js/56.04e7bc78.js"><link rel="prefetch" href="/lanjz/assets/js/57.06f12565.js"><link rel="prefetch" href="/lanjz/assets/js/58.e8ee07bf.js"><link rel="prefetch" href="/lanjz/assets/js/59.14c56c4a.js"><link rel="prefetch" href="/lanjz/assets/js/6.79967bc0.js"><link rel="prefetch" href="/lanjz/assets/js/60.c7b7efa9.js"><link rel="prefetch" href="/lanjz/assets/js/61.00a28ce5.js"><link rel="prefetch" href="/lanjz/assets/js/62.8c3225b9.js"><link rel="prefetch" href="/lanjz/assets/js/63.a9301728.js"><link rel="prefetch" href="/lanjz/assets/js/64.196ee770.js"><link rel="prefetch" href="/lanjz/assets/js/65.8a15f39f.js"><link rel="prefetch" href="/lanjz/assets/js/66.2f6af6d0.js"><link rel="prefetch" href="/lanjz/assets/js/67.0e8028b5.js"><link rel="prefetch" href="/lanjz/assets/js/68.21402b3f.js"><link rel="prefetch" href="/lanjz/assets/js/69.22bdc79c.js"><link rel="prefetch" href="/lanjz/assets/js/7.ffbbf829.js"><link rel="prefetch" href="/lanjz/assets/js/70.ea06dec5.js"><link rel="prefetch" href="/lanjz/assets/js/71.f20977f0.js"><link rel="prefetch" href="/lanjz/assets/js/72.8bc1e78f.js"><link rel="prefetch" href="/lanjz/assets/js/73.ee02e633.js"><link rel="prefetch" href="/lanjz/assets/js/74.2bf627d5.js"><link rel="prefetch" href="/lanjz/assets/js/75.ec5b178e.js"><link rel="prefetch" href="/lanjz/assets/js/76.aac1f95e.js"><link rel="prefetch" href="/lanjz/assets/js/77.e52d41c8.js"><link rel="prefetch" href="/lanjz/assets/js/78.03729c99.js"><link rel="prefetch" href="/lanjz/assets/js/79.37169c55.js"><link rel="prefetch" href="/lanjz/assets/js/8.bf3ccef5.js"><link rel="prefetch" href="/lanjz/assets/js/80.abece1c6.js"><link rel="prefetch" href="/lanjz/assets/js/81.316b697c.js"><link rel="prefetch" href="/lanjz/assets/js/82.441a1212.js"><link rel="prefetch" href="/lanjz/assets/js/83.debeebee.js"><link rel="prefetch" href="/lanjz/assets/js/84.8902f942.js"><link rel="prefetch" href="/lanjz/assets/js/85.1d517f08.js"><link rel="prefetch" href="/lanjz/assets/js/86.b6c9ed38.js"><link rel="prefetch" href="/lanjz/assets/js/87.63ea0f64.js"><link rel="prefetch" href="/lanjz/assets/js/88.76f09d30.js"><link rel="prefetch" href="/lanjz/assets/js/89.26c1364a.js"><link rel="prefetch" href="/lanjz/assets/js/9.6fbe80d8.js"><link rel="prefetch" href="/lanjz/assets/js/90.99bc1f4e.js"><link rel="prefetch" href="/lanjz/assets/js/91.9d0b1be9.js"><link rel="prefetch" href="/lanjz/assets/js/92.6553dd14.js"><link rel="prefetch" href="/lanjz/assets/js/93.49bccd35.js"><link rel="prefetch" href="/lanjz/assets/js/94.64d85a44.js"><link rel="prefetch" href="/lanjz/assets/js/95.6d1718e9.js"><link rel="prefetch" href="/lanjz/assets/js/96.9c15bd5e.js"><link rel="prefetch" href="/lanjz/assets/js/97.adc76242.js"><link rel="prefetch" href="/lanjz/assets/js/98.356fcffa.js"><link rel="prefetch" href="/lanjz/assets/js/99.dcd02301.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/ESBuild/" class="nav-link">
  esbuild
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/性能指标.html" class="nav-link">
  性能指标
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关于前端错误处理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#js运行时错误" class="sidebar-link">js运行时错误</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#window-onerror" class="sidebar-link">window.onerror</a></li></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#资源加载错误" class="sidebar-link">资源加载错误</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#window-addeventlistener-error" class="sidebar-link">window.addEventListener('error')</a></li></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#未处理的promise错误处理方式" class="sidebar-link">未处理的promise错误处理方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#请求异常" class="sidebar-link">请求异常</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#vue-错误" class="sidebar-link">Vue 错误</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#react-异常捕获" class="sidebar-link">React 异常捕获</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#崩溃和卡顿" class="sidebar-link">崩溃和卡顿</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#错误上报" class="sidebar-link">错误上报</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lanjz/%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.html#try-catch" class="sidebar-link">try...catch</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="关于前端错误处理"><a href="#关于前端错误处理" class="header-anchor">#</a> 关于前端错误处理</h1> <p>今天来捋下如何捕获前端出现的异常信息，首先整理了一下前端的错误类型：</p> <ul><li><p>js运行时错误</p></li> <li><p>资源加载错误</p></li> <li><p>未处理的promise错误</p></li> <li><p>异步请求错误（fetch与xhr）</p></li> <li><p>跨域 Script error</p></li> <li><p>Iframe 异常</p></li></ul> <p>目前没有一个 <code>api</code> 就能把上面几种错误类型都捕获到，所以针对不同类型的错误需要使用不同的捕获方式</p> <h2 id="js运行时错误"><a href="#js运行时错误" class="header-anchor">#</a> js运行时错误</h2> <p>运行时错误例子： <code>let a = 1 + b</code></p> <p>js运行时错误可以使用 <code>window.onerror</code> 和 <code>window.addEventListener('error')</code>，看下区别</p> <p><strong>window.onerror</strong></p> <ul><li><p>只能捕获到运行时错误</p></li> <li><p>可以捕获同步代码和异步代码的异常</p></li> <li><p>捕获不到静态资源加载异常</p></li></ul> <p><strong>window.addEventListener('error')</strong></p> <ul><li><p>可以捕获同步代码和异步代码的异常</p></li> <li><p>可以捕获到运行时错误</p></li> <li><p>可以捕获到静态资源加载异常</p></li></ul> <p>这么一看好像是 <code>window.addEventListener('error')</code> 更厉害一点，但是网上大多都是推荐使用 <code>window.onerror</code> 来捕获 js 运行时错误，为啥？</p> <p><strong>因为 <code>window.onerror</code> 是标准错误捕获接口，<code>window.addEventListener('error')</code> 不那么标准，各个浏览器的实现不统一，拿到的数据也不统一</strong></p> <p>所以才用以 <code>window.onerror</code> 为主， <code>window.addEventListener('error')</code> 为辅的监听方式</p> <h3 id="window-onerror"><a href="#window-onerror" class="header-anchor">#</a> window.onerror</h3> <p>回到正题，js运行时错误使用 <code>window.onerror = function(message, source, lineno, colno, error) { ... }</code>，参数表示如下：</p> <ul><li><p>message：错误信息（字符串）</p></li> <li><p>source：发生错误的脚本URL（字符串）</p></li> <li><p>lineno：发生错误的行号（数字）</p></li> <li><p>colno：发生错误的列号（数字）</p></li> <li><p>error：Error对象（对象）</p></li></ul> <p><img src="/lanjz/assets/img/onerror.a574d9ff.png" alt=""></p> <p>若该函数返回 <code>true</code>，则阻止异常继续向上抛出，否则最终控制台还是会显示 <code>Uncaught Error: xxxxx</code></p> <p><strong>Script error.</strong></p> <p>一般情况，如果出现 Script error 这样的错误，基本上可以确定是出现了跨域问题。这时候，是不会有其他太多辅助信息的，但是解决思路无非如下：</p> <p>跨源资源共享机制( CORS )：我们为 script 标签添加 crossOrigin 属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;http://jartto.wang/main.js&quot;</span> crossorigin<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>或者动态去添加 js 脚本：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>特别注意，服务器端需要设置：<code>Access-Control-Allow-Origin</code></p> <h2 id="资源加载错误"><a href="#资源加载错误" class="header-anchor">#</a> 资源加载错误</h2> <p>上文咱们使用 <code>window.onerror</code> 来捕获运行时的错误，但是 <code>window.onerror</code> 是捕获不到资源加载错误的，捕获资源加载错误需要使用 <code>window.addEventListener('error')</code></p> <h3 id="window-addeventlistener-error"><a href="#window-addeventlistener-error" class="header-anchor">#</a> window.addEventListener('error')</h3> <p>用法 <code>window.addEventListener('error', function(event) { ... })</code>， ErrorEvent 类型的 <code>event</code> 包含有关事件和错误的所有信息</p> <p>ErrorEvent 包含错误发生时的信息：</p> <ul><li><p><code>ErrorEvent.prototype.message</code>: 字符串，包含了所发生错误的描述信息</p></li> <li><p><code>ErrorEvent.prototype.filename</code>: 字符串，包含了发生错误的脚本文件的文件名</p></li> <li><p><code>ErrorEvent.prototype.lineno</code>: 数字，包含了错误发生时所在的行号</p></li> <li><p><code>ErrorEvent.prototype.colno</code>: 数字，包含了错误发生时所在的列号</p></li> <li><p><code>ErrorEvent.prototype.error</code>: 发生错误时所抛出的 Error 对象</p></li></ul> <p><img src="/lanjz/assets/img/addlistentceerror.8ec36f0c.png" alt=""></p> <p>注意 <code>window.addEventListener('error')</code> 虽然可以捕捉到网络请求的异常，但是无法判断 HTTP 的状态是 404 还是其他比如 500 等等，所以还需要配合服务端日志才进行排查分析才可以</p> <p>注意 <code>window.onerror</code> 捕获的错误 <code>window.addEventListener('error')</code> 也能捕获到，所以为了避免重复上报，需要添加资源错误类型的判断</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 过滤js error</span>
  <span class="token keyword">let</span> target <span class="token operator">=</span> event<span class="token punctuation">.</span>target <span class="token operator">||</span> event<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span>
  <span class="token keyword">let</span> isElementTarget <span class="token operator">=</span> target <span class="token keyword">instanceof</span> <span class="token class-name">HTMLScriptElement</span> <span class="token operator">||</span> target <span class="token keyword">instanceof</span> <span class="token class-name">HTMLLinkElement</span> <span class="token operator">||</span> target <span class="token keyword">instanceof</span> <span class="token class-name">HTMLImageElement</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isElementTarget<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token comment">// 上报资源地址</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> target<span class="token punctuation">.</span>src <span class="token operator">||</span> target<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="未处理的promise错误处理方式"><a href="#未处理的promise错误处理方式" class="header-anchor">#</a> 未处理的promise错误处理方式</h2> <p>当 <code>promise</code> 被 <code>reject</code> 并且错误信息没有被处理的时候，会抛出一个 <code>unhandledrejection</code></p> <p>这个错误不会被 <code>window.onerror</code> 以及 <code>window.addEventListener('error')</code> 捕获，但是有专门的 <code>window.addEventListener('unhandledrejection')</code> 方法进行捕获处理</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'rejectionhandled'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// reason字段包含错误的详细信息</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">pro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> b
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">pro</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/lanjz/assets/img/unhandlerreject.437e509d.png" alt=""></p> <h2 id="请求异常"><a href="#请求异常" class="header-anchor">#</a> 请求异常</h2> <p>如果使用第三方的请求库如 <code>axios</code>，包含了捕获错误的信息，可以当做 <code>promise</code> 异常处理</p> <p>对于原生的请求 api 如 <code>fetch</code> 和 <code>xhr</code>，我们需要通过改写它们的原生方法，在触发错误时进行自动化的捕获和上报</p> <p><strong>fetch:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// fetch的处理</span>
<span class="token keyword">function</span> <span class="token function">_errorFetchInit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>fetch<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _oldFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">_oldFetch</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当status不为2XX的时候，上报错误</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> res<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 当fetch方法错误时上报</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// error.message,</span>
            <span class="token comment">// error.stack</span>
            <span class="token comment">// 抛出错误并且上报</span>
            <span class="token keyword">throw</span> error<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>xhr:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// xhr的处理</span>
<span class="token keyword">function</span> <span class="token function">_errorAjaxInit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> protocol <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol <span class="token operator">===</span> <span class="token string">'file:'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理XMLHttpRequest</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> xmlhttp <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>    
    <span class="token comment">// 保存原生send方法</span>
    <span class="token keyword">let</span> _oldSend <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token function-variable function">_handleEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>currentTarget <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// event.currentTarget 即为构建的xhr实例</span>
                    <span class="token comment">// event.currentTarget.response</span>
                    <span class="token comment">// event.currentTarget.responseURL || event.currentTarget.ajaxUrl</span>
                    <span class="token comment">// event.currentTarget.status</span>
                    <span class="token comment">// event.currentTarget.statusText</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>va
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tool\'s error: '</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    xmlhttp<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> _handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 失败</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> _handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 完成</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> _handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取消</span>
        <span class="token keyword">return</span> <span class="token function">_oldSend</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-错误"><a href="#vue-错误" class="header-anchor">#</a> Vue 错误</h2> <p>vue内部发生的错误会被Vue拦截，因此vue提供方法给我们处理vue组件内部发生的错误</p> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="react-异常捕获"><a href="#react-异常捕获" class="header-anchor">#</a> React 异常捕获</h2> <p>React 16 提供了一个内置函数 <code>componentDidCatch</code>，使用它可以非常简单的获取到 react 下的错误信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="崩溃和卡顿"><a href="#崩溃和卡顿" class="header-anchor">#</a> 崩溃和卡顿</h2> <p>卡顿也就是网页暂时响应比较慢， JS 可能无法及时执行。崩溃就更严重了，有什么办法可以监控网页的崩溃</p> <p>利用 window 对象的 load 和 beforeunload 事件实现了网页崩溃的监控</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">,</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'time_before_crash'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'true'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
        insert crash logging code here
    */</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hey, welcome back from your crash, looks like you crashed on: '</span> <span class="token operator">+</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'time_before_crash'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>上面代码的是利用了页面崩溃无法触发 <code>beforeunload</code> 事件来实现的</p> <ul><li><p>页面 <code>load</code> 之后会缓存一个 <code>good_exit=pending</code> 变量</p></li> <li><p>如果页面是正常关闭的则将 <code>good_exit=true</code>, 如果是崩溃关闭的那么 <code>good_exit</code> 将会一直是 <code>pending</code></p></li> <li><p>每次进入页面的时候判断之前 <code>good_exit</code> 的值，根据是否为 <code>true</code> 来判断之前是否崩溃过</p></li></ul> <p>上面 <code>load</code> 事件里面还有一个 <code>setInterval</code> 的循环，是简单记录一下崩溃时间</p> <p>这个方案存在的问题：</p> <ul><li><p>采用 <code>sessionStorage</code> 存储状态，但通常网页崩溃/卡死后，用户会强制关闭网页或者索性重新打开浏览器，<code>sessionStorage</code> 存储但状态将不复存在</p></li> <li><p>如果将状态存储在 <code>localStorage</code> 甚至 <code>Cookie</code> 中，如果用户先后打开多个网页，但不关闭，<code>good_exit</code> 存储的一直都是 <code>pending</code>，完了，每有一次网页打开，就会有一个 <code>crash</code> 上报</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>sessionStorage</code> 只存在于当前的浏览器标签，之前以为是浏览器存在期间都存在，实际上只要关闭当前页面标签 <code>sessionStorage</code> 就清除</p> <p>即使复制当前链接再开新标签，新标签里是没保存之前 <code>sessionStorage</code> 的值</p></div> <p><strong>基于 Service Worker 的崩溃统计方案</strong></p> <p>Service Worker 有以下优点：</p> <ul><li><p>Service Worker 有自己独立的工作线程，与网页区分开，网页崩溃了，Service Worker 一般情况下不会崩溃</p></li> <li><p>Service Worker 生命周期一般要比网页还要长，可以用来监控网页的状态</p></li> <li><p>网页可以通过 navigator.serviceWorker.controller.postMessage API 向掌管自己的 SW 发送消息</p></li></ul> <p>基于以上几点，我们可以实现一种基于心跳检测的监控方案，流程如下：</p> <ol><li><p>网页加载后，通过 <code>postMessage</code> API 每 5s 给 sw 发送一个心跳，表示自己的在线，sw 将在线的网页登记下来，更新登记时间</p></li> <li><p>网页在 <code>beforeunload</code> 时，通过 postMessage API 告知自己已经正常关闭，sw 将登记的网页清除</p></li> <li><p>如果网页在运行的过程中 crash 了，sw 中的 running 状态将不会被清除，更新时间停留在奔溃前的最后一次心跳</p></li> <li><p>Service Worker 每 10s 查看一遍登记中的网页，发现登记时间已经超出了一定时间（比如 15s）即可判定该网页 crash 了</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 页面 JavaScript 代码</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token constant">HEARTBEAT_INTERVAL</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 每五秒发一次心跳</span>
  <span class="token keyword">let</span> sessionId <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">heartbeat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'heartbeat'</span><span class="token punctuation">,</span>
      id<span class="token operator">:</span> sessionId<span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 附加信息，如果页面 crash，上报的附加数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;beforeunload&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'unload'</span><span class="token punctuation">,</span>
      id<span class="token operator">:</span> sessionId
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span>heartbeat<span class="token punctuation">,</span> <span class="token constant">HEARTBEAT_INTERVAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">heartbeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CHECK_CRASH_INTERVAL</span> <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 每 10s 检查一次</span>
<span class="token keyword">const</span> <span class="token constant">CRASH_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">15</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 15s 超过15s没有心跳则认为已经 crash</span>
<span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> timer
<span class="token keyword">function</span> <span class="token function">checkCrash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> pages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> page <span class="token operator">=</span> pages<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>now <span class="token operator">-</span> page<span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token constant">CRASH_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 上报 crash</span>
      <span class="token keyword">delete</span> pages<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'heartbeat'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">[</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      t<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">checkCrash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">CHECK_CRASH_INTERVAL</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'unload'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> pages<span class="token punctuation">[</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="错误上报"><a href="#错误上报" class="header-anchor">#</a> 错误上报</h2> <p>通过 Ajax 发送数据可能会引发跨域问题，一般情况下更推荐使用 JSONP 形式进行上报</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reportUrl <span class="token operator">=</span> <span class="token string">'http://jartto.wang/report'</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reportUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?logs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>收集异常信息量太多，怎么办？实际中，我们不得不考虑这样一种情况：如果你的网站访问量很大，那么一个必然的错误发送的信息就有很多条，这时候，我们需要设置采集率，从而减缓服务器的压力：</p> <div class="language-js extra-class"><pre class="language-js"><code>Reporter<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 只采集 30%</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>      <span class="token comment">// 上报错误信息</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="try-catch"><a href="#try-catch" class="header-anchor">#</a> try...catch</h2> <p>最后来讲一下 <code>try...catch</code></p> <p>先看一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>前端错误处理<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    xxxx
    window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'生成了错误'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

<span class="token comment">//Uncaught ReferenceError: xxxx is not defined</span>
</code></pre></div><p>因为在捕获错误之前就报错了,所以没有捕获到错误</p> <p>第二段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生成了错误'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">try</span><span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抛出错误'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
<span class="token comment">// try</span>
<span class="token comment">// 生成了错误</span>
<span class="token comment">// 抛出错误</span>
</code></pre></div><ul><li><p>先执行<code>try</code>里的代码<code>console.log('try')</code>，</p></li> <li><p>然后执行<code>finally</code>抛出错误先被<code>window.onerror</code>捕获执行<code>console.log('生成了错误')</code>,</p></li> <li><p>最后输出<code>Uncaught Error: 抛出错误</code></p></li></ul> <p>抛出错误后，后面的代码将不会执行</p> <p>第三段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生成了错误'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 <span class="token keyword">try</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'try里抛出错误'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抛出错误'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// try</span>
  <span class="token comment">// e Error: try里抛出错误</span>
  <span class="token comment">// 生成了错误</span>
  <span class="token comment">// 错误处理问题.html?_ijt=evigh55v5vvrmi1gq000pg8ilj:20 Uncaught Error: 抛出错误</span>
</code></pre></div><ul><li><p>首先执行<code>try</code>里的代码<code>console.log('try')</code></p></li> <li><p><code>try</code>抛出错误后被<code>catch</code>捕获，执行<code>console.log('e', e)</code></p></li> <li><p>最后执行<code>finally</code>中的代码抛出错误，这个错误先被<code>window.onerror</code>捕获执行<code>console.log('生成了错误')</code></p></li> <li><p>最后打印<code>抛出错误</code></p></li></ul> <p>第四段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生成了错误'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'try里抛出错误'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'catch里抛出错误'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  	  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进入finally'</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抛出错误'</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// try</span>
  <span class="token comment">// 进入finally</span>
  <span class="token comment">// 生成了错误</span>
  <span class="token comment">// Uncaught Error: 抛出错误</span>
</code></pre></div><ul><li><p>首先执行<code>try</code>里的代码<code>console.log('try')</code>,抛出错误<code>throw new Error('try里抛出错误')</code></p></li> <li><p><code>try</code>抛出的错误后被<code>catch</code>捕获，然后又抛出错误<code>throw new Error('catch里抛出错误')</code></p></li> <li><p>然后直接执行<code>finally</code>,输出<code>console.log('进入finally')</code>,抛出错误<code>throw new Error('抛出错误')</code></p></li> <li><p><code>finally</code>抛出的错误被<code>window.onerror</code>捕获执行<code>console.log('生成了错误')</code>，然后打印<code>//Uncaught Error: 抛出错误</code></p></li></ul> <p>从上面再做代码可以得出几个信息：</p> <ul><li><p>无论是<code>try</code>和<code>catch</code>正常执行还是抛出错误,<code>finally</code>总会被执行</p></li> <li><p>在try抛出的错误会被<code>catch</code>捕获，<code>window.onerror</code>捕获不到</p></li></ul> <p>这里有点困惑<code>catch</code>抛出的错误呢，我们再来一个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'生成了错误'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">try</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'try里抛出错误'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'catch里抛出错误'</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进入finally'</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token comment">// try</span>
	<span class="token comment">// 进入finally</span>
	<span class="token comment">// finally</span>
	<span class="token comment">// 生成了错误</span>
	<span class="token comment">// Error: catch里抛出错误</span>
</code></pre></div><p>此时catch中的错误将被抛出，这是咋回事呢，是时候回顾一下<code>try..catch()</code>的用法了</p> <p><strong><code>try...catch()</code> 小结</strong></p> <ul><li><p>如果在<code>try</code>块中有任何一个语句（或者从<code>try</code>块中调用的函数）抛出异常，控制立即转向<code>catch</code>子句。如果在<code>try</code>块中没有异常抛出，会跳过<code>catch</code>子句。</p></li> <li><p><code>finally</code> 子句在 <code>try</code> 块和 <code>catch</code> 块之后执行但是在下一个 <code>try</code> 声明之前执行。无论是否有异常抛出或捕获它总是执行</p></li> <li><p>你可以嵌套一个或者更多的 <code>try</code> 语句。如果内部的 <code>try</code> 语句没有 <code>catch</code> 子句，那么将会进入包裹它的 <code>try</code> 语句的 <code>catch</code> 子句</p></li></ul> <p>我是这么理解第四个粟子的 <code>catch</code> 中的代码为什么没被抛出的：因为 <code>try</code> 和 <code>catch</code> 无论有没有成功，都会执行 <code>finally</code>，执行 <code>finally</code> 后抛出的错误把
<code>catch</code> 中的错误覆盖了，所以导致 <code>catch</code> 中的错误没被抛出</p> <blockquote><p><a href="https://juejin.cn/post/7017974567943536671" target="_blank" rel="noopener noreferrer">前端监控 SDK 的一些技术要点原理分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.7cd46e43.js" defer></script><script src="/lanjz/assets/js/2.01b6ac5f.js" defer></script><script src="/lanjz/assets/js/31.06c3ba3b.js" defer></script>
  </body>
</html>
