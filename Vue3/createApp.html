<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>createApp | Hello Wold</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/lanjz/assets/css/0.styles.5dda244b.css" as="style"><link rel="preload" href="/lanjz/assets/js/app.097601f3.js" as="script"><link rel="preload" href="/lanjz/assets/js/2.1da27f72.js" as="script"><link rel="preload" href="/lanjz/assets/js/46.d7048878.js" as="script"><link rel="prefetch" href="/lanjz/assets/js/10.ad88722c.js"><link rel="prefetch" href="/lanjz/assets/js/100.f390adff.js"><link rel="prefetch" href="/lanjz/assets/js/101.ef85e642.js"><link rel="prefetch" href="/lanjz/assets/js/102.67a3d0c8.js"><link rel="prefetch" href="/lanjz/assets/js/103.fcf49e56.js"><link rel="prefetch" href="/lanjz/assets/js/104.ca667ea0.js"><link rel="prefetch" href="/lanjz/assets/js/105.72243284.js"><link rel="prefetch" href="/lanjz/assets/js/106.f568569d.js"><link rel="prefetch" href="/lanjz/assets/js/107.405aa506.js"><link rel="prefetch" href="/lanjz/assets/js/108.320f57f3.js"><link rel="prefetch" href="/lanjz/assets/js/109.b9d26170.js"><link rel="prefetch" href="/lanjz/assets/js/11.4fd2fc7c.js"><link rel="prefetch" href="/lanjz/assets/js/110.ec35c517.js"><link rel="prefetch" href="/lanjz/assets/js/111.06a6b367.js"><link rel="prefetch" href="/lanjz/assets/js/112.74d278d4.js"><link rel="prefetch" href="/lanjz/assets/js/113.868fc3f5.js"><link rel="prefetch" href="/lanjz/assets/js/114.82694049.js"><link rel="prefetch" href="/lanjz/assets/js/115.6d2ff8ca.js"><link rel="prefetch" href="/lanjz/assets/js/116.90ab34bc.js"><link rel="prefetch" href="/lanjz/assets/js/117.993135e2.js"><link rel="prefetch" href="/lanjz/assets/js/118.9f53432a.js"><link rel="prefetch" href="/lanjz/assets/js/119.299e23fc.js"><link rel="prefetch" href="/lanjz/assets/js/12.eb0e4a5c.js"><link rel="prefetch" href="/lanjz/assets/js/120.5c9295c2.js"><link rel="prefetch" href="/lanjz/assets/js/121.aed3215e.js"><link rel="prefetch" href="/lanjz/assets/js/122.614c69ad.js"><link rel="prefetch" href="/lanjz/assets/js/123.9188c09d.js"><link rel="prefetch" href="/lanjz/assets/js/124.71bac7fa.js"><link rel="prefetch" href="/lanjz/assets/js/125.a6fb6ed6.js"><link rel="prefetch" href="/lanjz/assets/js/126.0f67a4f8.js"><link rel="prefetch" href="/lanjz/assets/js/127.45d43727.js"><link rel="prefetch" href="/lanjz/assets/js/128.64c55d58.js"><link rel="prefetch" href="/lanjz/assets/js/129.5581fbfc.js"><link rel="prefetch" href="/lanjz/assets/js/13.2a39c7df.js"><link rel="prefetch" href="/lanjz/assets/js/130.8957751c.js"><link rel="prefetch" href="/lanjz/assets/js/131.63e4b37c.js"><link rel="prefetch" href="/lanjz/assets/js/132.19d972c3.js"><link rel="prefetch" href="/lanjz/assets/js/133.9a875a0c.js"><link rel="prefetch" href="/lanjz/assets/js/134.b1eff704.js"><link rel="prefetch" href="/lanjz/assets/js/135.5c9532ff.js"><link rel="prefetch" href="/lanjz/assets/js/136.55da9d8b.js"><link rel="prefetch" href="/lanjz/assets/js/137.35a99ae2.js"><link rel="prefetch" href="/lanjz/assets/js/138.b00d2394.js"><link rel="prefetch" href="/lanjz/assets/js/139.d7802b4e.js"><link rel="prefetch" href="/lanjz/assets/js/14.5bb503b7.js"><link rel="prefetch" href="/lanjz/assets/js/140.5b58d560.js"><link rel="prefetch" href="/lanjz/assets/js/141.aa8e8249.js"><link rel="prefetch" href="/lanjz/assets/js/142.7951f044.js"><link rel="prefetch" href="/lanjz/assets/js/143.2c343243.js"><link rel="prefetch" href="/lanjz/assets/js/144.12b07a9d.js"><link rel="prefetch" href="/lanjz/assets/js/145.8e6bd5dc.js"><link rel="prefetch" href="/lanjz/assets/js/146.876da7f6.js"><link rel="prefetch" href="/lanjz/assets/js/147.6922d999.js"><link rel="prefetch" href="/lanjz/assets/js/148.65805f93.js"><link rel="prefetch" href="/lanjz/assets/js/149.41d2b604.js"><link rel="prefetch" href="/lanjz/assets/js/15.76609c51.js"><link rel="prefetch" href="/lanjz/assets/js/150.1cacbbd6.js"><link rel="prefetch" href="/lanjz/assets/js/151.80dd49ad.js"><link rel="prefetch" href="/lanjz/assets/js/152.b342d9e4.js"><link rel="prefetch" href="/lanjz/assets/js/153.7270ff14.js"><link rel="prefetch" href="/lanjz/assets/js/154.d5e87c50.js"><link rel="prefetch" href="/lanjz/assets/js/155.40d14179.js"><link rel="prefetch" href="/lanjz/assets/js/156.76293b8c.js"><link rel="prefetch" href="/lanjz/assets/js/157.6edd5efb.js"><link rel="prefetch" href="/lanjz/assets/js/158.42a0d03c.js"><link rel="prefetch" href="/lanjz/assets/js/159.9dad6fbf.js"><link rel="prefetch" href="/lanjz/assets/js/16.e410fdf4.js"><link rel="prefetch" href="/lanjz/assets/js/160.776e95ad.js"><link rel="prefetch" href="/lanjz/assets/js/161.09e27a91.js"><link rel="prefetch" href="/lanjz/assets/js/162.4644ba75.js"><link rel="prefetch" href="/lanjz/assets/js/163.0b9f3bbc.js"><link rel="prefetch" href="/lanjz/assets/js/164.3d0d5e10.js"><link rel="prefetch" href="/lanjz/assets/js/165.b7ca9e9c.js"><link rel="prefetch" href="/lanjz/assets/js/166.8b9e6a23.js"><link rel="prefetch" href="/lanjz/assets/js/167.0f0d42be.js"><link rel="prefetch" href="/lanjz/assets/js/168.6e13c4b1.js"><link rel="prefetch" href="/lanjz/assets/js/169.6436b3fa.js"><link rel="prefetch" href="/lanjz/assets/js/17.41d70b41.js"><link rel="prefetch" href="/lanjz/assets/js/170.575364c4.js"><link rel="prefetch" href="/lanjz/assets/js/171.eba256d8.js"><link rel="prefetch" href="/lanjz/assets/js/172.5aee903f.js"><link rel="prefetch" href="/lanjz/assets/js/173.624ed5fe.js"><link rel="prefetch" href="/lanjz/assets/js/174.0efa833b.js"><link rel="prefetch" href="/lanjz/assets/js/175.fd4101be.js"><link rel="prefetch" href="/lanjz/assets/js/176.983b7296.js"><link rel="prefetch" href="/lanjz/assets/js/177.cddea703.js"><link rel="prefetch" href="/lanjz/assets/js/178.173bd940.js"><link rel="prefetch" href="/lanjz/assets/js/179.48e6f0a7.js"><link rel="prefetch" href="/lanjz/assets/js/18.59092c66.js"><link rel="prefetch" href="/lanjz/assets/js/180.8fa5c83c.js"><link rel="prefetch" href="/lanjz/assets/js/181.42fb2f17.js"><link rel="prefetch" href="/lanjz/assets/js/182.ba680b61.js"><link rel="prefetch" href="/lanjz/assets/js/183.307e9b52.js"><link rel="prefetch" href="/lanjz/assets/js/184.dd14f133.js"><link rel="prefetch" href="/lanjz/assets/js/185.77bd949e.js"><link rel="prefetch" href="/lanjz/assets/js/186.b5e44e3d.js"><link rel="prefetch" href="/lanjz/assets/js/187.ef75c62a.js"><link rel="prefetch" href="/lanjz/assets/js/188.8e49be5e.js"><link rel="prefetch" href="/lanjz/assets/js/189.fdb6965d.js"><link rel="prefetch" href="/lanjz/assets/js/19.06f220fd.js"><link rel="prefetch" href="/lanjz/assets/js/190.9f1de014.js"><link rel="prefetch" href="/lanjz/assets/js/191.b729f49e.js"><link rel="prefetch" href="/lanjz/assets/js/192.90770456.js"><link rel="prefetch" href="/lanjz/assets/js/193.aae08e66.js"><link rel="prefetch" href="/lanjz/assets/js/194.b25eefb7.js"><link rel="prefetch" href="/lanjz/assets/js/195.a75f7a17.js"><link rel="prefetch" href="/lanjz/assets/js/196.da8cdb0d.js"><link rel="prefetch" href="/lanjz/assets/js/197.33250442.js"><link rel="prefetch" href="/lanjz/assets/js/198.79b2a21b.js"><link rel="prefetch" href="/lanjz/assets/js/199.55f69f4e.js"><link rel="prefetch" href="/lanjz/assets/js/20.86ccb3d4.js"><link rel="prefetch" href="/lanjz/assets/js/200.3a9e1131.js"><link rel="prefetch" href="/lanjz/assets/js/201.2f95ef07.js"><link rel="prefetch" href="/lanjz/assets/js/202.ad0a8315.js"><link rel="prefetch" href="/lanjz/assets/js/203.75e1e030.js"><link rel="prefetch" href="/lanjz/assets/js/204.0471491f.js"><link rel="prefetch" href="/lanjz/assets/js/205.5279d168.js"><link rel="prefetch" href="/lanjz/assets/js/206.8ce0c9f7.js"><link rel="prefetch" href="/lanjz/assets/js/207.21ecc2f3.js"><link rel="prefetch" href="/lanjz/assets/js/208.33ecc4ff.js"><link rel="prefetch" href="/lanjz/assets/js/209.e0e6806c.js"><link rel="prefetch" href="/lanjz/assets/js/21.0aec59f0.js"><link rel="prefetch" href="/lanjz/assets/js/210.37e2bc0f.js"><link rel="prefetch" href="/lanjz/assets/js/22.e2596de5.js"><link rel="prefetch" href="/lanjz/assets/js/23.064b080b.js"><link rel="prefetch" href="/lanjz/assets/js/24.c6553cd8.js"><link rel="prefetch" href="/lanjz/assets/js/25.d7ef68e7.js"><link rel="prefetch" href="/lanjz/assets/js/26.1177a89f.js"><link rel="prefetch" href="/lanjz/assets/js/27.4f32592c.js"><link rel="prefetch" href="/lanjz/assets/js/28.9a3ccc6c.js"><link rel="prefetch" href="/lanjz/assets/js/29.77626dc8.js"><link rel="prefetch" href="/lanjz/assets/js/3.27d4358d.js"><link rel="prefetch" href="/lanjz/assets/js/30.85649eaf.js"><link rel="prefetch" href="/lanjz/assets/js/31.1fd41c15.js"><link rel="prefetch" href="/lanjz/assets/js/32.8bf52b07.js"><link rel="prefetch" href="/lanjz/assets/js/33.a8cdd9ac.js"><link rel="prefetch" href="/lanjz/assets/js/34.426525a0.js"><link rel="prefetch" href="/lanjz/assets/js/35.607c4b6c.js"><link rel="prefetch" href="/lanjz/assets/js/36.468c8309.js"><link rel="prefetch" href="/lanjz/assets/js/37.d3c026f7.js"><link rel="prefetch" href="/lanjz/assets/js/38.1466f9a4.js"><link rel="prefetch" href="/lanjz/assets/js/39.ae25b9c1.js"><link rel="prefetch" href="/lanjz/assets/js/4.7c0c116a.js"><link rel="prefetch" href="/lanjz/assets/js/40.a0c1d388.js"><link rel="prefetch" href="/lanjz/assets/js/41.c4ba3a06.js"><link rel="prefetch" href="/lanjz/assets/js/42.57ddc013.js"><link rel="prefetch" href="/lanjz/assets/js/43.0788aa0a.js"><link rel="prefetch" href="/lanjz/assets/js/44.9ddd4f00.js"><link rel="prefetch" href="/lanjz/assets/js/45.0493e1d0.js"><link rel="prefetch" href="/lanjz/assets/js/47.e99991f0.js"><link rel="prefetch" href="/lanjz/assets/js/48.2da5fb77.js"><link rel="prefetch" href="/lanjz/assets/js/49.41e743d7.js"><link rel="prefetch" href="/lanjz/assets/js/5.29a3cb75.js"><link rel="prefetch" href="/lanjz/assets/js/50.ccc7ed6a.js"><link rel="prefetch" href="/lanjz/assets/js/51.39025cc3.js"><link rel="prefetch" href="/lanjz/assets/js/52.f1a10a0c.js"><link rel="prefetch" href="/lanjz/assets/js/53.ea6560a7.js"><link rel="prefetch" href="/lanjz/assets/js/54.8f57f6bd.js"><link rel="prefetch" href="/lanjz/assets/js/55.7c309ebc.js"><link rel="prefetch" href="/lanjz/assets/js/56.7a121295.js"><link rel="prefetch" href="/lanjz/assets/js/57.b89feaab.js"><link rel="prefetch" href="/lanjz/assets/js/58.5f8513e5.js"><link rel="prefetch" href="/lanjz/assets/js/59.4f826ab9.js"><link rel="prefetch" href="/lanjz/assets/js/6.2dc1930e.js"><link rel="prefetch" href="/lanjz/assets/js/60.4cc3d3d8.js"><link rel="prefetch" href="/lanjz/assets/js/61.b800569b.js"><link rel="prefetch" href="/lanjz/assets/js/62.0d48fa49.js"><link rel="prefetch" href="/lanjz/assets/js/63.d9cb28e5.js"><link rel="prefetch" href="/lanjz/assets/js/64.0e11e5d0.js"><link rel="prefetch" href="/lanjz/assets/js/65.ad157dee.js"><link rel="prefetch" href="/lanjz/assets/js/66.04abfa5c.js"><link rel="prefetch" href="/lanjz/assets/js/67.a4258394.js"><link rel="prefetch" href="/lanjz/assets/js/68.ebc3e1e1.js"><link rel="prefetch" href="/lanjz/assets/js/69.103f462e.js"><link rel="prefetch" href="/lanjz/assets/js/7.3b3a908f.js"><link rel="prefetch" href="/lanjz/assets/js/70.96942b5e.js"><link rel="prefetch" href="/lanjz/assets/js/71.f5c2459a.js"><link rel="prefetch" href="/lanjz/assets/js/72.72b34930.js"><link rel="prefetch" href="/lanjz/assets/js/73.fe33e382.js"><link rel="prefetch" href="/lanjz/assets/js/74.424c6bbb.js"><link rel="prefetch" href="/lanjz/assets/js/75.7d255bac.js"><link rel="prefetch" href="/lanjz/assets/js/76.db3dbbb8.js"><link rel="prefetch" href="/lanjz/assets/js/77.7d912c17.js"><link rel="prefetch" href="/lanjz/assets/js/78.5c4963d5.js"><link rel="prefetch" href="/lanjz/assets/js/79.04956c4f.js"><link rel="prefetch" href="/lanjz/assets/js/8.d74f6252.js"><link rel="prefetch" href="/lanjz/assets/js/80.fdd5e955.js"><link rel="prefetch" href="/lanjz/assets/js/81.b8662c58.js"><link rel="prefetch" href="/lanjz/assets/js/82.8e6c9c7b.js"><link rel="prefetch" href="/lanjz/assets/js/83.b16941c5.js"><link rel="prefetch" href="/lanjz/assets/js/84.76b08dc3.js"><link rel="prefetch" href="/lanjz/assets/js/85.5b836d37.js"><link rel="prefetch" href="/lanjz/assets/js/86.95119094.js"><link rel="prefetch" href="/lanjz/assets/js/87.fc416e77.js"><link rel="prefetch" href="/lanjz/assets/js/88.274e5843.js"><link rel="prefetch" href="/lanjz/assets/js/89.ca5822bf.js"><link rel="prefetch" href="/lanjz/assets/js/9.a5f68e94.js"><link rel="prefetch" href="/lanjz/assets/js/90.bf90b6e8.js"><link rel="prefetch" href="/lanjz/assets/js/91.a83bbc44.js"><link rel="prefetch" href="/lanjz/assets/js/92.74a54da8.js"><link rel="prefetch" href="/lanjz/assets/js/93.8ab71f74.js"><link rel="prefetch" href="/lanjz/assets/js/94.46b8f37a.js"><link rel="prefetch" href="/lanjz/assets/js/95.c6c61039.js"><link rel="prefetch" href="/lanjz/assets/js/96.1f28f568.js"><link rel="prefetch" href="/lanjz/assets/js/97.b63de440.js"><link rel="prefetch" href="/lanjz/assets/js/98.d9fcaaa1.js"><link rel="prefetch" href="/lanjz/assets/js/99.39e5821f.js">
    <link rel="stylesheet" href="/lanjz/assets/css/0.styles.5dda244b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lanjz/" class="home-link router-link-active"><!----> <span class="site-name">Hello Wold</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link router-link-active">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lanjz/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Browser/" class="nav-link">
  Browser
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络&amp;算法" class="dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="网络&amp;算法" class="mobile-dropdown-title"><span class="title">网络&amp;算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/network/" class="nav-link">
  网络
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/secure/" class="nav-link">
  Web安全
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Vue3/" class="nav-link router-link-active">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/qiankun/" class="nav-link">
  qiankun
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/NA/" class="nav-link">
  跨平台
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow down"></span></button> <button type="button" aria-label="Node" class="mobile-dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/Node/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Package/" class="nav-link">
  yarn&amp;npm
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/Vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/Node/数据库/" class="nav-link">
  SQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端优化总结/" class="nav-link">
  前端优化总结
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/系统设计/" class="nav-link">
  系统设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/预加载&amp;预解析.html" class="nav-link">
  预加载&amp;预解析
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/重构改善既有代码的设计.html" class="nav-link">
  重构代码原则
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/开发与调试技巧.html" class="nav-link">
  开发与调试
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/组件设计的基本原则.html" class="nav-link">
  组件设计
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/公共模块管理.html" class="nav-link">
  公共模块管理
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/前端异常捕获.html" class="nav-link">
  前端异常捕获
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/自动化部署.html" class="nav-link">
  自动化部署
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/工程化/疑难杂症.html" class="nav-link">
  问题小计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="利其器" class="dropdown-title"><span class="title">利其器</span> <span class="arrow down"></span></button> <button type="button" aria-label="利其器" class="mobile-dropdown-title"><span class="title">利其器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Mac.html" class="nav-link">
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/lanjz/利其器/Github.html" class="nav-link">
  Github
</a></li></ul></div></div><div class="nav-item"><a href="/lanjz/Im/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lanjz/Vue3/V3升级目的.html" class="sidebar-link">V3升级目的</a></li><li><a href="/lanjz/Vue3/使用区别.html" class="sidebar-link">Vue3相比Vue2使用差异</a></li><li><a href="/lanjz/Vue3/SFC还是JSX.html" class="sidebar-link">SCF还是JSX</a></li><li><a href="/lanjz/Vue3/createApp.html" aria-current="page" class="active sidebar-link">createApp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lanjz/Vue3/createApp.html#app创建" class="sidebar-link">app创建</a></li><li class="sidebar-sub-header"><a href="/lanjz/Vue3/createApp.html#mounted" class="sidebar-link">mounted</a></li><li class="sidebar-sub-header"><a href="/lanjz/Vue3/createApp.html#组件更新" class="sidebar-link">组件更新</a></li></ul></li><li><a href="/lanjz/Vue3/响应式原理.html" class="sidebar-link">响应式原理</a></li><li><a href="/lanjz/Vue3/watch.html" class="sidebar-link">Watch</a></li><li><a href="/lanjz/Vue3/setup.html" class="sidebar-link">setup</a></li><li><a href="/lanjz/Vue3/响应式API.html" class="sidebar-link">粗读响应式API</a></li><li><a href="/lanjz/Vue3/Diff.html" class="sidebar-link">Diff</a></li><li><a href="/lanjz/Vue3/预渲染.html" class="sidebar-link">预渲染</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="createapp"><a href="#createapp" class="header-anchor">#</a> createApp</h1> <p>Vue3.0和Vue2.0 创建应用的区别</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2.0</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">// 全局混入</span>
Vue<span class="token punctuation">.</span><span class="token function">minxin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 注册全局指令</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 注册全局组件</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component-name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 注册插件</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//绑定的全局方法和变量</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>xxx <span class="token operator">=</span> xxx
<span class="token comment">// 挂载</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 3.0</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 混</span>
app<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 注册全局组件</span>
app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'SearchInput'</span><span class="token punctuation">,</span> SearchInputComponent<span class="token punctuation">)</span>
<span class="token comment">// 注册全局指令</span>
app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> FocusDirective<span class="token punctuation">)</span>
<span class="token comment">// 注册插件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>LocalePlugin<span class="token punctuation">)</span>
<span class="token comment">// 添加全局属性</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$message <span class="token operator">=</span> message 
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#counter'</span><span class="token punctuation">)</span>

</code></pre></div><p>3.0 将通过 <code>Vue.createApp({}).mount('#counter')</code> 创建一个应用并挂载实例，并在这个实例上面注册一些全局API</p> <p>接下来分别看下 <code>createApp</code> 和 <code>mount</code> 方法的定义</p> <h2 id="app创建"><a href="#app创建" class="header-anchor">#</a> app创建</h2> <p><code>createApp</code> 在源码中的定义：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> createApp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      <span class="token function">injectNativeTagCheck</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">containerOrSelector</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token comment">// mount 方法</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">ensureRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这一步说明 renderer 只有一个，renderer 是通过 createRenderer 创建</span>
    <span class="token comment">// rendererOptions 是一些处理 DOM 元素相关的方法</span>
    <span class="token keyword">return</span> renderer <span class="token operator">||</span> <span class="token punctuation">(</span>renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span>rendererOptions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">baseCreateRenderer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">baseCreateRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 定义了一些操作更新 VNode 的一些方法</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      render<span class="token punctuation">,</span>
      hydrate<span class="token punctuation">,</span>
      createApp<span class="token operator">:</span> <span class="token function">createAppAPI</span><span class="token punctuation">(</span>render<span class="token punctuation">,</span> hydrate<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上面代码可以看到首先是通过 <code>createRenderer</code> 创建的一个 <code>renderer</code>, 这个<code>renderer</code> 只包含了三个属性</p> <ul><li><p><code>render</code>： 创建VNode方法</p></li> <li><p><code>hydrate</code>: 是否服务渲染的标识</p></li> <li><p><code>createApp</code>: 通过 <code>createAppAPI(render, hydrate)</code> 返回一个创建Vue应用实例的方法</p></li></ul> <p><code>createAppAPI(render, hydrate)</code> 定义如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createAppAPI</span><span class="token punctuation">(</span><span class="token parameter">render<span class="token punctuation">,</span> hydrate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// rootComponent 正常就是我们传入的根 vue 组件</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">rootComponent<span class="token punctuation">,</span> rootProps <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rootProps <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>rootProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">root props passed to app.mount() must be an object.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rootProps <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 创建当前 app 的上下文， 说白了就是存一些配置信息的一个对象，这个对象包含了 app、config、mixins、components、directives、provides属性</span>
      <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">createAppContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> isMounted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 创建一个 app 应用并保存到 context.app 中</span>
        _uid<span class="token operator">:</span> uid$<span class="token number">1</span><span class="token operator">++</span><span class="token punctuation">,</span>
        _component<span class="token operator">:</span> rootComponent<span class="token punctuation">,</span>
        _props<span class="token operator">:</span> rootProps<span class="token punctuation">,</span>
        _container<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        _context<span class="token operator">:</span> context<span class="token punctuation">,</span>
        version<span class="token punctuation">,</span>
        <span class="token keyword">get</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> context<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">set</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app.config cannot be replaced. Modify individual options instead.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">plugin<span class="token punctuation">,</span> <span class="token operator">...</span>options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Plugin has already been applied to target app.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>plugin <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>install<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            installedPlugins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            installedPlugins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">plugin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">A plugin must either be a function or an object with an &quot;install&quot; </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token parameter">mixin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>mixins<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>mixin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              context<span class="token punctuation">.</span>mixins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// global mixin with props/emits de-optimizes props/emits</span>
              <span class="token comment">// normalization caching.</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>mixin<span class="token punctuation">.</span>props <span class="token operator">||</span> mixin<span class="token punctuation">.</span>emits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                context<span class="token punctuation">.</span>deopt <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Mixin has already been applied to target app'</span> <span class="token operator">+</span>
                <span class="token punctuation">(</span>mixin<span class="token punctuation">.</span>name <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mixin<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">component</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span>
            <span class="token function">validateComponentName</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> context<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> context<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> context<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Component &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; has already been registered in target app.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          context<span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> component<span class="token punctuation">;</span>
          <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">directive</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> directive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span>
            <span class="token function">validateDirectiveName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>directive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> context<span class="token punctuation">.</span>directives<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> context<span class="token punctuation">.</span>directives<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Directive &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; has already been registered in target app.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          context<span class="token punctuation">.</span>directives<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> directive<span class="token punctuation">;</span>
          <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">rootContainer<span class="token punctuation">,</span> isHydrate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">,</span> rootProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// store app context on the root VNode.</span>
            <span class="token comment">// this will be set on the root instance on initial mount.</span>
            vnode<span class="token punctuation">.</span>appContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
            <span class="token comment">// HMR root reload</span>
            <span class="token punctuation">{</span>
              context<span class="token punctuation">.</span><span class="token function-variable function">reload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">cloneVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isHydrate <span class="token operator">&amp;&amp;</span> hydrate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">hydrate</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            app<span class="token punctuation">.</span>_container <span class="token operator">=</span> rootContainer<span class="token punctuation">;</span>
            rootContainer<span class="token punctuation">.</span>__vue_app__ <span class="token operator">=</span> app<span class="token punctuation">;</span>
            <span class="token punctuation">{</span>
              <span class="token function">devtoolsInitApp</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>component<span class="token punctuation">.</span>proxy<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">App has already been mounted.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">If you want to remount the same app, move your app creation logic </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">into a factory function and create fresh app instances for each </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mount - e.g. \`const createMyApp = () =&gt; createApp(App)\`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>_container<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">{</span>
              <span class="token function">devtoolsUnmountApp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot unmount an app that is not mounted.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">provide</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> key <span class="token keyword">in</span> context<span class="token punctuation">.</span>provides<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">App already provides property with key &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">It will be overwritten with the new value.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// TypeScript doesn't allow symbols as index type</span>
          <span class="token comment">// https://github.com/Microsoft/TypeScript/issues/24587</span>
          context<span class="token punctuation">.</span>provides<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> app<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>createAppAPI</code> 方法返回的是 <code>createApp</code> 方法，也就是说 <code>Vue.createApp(CounterApp).mount('#counter') =&gt; const app = ensureRenderer().createApp(...args)</code>, 实际上执行的就是这里返回的 <code>createApp</code> 方法</p> <p>从上面代码可以看到 <code>createApp</code> 返回一个 <code>app</code> 对象，这个对象就是返回的 vue 应用实例，这个对象定义了  <code>use</code>、<code>mixin</code>、<code>component</code>、<code>mount</code>等方法让我们可以添加全局方法、插件、组件等</p> <p>至此， <code>app</code> 的创建大概捋了下，整个过程就是利用闭包创建一个对象， 一个app 的包含的属性如下图：</p> <p><img src="/lanjz/assets/img/app.16b6c97b.jpg" alt=""></p> <p>接下来看下 <code>mounted</code> 方法的调用，看下应用怎么挂载的</p> <h2 id="mounted"><a href="#mounted" class="header-anchor">#</a> mounted</h2> <p><code>mounted</code> 是 <code>app</code> 中的属性，定义如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">rootContainer<span class="token punctuation">,</span> isHydrate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>rootComponent<span class="token punctuation">,</span> rootProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// store app context on the root VNode.</span>
    <span class="token comment">// this will be set on the root instance on initial mount.</span>
    <span class="token comment">// vnode.appContext 保存 当前 app 的属性信息</span>
    vnode<span class="token punctuation">.</span>appContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token comment">// HMR root reload</span>
    <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span><span class="token function-variable function">reload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">cloneVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isHydrate <span class="token operator">&amp;&amp;</span> hydrate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">hydrate</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> rootContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span>_container <span class="token operator">=</span> rootContainer<span class="token punctuation">;</span>
    rootContainer<span class="token punctuation">.</span>__vue_app__ <span class="token operator">=</span> app<span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      <span class="token function">devtoolsInitApp</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>component<span class="token punctuation">.</span>proxy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">App has already been mounted.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">If you want to remount the same app, move your app creation logic </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">into a factory function and create fresh app instances for each </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mount - e.g. \`const createMyApp = () =&gt; createApp(App)\`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><code>mounted</code> 重点做两件事：</p> <ul><li><p><code>createVNode(rootComponent, rootProps)</code>： 创建 VNode， 暂不细究这里</p></li> <li><p><code>render(vnode, rootContainer)</code>：渲染组件</p></li></ul> <p>大致看下 <code>render</code> 方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// render</span>
<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unmount</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>_vnode <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">flushPostFlushCbs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span>_vnode <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>render</code> 中执行 <code>patch</code> 方法,<code>patch</code> 也是 <code>diff</code> VNode节点的地方，这里是加载根元素，所以在 <code>patch</code> 方法内执行 <code>processComponent(n1, n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized)</code> 方法，此的参数为：</p> <ul><li><p>n1: <code>null</code></p></li> <li><p>n2: 上文创建的 VNode 对象</p></li> <li><p>container： 要挂载的 DOM 元素</p></li> <li><p>其它参数均为 <code>null</code> 或 <code>false</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">processComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n2<span class="token punctuation">.</span>shapeFlag <span class="token operator">&amp;</span> <span class="token number">512</span> <span class="token comment">/* COMPONENT_KEPT_ALIVE */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parentComponent<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">activate</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">mountComponent</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">updateComponent</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>processComponent</code> 内部再执行 <code>mountComponent(n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized)</code> 方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mountComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">initialVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建组件实例</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span>initialVNode<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token function">createComponentInstance</span><span class="token punctuation">(</span>initialVNode<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> instance<span class="token punctuation">.</span>type<span class="token punctuation">.</span>__hmrId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">registerHMR</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 将当前vnode 添加到全局栈 stack 中</span>
    <span class="token function">pushWarningContext</span><span class="token punctuation">(</span>initialVNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">startMeasure</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mount</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// inject renderer internals for keepAlive</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isKeepAlive</span><span class="token punctuation">(</span>initialVNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>renderer <span class="token operator">=</span> internals<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// resolve props and slots for setup context</span>
  <span class="token punctuation">{</span>
    <span class="token function">startMeasure</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">init</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 通过组件属性(data, compunted, watch 等)，组装组件实例</span>
  <span class="token function">setupComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token function">endMeasure</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">init</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// setup() is async. This component relies on async logic to be resolved</span>
  <span class="token comment">// before proceeding</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> instance<span class="token punctuation">.</span>asyncDep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parentSuspense <span class="token operator">&amp;&amp;</span> parentSuspense<span class="token punctuation">.</span><span class="token function">registerDep</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> setupRenderEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Give it a placeholder if this is not hydration</span>
    <span class="token comment">// TODO handle self-defined fallback</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>initialVNode<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> placeholder <span class="token operator">=</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> <span class="token function">createVNode</span><span class="token punctuation">(</span>Comment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">processCommentNode</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> placeholder<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> initialVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token function">popWarningContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">endMeasure</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mount</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>mountComponent</code> 方法先是通过 <code>createComponentInstance</code> 创建一个对象，这里暂时取名就组件实例对象，源码：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createComponentInstance</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> suspense</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取 type， type是当前根组件信息，下面是一个type的例子</span>
    <span class="token comment">// data: ƒ data()</span>
    <span class="token comment">// mounted: ƒ mounted()</span>
    <span class="token comment">// render: ƒ render(_ctx, _cache)</span>
    <span class="token comment">// template: &quot;↵    Counter: {{ counter }}↵&quot;</span>
    <span class="token comment">// __emits: null</span>
    <span class="token comment">// __props: []</span>
    <span class="token comment">// __proto__: Object</span>

    <span class="token keyword">const</span> type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token comment">// vnode.appContext 是 createApp方法中，定义的上下文,粟：</span>
    <span class="token comment">// app: {_uid: 0, _component: {…}, _props: null, _container: null, _context: {…}, …}</span>
    <span class="token comment">// components: {}</span>
    <span class="token comment">// config: {performance: false, globalProperties: {…}, optionMergeStrategies: {…}, isNativeTag: ƒ, isCustomElement: ƒ, …}</span>
    <span class="token comment">// directives: {}</span>
    <span class="token comment">// mixins: []</span>
    <span class="token comment">// provides: {}</span>
    <span class="token comment">// reload: () =&gt; {…}</span>

    <span class="token keyword">const</span> appContext <span class="token operator">=</span> <span class="token punctuation">(</span>parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>appContext <span class="token operator">:</span> vnode<span class="token punctuation">.</span>appContext<span class="token punctuation">)</span> <span class="token operator">||</span> emptyAppContext<span class="token punctuation">;</span>
    <span class="token comment">// 创建一个 instance 对象</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
      uid<span class="token operator">:</span> uid$<span class="token number">2</span><span class="token operator">++</span><span class="token punctuation">,</span>
      vnode<span class="token punctuation">,</span>
      type<span class="token punctuation">,</span>
      parent<span class="token punctuation">,</span>
      appContext<span class="token punctuation">,</span>
      root<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      subTree<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      update<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      render<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      proxy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      exposed<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      withProxy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      effects<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      provides<span class="token operator">:</span> parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>provides <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>appContext<span class="token punctuation">.</span>provides<span class="token punctuation">)</span><span class="token punctuation">,</span>
      accessCache<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      renderCache<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// local resovled assets</span>
      components<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      directives<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// resolved props and emits options</span>
      propsOptions<span class="token operator">:</span> <span class="token function">normalizePropsOptions</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> appContext<span class="token punctuation">)</span><span class="token punctuation">,</span>
      emitsOptions<span class="token operator">:</span> <span class="token function">normalizeEmitsOptions</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> appContext<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// emit</span>
      emit<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      emitted<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// state</span>
      ctx<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      props<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      attrs<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      slots<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      refs<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      setupState<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>
      setupContext<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token comment">// suspense related</span>
      suspense<span class="token punctuation">,</span>
      suspenseId<span class="token operator">:</span> suspense <span class="token operator">?</span> suspense<span class="token punctuation">.</span>pendingId <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      asyncDep<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      asyncResolved<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// lifecycle hooks</span>
      <span class="token comment">// not using enums here because it results in computed properties</span>
      isMounted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      isUnmounted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      isDeactivated<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      bc<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      c<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      bm<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      m<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      bu<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      u<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      um<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      bum<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      da<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      a<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      rtg<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      rtc<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      ec<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      instance<span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token function">createRenderContext</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// root 指定当前 instance</span>
    instance<span class="token punctuation">.</span>root <span class="token operator">=</span> parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>root <span class="token operator">:</span> instance<span class="token punctuation">;</span>
    instance<span class="token punctuation">.</span>emit <span class="token operator">=</span> <span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      <span class="token function">devtoolsComponentAdded</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>createRenderContext</code> 的方法定义如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createRenderContext</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// expose internal instance for proxy handlers</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> instance
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// expose public properties</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>publicPropertiesMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> publicPropertiesMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// intercepted by the proxy so no need for implementation,</span>
        <span class="token comment">// but needed to prevent set errors</span>
        set<span class="token operator">:</span> <span class="token constant">NOOP</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// expose global properties</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> globalProperties <span class="token punctuation">}</span> <span class="token operator">=</span> instance<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>globalProperties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> globalProperties<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
        set<span class="token operator">:</span> <span class="token constant">NOOP</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>createRenderContext</code> 方法的目的就是给当前组件 <code>insatcne</code> 代理一些方法：</p> <ul><li><p><code>$el</code>、<code>$data</code>、<code>$attrs</code>、<code>$props</code>等等</p></li> <li><p>包括使用 <code>app.config.globalProperties</code> 添加的全局属性和方法，也在这里做了代理</p></li></ul> <p><code>createComponentInstance</code> 执行完后返回当前创建的 <code>instance</code>,回到 <code>mountComponent</code> 方法中，接下直接看 <code>setupRenderEffect(instance, initialVNode, container, anchor, parentSuspense, isSVG, optimized);</code> 方法的调用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">setupRenderEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> initialVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// create reactive effect for rendering</span>
  instance<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">componentEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// componentEffect 代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">createDevEffectOptions</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// createDevEffectOptions 返回四个属性</span>
<span class="token keyword">function</span> <span class="token function">createDevEffectOptions</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
     scheduler<span class="token operator">:</span> queueJob<span class="token punctuation">,</span>
     allowRecurse<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
     onTrack<span class="token operator">:</span> instance<span class="token punctuation">.</span>rtc <span class="token operator">?</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">invokeArrayFns</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>rtc<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
     onTrigger<span class="token operator">:</span> instance<span class="token punctuation">.</span>rtg <span class="token operator">?</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">invokeArrayFns</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>rtg<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面给 <code>instance.update</code> 赋值一个 <code>effect</code>，先看下 <code>effect</code> 的定义，<strong>终于来了一个重点：这里的 <code>effect</code> 相当于 vue2.0的 <code>watcher</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// effect</span>
  <span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token constant">EMPTY_OBJ</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEffect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fn <span class="token operator">=</span> fn<span class="token punctuation">.</span>raw<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 中式翻译：创建响度式效果</span>
    <span class="token comment">// effect 是个函数</span>
    <span class="token keyword">const</span> effect <span class="token operator">=</span> <span class="token function">createReactiveEffect</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行 effect</span>
      <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> effect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">// createReactiveEffect： 创建一个 effect 函数</span>
  <span class="token keyword">function</span> <span class="token function">createReactiveEffect</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">effect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">reactiveEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>effect<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> options<span class="token punctuation">.</span>scheduler <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// effectStack 是个全局属性，收集 effect</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>effectStack<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">cleanup</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除 effect.deps 中收集到的 effect，当前是首次挂载根组件，所以 deps 是没东西中</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 启动跟踪, 往全局属性 trackStack 添加一个 true</span>
          <span class="token function">enableTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          effectStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加当前的 effect 到 effectStack 数组中</span>
          activeEffect <span class="token operator">=</span> effect<span class="token punctuation">;</span> <span class="token comment">// activeEffect 为全局属性，保存当前的 effect</span>
          <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行回调， 即 componentEffect 方法</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
          <span class="token comment">// 渲染完成后将当前的 effect 推出</span>
          effectStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resetTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          activeEffect <span class="token operator">=</span> effectStack<span class="token punctuation">[</span>effectStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>allowRecurse <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>allowRecurse<span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>_isEffect <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>raw <span class="token operator">=</span> fn<span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 看到了个奇怪的属性，在vue2中 deps是跟事件收集有关系的东西</span>
    effect<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">return</span> effect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">// cleanup</span>
  <span class="token keyword">function</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token parameter">effect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> deps <span class="token punctuation">}</span> <span class="token operator">=</span> effect<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deps<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      deps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">let</span> shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> trackStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">pauseTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    trackStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>shouldTrack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    shouldTrack <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">enableTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    trackStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>shouldTrack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    shouldTrack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>当执行的 <code>effect</code> 的时候，将当前 <code>effect</code> 保存到全局，最后执行回调 <code>fn</code>  即 <code>componentEffect</code> 方法渲染组件到DOM，这部分的过程先不细究，这里就完成了组件一次渲染同时在渲染过程中问到依赖的属性时，全局的 <code>effect</code> 就被当前的属性收集</p> <h2 id="组件更新"><a href="#组件更新" class="header-anchor">#</a> 组件更新</h2> <p>接下来大概分析当属性更新时，如果重新触发组件的更新</p> <p>当属性更新时，被 <code>proxy</code> 的 <code>set</code> 劫持，执行 <code>trigger(target, &quot;set&quot; /* SET */, key, value, oldValue)</code> 方法，这个方法就是取出收集的 <code>effect</code> 执行 <code>effect.options.scheduler(effect)</code> 方法</p> <p>回到上文找到<code>scheduler</code> 方法定义的位置，在 <code>setupRenderEffect</code> 中的 <code>createDevEffectOptions</code> 中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">setupRenderEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> initialVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// create reactive effect for rendering</span>
  instance<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">componentEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// componentEffect 代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">createDevEffectOptions</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// createDevEffectOptions 返回四个属性</span>
<span class="token keyword">function</span> <span class="token function">createDevEffectOptions</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
     scheduler<span class="token operator">:</span> queueJob<span class="token punctuation">,</span>
     allowRecurse<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
     onTrack<span class="token operator">:</span> instance<span class="token punctuation">.</span>rtc <span class="token operator">?</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">invokeArrayFns</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>rtc<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
     onTrigger<span class="token operator">:</span> instance<span class="token punctuation">.</span>rtg <span class="token operator">?</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">invokeArrayFns</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>rtg<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//queueJob</span>
  <span class="token keyword">function</span> <span class="token function">queueJob</span><span class="token punctuation">(</span><span class="token parameter">job</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the dedupe search uses the startIndex argument of Array.includes()</span>
    <span class="token comment">// by default the search index includes the current job that is being run</span>
    <span class="token comment">// so it cannot recursively trigger itself again.</span>
    <span class="token comment">// if the job is a watch() callback, the search will start with a +1 index to</span>
    <span class="token comment">// allow it recursively trigger itself - it is the user's responsibility to</span>
    <span class="token comment">// ensure it doesn't end up in an infinite loop.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>queue<span class="token punctuation">.</span>length <span class="token operator">||</span>
      <span class="token operator">!</span>queue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> isFlushing <span class="token operator">&amp;&amp;</span> job<span class="token punctuation">.</span>allowRecurse <span class="token operator">?</span> flushIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> flushIndex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      job <span class="token operator">!==</span> currentPreFlushParentJob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">queueFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>根据上文， <code>scheduler</code> 的作用就是将当前 <code>effect</code> 添加到微任务队列 <code>queue</code> 中，执行 <code>queueFlush();</code>, 待事件循环清理</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">queueFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isFlushing <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isFlushPending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isFlushPending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      currentFlushPromise <span class="token operator">=</span> resolvedPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushJobs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">flushJobs</span><span class="token punctuation">(</span><span class="token parameter">seen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isFlushPending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    isFlushing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      seen <span class="token operator">=</span> seen <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">flushPreFlushCbs</span><span class="token punctuation">(</span>seen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Sort queue before flush.</span>
    <span class="token comment">// This ensures that:</span>
    <span class="token comment">// 1. Components are updated from parent to child. (because parent is always</span>
    <span class="token comment">//    created before the child so its render effect will have smaller</span>
    <span class="token comment">//    priority number)</span>
    <span class="token comment">// 2. If a component is unmounted during a parent component's update,</span>
    <span class="token comment">//    its update can be skipped.</span>
    queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getId</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getId</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>flushIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> flushIndex <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> flushIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> job <span class="token operator">=</span> queue<span class="token punctuation">[</span>flushIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">checkRecursiveUpdates</span><span class="token punctuation">(</span>seen<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">14</span> <span class="token comment">/* SCHEDULER */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      flushIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      queue<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">flushPostFlushCbs</span><span class="token punctuation">(</span>seen<span class="token punctuation">)</span><span class="token punctuation">;</span>
      isFlushing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      currentFlushPromise <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// some postFlushCb queued jobs!</span>
      <span class="token comment">// keep flushing until it drains.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">||</span> pendingPostFlushCbs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">flushJobs</span><span class="token punctuation">(</span>seen<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> type<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> args <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>最终会执行的 <code>job</code> 回调， 加成一下 <code>createReactiveEffect</code> 方法的调用</p> <p>根据上文中的 <code>scheduler</code> 的调用， <code>effect.options.scheduler(effect)</code></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createReactiveEffect</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">effect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">reactiveEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>effect<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> options<span class="token punctuation">.</span>scheduler <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>effectStack<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">cleanup</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">enableTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          effectStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
          activeEffect <span class="token operator">=</span> effect<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
          effectStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resetTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          activeEffect <span class="token operator">=</span> effectStack<span class="token punctuation">[</span>effectStack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>allowRecurse <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>allowRecurse<span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>_isEffect <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>raw <span class="token operator">=</span> fn<span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    effect<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">return</span> effect<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>可以看到队列中的的 <code>job</code> 就是 <code>reactiveEffect</code>， <code>reactiveEffect</code> 执行 <code>fn</code> 回调 即 <code>componentEffect</code> 方法渲染组件</p> <p>好像跑题了~</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lanjz/Vue3/SFC还是JSX.html" class="prev">
        SCF还是JSX
      </a></span> <span class="next"><a href="/lanjz/Vue3/响应式原理.html">
        响应式原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lanjz/assets/js/app.097601f3.js" defer></script><script src="/lanjz/assets/js/2.1da27f72.js" defer></script><script src="/lanjz/assets/js/46.d7048878.js" defer></script>
  </body>
</html>
