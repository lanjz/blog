<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.0">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>组件更新机制(diff) | 前端知识体系</title><meta name="description" content="前端总结与记录">
    <link rel="preload" href="/lanjz/assets/style-W1-NA_tl.css" as="style"><link rel="stylesheet" href="/lanjz/assets/style-W1-NA_tl.css">
    <link rel="modulepreload" href="/lanjz/assets/app-QMonxybV.js"><link rel="modulepreload" href="/lanjz/assets/PatchNode.html-TJoStkPf.js"><link rel="modulepreload" href="/lanjz/assets/PatchNode.html-6PkmZC_n.js">
    <link rel="prefetch" href="/lanjz/assets/index.html-xpFVQwL6.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-TIv5HE_i.js" as="script"><link rel="prefetch" href="/lanjz/assets/剑指offer二.html-H6yHdsZG.js" as="script"><link rel="prefetch" href="/lanjz/assets/动态规划.html-MhDsDeLt.js" as="script"><link rel="prefetch" href="/lanjz/assets/回文串.html-icos-EVD.js" as="script"><link rel="prefetch" href="/lanjz/assets/回溯.html-s1IKarUQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/字节前端.html-20lYAhSV.js" as="script"><link rel="prefetch" href="/lanjz/assets/小题.html-b2ajlKkX.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间_空间复杂度.html-oFvTYAPj.js" as="script"><link rel="prefetch" href="/lanjz/assets/树.html-JK6RdsGr.js" as="script"><link rel="prefetch" href="/lanjz/assets/简单排序.html-v4w_H1pz.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML渲染过程.html-cjfk9Wm0.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-eU-i0c7P.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器中的进程与线程.html-IdTgMSQ_.js" as="script"><link rel="prefetch" href="/lanjz/assets/BFC和IFC.html-dovj6K9_.js" as="script"><link rel="prefetch" href="/lanjz/assets/CSS3新特性.html-8qiEZCwL.js" as="script"><link rel="prefetch" href="/lanjz/assets/Flex.html-qLUBPMuc.js" as="script"><link rel="prefetch" href="/lanjz/assets/Image.html-4W7oQRIK.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-O-79NUsQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/多列.html-bQXLN_vk.js" as="script"><link rel="prefetch" href="/lanjz/assets/换肤.html-eVsfjoup.js" as="script"><link rel="prefetch" href="/lanjz/assets/样式实现.html--k5Pbhd6.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端一像素问题.html-X7pYghaS.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端适配方案.html-2GtQqZKR.js" as="script"><link rel="prefetch" href="/lanjz/assets/适配iponeX.html-g6SM1Pc1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class.html-SSWxzeHD.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class继承.html-3roVSLHF.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generater应用.html-Z2hdO4_7.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generator.html-Yp3C1Pfj.js" as="script"><link rel="prefetch" href="/lanjz/assets/Iterator.html-qL32ubgi.js" as="script"><link rel="prefetch" href="/lanjz/assets/Map和WeakMap.html-7Ps2NyGQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module.html-6QWYogdy.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module的加载实现.html-GLbM-L-t.js" as="script"><link rel="prefetch" href="/lanjz/assets/Promise.html-0INPdCq-.js" as="script"><link rel="prefetch" href="/lanjz/assets/Proxy.html-9KjEt2z2.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-hoeK4zBn.js" as="script"><link rel="prefetch" href="/lanjz/assets/Set和WeakSet.html-S7aWte39.js" as="script"><link rel="prefetch" href="/lanjz/assets/Symbol.html-B0ibI1wu.js" as="script"><link rel="prefetch" href="/lanjz/assets/async函数.html-Xp9slu1L.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数的扩展.html-UlzwEL4k.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象.html-PCLs8NxF.js" as="script"><link rel="prefetch" href="/lanjz/assets/数组.html-GLvyheYg.js" as="script"><link rel="prefetch" href="/lanjz/assets/装饰器.html-ULm0I_CG.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML5新特性.html-ZnCVajy4.js" as="script"><link rel="prefetch" href="/lanjz/assets/IntersectionObserver.html-BSb0zKCd.js" as="script"><link rel="prefetch" href="/lanjz/assets/Preload和Prefetch.html-B9Tvs1gG.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-B1G0cOmI.js" as="script"><link rel="prefetch" href="/lanjz/assets/SVG.html-Inig3hyj.js" as="script"><link rel="prefetch" href="/lanjz/assets/Worker.html-OG3VwMKk.js" as="script"><link rel="prefetch" href="/lanjz/assets/requestIdleCallback和requestAnimationFrame.html-9iWgZREw.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-vM2rNHKc.js" as="script"><link rel="prefetch" href="/lanjz/assets/DOM.html-sucZj9T5.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS基础.html-VGDSM11k.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS核心.html-ARBiewQE.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS面象对象.html-uX-93pwC.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-k4k200aw.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件.html-ZSyr-sj_.js" as="script"><link rel="prefetch" href="/lanjz/assets/代码实现.html-4XLIUaPh.js" as="script"><link rel="prefetch" href="/lanjz/assets/全面解析Module模式.html-p1npiIKO.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数.html-YHrUb0e_.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-hYQvLhW_.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱二.html-YkIhxhob.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象创建模式.html-xjYIuPxw.js" as="script"><link rel="prefetch" href="/lanjz/assets/正则.html-2nJbZK5e.js" as="script"><link rel="prefetch" href="/lanjz/assets/编写高质量JavaScript代码的基本要点.html-xA0SZmu6.js" as="script"><link rel="prefetch" href="/lanjz/assets/设计模式.html-lHhOfgUM.js" as="script"><link rel="prefetch" href="/lanjz/assets/闭包.html-jjTw3j4y.js" as="script"><link rel="prefetch" href="/lanjz/assets/JSBridge.html-lP5o-KQX.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-1Cumsuo4.js" as="script"><link rel="prefetch" href="/lanjz/assets/uniapp.html-qy-O_BBt.js" as="script"><link rel="prefetch" href="/lanjz/assets/微信小程序.html-OCZrKtxA.js" as="script"><link rel="prefetch" href="/lanjz/assets/Component.html-IboDxMj1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-pnEV3zjI.js" as="script"><link rel="prefetch" href="/lanjz/assets/Fiber.html-R0LeAbi1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Hook.html-3x7JI3HY.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-m4FB_UBE.js" as="script"><link rel="prefetch" href="/lanjz/assets/React-router5.html-CvIE6oVe.js" as="script"><link rel="prefetch" href="/lanjz/assets/React.html-RNMk0VOh.js" as="script"><link rel="prefetch" href="/lanjz/assets/React16新特性.html-814tuCi7.js" as="script"><link rel="prefetch" href="/lanjz/assets/ReactDOM.render.html-fX8tjUjV.js" as="script"><link rel="prefetch" href="/lanjz/assets/React高级指引.html-TmXn8O_9.js" as="script"><link rel="prefetch" href="/lanjz/assets/VirtualDom.html-7bTSFgzB.js" as="script"><link rel="prefetch" href="/lanjz/assets/vsVue.html-56mn2N9r.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-aqQ-nc5l.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能优化.html-wxneI8cR.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间切片.html-ZL86DsoM.js" as="script"><link rel="prefetch" href="/lanjz/assets/更新机制.html-LG37yWVf.js" as="script"><link rel="prefetch" href="/lanjz/assets/服务端渲染.html-72wgK1iO.js" as="script"><link rel="prefetch" href="/lanjz/assets/渲染过程.html-0k6lk2iD.js" as="script"><link rel="prefetch" href="/lanjz/assets/高阶组件.html-t2UO3erv.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ITf88Lsr.js" as="script"><link rel="prefetch" href="/lanjz/assets/nextTick.html-hB-pqyx4.js" as="script"><link rel="prefetch" href="/lanjz/assets/set.html-QLNz9Djx.js" as="script"><link rel="prefetch" href="/lanjz/assets/Computed.html-iODhKG8e.js" as="script"><link rel="prefetch" href="/lanjz/assets/Extend.html-5D8vOT5M.js" as="script"><link rel="prefetch" href="/lanjz/assets/Paas应用.html--u3CZHjI.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-oDmkgbik.js" as="script"><link rel="prefetch" href="/lanjz/assets/Render.html-EOsdmFwg.js" as="script"><link rel="prefetch" href="/lanjz/assets/SSR.html-ypvzy4ik.js" as="script"><link rel="prefetch" href="/lanjz/assets/VueRouter.html-8Tmdolw5.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vuex.html-8qbu9gnK.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vue性能优化.html-KBkjURf3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watch.html-nIz9q9rN.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watcher更新顺序.html-dPqsmR-Y.js" as="script"><link rel="prefetch" href="/lanjz/assets/v-model.html-YtZ53wLv.js" as="script"><link rel="prefetch" href="/lanjz/assets/共享状态思想.html-tc6hhLE1.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-DUHTOZaR.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-4yEvQnK_.js" as="script"><link rel="prefetch" href="/lanjz/assets/数据代理.html-WNKoIQyA.js" as="script"><link rel="prefetch" href="/lanjz/assets/模板到DOM.html-ZyETjtOs.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件通信.html-I3zyocKp.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-zlfpMUK5.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-54XFAuls.js" as="script"><link rel="prefetch" href="/lanjz/assets/SFC还是JSX.html-lVYviH78.js" as="script"><link rel="prefetch" href="/lanjz/assets/V3升级目的.html-NmETZNWY.js" as="script"><link rel="prefetch" href="/lanjz/assets/createApp.html-VkJtBe3l.js" as="script"><link rel="prefetch" href="/lanjz/assets/setup.html-a-i2wGNs.js" as="script"><link rel="prefetch" href="/lanjz/assets/watch.html-w66s65pj.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用区别.html-edGwdSF7.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式API.html-j7Pr8LHd.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-7rSZWsbR.js" as="script"><link rel="prefetch" href="/lanjz/assets/预渲染.html-W8WaEN8T.js" as="script"><link rel="prefetch" href="/lanjz/assets/CDN.html-OanE2fvK.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie.html-VZnPiWuq.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie、Session、Token、JWT.html-6KASPfeL.js" as="script"><link rel="prefetch" href="/lanjz/assets/DNS.html-Tp3WZn6D.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTPS.html-90DTZfbf.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTP及演变.html-6iRnK5v7.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Wj7FUAUj.js" as="script"><link rel="prefetch" href="/lanjz/assets/Socket.html-9UEtYx06.js" as="script"><link rel="prefetch" href="/lanjz/assets/TCP.html-9zFqxc-Q.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebSocket.html-1-ImvYBZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/keep-alive.html-P4T3wYP4.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器缓存.html-sm_2xXBP.js" as="script"><link rel="prefetch" href="/lanjz/assets/网络层的优化.html-uyPmn4tG.js" as="script"><link rel="prefetch" href="/lanjz/assets/跨域.html-CQDfaiJ-.js" as="script"><link rel="prefetch" href="/lanjz/assets/MD.html-KzPs4jZq.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-maE5QfQy.js" as="script"><link rel="prefetch" href="/lanjz/assets/importHtmlEntry.html-sH8XQ873.js" as="script"><link rel="prefetch" href="/lanjz/assets/qiankun原理.html-wHTRVwYB.js" as="script"><link rel="prefetch" href="/lanjz/assets/微前端.html-HTdq6tHW.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-yXu48Z6s.js" as="script"><link rel="prefetch" href="/lanjz/assets/FE重构.html-ENEVAutR.js" as="script"><link rel="prefetch" href="/lanjz/assets/Performance.html-Fa4Jo_l4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack构建优化.html-h4jVhoJV.js" as="script"><link rel="prefetch" href="/lanjz/assets/che.html-dz3inqsi.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理分享.html-lz7hoV_s.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点分享.html-y7y6qqOq.js" as="script"><link rel="prefetch" href="/lanjz/assets/评审.html-vZP1juIH.js" as="script"><link rel="prefetch" href="/lanjz/assets/Git.html-aKvUKaCO.js" as="script"><link rel="prefetch" href="/lanjz/assets/Mac.html-MQVZaYsh.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-YJRxGQ2V.js" as="script"><link rel="prefetch" href="/lanjz/assets/公共模块管理.html-7YOvJOn6.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄漏.html-ULemVbNM.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端优化总结.html-V8Juiz_p.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端异常捕获.html-vs12Pqzj.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点方案.html-1aYc5YwJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/开发与调试技巧.html-X4Do7tuT.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能定位.html-nBG_2WIS.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能指标.html--hMThFiS.js" as="script"><link rel="prefetch" href="/lanjz/assets/疑难杂症.html-CI0jSrv2.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件设计的基本原则.html-RligA6vX.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动化部署.html-SlXYK3Yt.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动引入组和ICON.html-uLWJAGrk.js" as="script"><link rel="prefetch" href="/lanjz/assets/重构改善既有代码的设计.html-qU4Nruc1.js" as="script"><link rel="prefetch" href="/lanjz/assets/预加载_预解析.html-Bb1jUxV9.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebStorage.html-7z2G8bqz.js" as="script"><link rel="prefetch" href="/lanjz/assets/svgMap.html-A4MjyOZG.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Lx-jRl3M.js" as="script"><link rel="prefetch" href="/lanjz/assets/README2.html-cZEzrKAw.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用小记.html-8wCrdqLP.js" as="script"><link rel="prefetch" href="/lanjz/assets/Buffer.html-evLOj6wx.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node中的进程和线程.html-gOztiENE.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-l-cSjo3H.js" as="script"><link rel="prefetch" href="/lanjz/assets/流.html-dAztHHLm.js" as="script"><link rel="prefetch" href="/lanjz/assets/待看.html-RWSJu-lA.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-CkNmsSXO.js" as="script"><link rel="prefetch" href="/lanjz/assets/NPM.html-vHU0nqmL.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-SkIPy7RS.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-tOp21v6H.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vite是啥.html-dQYzNKV4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Babel-Loader.html-reec-3N1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Loader.html-D6LlU_9Q.js" as="script"><link rel="prefetch" href="/lanjz/assets/ModuleFederation.html-e9vlyNzZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Plugin.html-IYq8h__n.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-LNK6sfts.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack5新特性.html-VyoL-2Vp.js" as="script"><link rel="prefetch" href="/lanjz/assets/css-loader_style-loader.html-ch-GGpxJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/library.html-zNdERoCD.js" as="script"><link rel="prefetch" href="/lanjz/assets/优化实践之Vue-Cli.html-10FEnVUw.js" as="script"><link rel="prefetch" href="/lanjz/assets/构建优化方案.html-TFq58dSl.js" as="script"><link rel="prefetch" href="/lanjz/assets/配置小记.html-49Y1eOrr.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node模块.html-5jTmd1TY.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-zoHHCCt_.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件循环.html-mJ2V-5Ig.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄露.html--p47aptr.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-bL8JdB3z.js" as="script"><link rel="prefetch" href="/lanjz/assets/基础使用.html-hTLjVzAf.js" as="script"><link rel="prefetch" href="/lanjz/assets/守护服务.html-SN7LQfad.js" as="script"><link rel="prefetch" href="/lanjz/assets/认识Node.html-NUuTcs5v.js" as="script"><link rel="prefetch" href="/lanjz/assets/进程和线程.html-bDeepQaV.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Y3NtU4f4.js" as="script"><link rel="prefetch" href="/lanjz/assets/setState.html-t19ojuh9.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端规范.html-K7KaUSnJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/项目模板.html-Q6_xXIFu.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-3aygG5JI.js" as="script"><link rel="prefetch" href="/lanjz/assets/登录系统.html-fcJTU7Cy.js" as="script"><link rel="prefetch" href="/lanjz/assets/页面鉴权.html-Fiy6TXrr.js" as="script"><link rel="prefetch" href="/lanjz/assets/code-split.html-0pBmni0g.js" as="script"><link rel="prefetch" href="/lanjz/assets/tree-shaking.html-qOtEtDvd.js" as="script"><link rel="prefetch" href="/lanjz/assets/模块热替换.html-MQW2tdrS.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-dESqkmtA.js" as="script"><link rel="prefetch" href="/lanjz/assets/404.html-r6aI8Oiv.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-RnOQSJ_L.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-OCX92lVq.js" as="script"><link rel="prefetch" href="/lanjz/assets/剑指offer二.html-03XlpQP6.js" as="script"><link rel="prefetch" href="/lanjz/assets/动态规划.html-NV2ktc3U.js" as="script"><link rel="prefetch" href="/lanjz/assets/回文串.html-aBJSXGrZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/回溯.html-ut5yLHWv.js" as="script"><link rel="prefetch" href="/lanjz/assets/字节前端.html-vGoF-aGQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/小题.html-J0k4IYP0.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间_空间复杂度.html-yc3yNwWP.js" as="script"><link rel="prefetch" href="/lanjz/assets/树.html-Hbrer37p.js" as="script"><link rel="prefetch" href="/lanjz/assets/简单排序.html-3NuRSfbF.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML渲染过程.html-6-fYyW_5.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Iy10vtWZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器中的进程与线程.html-EZqcCLi8.js" as="script"><link rel="prefetch" href="/lanjz/assets/BFC和IFC.html-oLLd3jnM.js" as="script"><link rel="prefetch" href="/lanjz/assets/CSS3新特性.html-M4xAZ6Gn.js" as="script"><link rel="prefetch" href="/lanjz/assets/Flex.html-3By-SU-d.js" as="script"><link rel="prefetch" href="/lanjz/assets/Image.html-1QW7KyIb.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-V7WHrMz2.js" as="script"><link rel="prefetch" href="/lanjz/assets/多列.html-v0pU41bE.js" as="script"><link rel="prefetch" href="/lanjz/assets/换肤.html-PnfoT8eT.js" as="script"><link rel="prefetch" href="/lanjz/assets/样式实现.html-hd_5VhuJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端一像素问题.html-oWTQsOfr.js" as="script"><link rel="prefetch" href="/lanjz/assets/移动端适配方案.html-JufcuDSO.js" as="script"><link rel="prefetch" href="/lanjz/assets/适配iponeX.html-d7B5akHz.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class.html-PejArFgj.js" as="script"><link rel="prefetch" href="/lanjz/assets/Class继承.html-op8XfKh4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generater应用.html-w7xswd3N.js" as="script"><link rel="prefetch" href="/lanjz/assets/Generator.html-hD_Y4CCD.js" as="script"><link rel="prefetch" href="/lanjz/assets/Iterator.html-Ju_aasbw.js" as="script"><link rel="prefetch" href="/lanjz/assets/Map和WeakMap.html-zsn8e89b.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module.html-NoDg8yEc.js" as="script"><link rel="prefetch" href="/lanjz/assets/Module的加载实现.html-AqYfD75D.js" as="script"><link rel="prefetch" href="/lanjz/assets/Promise.html-ABctceW6.js" as="script"><link rel="prefetch" href="/lanjz/assets/Proxy.html-AX3TWugN.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-MO42vdr3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Set和WeakSet.html-KGPMaJC3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Symbol.html-oNi3B70j.js" as="script"><link rel="prefetch" href="/lanjz/assets/async函数.html-p9EqMdU9.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数的扩展.html-perxKATh.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象.html-YZ6sujw8.js" as="script"><link rel="prefetch" href="/lanjz/assets/数组.html-JS0S99Fe.js" as="script"><link rel="prefetch" href="/lanjz/assets/装饰器.html-i3AHnot9.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTML5新特性.html-l2tKe0TM.js" as="script"><link rel="prefetch" href="/lanjz/assets/IntersectionObserver.html-vlaIPohp.js" as="script"><link rel="prefetch" href="/lanjz/assets/Preload和Prefetch.html-a2Gb5hN0.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ZxezbKFj.js" as="script"><link rel="prefetch" href="/lanjz/assets/SVG.html-hMttkAww.js" as="script"><link rel="prefetch" href="/lanjz/assets/Worker.html-1Rw8H9oW.js" as="script"><link rel="prefetch" href="/lanjz/assets/requestIdleCallback和requestAnimationFrame.html-ZcaMjTjt.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-ETvfWW3p.js" as="script"><link rel="prefetch" href="/lanjz/assets/DOM.html-utc1Ciy_.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS基础.html-jJ9Nja6E.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS核心.html-jbStywmS.js" as="script"><link rel="prefetch" href="/lanjz/assets/JS面象对象.html--ndBPZAO.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-zqqLNhh9.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件.html-EmcxEYuY.js" as="script"><link rel="prefetch" href="/lanjz/assets/代码实现.html-yL0ZW1N2.js" as="script"><link rel="prefetch" href="/lanjz/assets/全面解析Module模式.html-j9PT9LAQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/函数.html-v6wb8jlu.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-5FpYpbzF.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱二.html-fW21QH_E.js" as="script"><link rel="prefetch" href="/lanjz/assets/对象创建模式.html-YRgN-Hr6.js" as="script"><link rel="prefetch" href="/lanjz/assets/正则.html-PvFwc9zO.js" as="script"><link rel="prefetch" href="/lanjz/assets/编写高质量JavaScript代码的基本要点.html-e8NcrisE.js" as="script"><link rel="prefetch" href="/lanjz/assets/设计模式.html-ZRHeNbOT.js" as="script"><link rel="prefetch" href="/lanjz/assets/闭包.html-ESB-z9c3.js" as="script"><link rel="prefetch" href="/lanjz/assets/JSBridge.html-2-HGFlkl.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-qpJN8tsu.js" as="script"><link rel="prefetch" href="/lanjz/assets/uniapp.html-1mfYIISP.js" as="script"><link rel="prefetch" href="/lanjz/assets/微信小程序.html-P1siRWcL.js" as="script"><link rel="prefetch" href="/lanjz/assets/Component.html-OEGiVUcP.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-_UPrfHqT.js" as="script"><link rel="prefetch" href="/lanjz/assets/Fiber.html-Jn-vy9cI.js" as="script"><link rel="prefetch" href="/lanjz/assets/Hook.html-j3GFkvOe.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-hlz65wrC.js" as="script"><link rel="prefetch" href="/lanjz/assets/React-router5.html-Om6JuPdc.js" as="script"><link rel="prefetch" href="/lanjz/assets/React.html-BcxJQlmB.js" as="script"><link rel="prefetch" href="/lanjz/assets/React16新特性.html-IDMbUhMp.js" as="script"><link rel="prefetch" href="/lanjz/assets/ReactDOM.render.html-UnRAjGM4.js" as="script"><link rel="prefetch" href="/lanjz/assets/React高级指引.html-2JhiBH29.js" as="script"><link rel="prefetch" href="/lanjz/assets/VirtualDom.html-r2pH832N.js" as="script"><link rel="prefetch" href="/lanjz/assets/vsVue.html-Cd3DeCoM.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-NW1WxtuX.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能优化.html-Yca_wpo7.js" as="script"><link rel="prefetch" href="/lanjz/assets/时间切片.html-pB6xF7yc.js" as="script"><link rel="prefetch" href="/lanjz/assets/更新机制.html-Z5lV2e67.js" as="script"><link rel="prefetch" href="/lanjz/assets/服务端渲染.html-aLFLJ_CM.js" as="script"><link rel="prefetch" href="/lanjz/assets/渲染过程.html-NLUDiBUQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/高阶组件.html-o9nzkZVG.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-flfY4ga3.js" as="script"><link rel="prefetch" href="/lanjz/assets/nextTick.html-_0ZdpS1O.js" as="script"><link rel="prefetch" href="/lanjz/assets/set.html-BsvktBJV.js" as="script"><link rel="prefetch" href="/lanjz/assets/Computed.html-8UoHcDfP.js" as="script"><link rel="prefetch" href="/lanjz/assets/Extend.html-l0UwtXps.js" as="script"><link rel="prefetch" href="/lanjz/assets/Paas应用.html-UjxaNoXK.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-1S0qTdku.js" as="script"><link rel="prefetch" href="/lanjz/assets/Render.html-EQO9OPiU.js" as="script"><link rel="prefetch" href="/lanjz/assets/SSR.html-Ifvn3ON-.js" as="script"><link rel="prefetch" href="/lanjz/assets/VueRouter.html-necuUypn.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vuex.html-Qy4LHlWy.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vue性能优化.html-9YumNLUu.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watch.html-nZFmjirc.js" as="script"><link rel="prefetch" href="/lanjz/assets/Watcher更新顺序.html-EmjZ7Aaw.js" as="script"><link rel="prefetch" href="/lanjz/assets/v-model.html-5wmXo6lB.js" as="script"><link rel="prefetch" href="/lanjz/assets/共享状态思想.html-az33Opk-.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-8Lwzq2Og.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-qR7jOEC8.js" as="script"><link rel="prefetch" href="/lanjz/assets/数据代理.html-XZDDYyea.js" as="script"><link rel="prefetch" href="/lanjz/assets/模板到DOM.html-KLRcdrXw.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件通信.html-1ukm98c4.js" as="script"><link rel="prefetch" href="/lanjz/assets/Diff.html-QFFEyrGa.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-dY-GWuBQ.js" as="script"><link rel="prefetch" href="/lanjz/assets/SFC还是JSX.html-70K_bzCF.js" as="script"><link rel="prefetch" href="/lanjz/assets/V3升级目的.html-AoXpRaaG.js" as="script"><link rel="prefetch" href="/lanjz/assets/createApp.html-xGYTRDo0.js" as="script"><link rel="prefetch" href="/lanjz/assets/setup.html-Fl-UlpWU.js" as="script"><link rel="prefetch" href="/lanjz/assets/watch.html-kuuYavMD.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用区别.html-hpYo18Fu.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式API.html-ok9DLLnU.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理.html-Pd7nR67d.js" as="script"><link rel="prefetch" href="/lanjz/assets/预渲染.html-erRLojcm.js" as="script"><link rel="prefetch" href="/lanjz/assets/CDN.html-kbQe-7_V.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie.html-Z2gK3mEP.js" as="script"><link rel="prefetch" href="/lanjz/assets/Cookie、Session、Token、JWT.html-R2HcziCv.js" as="script"><link rel="prefetch" href="/lanjz/assets/DNS.html-7vs9USoB.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTPS.html-1vM7Z7yu.js" as="script"><link rel="prefetch" href="/lanjz/assets/HTTP及演变.html-z9KCK47q.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-Lt7Q7S8F.js" as="script"><link rel="prefetch" href="/lanjz/assets/Socket.html-iQGD4SEd.js" as="script"><link rel="prefetch" href="/lanjz/assets/TCP.html-sTxcpQBj.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebSocket.html-FbEadnhh.js" as="script"><link rel="prefetch" href="/lanjz/assets/keep-alive.html-KEOHQ0u7.js" as="script"><link rel="prefetch" href="/lanjz/assets/浏览器缓存.html-Ovyq5Gmj.js" as="script"><link rel="prefetch" href="/lanjz/assets/网络层的优化.html-jaFhJWv4.js" as="script"><link rel="prefetch" href="/lanjz/assets/跨域.html-s9JtEMh-.js" as="script"><link rel="prefetch" href="/lanjz/assets/MD.html-p3Uz5rxA.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-lCFI8Anz.js" as="script"><link rel="prefetch" href="/lanjz/assets/importHtmlEntry.html-7vrftpf4.js" as="script"><link rel="prefetch" href="/lanjz/assets/qiankun原理.html-LyvHjWKO.js" as="script"><link rel="prefetch" href="/lanjz/assets/微前端.html-35EqICXs.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-aTHK34bw.js" as="script"><link rel="prefetch" href="/lanjz/assets/FE重构.html-TwRdhSl9.js" as="script"><link rel="prefetch" href="/lanjz/assets/Performance.html-SSiXBlA1.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack构建优化.html-Sn7I5SEM.js" as="script"><link rel="prefetch" href="/lanjz/assets/che.html-rlwUWpXC.js" as="script"><link rel="prefetch" href="/lanjz/assets/响应式原理分享.html-Q4el3q1K.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点分享.html-WXQtPww0.js" as="script"><link rel="prefetch" href="/lanjz/assets/评审.html-kytjjXlW.js" as="script"><link rel="prefetch" href="/lanjz/assets/Git.html-g6FQo2qG.js" as="script"><link rel="prefetch" href="/lanjz/assets/Mac.html-gD4v59NB.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-fwS_QaxE.js" as="script"><link rel="prefetch" href="/lanjz/assets/公共模块管理.html-Gh6I7YaN.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄漏.html-5Llgj3TX.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端优化总结.html-4dF2Wa-A.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端异常捕获.html-Qo80wR3M.js" as="script"><link rel="prefetch" href="/lanjz/assets/埋点方案.html-3qVWH9Lo.js" as="script"><link rel="prefetch" href="/lanjz/assets/开发与调试技巧.html-fvbAG6mG.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能定位.html-Uq8y3xl9.js" as="script"><link rel="prefetch" href="/lanjz/assets/性能指标.html-8H07H2cq.js" as="script"><link rel="prefetch" href="/lanjz/assets/疑难杂症.html-aGIhJjZV.js" as="script"><link rel="prefetch" href="/lanjz/assets/组件设计的基本原则.html-3OSL7iVf.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动化部署.html-MfLq74k_.js" as="script"><link rel="prefetch" href="/lanjz/assets/自动引入组和ICON.html-MBxOwSEe.js" as="script"><link rel="prefetch" href="/lanjz/assets/重构改善既有代码的设计.html-rYSi9F0z.js" as="script"><link rel="prefetch" href="/lanjz/assets/预加载_预解析.html-QiTG4oGI.js" as="script"><link rel="prefetch" href="/lanjz/assets/WebStorage.html-Bqn05ZaN.js" as="script"><link rel="prefetch" href="/lanjz/assets/svgMap.html-3Z0R0ySA.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-kWWXGTr3.js" as="script"><link rel="prefetch" href="/lanjz/assets/README2.html-g6tduxpJ.js" as="script"><link rel="prefetch" href="/lanjz/assets/使用小记.html-tYKmWRv6.js" as="script"><link rel="prefetch" href="/lanjz/assets/Buffer.html-qgOsVe32.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node中的进程和线程.html-Bts0Vxi9.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-APGEQPef.js" as="script"><link rel="prefetch" href="/lanjz/assets/流.html-Ts0Egm8Z.js" as="script"><link rel="prefetch" href="/lanjz/assets/待看.html-_cG39yoF.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-NNbIOfY4.js" as="script"><link rel="prefetch" href="/lanjz/assets/NPM.html-Qs3poDir.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-wF9dIubE.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-VUaHQj5p.js" as="script"><link rel="prefetch" href="/lanjz/assets/Vite是啥.html-_2mX9sxZ.js" as="script"><link rel="prefetch" href="/lanjz/assets/Babel-Loader.html-QD9y68W6.js" as="script"><link rel="prefetch" href="/lanjz/assets/Loader.html-72dhCU7e.js" as="script"><link rel="prefetch" href="/lanjz/assets/ModuleFederation.html-uOr8t7nE.js" as="script"><link rel="prefetch" href="/lanjz/assets/Plugin.html-kzPUf99x.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-CqknjJBW.js" as="script"><link rel="prefetch" href="/lanjz/assets/Webpack5新特性.html-T26zukoX.js" as="script"><link rel="prefetch" href="/lanjz/assets/css-loader_style-loader.html-HyA7C6aP.js" as="script"><link rel="prefetch" href="/lanjz/assets/library.html-QdaOg_Xj.js" as="script"><link rel="prefetch" href="/lanjz/assets/优化实践之Vue-Cli.html-iAZMl2vH.js" as="script"><link rel="prefetch" href="/lanjz/assets/构建优化方案.html-gkKNIcy-.js" as="script"><link rel="prefetch" href="/lanjz/assets/配置小记.html-yd8-9G1g.js" as="script"><link rel="prefetch" href="/lanjz/assets/Node模块.html-V20zYM4J.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-bplLUPng.js" as="script"><link rel="prefetch" href="/lanjz/assets/事件循环.html-2ZNpHrew.js" as="script"><link rel="prefetch" href="/lanjz/assets/内存泄露.html-0w4zhyoG.js" as="script"><link rel="prefetch" href="/lanjz/assets/吱不吱.html-BJs2nR_4.js" as="script"><link rel="prefetch" href="/lanjz/assets/基础使用.html-DxGjmzR8.js" as="script"><link rel="prefetch" href="/lanjz/assets/守护服务.html-U3WOdP3R.js" as="script"><link rel="prefetch" href="/lanjz/assets/认识Node.html-iEwoCvcr.js" as="script"><link rel="prefetch" href="/lanjz/assets/进程和线程.html-wlP2CScO.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-np8H03AS.js" as="script"><link rel="prefetch" href="/lanjz/assets/setState.html-JyP2QwmI.js" as="script"><link rel="prefetch" href="/lanjz/assets/前端规范.html-CxbAQ-tm.js" as="script"><link rel="prefetch" href="/lanjz/assets/项目模板.html-2vCVzJB7.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-11ravlOm.js" as="script"><link rel="prefetch" href="/lanjz/assets/登录系统.html-9QIVlQOw.js" as="script"><link rel="prefetch" href="/lanjz/assets/页面鉴权.html-VFOksRbH.js" as="script"><link rel="prefetch" href="/lanjz/assets/code-split.html-e2DxQlSG.js" as="script"><link rel="prefetch" href="/lanjz/assets/tree-shaking.html-svkN-Hzp.js" as="script"><link rel="prefetch" href="/lanjz/assets/模块热替换.html-5cABSEUj.js" as="script"><link rel="prefetch" href="/lanjz/assets/index.html-7YyVbzFg.js" as="script"><link rel="prefetch" href="/lanjz/assets/404.html-TL8ilsK3.js" as="script"><link rel="prefetch" href="/lanjz/assets/Home-D7raDk4x.js" as="script"><link rel="prefetch" href="/lanjz/assets/My-6FN4uiFB.js" as="script"><link rel="prefetch" href="/lanjz/assets/NavSvg-Kr-IYhos.js" as="script"><link rel="prefetch" href="/lanjz/assets/Resume-vwIsJZsJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/lanjz/" class=""><!----><span class="site-name">前端知识体系</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/lanjz/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/JavaScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/ES6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/HTML5/" class="" aria-label="HTML5"><!--[--><!--]--> HTML5 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/CSS/" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Browser/" class="" aria-label="Browser"><!--[--><!--]--> Browser <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/secure/" class="" aria-label="Web安全"><!--[--><!--]--> Web安全 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Vue/" class="router-link-active" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/React/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/qiankun/" class="" aria-label="qiankun"><!--[--><!--]--> qiankun <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/NA/" class="" aria-label="跨平台"><!--[--><!--]--> 跨平台 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Node"><span class="title">Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Node"><span class="title">Node</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Node/基础/" class="" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Package/" class="" aria-label="yarn&amp;npm"><!--[--><!--]--> yarn&amp;npm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/ESBuild/" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/数据库/" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端优化总结.md" class="" aria-label="前端优化总结"><!--[--><!--]--> 前端优化总结 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/系统设计/" class="" aria-label="系统设计"><!--[--><!--]--> 系统设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/预加载&amp;预解析.md" class="" aria-label="预加载&amp;预解析"><!--[--><!--]--> 预加载&amp;预解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/重构改善既有代码的设计.md" class="" aria-label="重构代码原则"><!--[--><!--]--> 重构代码原则 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/开发与调试技巧.md" class="" aria-label="开发与调试"><!--[--><!--]--> 开发与调试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/组件设计的基本原则.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/公共模块管理.md" class="" aria-label="公共模块管理"><!--[--><!--]--> 公共模块管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/内存泄漏.md" class="" aria-label="内存泄漏"><!--[--><!--]--> 内存泄漏 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端异常捕获.md" class="" aria-label="前端异常捕获"><!--[--><!--]--> 前端异常捕获 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/自动化部署.md" class="" aria-label="自动化部署"><!--[--><!--]--> 自动化部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/疑难杂症.md" class="" aria-label="问题小计"><!--[--><!--]--> 问题小计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能指标.md" class="" aria-label="性能指标"><!--[--><!--]--> 性能指标 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能定位.md" class="" aria-label="性能定位"><!--[--><!--]--> 性能定位 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/" class="" aria-label="规范"><!--[--><!--]--> 规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/前端规范.md" class="" aria-label="前端规范"><!--[--><!--]--> 前端规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/项目模板.md" class="" aria-label="项目模板"><!--[--><!--]--> 项目模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/埋点方案.md" class="" aria-label="埋点"><!--[--><!--]--> 埋点 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="利其器"><span class="title">利其器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="利其器"><span class="title">利其器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Mac.md" class="" aria-label="Mac"><!--[--><!--]--> Mac <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Git.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小工具"><span class="title">小工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小工具"><span class="title">小工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/online-tools/MD.md" class="" aria-label="MD"><!--[--><!--]--> MD <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/lanjz/Im/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/lanjz/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端基础"><span class="title">前端基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/JavaScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/ES6/" class="" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/HTML5/" class="" aria-label="HTML5"><!--[--><!--]--> HTML5 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/CSS/" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Browser/" class="" aria-label="Browser"><!--[--><!--]--> Browser <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="网络&amp;算法"><span class="title">网络&amp;算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/network/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/secure/" class="" aria-label="Web安全"><!--[--><!--]--> Web安全 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Vue/" class="router-link-active" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Vue3/" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/React/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/qiankun/" class="" aria-label="qiankun"><!--[--><!--]--> qiankun <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/NA/" class="" aria-label="跨平台"><!--[--><!--]--> 跨平台 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Node"><span class="title">Node</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Node"><span class="title">Node</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/Node/基础/" class="" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Api/" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Package/" class="" aria-label="yarn&amp;npm"><!--[--><!--]--> yarn&amp;npm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/Vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/ESBuild/" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/Node/数据库/" class="" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端优化总结.md" class="" aria-label="前端优化总结"><!--[--><!--]--> 前端优化总结 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/系统设计/" class="" aria-label="系统设计"><!--[--><!--]--> 系统设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/预加载&amp;预解析.md" class="" aria-label="预加载&amp;预解析"><!--[--><!--]--> 预加载&amp;预解析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/重构改善既有代码的设计.md" class="" aria-label="重构代码原则"><!--[--><!--]--> 重构代码原则 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/开发与调试技巧.md" class="" aria-label="开发与调试"><!--[--><!--]--> 开发与调试 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/组件设计的基本原则.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/公共模块管理.md" class="" aria-label="公共模块管理"><!--[--><!--]--> 公共模块管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/内存泄漏.md" class="" aria-label="内存泄漏"><!--[--><!--]--> 内存泄漏 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端异常捕获.md" class="" aria-label="前端异常捕获"><!--[--><!--]--> 前端异常捕获 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/自动化部署.md" class="" aria-label="自动化部署"><!--[--><!--]--> 自动化部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/疑难杂症.md" class="" aria-label="问题小计"><!--[--><!--]--> 问题小计 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能指标.md" class="" aria-label="性能指标"><!--[--><!--]--> 性能指标 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/性能定位.md" class="" aria-label="性能定位"><!--[--><!--]--> 性能定位 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/" class="" aria-label="规范"><!--[--><!--]--> 规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/前端规范.md" class="" aria-label="前端规范"><!--[--><!--]--> 前端规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/前端规范/项目模板.md" class="" aria-label="项目模板"><!--[--><!--]--> 项目模板 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/工程化/埋点方案.md" class="" aria-label="埋点"><!--[--><!--]--> 埋点 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="利其器"><span class="title">利其器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="利其器"><span class="title">利其器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Mac.md" class="" aria-label="Mac"><!--[--><!--]--> Mac <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lanjz/利其器/Git.md" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小工具"><span class="title">小工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小工具"><span class="title">小工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/lanjz/online-tools/MD.md" class="" aria-label="MD"><!--[--><!--]--> MD <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/lanjz/Im/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/lanjz/Vue/%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1.html" class="sidebar-item sidebar-heading" aria-label="Vue 组件通信方式"><!--[--><!--]--> Vue 组件通信方式 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/%E6%A8%A1%E6%9D%BF%E5%88%B0DOM.html" class="sidebar-item sidebar-heading" aria-label="模板到真实DOM经历了什么？"><!--[--><!--]--> 模板到真实DOM经历了什么？ <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html" class="sidebar-item sidebar-heading" aria-label="响应式原理"><!--[--><!--]--> 响应式原理 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Watcher%E6%9B%B4%E6%96%B0%E9%A1%BA%E5%BA%8F.html" class="sidebar-item sidebar-heading" aria-label="Watcher更新顺序"><!--[--><!--]--> Watcher更新顺序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="组件更新机制(diff)"><!--[--><!--]--> 组件更新机制(diff) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#virtual-dom" class="router-link-active router-link-exact-active sidebar-item" aria-label="Virtual DOM"><!--[--><!--]--> Virtual DOM <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#virtual-dom的优点" class="router-link-active router-link-exact-active sidebar-item" aria-label="Virtual DOM的优点"><!--[--><!--]--> Virtual DOM的优点 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#diff-算法" class="router-link-active router-link-exact-active sidebar-item" aria-label="diff 算法"><!--[--><!--]--> diff 算法 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#diff-算法特点" class="router-link-active router-link-exact-active sidebar-item" aria-label="diff 算法特点"><!--[--><!--]--> diff 算法特点 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#diff-算法过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="diff 算法过程"><!--[--><!--]--> diff 算法过程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#源码分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="源码分析"><!--[--><!--]--> 源码分析 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#samevnode" class="router-link-active router-link-exact-active sidebar-item" aria-label="sameVnode"><!--[--><!--]--> sameVnode <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#patchvnode" class="router-link-active router-link-exact-active sidebar-item" aria-label="patchVnode"><!--[--><!--]--> patchVnode <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#updatechildren" class="router-link-active router-link-exact-active sidebar-item" aria-label="updateChildren"><!--[--><!--]--> updateChildren <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#栗子" class="router-link-active router-link-exact-active sidebar-item" aria-label="栗子"><!--[--><!--]--> 栗子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/lanjz/Vue/PatchNode.html#q-a" class="router-link-active router-link-exact-active sidebar-item" aria-label="Q&amp;A"><!--[--><!--]--> Q&amp;A <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/lanjz/Vue/Watch.html" class="sidebar-item sidebar-heading" aria-label="Watch"><!--[--><!--]--> Watch <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Computed.html" class="sidebar-item sidebar-heading" aria-label="Computed"><!--[--><!--]--> Computed <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/v-model.html" class="sidebar-item sidebar-heading" aria-label="v-model"><!--[--><!--]--> v-model <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/$nextTick" class="sidebar-item sidebar-heading" aria-label="/Vue/$nextTick"><!--[--><!--]--> /Vue/$nextTick <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/$set" class="sidebar-item sidebar-heading" aria-label="/Vue/$set"><!--[--><!--]--> /Vue/$set <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%90%86.html" class="sidebar-item sidebar-heading" aria-label="数据代理"><!--[--><!--]--> 数据代理 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/VueRouter.html" class="sidebar-item sidebar-heading" aria-label="Vue-Router"><!--[--><!--]--> Vue-Router <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Vuex.html" class="sidebar-item sidebar-heading" aria-label="Vuex"><!--[--><!--]--> Vuex <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Extend.html" class="sidebar-item sidebar-heading" aria-label="Extend"><!--[--><!--]--> Extend <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/SSR.html" class="sidebar-item sidebar-heading" aria-label="VUE-SSR"><!--[--><!--]--> VUE-SSR <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E6%80%9D%E6%83%B3.html" class="sidebar-item sidebar-heading" aria-label="共享状态思想"><!--[--><!--]--> 共享状态思想 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Paas%E5%BA%94%E7%94%A8.html" class="sidebar-item sidebar-heading" aria-label="PAAS应用"><!--[--><!--]--> PAAS应用 <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/Render.html" class="sidebar-item sidebar-heading" aria-label="Render"><!--[--><!--]--> Render <!--[--><!--]--></a><!----></li><li><a href="/lanjz/Vue/%E5%90%B1%E4%B8%8D%E5%90%B1.html" class="sidebar-item sidebar-heading" aria-label="吱不吱"><!--[--><!--]--> 吱不吱 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="组件更新机制-diff" tabindex="-1"><a class="header-anchor" href="#组件更新机制-diff" aria-hidden="true">#</a> 组件更新机制(diff)</h1><h2 id="virtual-dom" tabindex="-1"><a class="header-anchor" href="#virtual-dom" aria-hidden="true">#</a> Virtual DOM</h2><p>Vue 中使用 <code>Virtual Dom</code> 的概念，它表示 DOM 节点的 JavaScript 对象，一个 <code>Virtual Dom</code> 节点包含相应 DOM 节点的 <code>标签</code>，<code>属性</code>，<code>子节点</code>，<code>事件</code> 等的属性，它是对真实 DOM 节点的抽象表示。</p><p>Vue 在更新视图的时候在，并不是直接 DOM 上进行更新，而是先在 <code>Virtual Dom</code> 上进行相应从上面代码可以看到判断新旧相同的规则为的更新操作，最后再映射到真实 DOM 中</p><h3 id="virtual-dom的优点" tabindex="-1"><a class="header-anchor" href="#virtual-dom的优点" aria-hidden="true">#</a> Virtual DOM的优点</h3><p><strong>跨平台性</strong></p><p>由于 <code>Virtual DOM</code> 是以 JavaScript 对象为基础而不依赖真实平台环境，所以使它具有了跨平台的能力，比如说 <code>浏览器平台</code>、<code>Weex</code>、<code>Node</code> 等</p><p><strong>提升渲染性能</strong></p><p>对于高频的 DOM 更新，<code>Virtual DOM</code> 可以提高性能，因为直接操作操作 DOM 慢，JS运行效率更高。</p><p>因为 DOM 操作的执行速度远不如 Javascript 的运算速度快，因此，把大量的 DOM 操作搬运到 Javascript 中，运用 <code>patching</code> 算法来计算出真正需要更新的节点，最大限度地减少 DOM 操作，从而显著提高性能。</p><p><strong><code>Virtual DOM</code> 的优势不在于单次的操作，而是在大量、频繁的数据更新下，能够对视图进行合理、高效的更新。</strong></p><h2 id="diff-算法" tabindex="-1"><a class="header-anchor" href="#diff-算法" aria-hidden="true">#</a> diff 算法</h2><p>为什么需要 <code>diff</code> 算法， 因为如果直接使用虚拟节点覆盖旧节点的话，会有很多不必要的 DOM 操作。例如，一个 <code>ul</code> 标签下很多个 <code>li</code> 标签，其中只有一个 <code>li</code> 有变化，这种情况下如果使用新的 <code>ul</code> 去替代旧的 <code>ul</code> ,因为这些不必要的 DOM 操作而造成了性能上的浪费</p><p>为了避免不必要的 DOM 操作，虚拟DOM 在虚拟节点映射到视图的过程中，将虚拟节点与上一次渲染视图所使用的旧虚拟节点（oldVnode）做对比，找出真正需要更新的节点来进行 DOM 操作，从而避免操作其他无需改动的 DOM。</p><p>仅在同级的 <code>vnode</code> 间做 <code>diff</code> ，递归地进行同级 <code>vnode</code> 的 <code>diff</code> ，最终实现整个 DOM 树的更新。因为跨层级的操作是非常少的，忽略不计，这样时间复杂度就从 <code>O(n3)</code> 变成 <code>O(n)</code> 。</p><p><strong>总之一句话：使用 <code>diff</code> 算法就是为了避免不必要的 DOM 操作</strong></p><h3 id="diff-算法特点" tabindex="-1"><a class="header-anchor" href="#diff-算法特点" aria-hidden="true">#</a> diff 算法特点</h3><p><code>diff</code> 算法有两个比较显著的特点</p><ul><li><p>比较只会在同层级进行, 不会跨层级比较</p></li><li><p>在 <code>diff</code> 比较的过程中，循环从两边向中间收拢</p></li></ul><h3 id="diff-算法过程" tabindex="-1"><a class="header-anchor" href="#diff-算法过程" aria-hidden="true">#</a> diff 算法过程</h3><p><code>diff</code> 的实现主要通过两个方法，<code>patchVnode</code> 与 <code>updateChildren</code></p><p><code>patchVnode</code> 主要有两个参数:旧节点 <code>oldVnode</code> 和新节点 <code>vnode</code>，并进行以下情况的处理：</p><ul><li><p><code>if (oldVnode === vnode)</code>，他们的引用一致，可以认为没有变化</p></li><li><p>如果 <code>vnode</code> 不是文本节点</p><ul><li><p>如果新旧节点都存在子节点，且两者不相同时，调用 <code>updateChildren</code> 更新子节点</p></li><li><p>两者不同且 <code>vnode</code> 是否有子节点，则直接使用这些子节点</p></li><li><p>两者不同且 <code>vnode</code> 不存在子节点且 <code>oldVnode</code> 存在子节点，则删除这些子节点</p></li><li><p>都不存在子节点，且 <code>oldVnode</code> 是文本节点，则直接清空这些文本节点</p></li></ul></li><li><p>如果 <code>vnode</code> 是文本节点，则直接更新成这个文本节点</p></li></ul><p>*<em><code>updateChildren</code> 是关键，这个过程可以概括如下:</em></p><p><code>oldCh</code> 和 <code>newCh</code> 各有两个头尾的变量 <code>StartIdx</code> 和 <code>EndIdx</code> ，它们的2个变量相互比较，一共有4种比较方式</p><ul><li><p><code>oldCh</code>的头部与<code>newCh</code>的头部比较</p></li><li><p><code>oldCh</code>的尾部与<code>newCh</code>的尾部比较</p></li><li><p><code>oldCh</code>的头部与<code>newCh</code>的尾部比较</p></li><li><p><code>oldCh</code>的尾部与<code>newCh</code>的头部比较</p></li></ul><p>如果 4 种比较都没匹配，如果设置了<code>key</code>，就会用<code>key</code>进行比较，在比较的过程中，变量会往中间靠，一旦 <code>StartIdx &gt; EndIdx</code> 表明 <code>oldCh</code> 和 <code>newCh</code> 至少有一个已经遍历完了，就会结束比较。</p><h2 id="源码分析" tabindex="-1"><a class="header-anchor" href="#源码分析" aria-hidden="true">#</a> 源码分析</h2><p>当 Vue 数据发生变化的时候，会触发渲染 <code>watcher</code> 的回调函数，然后执行组件的更新方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> updateComponent<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">before</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&#39;beforeUpdate&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>组件的更新还是调用了 <code>vm._update</code> 方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vnode</span><span class="token operator">:</span> VNode<span class="token punctuation">,</span> hydrating<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> prevVnode <span class="token operator">=</span> vm<span class="token punctuation">.</span>_vnode
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// initial render</span>
    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* removeOnly */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// updates</span>
    vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>prevVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>vm._update</code> 方法中会调用 <code>__patch__</code> 方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果新节点为空</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果存在旧 oldVnode 调用旧节点的 invokeDestroyHook 生命周期</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// 如果没有旧节点，走的逻辑</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建新的根元素</span>
    isInitialPatch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断 oldVnode 是否是真实节点，比如挂载DOM的时候，旧节点是 设置的根节点，那么此时 isRealElement=true</span>
    <span class="token keyword">var</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 不是真实节点且新旧节点相同，相同的时候才执行 patchVnode 去 diff 两者的区别</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRealElement <span class="token operator">&amp;&amp;</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 进入 diff</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// vnode 是真实节点</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 服务端渲染走的逻辑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          oldVnode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          hydrating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>hydrating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldVnode
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">warn</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// either not server-rendered, or hydration failed.</span>
        <span class="token comment">// 创建一个空节点并替换它</span>
        oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 获取oldVnode的dom</span>
      <span class="token keyword">var</span> oldElm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
      <span class="token keyword">var</span> parentElm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// create new node</span>
      <span class="token function">createElm</span><span class="token punctuation">(</span>
        vnode<span class="token punctuation">,</span>
        insertedVnodeQueue<span class="token punctuation">,</span>
        oldElm<span class="token punctuation">.</span>_leaveCb <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> parentElm<span class="token punctuation">,</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// update parent placeholder node element, recursively</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ancestor <span class="token operator">=</span> vnode<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">var</span> patchable <span class="token operator">=</span> <span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          ancestor<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>patchable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i$1 <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i$1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i$1<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> ancestor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> insert <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span>insert<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>insert<span class="token punctuation">.</span>merged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// start at index 1 to avoid re-invoking hllComponent mounted hook</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i$2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i$2 <span class="token operator">&lt;</span> insert<span class="token punctuation">.</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i$2<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                insert<span class="token punctuation">.</span>fns<span class="token punctuation">[</span>i$2<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">registerRef</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          ancestor <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// destroy old node</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">removeVnodes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> isInitialPatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码先不细品了，大至过程如下：</p><ul><li><p>如果新节点为空，此时旧节点存在（组件销毁时），调用旧节点 <code>destroy</code> 生命周期函数</p></li><li><p>如果旧节点为空，根据新节点创建 DOM</p></li><li><p>如果新旧节点都存在</p><ul><li><p>旧节点不是 DOM (组件节点)，且新旧节点相同, 执行 <code>patchVnode</code>（<code>diff</code> 的核心）</p></li><li><p>旧节点是 DOM 元素或者两个节点不相同, 创建新节点 DOM，销毁旧节点以及 DOM。</p></li></ul></li></ul><p><code>patch</code> 最后会返回 <code>vnode</code>，<code>vnode</code> 和进入 <code>patch</code> 之前的不同在哪？</p><p>没错，就是<code>vnode.elm</code>，唯一的改变就是之前 <code>vnode.el = null</code> , 而现在它引用的是对应的真实dom。</p><h3 id="samevnode" tabindex="-1"><a class="header-anchor" href="#samevnode" aria-hidden="true">#</a> sameVnode</h3><p>判断新旧 VNode 是否相同是通过 <code>sameVnode</code> 方法进行判断的，源码定义:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span>
          a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span>
          a<span class="token punctuation">.</span>isComment <span class="token operator">===</span> b<span class="token punctuation">.</span>isComment <span class="token operator">&amp;&amp;</span>
          <span class="token function">isDef</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">isDef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token function">sameInputType</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
          <span class="token function">isTrue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          a<span class="token punctuation">.</span>asyncFactory <span class="token operator">===</span> b<span class="token punctuation">.</span>asyncFactory <span class="token operator">&amp;&amp;</span>
          <span class="token function">isUndef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果是 input 判断是否是相同的 input 先不细品这个</span>
  <span class="token keyword">function</span> <span class="token function">sameInputType</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token keyword">var</span> i<span class="token punctuation">;</span>
    <span class="token keyword">var</span> typeA <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">var</span> typeB <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">return</span> typeA <span class="token operator">===</span> typeB <span class="token operator">||</span> <span class="token function">isTextInputType</span><span class="token punctuation">(</span>typeA<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isTextInputType</span><span class="token punctuation">(</span>typeB<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面代码可以看到判断新旧相同的规则为：</p><ol><li><p>首先判断 <code>key</code> 是否相同，如果都没有 <code>key</code> （都是 <code>undefined</code>），获取有相同的 <code>key</code>，则继续往下判断</p></li><li><p>判断 <code>tag</code>、<code>isComment</code>、<code>data</code>(是否都存在)是否相同，如果是 <code>input</code> 元素则还对通过 <code>sameInputType</code>, 判断是否是相同的表单</p></li></ol><h3 id="patchvnode" tabindex="-1"><a class="header-anchor" href="#patchvnode" aria-hidden="true">#</a> patchVnode</h3><p>如果通过 <code>sameVnode()</code> 方法判断到新旧 <code>vnode</code> 是相同的则进入 <code>patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly);</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>
  <span class="token parameter">oldVnode<span class="token punctuation">,</span>
  vnode<span class="token punctuation">,</span>
  insertedVnodeQueue<span class="token punctuation">,</span>
  ownerArray<span class="token punctuation">,</span>
  index<span class="token punctuation">,</span>
  removeOnly</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果新旧节点相同</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果elm存在，且存在子节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ownerArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 克隆一个vnode节点。</span>
    vnode <span class="token operator">=</span> ownerArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cloneVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// elm 属性指向 vnode 对应的 dom 节点，这里的新vnode的elm也指向这旧vnode的dem 节点</span>
  <span class="token keyword">var</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>isAsyncPlaceholder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// reuse element for static trees.</span>
  <span class="token comment">// note we only do this if the vnode is cloned -</span>
  <span class="token comment">// if the new node is not cloned it means the render functions have been</span>
  <span class="token comment">// reset by the hot-reload-api and we need to do a proper re-render.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token function">isTrue</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>isStatic<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    vnode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isCloned<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isTrue</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>isOnce<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> i<span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>prepatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取旧节点的子节点</span>
  <span class="token keyword">var</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
   <span class="token comment">// 获取新节点的子节点</span>
  <span class="token keyword">var</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token comment">// 紧接着就是调用各种更新函数。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果没有文本节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 如果新旧节点都存在子节点，且两者不相同时，调用 updateChildren 更新子节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">{</span>
       <span class="token comment">// 检查是否有重复的key，如果存在重复会提示’warn‘</span>
        <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 新的vnode存在子集的情况下如果旧节点存在文本节点，那就把’Text‘清空。</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token comment">// 添加新的节点</span>
      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果新节点不存在子节点的情况下，旧节点之前是有子节点的</span>
     <span class="token comment">// 移除子节点</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果新节点不存在子节点的情况下，如果旧节点存在文本节点，清除文本节点</span>
      nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果新节占是文本节点，更新文本节点</span>
    nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>postpatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大致过程：</p><p><code>const el = vnode.el = oldVnode.el</code> 这是很重要的一步，让<code>vnode.el</code>引用到现在的真实<code>dom</code>，当<code>el</code>修改时，<code>vnode.el</code>会同步变化。</p><p>节点的比较有5种情况</p><ul><li><p><code>if (oldVnode === vnode)</code>，他们的引用一致，可以认为没有变化</p></li><li><p><code>if(oldVnode.text !== null &amp;&amp; vnode.text !== null &amp;&amp; oldVnode.text !== vnode.text)</code>，文本节点的比较，需要修改， 则会调用<code>Node.textContent = vnode.text</code></p></li><li><p><code>if( oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch )</code>, 两个节点都有子节点，而且它们不一样，这样我们会调用<code>updateChildren</code>函数比较子节点，这是<code>diff</code>的核心，后边会讲到</p></li><li><p><code>else if (ch)</code>，只有新的节点有子节点，调用<code>createEle(vnode)</code>，<code>vnode.el</code>已经引用了老的<code>dom</code>节点，<code>createEle</code>函数会在老dom节点上添加子节点</p></li><li><p><code>else if (oldCh)</code>，新节点没有子节点，老节点有子节点，直接删除老节点</p></li></ul><h3 id="updatechildren" tabindex="-1"><a class="header-anchor" href="#updatechildren" aria-hidden="true">#</a> updateChildren</h3><p>都新旧 vnode 都有子节点且不相同时，则会执行 <code>updateChildren</code> 对子元素进行 <code>diff</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateChildren</span> <span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录旧节点的开始标记位</span>
  <span class="token keyword">var</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录新节点的开始标记位</span>
  <span class="token keyword">var</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 记录旧节点的末尾标记位</span>
  <span class="token keyword">var</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 记录旧节点开始子节点</span>
  <span class="token keyword">var</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 记录旧节点的末尾子节点</span>
  <span class="token keyword">var</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 记录新节点的末尾标记位</span>
  <span class="token keyword">var</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 记录新节点开始子节点</span>
  <span class="token keyword">var</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 记录新节点的末尾子节点</span>
  <span class="token keyword">var</span> oldKeyToIdx<span class="token punctuation">,</span> idxInOld<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">,</span> refElm<span class="token punctuation">;</span>

  <span class="token comment">// removeOnly is a special flag used only by &lt;transition-group&gt;</span>
  <span class="token comment">// to ensure removed elements stay in correct relative positions</span>
  <span class="token comment">// during leaving transitions</span>
  <span class="token keyword">var</span> canMove <span class="token operator">=</span> <span class="token operator">!</span>removeOnly<span class="token punctuation">;</span>

  <span class="token punctuation">{</span>
    <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>newCh<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 新旧节点的标记从两侧往中间靠拢，直到有一方到达中间结束</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 如果没 oldStartVnode 则取下一个 vnode</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Vnode has been moved left</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 如果没 oldEndVnode 则倒着取前一个 vnode</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 如果当前两个新旧子节点的首部节点都相同</span>
    <span class="token comment">// 继续调用 patchVnode 进行 diff 判断</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// oldStartIdx newStartIdx 往右移一位</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果当前两个新旧子节点的尾部节点都相同</span>
    <span class="token comment">// 是继续调用 patchVnode 进行 diff 判断</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// oldEndVnode newEndVnode 往左移一位</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果当前旧节点的首部与新节点的尾部相同</span>
    <span class="token comment">// 是继续调用 patchVnode 进行 diff 判断</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 说明只是oldStartVnode节点的位置发生了变化，将oldStartVnode节点插入到oldEndVnode后一个节点之前</span>
      canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// oldStartIdx 向右移一位   newEndIdx 向左移一位</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved left</span>
     <span class="token comment">// 如果当前旧节点的尾部与新节点的首部都相同，是继续调用 patchVnode 进行 diff 判断</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 说明只是oldEndVnode节点的位置发生了变化，将oldEndVnode插入到oldStartVnode前</span>
      canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// newStartVnode 向右移一位   oldEndVnode 向左移一位</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// oldKeyToIdx 表示当前列表的 [key] map [元素] 的映射，如果没有则执行 createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) 遍历一次列表生成 oldKeyToIdx</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldKeyToIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token comment">// 如果当前存在 key 则从oldKeyToIdx 找出旧节点对应的key的元素的索引值</span>
      idxInOld <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
        <span class="token operator">?</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
        <span class="token operator">:</span> <span class="token function">findIdxInOld</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 使用key 匹配不到对应的元素时</span>
        <span class="token comment">// 如果有新增的节点，则会执行这里进行dom元素添加</span>
        <span class="token comment">// 如果删除节点，则会执行这里在要开始删除的元素前面添加注释节点</span>
        <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        vnodeToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 找出对应key的旧元素</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果两个元素相等</span>
        <span class="token comment">// diff 子节点</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
          oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          <span class="token comment">// 更新位置 </span>
          canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 同样的key但不同的元素。作为新元素处理</span>
          <span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    refElm <span class="token operator">=</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是删除节点则在这里进行真正的节点删除</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="栗子" tabindex="-1"><a class="header-anchor" href="#栗子" aria-hidden="true">#</a> 栗子</h3><p>假设现有旧节点 A、B、C、D、E、F，新节点 A、E、C、D、B、F</p><p>新旧节点的变化就是将 B 与 E 更换了位置</p><p>(→): 表示 <code>startIdx</code> 所在位置 (←): 表示 <code>endIdx</code> 所在位置</p><p>VNode 旧: (→)A、B、C、D、E、(←)F 新: (→)A、E、C、D、B、(←)F</p><p>对应DOM : A、B、C、D、E、F</p><p>第一轮判断</p><ul><li><code>if(sameVnode(oldStartVnode, newStartVnode))</code> 为 <code>true</code>,所以移动 <code>oldStartIdx</code> 和 <code>newStartIdx</code> 的指针: <code>++oldStartIdx</code>、<code>++newStartIdx</code></li></ul><p>VNode 旧: A、(→)B、C、D、E、(←)F 新: A、(→)E、C、D、B、(←)F</p><p>对应DOM : A、B、C、D、E、F</p><p>第二轮判断</p><ul><li><p><code>if(sameVnode(oldStartVnode, newStartVnode))</code> : <code>false</code></p></li><li><p><code>if (sameVnode(oldEndVnode, newEndVnode))</code> : <code>true</code>，所以移动 <code>oldEndVnode</code> 和 <code>newEndVnode</code> 的指针: <code>--oldEndIdx</code>、 <code>--oldEndIdx</code></p></li></ul><p>VNode 旧: A、(→)B、C、D、(←)E、F 新: A、(→)E、C、D、(←)B、F</p><p>对应DOM : A、B、C、D、E、F</p><p>第三轮判断</p><ul><li><p><code>if(sameVnode(oldStartVnode, newStartVnode))</code> : <code>false</code></p></li><li><p><code>if(sameVnode(oldEndVnode, newEndVnode))</code> : <code>false</code></p></li><li><p><code>if(sameVnode(oldStartVnode, newEndVnode))</code>：<code>true</code>, 说明 <code>oldStartVnode</code> 移到后面去</p><p>具体移动节点的方法是 <code>nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))</code>, <code>oldStartVnode.elm</code> 表示DOM 元素 <code>B</code>; <code>nodeOps.nextSibling(oldEndVnode.elm))</code> 表示 <code>oldEndVnode.elm</code> 的下一个节点（E后面的F），所以这个方法表示将 <code>B</code> 插入到 <code>F</code> 之前</p><p>然后移动 <code>oldStartIdx</code> 和 <code>newEndIdx</code> 的指针：<code>++oldStartIdx</code>, <code>--newEndIdx</code></p></li></ul><p>VNode 旧: A、B、(→)C、D、(←)E、F 新: A、(→)E、C、(←)D、B、F</p><p>对应DOM : A、C、D、E、B、F</p><p>第四轮判断</p><ul><li><p><code>if(sameVnode(oldStartVnode, newStartVnode))</code> : <code>false</code></p></li><li><p><code>if(sameVnode(oldEndVnode, newEndVnode))</code> : <code>false</code></p></li><li><p><code>if(sameVnode(oldStartVnode, newEndVnode))</code>：<code>false</code></p></li><li><p><code>if(sameVnode(oldEndVnode, newStartVnode))</code>：<code>true</code>, 说明 <code>oldEndVnode</code> 移到后面去</p></li></ul><p>具体移动节点的方法是 <code>nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)</code>, <code>oldEndVnode.elm</code> 表示DOM 元素 <code>E</code>; <code>oldStartVnode.elm</code> 表示 DOM 元素 <code>C</code>，所以这个方法表示将 <code>E</code> 插入到 <code>C</code> 之前</p><p>然后移动 <code>oldStartIdx</code> 和 <code>newEndIdx</code> 的指针：<code>--oldEndIdx</code>, <code>++newStartIdx</code></p><p>VNode 旧: A、B、(→)C、(←)D、E、F 新: A、E、(→)C、(←)D、B、F</p><p>对应DOM : A、E、C、D、B、F</p><p>第五轮判断</p><ul><li><code>if(sameVnode(oldStartVnode, newStartVnode))</code> 为 <code>true</code>,所以移动 <code>oldStartIdx</code> 和 <code>newStartIdx</code> 的指针: <code>++oldStartIdx</code>、<code>++newStartIdx</code></li></ul><p>VNode 旧: A、B、C、(→ ←)D、E、F 新: A、E、C、(→ ←)D、B、F</p><p>对应DOM : A、E、C、D、B、F</p><p>第六轮判断</p><ul><li><code>if(sameVnode(oldStartVnode, newStartVnode))</code> 为 <code>true</code>,所以移动 <code>oldStartIdx</code> 和 <code>newStartIdx</code> 的指针: <code>++oldStartIdx</code>、<code>++newStartIdx</code></li></ul><p>VNode 旧: A、B、C、(←)D、(→)E、F 新: A、E、C、(←)D、(→)B、F</p><p>对应DOM : A、E、C、D、B、F</p><p>之会跳出 <code>while</code> 循环</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><p>过程可以概括为：<code>oldCh</code> 和 <code>newCh</code> 各有两个头尾的变量 <code>StartIdx</code> 和 <code>EndIdx</code> ，在一次遍历中，会使用他们做4种比较方式。</p><ol><li><p>新节点的首部节点与旧节点的首部节点是否相同</p></li><li><p>新节点的尾部节点与旧节点的尾部节点是否相同</p></li><li><p>新节点的头部节点与旧节点的尾部节点是否相同： 元素内部发生了位置变化，有个元素跑前面来了</p></li><li><p>新节点的尾部节点与旧节点的着部节点是否相同： 元素内部发生了位置变化，有个元素跑后面去了</p></li><li><p>如果4种比较都没匹配，则尝试通过 <code>key</code> 查找，这里分两种情况</p></li></ol><ul><li><p>如果新节点有 <code>key</code>, 且能匹配到旧节点，则当做添加新节点处理</p></li><li><p>如果新节点有 <code>key</code>, 且能匹配到旧节点，则先通过 <code>sameVnode</code> 方法判断这两个新旧节点是否相同，情况也分两种</p><ul><li><p>如果相同，则 <code>patchVnode</code> 继续对新旧节点做 <code>diff</code> 处理，并且交换位置</p></li><li><p>如果不相同，则当做新节点做处理</p></li></ul></li></ul><p><strong>所以为节点设置<code>key</code>可以更高效的利用<code>dom</code></strong></p><p>在比较的过程中，变量会往中间靠，一旦 <code>StartIdx&gt;EndIdx</code> 表明 <code>oldCh</code> 和 <code>newCh</code> 至少有一个已经遍历完了，就会结束比较。</p><p>在结束时，分为两种情况：</p><ul><li><p><code>oldStartIdx &gt; oldEndIdx</code>,说明旧的节点都遍历完了，如果还有新节点没遍历完，则都是新加的节点，执行<code>addVnodes</code>函数插入这些节点</p></li><li><p><code>newStartIdx &gt; newEndIdx</code>, 可以认为<code>newCh</code>先遍历完。此时<code>oldStartIdx</code>和<code>oldEndIdx</code>之间的<code>vnode</code>在新的子节点里已经不存在了， 调用<code>removeVnodes</code>将它们从dom里删除。</p></li></ul><h2 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a" aria-hidden="true">#</a> Q&amp;A</h2><p><strong>为什么不推荐使用index作为key？</strong></p><p>因为使用 <code>index</code> 作为 <code>key</code>，会导致 diff 时不能找到<strong>正确</strong>的节点做复用。注意这里的<strong>正确</strong>一词</p><p>假设有以下列表 <code>[1, 2, 3, 4]</code>，并用 <code>index</code> 做为 <code>key</code>，此时列表对应原 <code>key</code> 为 <code>[0, 1, 2, 3]</code> 之后我们将列表改成 <code>[2, 3, 4, 1]</code>,此时对应的 <code>key</code> 还是 <code>[0, 1, 2， 3]</code></p><p>回顾下进行 <code>diff</code> 时执行的 <code>updateChildren</code> 方法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
          oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
          newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// todo</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved right</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
          canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
          newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Vnode moved left</span>
          <span class="token comment">// todo</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// todo</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假设当前进行对比都是第一个元素，在执行到第一个判断语句 <code>sameVnode(oldStartVnode, newStartVnode)</code> 时，此时新旧节点的<code>tag</code>, <code>key</code> 都是相同的此时就对这两个节点做进一步的 <code>diff</code> 判断，之后判断到文本内容是不一样的，就会将新的文本替换旧的文本，这样就导致子节点没办法得到复用了。以此类推，其它的所节点都会有这个问题</p><p>但是如果当前使用的是唯一 <code>id</code> 作为 <code>key</code>，在上面的例子中，在对比第一个元素，将执行第三个判断主句 <code>sameVnode(oldStartVnode, newEndVnode)</code> ，实际上他们的子节点也是相同，因此再进一步 <code>diff</code> 时也是认为是相同的，之后将执行 <code>canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm));</code>语句， 直接以相换位置的方式复用旧节点，以此拿到提高性能的目的</p><p>所以如果使用 <code>index</code> 作为 <code>key</code>将不利于节点的复用</p><p><strong>Virtual DOM 比真实 DOM 快嘛</strong></p><p><code>Virtual DOM</code> 并不是比真实 DOM 快，而是不管数据怎么变化，都可以用最小的代码进行更新 DOM</p><p>虽然说 <code>diff</code> 算法号称算法复杂度 <code>O(n)</code> 可以得到最小操作结果，但实际上 DOM 树很大的时候，遍历两棵树进行各种对比还是有性能损耗的， 特别是我在顶层更新一个简单的数据，你就要整棵树 <code>walk</code> 一遍，而真实中我可以一句 <code>jQuery</code> 就搞定</p><p>框架的意义在于为你掩盖底层的 DOM 操作，让你用更声明式的方式来描述你的目的，从而让你的代码更容易维护。没有任何框架可以比纯手动的优化 DOM 操作更快</p><p>框架给你的保证是，你在不需要手动优化的情况下，我依然可以给你提供过得去的性能</p><p><strong>vue和react更新机制的区别</strong></p><p>vue会跟踪每一个组件的依赖关系,不需要重新渲染整个组件树。</p><p>而对于React而言，每当应用的状态被改变时，全部组件都会重新渲染，所以 react 中会需要 <code>shouldComponentUpdate</code> 这个生命周期函数方法来进行控制</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 156081289@qq.com">156081289@qq.com</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/lanjz/Vue/Watcher%E6%9B%B4%E6%96%B0%E9%A1%BA%E5%BA%8F.html" class="" aria-label="Watcher更新顺序"><!--[--><!--]--> Watcher更新顺序 <!--[--><!--]--></a></span><span class="next"><a href="/lanjz/Vue/Watch.html" class="" aria-label="Watch"><!--[--><!--]--> Watch <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/lanjz/assets/app-QMonxybV.js" defer></script>
  </body>
</html>
