import{_ as n,o as s,c as a,d as t}from"./app.4d5def3b.js";const e={},p=t(`<h1 id="vuex" tabindex="-1"><a class="header-anchor" href="#vuex" aria-hidden="true">#</a> Vuex</h1><p>\u4F7F\u7528\u4F8B\u5B50</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./app.js&#39;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>count<span class="token operator">++</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">&#39;app&#39;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    store<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="vue-use-vuex" tabindex="-1"><a class="header-anchor" href="#vue-use-vuex" aria-hidden="true">#</a> Vue.use(vuex)</h2><p><code>Vue.use(vuex)</code> \u4F1A\u6267\u884C <code>vuex</code> \u4E2D\u7684 <code>install</code> \u65B9\u6CD5\uFF0C\u5B83\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">install</span> <span class="token punctuation">(</span><span class="token parameter">_Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Vue <span class="token operator">&amp;&amp;</span> _Vue <span class="token operator">===</span> Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
        <span class="token string">&#39;[vuex] already installed. Vue.use(Vuex) should be called only once.&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  Vue <span class="token operator">=</span> _Vue<span class="token punctuation">;</span>
  <span class="token function">applyMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// applyMixin</span>
<span class="token keyword">function</span> <span class="token function">applyMixin</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> version <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>version<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">beforeCreate</span><span class="token operator">:</span> vuexInit <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// vuexInit</span>
  <span class="token keyword">function</span> <span class="token function">vuexInit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">;</span>
    <span class="token comment">// store injection</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>store <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>
        <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> options<span class="token punctuation">.</span>store<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>parent <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>$store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> options<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>$store<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vux \u7684 <code>install</code> \u65B9\u6CD5\u6267\u884C\u7684\u5C31\u662F <code>applyMixin</code> \u65B9\u6CD5, <code>applyMixin</code> \u65B9\u6CD5\u7684\u4E3B\u8981\u529F\u80FD\u5C06\u521D\u59CB\u5316 Vue \u5B9E\u4F8B\u65F6\u4F20\u5165\u7684 <code>store</code> \u8BBE\u7F6E\u5230 <code>this.$store</code> \u5C5E\u6027\u4E0A, \u5B50\u7EC4\u4EF6\u5219\u4ECE\u5176\u7236\u7EC4\u4EF6\u5F15\u7528 <code>$store</code> \u5C5E\u6027, \u5C42\u5C42\u5D4C\u5957\u8FDB\u884C\u8BBE\u7F6E. \u8FD9\u6837,\u4EFB\u4F55\u4E00\u4E2A\u7EC4\u4EF6\u90FD\u80FD\u901A\u8FC7 <code>this.$store</code> \u7684\u65B9\u5F0F\u8BBF\u95EE <code>store</code> \u5BF9\u8C61\u4E86</p><p>\u5355\u4ECE\u8FD9\u91CC\u4F1A\u6709\u7591\u95EE\u5C31\u662F\u53EA\u5728 <code>this</code> \u4E0A\u6DFB\u52A0 <code>$store</code> \u5C5E\u6027\u662F\u4E0D\u4F1A\u6709\u54CD\u5E94\u529F\u80FD\u7684\uFF0C\u4F46\u662F\u5B9E\u73B0\u4F7F\u7528\u65F6\u4FEE\u6539 <code>state</code> \u662F\u53EF\u4EE5\u89E6\u53D1\u89C6\u56FE\u66F4\u65B0\uFF0C\u5728\u54EA\u505A\u7684\u4E86\uFF1F</p><h2 id="vuex\u7684\u54CD\u5E94\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#vuex\u7684\u54CD\u5E94\u673A\u5236" aria-hidden="true">#</a> Vuex\u7684\u54CD\u5E94\u673A\u5236</h2><p>\u5728 <code>vuex.Store</code> \u7684\u6784\u9020\u65B9\u6CD5\u4E2D\u6709\u4EE5\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u521D\u59CB\u5316 store \u7684\u54CD\u5E94\u673A\u5236\uFF08\u5305\u62EC\u5C06 _wrappedGetters \u521D\u59CB\u4E3A compute\uFF09</span>
<span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// resetStoreVM(this, state);</span>
<span class="token keyword">function</span> <span class="token function">resetStoreVM</span> <span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> state<span class="token punctuation">,</span> hot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oldVm <span class="token operator">=</span> store<span class="token punctuation">.</span>_vm<span class="token punctuation">;</span>

  <span class="token comment">// bind store public getters</span>
  store<span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// reset local getters cache</span>
  store<span class="token punctuation">.</span>_makeLocalGettersCache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> wrappedGetters <span class="token operator">=</span> store<span class="token punctuation">.</span>_wrappedGetters<span class="token punctuation">;</span>
  <span class="token keyword">var</span> computed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">forEachValue</span><span class="token punctuation">(</span>wrappedGetters<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// use computed to leverage its lazy-caching mechanism</span>
    <span class="token comment">// direct inline function use will lead to closure preserving oldVm.</span>
    <span class="token comment">// using partial to return function with only arguments preserved in closure environment.</span>
    computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> store<span class="token punctuation">.</span>_vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// for local getters</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// use a Vue instance to store the state tree</span>
  <span class="token comment">// suppress warnings just in case the user has added</span>
  <span class="token comment">// some funky global mixins</span>
  <span class="token keyword">var</span> silent <span class="token operator">=</span> Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>silent<span class="token punctuation">;</span>
  Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>silent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  store<span class="token punctuation">.</span>_vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$$state</span><span class="token operator">:</span> state
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> computed
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>silent <span class="token operator">=</span> silent<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4EE3\u7801\u901A\u8FC7\u5B9E\u4F8B\u5316\u4E00\u4E2A\u65B0 <code>Vue</code> \u5B9E\u4F8B\uFF0C\u7ED9 <code>$$state</code> \u548C <code>computed</code> \u6DFB\u52A0\u54CD\u5E94\u673A\u5236\uFF0C\u770B\u5230\u8FD9\u91CC\u8FD8\u662F\u4E0D\u660E\u767D\u8FD9\u91CC <code>new Vue</code> \u6DFB\u52A0\u7684\u54CD\u5E94\u8DDF\u542F\u52A8\u9879\u76EE\u7684 <code>new Vue</code> \u6709\u5565\u5173\u7CFB\uFF1F</p><p>\u4E0B\u9762\u901A\u8FC7\u4E00\u4E2A\u4F8B\u5B50\u7406\u89E3\u4E00\u4E0B\uFF1A</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{arr}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{$$obj}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">&#39;l&#39;</span><span class="token punctuation">}</span>
  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$obj</span><span class="token operator">:</span> obj
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&#39;#app&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    obj<span class="token punctuation">,</span>
    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$$obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>obj
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4F8B\u5B50\u4E2D\u542F\u52A8\u9879\u76EE\u7684 <code>Vue</code> \u6CA1\u6709\u76F4\u63A5\u5728 <code>data</code> \u4E2D\u5B9A\u4E49 <code>$$obj</code> \u5C5E\u6027\uFF0C<code>$$obj</code> \u5C5E\u6027\u662F\u5728 <code>beforeCreate</code> \u94A9\u5B50\u51FD\u6570\u8D4B\u503C\u7684\uFF0C\u53D6\u81F3 <code>$options</code> \u4E0A\u5C5E\u6027 <code>obj</code>\uFF0C<code>$options.obj</code> \u662F\u5728 <code>new Vue</code> \u4E2D\u4F20\u5165\u7684\uFF0C\u4E14\u8FD9\u4E2A <code>obj</code> \u5C5E\u6027\u4E5F\u5728\u53E6\u4E00\u4E2A <code>new Vue</code> \u4E2D\u4F7F\u7528\u4E14\u662F\u4F7F\u7528\u5728 <code>data.$obj</code> \u5C5E\u6027\u4E0A\uFF0C\u4E5F\u5728\u5C31\u8BF4\u8FD9\u4E2A <code>$obj</code> \u5C5E\u6027\u5728\u8FD9\u4E2A <code>Vue</code> \u4E2D\u662F\u54CD\u5E94\u5F0F\u7684\u3002\u4E5F\u56E0\u6B64\u5728\u5E94\u7528\u4E2D\u8BBF\u95EE<code>$$obj</code> \u65F6\uFF0C\u5168\u5C40\u7684 <code>Watcher</code> \u5C06\u4F1A\u88AB\u53E6\u4E00\u4E2A Vue \u4E2D\u7684 <code>$obj</code> \u5C5E\u6027\u6536\u96C6</p><p>\u4E0D\u5F97\u4E0D\u8BF4\u8FD9\u6CE2\u64CD\u4F5C\u6709\u70B9\u9A9A\uFF5E</p><h2 id="getter\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#getter\u5B9E\u73B0" aria-hidden="true">#</a> getter\u5B9E\u73B0</h2><p><strong><code>getters</code> \u5219\u662F\u501F\u52A9 Vue \u7684\u8BA1\u7B97\u5C5E\u6027 <code>computed</code> \u6765\u5B9E\u73B0\u7684</strong></p><p>\u5148\u56DE\u987E\u4E00\u4E0B <code>getters</code> \u7684\u7528\u6CD5: <code>{ key: fn }</code></p><p>\u7136\u540E\u5148\u770B\u8FD9\u6BB5\u4EE3\u7801\u903B\u8F91\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> computed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">forEachValue</span><span class="token punctuation">(</span>wrappedGetters<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// use computed to leverage its lazy-caching mechanism</span>
  <span class="token comment">// direct inline function use will lead to closure preserving oldVm.</span>
  <span class="token comment">// using partial to return function with only arguments preserved in closure environment.</span>
  computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> store<span class="token punctuation">.</span>_vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// for local getters</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u4F5C\u7528\u5C31\u662F\u904D\u5386 <code>wrappedGetters</code> \u751F\u6210\u4E00\u4E2A <code>compunted</code> \u7684\u683C\u5F0F\uFF0C\u5148\u770B\u4E0B <code>wrappedGetters</code> \u600E\u4E48\u6765\u7684</p><p>\u4E0B\u9762\u662F\u8DDF <code>wrappedGetters</code> \u6709\u5173\u7CFB\u7684\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">function</span> <span class="token function">registerGetter</span> <span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> type<span class="token punctuation">,</span> rawGetter<span class="token punctuation">,</span> local</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>_wrappedGetters<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;[vuex] duplicate getter key: &quot;</span> <span class="token operator">+</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    store<span class="token punctuation">.</span>_wrappedGetters<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">wrappedGetter</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">rawGetter</span><span class="token punctuation">(</span>
        local<span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token comment">// local state</span>
        local<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> <span class="token comment">// local getters</span>
        store<span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token comment">// root state</span>
        store<span class="token punctuation">.</span>getters <span class="token comment">// root getters</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  module<span class="token punctuation">.</span><span class="token function">forEachGetter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">getter<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> namespacedType <span class="token operator">=</span> namespace <span class="token operator">+</span> key<span class="token punctuation">;</span>
    <span class="token function">registerGetter</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> namespacedType<span class="token punctuation">,</span> getter<span class="token punctuation">,</span> local<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Module</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">forEachGetter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">forEachGetter</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_rawModule<span class="token punctuation">.</span>getters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">forEachValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_rawModule<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">forEachValue</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u5206\u6790\uFF1A</p><ol><li><p>\u9996\u5148 <code>Module</code> \u539F\u578B\u4E0A\u5B9A\u4E49\u4E86\u4E00\u4E2A <code>forEachGetter</code> \u65B9\u6CD5\uFF0C\u5B83\u63A5\u53D7\u4E00\u4E2A\u53C2\u6570 <code>fn</code>\uFF0C\u51FD\u6570\u4E3B\u4F53\u4E2D\u7684 <code>this._rawModule.getters</code> \u5C31\u662F\u6211\u4EEC\u5728 Vuex \u5B9A\u4E49\u7684 <code>getters</code></p></li><li><p>\u7136\u540E\u770B <code>module.forEachGetter</code> \u7684\u8C03\u7528\uFF0C\u6B64\u65F6\u4F20\u5165\u4E86\u4E00\u4E2A\u51FD\u6570 <code>fn</code>\uFF0C<code>forEachGetter</code> \u5185\u90E8\u6267\u884C <code>forEachValue</code> \u904D\u5386\u6211\u4EEC\u7684 <code>this._rawModule.getters(getters)</code>\uFF0C\u5BF9\u4E8E\u6BCF\u4E00\u4E2A <code>getters</code> \u9879\u90FD\u4F1A\u6267\u884C\u4F20\u5165\u7684 <code>fn</code> \u51FD\u6570\uFF0C\u6267\u884C <code>fn</code> \u65F6\u4F20\u5165\u4E24\u4E2A\u53C2\u6570\uFF1A\u7B2C\u4E00\u4E2A\u662F <code>getters</code> \u5BF9\u5E94\u7684\u8BA1\u7B97\u51FD\u6570\uFF1B\u7B2C\u4E8C\u53C2\u6570\u5BF9\u5E94 <code>getters</code> \u7684 <code>key</code></p></li><li><p>\u56DE\u5230\u8FD9\u4E2A <code>fn</code> \u65B9\u6CD5\u672C\u8EAB\uFF0C\u91CD\u70B9\u5C31\u662F\u6267\u884C <code>registerGetter(store, namespacedType, getter, local);</code>\uFF0C\u5B83\u7684\u529F\u80FD\u5C31\u662F\u91CD\u65B0\u6253\u5305\u4E86 <code>getters</code>\uFF0C\u4ECD\u662F\u5DF2 <code>{key: fn}</code> \u7684\u683C\u5F0F\u5C06\u5F53\u524D <code>getters</code> \u65B9\u6CD5\u4FDD\u5B58\u5230 <code>store._wrappedGetters</code> \u5BF9\u8C61\u4E2D\u3002\u53EA\u662F\u8FD9\u65F6\u7684 <code>getters-key</code> \u52A0\u4E86\u547D\u540D\u7A7A\u95F4\uFF0C <code>getters-\u8BA1\u7B97\u65B9\u6CD5</code> \u91CD\u65B0\u6253\u5305\u540E\u6CE8\u5165\u4E86 <code>local.state</code>\u3001<code>local.getters</code>\u3001<code>store.state</code>\u3001<code>store.getters</code> \u56DB\u4E2A\u53C2\u6570\uFF0C\u6211\u4EEC\u5728\u4F7F\u7528 <code>getters</code> \u53EF\u4EE5\u8BBF\u95EE\u5230\u7684\u56DB\u4E2A\u53C2\u6570\u5C31\u662F\u4ECE\u8FD9\u91CC\u6765\u7684</p></li></ol><h3 id="\u521B\u5EFA-computed" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA-computed" aria-hidden="true">#</a> \u521B\u5EFA computed</h3><p>\u4E0A\u9762\u660E\u767D\u4E86 <code>wrappedGetters</code> \u7684\u7531\u6765\uFF0C\u56DE\u5230\u521B\u5EFA <code>computed</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> computed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">forEachValue</span><span class="token punctuation">(</span>wrappedGetters<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// use computed to leverage its lazy-caching mechanism</span>
  <span class="token comment">// direct inline function use will lead to closure preserving oldVm.</span>
  <span class="token comment">// using partial to return function with only arguments preserved in closure environment.</span>
  computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> store<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> store<span class="token punctuation">.</span>_vm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// for local getters</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
* forEach for object
*/</span>
<span class="token keyword">function</span> <span class="token function">forEachValue</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// partial</span>
<span class="token keyword">function</span> <span class="token function">partial</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u636E\u4EE3\u7801\u53EF\u4EE5\u770B\u5230\u4E5F\u662F\u4F7F\u7528 <code>forEachValue</code> \u904D\u5386 <code>wrappedGetters</code> \u7ED9 <code>computed</code> \u8D4B\u503C\u7684\uFF0C<code>forEachValue</code> \u7684\u4F5C\u7528\u5C31\u662F\u904D\u5386 <code>wrappedGetters</code>\uFF0C\u7136\u540E\u6267\u884C\u4F20\u5165\u7684\u51FD\u6570\u53C2\u6570</p><p>\u6267\u884C\u53C2\u6570\u51FD\u6570\u65F6\u7B2C\u4E00\u4E2A\u53C2\u6570 <code>fn</code> \u5C31\u662F\u6BCF\u4E2A <code>getter</code> \u7684\u8BA1\u7B97\u51FD\u6570\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5C31\u662F <code>getter</code> \u7684 <code>key</code>\uFF0C\u5185\u90E8\u5C31\u662F\u901A\u8FC7 <code>computed[key] = partial(fn, store)</code> \u7ED9 <code>computed</code> \u6DFB\u52A0\u5C5E\u6027\uFF0C\u901A\u8FC7 <code>partial(fn, store)</code> \u518D\u6B21\u6253\u5305 <code>getter</code> \u7684\u8BA1\u7B97\u51FD\u6570\uFF0C\u5E76\u628A <code>store</code> \u53C2\u6570\u4F20\u5165\uFF0C\u4E5F\u5C31\u662F\u5BF9\u5E94\u4E0A\u6587 <code>wrappedGetter</code> \u4E2D\u7684 <code>store</code> \u53C2\u6570</p><p>\u7136\u540E\u4F7F\u7528 <code>Object.defineProperty</code> \u5C06 <code>store.getters</code> \u5C5E\u6027\u7684\u8BBF\u95EE\u4EE3\u7406\u5230 <code>store._vm</code> \u4E2D</p><p>\u7136\u540E\u5728\u5B9E\u4F8B Vue \u65F6\uFF0C\u5C06\u4E0A\u9762\u7684 <code>computed</code> \u4F20\u5165\u4F7F\u7528</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  store<span class="token punctuation">.</span>_vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$$state</span><span class="token operator">:</span> state
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> computed
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u603B\u7684\u6765\u8BF4 Vue \u4E2D\u7684 <code>computed</code> \u5305\u542B\u4E86\u6211\u4EEC\u7684 <code>getters</code></p><p>\u5F53\u6211\u4EEC\u76F4\u63A5\u4F7F\u7528 <code>store._vm[nameapce+key]</code> \u8BBF\u95EE <code>getters</code> \u65F6\uFF0C\u4F1A\u4ECE<code>store._vm[nameapce+key]</code> \u627E\uFF0C<code>store._vm</code> \u5C31\u662F Vue \u5B9E\u4F8B\uFF0C\u4E5F\u662F\u4F1A\u4ECE <code>computed[nameapce+key]</code> \u4E2D\u53BB\u627E</p><p>\u6240\u4EE5\u5F53\u6211\u4EEC\u901A\u8FC7 <code>store.getters[nameapce+key]</code> \u53BB\u627E <code>getters</code> \u65F6\uFF0C\u4E4B\u540E\u7531\u4E0A</p><h2 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a" aria-hidden="true">#</a> Q&amp;A</h2><p><strong>\u4E3A\u4EC0\u4E48 MUTATION \u53EA\u80FD\u662F\u540C\u6B65\u7684\uFF1F</strong></p><ol><li><p>\u4E3A\u4E86 devtool \u5FEB\u7167\u53EF\u4EE5\u66F4\u6B63\u786E\u5F97\u8BB0\u5F55\u72B6\u6001\u7684\u53D8\u5316</p></li><li><p>\u5F02\u6B65\u64CD\u4F5C\u662F\u6210\u529F\u8FD8\u662F\u5931\u8D25\u662F\u4E0D\u53EF\u9884\u6D4B\u7684\uFF0C\u4F1A\u4EA7\u751F\u526F\u4F5C\u7528</p></li></ol>`,41),o=[p];function c(u,l){return s(),a("div",null,o)}var r=n(e,[["render",c],["__file","Vuex.html.vue"]]);export{r as default};
