import{_ as p,o as t,c as e,b as n,a as o,d as s,e as c,r as i}from"./app.62075c25.js";const l={},u=s(`<h1 id="\u5431\u4E0D\u5431" tabindex="-1"><a class="header-anchor" href="#\u5431\u4E0D\u5431" aria-hidden="true">#</a> \u5431\u4E0D\u5431</h1><h2 id="node\u5F00\u53D1\u6CE8\u610F\u70B9" tabindex="-1"><a class="header-anchor" href="#node\u5F00\u53D1\u6CE8\u610F\u70B9" aria-hidden="true">#</a> Node\u5F00\u53D1\u6CE8\u610F\u70B9</h2><h3 id="\u907F\u514D\u963B\u585E" tabindex="-1"><a class="header-anchor" href="#\u907F\u514D\u963B\u585E" aria-hidden="true">#</a> \u907F\u514D\u963B\u585E</h3><p>\u5728 Node.js \u4E2D\uFF0C\u6709\u4E24\u79CD\u7C7B\u578B\u7684\u7EBF\u7A0B\uFF1A\u4E00\u4E2A\u4E8B\u4EF6\u5FAA\u73AF\u7EBF\u7A0B\uFF08\u4E5F\u88AB\u79F0\u4E3A\u4E3B\u5FAA\u73AF\uFF0C\u4E3B\u7EBF\u7A0B\uFF0C\u4E8B\u4EF6\u7EBF\u7A0B\u7B49\uFF09\u3002\u53E6\u5916\u4E00\u4E2A\u662F\u5728\u5DE5\u4F5C\u7EBF\u7A0B\u6C60\u91CC\u7684 k \u4E2A\u5DE5\u4F5C\u7EBF\u7A0B\uFF08\u4E5F\u88AB\u79F0\u4E3A\u7EBF\u7A0B\u6C60\uFF09\u3002</p><p><strong>\u54EA\u79CD\u4EE3\u7801\u8FD0\u884C\u5728\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u4E0A?</strong></p><p>\u5F53 Node.js \u7A0B\u5E8F\u8FD0\u884C\u65F6\uFF0C\u7A0B\u5E8F\u9996\u5148\u5B8C\u6210\u521D\u59CB\u5316\u90E8\u5206\uFF0C\u5373\u5904\u7406 require \u52A0\u8F7D\u7684\u6A21\u5757\u548C\u6CE8\u518C\u4E8B\u4EF6\u56DE\u8C03\u3002 \u7136\u540E\uFF0CNode.js \u5E94\u7528\u7A0B\u5E8F\u8FDB\u5165\u4E8B\u4EF6\u5FAA\u73AF\u9636\u6BB5\uFF0C\u901A\u8FC7\u6267\u884C\u5BF9\u5E94\u56DE\u8C03\u51FD\u6570\u6765\u5BF9\u5BA2\u6237\u7AEF\u8BF7\u6C42\u505A\u51FA\u56DE\u5E94\u3002 \u6B64\u56DE\u8C03\u5C06\u540C\u6B65\u6267\u884C\uFF0C\u5E76\u4E14\u53EF\u80FD\u5728\u5B8C\u6210\u4E4B\u540E\u7EE7\u7EED\u6CE8\u518C\u65B0\u7684\u5F02\u6B65\u8BF7\u6C42\u3002 \u8FD9\u4E9B\u5F02\u6B65\u8BF7\u6C42\u7684\u56DE\u8C03\u4E5F\u4F1A\u5728\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u4E2D\u88AB\u5904\u7406\u3002</p><p>\u4E8B\u4EF6\u5FAA\u73AF\u4E2D\u540C\u6837\u4E5F\u5305\u542B\u5F88\u591A\u975E\u963B\u585E\u5F02\u6B65\u8BF7\u6C42\u7684\u56DE\u8C03\uFF0C\u5982\u7F51\u7EDC I/O\u3002</p><p>\u603B\u4F53\u6765\u8BF4\uFF0C\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u6267\u884C\u4E8B\u4EF6\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u5E76\u4E14\u8D1F\u8D23\u5BF9\u5904\u7406\u7C7B\u4F3C\u7F51\u7EDC I/O \u7684\u975E\u963B\u585E\u5F02\u6B65\u8BF7\u6C42</p><p><strong>\u54EA\u79CD\u4EE3\u7801\u8FD0\u884C\u5728\u5DE5\u4F5C\u7EBF\u7A0B\u6C60?</strong></p><p>Node.js \u4F7F\u7528\u5DE5\u4F5C\u7EBF\u7A0B\u6C60\u6765\u5904\u7406\u201C\u9AD8\u6210\u672C\u201D\u7684\u4EFB\u52A1\u3002 \u8FD9\u5305\u62EC\u4E00\u4E9B\u64CD\u4F5C\u7CFB\u7EDF\u5E76\u6CA1\u6709\u63D0\u4F9B\u975E\u963B\u585E\u7248\u672C\u7684 I/O \u64CD\u4F5C\uFF0C\u4EE5\u53CA\u4E00\u4E9B CPU \u5BC6\u96C6\u578B\u7684\u4EFB\u52A1\u3002</p><p>Node.js \u6A21\u5757\u4E2D\u6709\u5982\u4E0B\u8FD9\u4E9B API \u7528\u5230\u4E86\u5DE5\u4F5C\u7EBF\u7A0B\u6C60\uFF1A</p><ul><li><p>I/O \u5BC6\u96C6\u578B\u4EFB\u52A1\uFF1A</p><p>-DNS\uFF1Adns.lookup()\uFF0Cdns.lookupService()\u3002</p><ul><li>\u6587\u4EF6\u7CFB\u7EDF\uFF1A\u6240\u6709\u7684\u6587\u4EF6\u7CFB\u7EDF API\u3002\u9664 fs.FSWatcher() \u548C\u90A3\u4E9B\u663E\u5F0F\u540C\u6B65\u8C03\u7528\u7684 API \u4E4B\u5916\uFF0C\u90FD\u4F7F\u7528 libuv \u7684\u7EBF\u7A0B\u6C60\u3002</li></ul></li><li><p>CPU \u5BC6\u96C6\u578B\u4EFB\u52A1\uFF1A</p><ul><li><p>Crypto\uFF1Acrypto.pbkdf2()\u3001crypto.scrypt()\u3001crypto.randomBytes()\u3001crypto.randomFill()\u3001crypto.generateKeyPair()\u3002</p></li><li><p>Zlib\uFF1A\u6240\u6709 Zlib \u76F8\u5173\u51FD\u6570\uFF0C\u9664\u90A3\u4E9B\u663E\u5F0F\u540C\u6B65\u8C03\u7528\u7684 API \u4E4B\u5916\uFF0C\u90FD\u9002\u7528 libuv \u7684\u7EBF\u7A0B\u6C60</p></li></ul></li></ul><p>\u867D\u7136\u6709 Node \u6709\u7EBF\u7A0B\u6C60\u52A0\u6301\u63D0\u9AD8 I/O \u64CD\u4F5C\u7684\u6027\u80FD\uFF0C\u4F46\u662F\u4ECD\u7136\u53EA\u4E00\u4E2A\u4E3B\u7EBF\u7A0B\uFF08\u4E8B\u4EF6\u5FAA\u73AF\u7EBF\u7A0B\uFF09\u6765\u7EDF\u4E00\u6267\u884C\u56DE\u8C03\u3002\u6240\u4EE5\u5982\u679C\u4E3B\u7EBF\u7A0B\u5728\u5904\u7406\u67D0\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BF7\u6C42\u65F6\u6216\u56DE\u8C03\u65F6\u88AB\u963B\u585E\u4E86\uFF0C\u5B83\u5C31\u65E0\u6CD5\u5904\u7406\u5176\u5B83\u5BA2\u6237\u7AEF\u7684\u8BF7\u6C42\u4E86\u3002\u56E0\u4E3A<strong>\u4E0D\u8981\u963B\u585E\u4F60\u7684\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B</strong></p><h4 id="\u4E0D\u8981\u963B\u585E\u4F60\u7684\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u8981\u963B\u585E\u4F60\u7684\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B" aria-hidden="true">#</a> \u4E0D\u8981\u963B\u585E\u4F60\u7684\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B</h4><p>\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u5173\u6CE8\u7740\u6BCF\u4E2A\u65B0\u7684\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0C\u534F\u8C03\u4EA7\u751F\u4E00\u4E2A\u56DE\u5E94\u3002 \u6240\u6709\u8FD9\u4E9B\u8FDB\u5165\u7684\u8BF7\u6C42\u548C\u8F93\u51FA\u7684\u5E94\u7B54\u90FD\u8981\u901A\u8FC7\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u3002 \u8FD9\u610F\u5473\u7740\u5982\u679C\u4F60\u7684\u4E8B\u4EF6\u8F6E\u8BE2\u7EBF\u7A0B\u5728\u67D0\u4E2A\u5730\u65B9\u82B1\u8D39\u592A\u591A\u7684\u65F6\u95F4\uFF0C\u6240\u6709\u5F53\u524D\u548C\u672A\u6765\u65B0\u7684\u5BA2\u6237\u7AEF\u8BF7\u6C42\u90FD\u5F97\u4E0D\u5230\u5904\u7406\u673A\u4F1A\u4E86</p><p><strong>\u907F\u514D\u53D1\u751F\u7684\u963B\u585E\u7684\u57FA\u672C\u539F\u5219\u5C31\u662F\uFF1A\u5C3D\u91CF\u4E0D\u8981\u4EA7\u751F\u590D\u6742\u7684\u8BA1\u7B97\u6216\u5FAA\u73AF</strong>\uFF0C\u6BD4\u5982\u4E0B\u9762\u793A\u4F8B\u968F\u7740 <code>n</code> \u7684\u589E\u5927\uFF0C\u8FD0\u884C\u65F6\u95F4\u4E5F\u4F1A\u8D8A\u4E45</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
<span class="token keyword">let</span> avg <span class="token operator">=</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;avg: &#39;</span> <span class="token operator">+</span> avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u65E0\u907F\u514D\u8017\u65F6\u8BA1\u7B97\u4F7F\u7528\u7684\u65F6\u5019\u53EF\u4EE5\u4F7F\u7528\u4E00\u4E9B\u7684\u4F18\u5316\u624B\u6BB5\uFF1A</p><p><strong>\u4EFB\u52A1\u62C6\u5206</strong></p><p>\u53EF\u4EE5\u628A\u4F60\u7684\u590D\u6742\u8BA1\u7B97\u62C6\u5206\u5F00\uFF0C\u7136\u540E\u8BA9\u6BCF\u4E2A\u8BA1\u7B97\u5206\u522B\u8FD0\u884C\u5728\u4E8B\u4EF6\u5FAA\u73AF\u4E2D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">asyncAvg</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> avgCB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Save ongoing sum in JS closure.</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">help</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &quot;Asynchronous recursion&quot;.</span>
    <span class="token comment">// Schedule next operation asynchronously.</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token function">help</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Start the helper, with CB to call avgCB.</span>
  <span class="token function">help</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> avg <span class="token operator">=</span> sum<span class="token operator">/</span>n<span class="token punctuation">;</span>
      <span class="token function">avgCB</span><span class="token punctuation">(</span>avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">asyncAvg</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">avg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;avg of 1-n: &#39;</span> <span class="token operator">+</span> avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u79CD\u65B9\u6848\u7684\u7F3A\u70B9\u662F\uFF1A\u5F53\u524D\u7EBF\u7A0B\u90FD\u5C06\u589E\u52A0\u7A7A\u95F4\u548C\u65F6\u95F4\u5F00\u9500</p><p><strong>\u4EFB\u52A1\u5206\u6D41</strong></p><ul><li><p>\u901A\u8FC7\u5F00\u53D1 C++ \u63D2\u4EF6 \u7684\u65B9\u5F0F\u4F7F\u7528\u5185\u7F6E\u7684 Node.js \u5DE5\u4F5C\u6C60\u3002\u4F7F\u7528 N-API\u3002 node-webworker-threads \u63D0\u4F9B\u4E86\u4E00\u4E2A\u4EC5\u7528 JavaScript \u5C31\u53EF\u4EE5\u8BBF\u95EE Node.js \u7684\u5DE5\u4F5C\u6C60\u7684\u65B9\u5F0F</p></li><li><p>\u4F7F\u7528 <code>Child Process</code> \u5C06\u5206\u914D\u4E00\u4E2A\u8FDB\u7A0B\u6267\u884C\u4EFB\u52A1\uFF0C\u4E4B\u540E\u901A\u4FE1\u8FDB\u7A0B\u901A\u4FE1\u83B7\u53D6\u7ED3\u679C</p></li></ul><p>\u8FD9\u7C7B\u65B9\u6CD5\u7684\u7F3A\u70B9\u662F\u5B83\u589E\u5927\u4E86\u901A\u4FE1\u5F00\u9500</p><h4 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h4><p>Node.js \u64C5\u957F\u4E8E I/O \u5BC6\u96C6\u578B\u4EFB\u52A1\uFF0C\u4F46\u5BF9\u4E8E\u6602\u8D35\u7684\u8BA1\u7B97\uFF0C\u5B83\u53EF\u80FD\u4E0D\u662F\u6700\u597D\u7684\u9009\u62E9</p>`,27),r={href:"https://nodejs.org/zh-cn/docs/guides/dont-block-the-event-loop/",target:"_blank",rel:"noopener noreferrer"},d=c("\u4E0D\u8981\u963B\u585E\u4F60\u7684\u4E8B\u4EF6\u5FAA\u73AF\uFF08\u6216\u662F\u5DE5\u4F5C\u7EBF\u7A0B\u6C60\uFF09"),k=s(`<h3 id="\u9519\u8BEF\u6355\u83B7" tabindex="-1"><a class="header-anchor" href="#\u9519\u8BEF\u6355\u83B7" aria-hidden="true">#</a> \u9519\u8BEF\u6355\u83B7</h3><p><strong>\u4E0E\u666E\u901A\u9875\u9762\u5F00\u53D1\u7684\u533A\u522B</strong></p><p>\u5F00\u53D1\u9875\u9762\u65F6\uFF0C\u6BCF\u4E00\u4E2A\u7528\u6237\u7684\u6D4F\u89C8\u5668\u4E0A\u90FD\u6709\u4E00\u4EFDJS\u4EE3\u7801\u3002\u5982\u679C\u4EE3\u7801\u5728\u67D0\u79CD\u60C5\u51B5\u4E0B\u5D29\u4E86\uFF0C\u53EA\u4F1A\u5BF9\u5F53\u524D\u7528\u6237\u4EA7\u751F\u5F71\u54CD\uFF0C\u5E76\u4E0D\u4F1A\u5F71\u54CD\u5176\u4ED6\u7528\u6237\uFF0C\u7528\u6237\u5237\u65B0\u4E00\u4E0B\u5373\u53EF\u6062\u590D\u3002\u800C\u5728Node.js\u4E2D\uFF0C\u5728\u4E0D\u5F00\u542F\u591A\u8FDB\u7A0B\u7684\u60C5\u51B5\u4E0B\uFF0C\u6240\u6709\u7528\u6237\u7684\u8BF7\u6C42\uFF0C\u90FD\u4F1A\u8D70\u8FDB\u540C\u4E00\u4EFDJS\u4EE3\u7801\uFF0C\u5E76\u4E14\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u5728\u6267\u884C\u8FD9\u4EFDJS\u4EE3\u7801\u3002\u5982\u679C\u67D0\u4E2A\u7528\u6237\u7684\u8BF7\u6C42\uFF0C\u5BFC\u81F4\u53D1\u751F\u9519\u8BEF\uFF0CNode.js\u8FDB\u7A0B\u6302\u6389\uFF0Cserver\u7AEF\u76F4\u63A5\u5C31\u6302\u4E86\u3002\u5C3D\u7BA1\u53EF\u80FD\u6709\u8FDB\u7A0B\u5B88\u62A4\uFF0C\u6302\u6389\u7684\u8FDB\u7A0B\u4F1A\u88AB\u91CD\u542F\uFF0C\u4F46\u662F\u5728\u7528\u6237\u8BF7\u6C42\u91CF\u5927\u7684\u60C5\u51B5\u4E0B\uFF0C\u9519\u8BEF\u4F1A\u88AB\u9891\u7E41\u89E6\u53D1\uFF0C\u53EF\u80FD\u5C31\u4F1A\u51FA\u73B0server\u7AEF\u4E0D\u505C\u6302\u6389\uFF0C\u4E0D\u505C\u91CD\u542F\u7684\u60C5\u51B5\uFF0C\u5BF9\u7528\u6237\u4F53\u9A8C\u9020\u6210\u5F71\u54CD</p><p>\u56E0\u6B64<strong>server\u7AEF\u7684\u76EE\u6807\uFF0C\u5C31\u662F\u8981 \u5FEB\u901F\u3001\u53EF\u9760 \u5730\u8FD4\u56DE\u6570\u636E</strong></p><p><strong>\u9519\u8BEF\u6355\u83B7</strong></p><p>\u9664\u4E86\u4F7F\u7528 <code>try...catch</code>\uFF0C \u8FD8\u53EF\u4EE5\u4F7F\u7528 <code>process</code> \u6765\u6355\u83B7\u5168\u5C40\u9519\u8BEF\uFF0C\u9632\u6B62\u8FDB\u7A0B\u76F4\u63A5\u9000\u51FA\uFF0C\u5BFC\u81F4\u540E\u9762\u7684\u8BF7\u6C42\u6302\u6389\u3002\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;uncaughtException&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token punctuation">.</span>stack<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;unhandledRejection&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reason<span class="token punctuation">,</span> p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Unhandled Rejection at: Promise </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>p<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> reason: </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>uncaughtException\uFF1A\u662F\u5982\u679C\u7A0B\u5E8F\u4E2D\u6CA1\u6709\u6B63\u5E38\u5904\u7406\u5230\u9519\u8BEF\uFF0C\u901A\u8FC7\u76D1\u542C <code>process.on(\u2018uncaughtException\u2019)</code> \u6765\u6355\u6349\u9519\u8BEF</p></li><li><p>unhandledRejection\uFF1A\u5728Node\u4E2D\uFF0CPromise\u4E2D\u7684\u9519\u8BEF\u540C\u6837\u4E0D\u80FD\u88AB <code>try...catch</code> \u548C <code>uncaughtException</code> \u6355\u83B7\u3002\u8FD9\u65F6\u5019\u6211\u4EEC\u5C31\u9700\u8981 <code>unhandledRejection</code> \u6765\u5E2E\u6211\u4EEC\u6355\u83B7\u8FD9\u90E8\u5206\u9519\u8BEF\u3002</p></li></ul><h2 id="\u5728node\u4E0A\u5904\u7406options\u8BF7\u6C42" tabindex="-1"><a class="header-anchor" href="#\u5728node\u4E0A\u5904\u7406options\u8BF7\u6C42" aria-hidden="true">#</a> \u5728node\u4E0A\u5904\u7406OPTIONS\u8BF7\u6C42</h2><p>\u5B66\u4E60 cors \u8DE8\u57DF\u95EE\u9898\u79CD\uFF0C\u975E\u7B80\u5355\u8BF7\u6C42\u65F6\uFF0C\u6D4F\u89C8\u5668\u4F1A\u53D1\u9001\u4E00\u4E2A\u9884\u8BF7\u6C42\u8BE2\u95EE\u670D\u52A1\u7AEF\uFF0C\u80FD\u5426\u901A\u8FC7\u540C\u6E90\u7B56\u7565\u68C0\u67E5\uFF0C\u8FD9\u4E2A\u9884\u8BF7\u6C42\u662F OPTIONS \u7C7B\u578B\u7684\u3002 \u5728\u4F7F\u7528\u539F\u751Fnode\u6784\u5EFA\u7684\u670D\u52A1\u4E2D\uFF0C\u9700\u8981\u5BF9 OPTIONS \u8BF7\u6C42\u65B9\u6CD5\u8FDB\u884C\u5904\u7406</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;OPTIONS&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;Access-Control-Allow-Origin&#39;</span><span class="token operator">:</span> <span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json;charset=utf-8&#39;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&#39;Access-Control-Allow-Origin&#39;</span><span class="token operator">:</span> <span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;hello node&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\u3002\u5728\u5904\u7406 <code>OPTIONS</code> \u8BF7\u6C42\u65F6\uFF0C\u4E5F\u9700\u8981\u8BBE\u7F6E\u5934\u90E8\u7684 <code>Access-Control-Allow-Origin</code> \u5C5E\u6027\uFF0C\u6D4F\u89C8\u5668\u4E5F\u4F1A\u5BF9 <code>OPTIONS</code> \u8BF7\u6C42\u8FDB\u884C\u540C\u6E90\u7B56\u7565\u68C0\u67E5\u3002\u76F8\u5E94\u7684 <code>Access-Control-Allow-Headers</code> \u4E5F\u9700\u8981\u8BBE\u7F6E\u975E\u7B80\u5355\u8BF7\u6C42\u7684\u5934\u90E8\u5B57\u6BB5\u3002</p><h2 id="\u4EC0\u4E48\u662F\u9519\u8BEF\u4F18\u5148\u7684\u56DE\u8C03\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u9519\u8BEF\u4F18\u5148\u7684\u56DE\u8C03\u51FD\u6570" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u9519\u8BEF\u4F18\u5148\u7684\u56DE\u8C03\u51FD\u6570\uFF1F</h2><p>\u9519\u8BEF\u4F18\u5148\u7684\u56DE\u8C03\u51FD\u6570\u7528\u4E8E\u4F20\u9012\u9519\u8BEF\u548C\u6570\u636E\u3002\u7B2C\u4E00\u4E2A\u53C2\u6570\u59CB\u7EC8\u5E94\u8BE5\u662F\u4E00\u4E2A\u9519\u8BEF\u5BF9\u8C61\uFF0C \u7528\u4E8E\u68C0\u67E5\u7A0B\u5E8F\u662F\u5426\u53D1\u751F\u4E86\u9519\u8BEF\u3002\u5176\u4F59\u7684\u53C2\u6570\u7528\u4E8E\u4F20\u9012\u6570\u636E\u3002\u4F8B\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//handle the error</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// use the data object</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5982\u4F55\u907F\u514D\u56DE\u8C03\u5730\u72F1" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u907F\u514D\u56DE\u8C03\u5730\u72F1" aria-hidden="true">#</a> \u5982\u4F55\u907F\u514D\u56DE\u8C03\u5730\u72F1</h2><p>\u4F60\u53EF\u4EE5\u6709\u5982\u4E0B\u51E0\u4E2A\u65B9\u6CD5\uFF1A</p><ul><li><p>\u6A21\u5757\u5316\uFF1A\u5C06\u56DE\u8C03\u51FD\u6570\u5206\u5272\u4E3A\u72EC\u7ACB\u7684\u51FD\u6570</p></li><li><p>\u4F7F\u7528Promises</p></li><li><p>\u4F7F\u7528<code>yield</code></p></li></ul><h2 id="\u4EC0\u4E48\u662F\u5B64\u513F\u8FDB\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u5B64\u513F\u8FDB\u7A0B" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u5B64\u513F\u8FDB\u7A0B\uFF1F</h2><p>\u7236\u8FDB\u7A0B\u521B\u5EFA\u5B50\u8FDB\u7A0B\u4E4B\u540E\uFF0C\u7236\u8FDB\u7A0B\u9000\u51FA\u4E86\uFF0C\u4F46\u662F\u7236\u8FDB\u7A0B\u5BF9\u5E94\u7684\u4E00\u4E2A\u6216\u591A\u4E2A\u5B50\u8FDB\u7A0B<strong>\u8FD8\u5728\u8FD0\u884C</strong>\uFF0C\u8FD9\u4E9B\u5B50\u8FDB\u7A0B\u4F1A\u88AB\u7CFB\u7EDF\u7684 init \u8FDB\u7A0B\u6536\u517B\uFF0C\u5BF9\u5E94\u7684\u8FDB\u7A0B ppid \u4E3A 1\uFF0C\u8FD9\u5C31\u662F\u5B64\u513F\u8FDB\u7A0B\u3002\u901A\u8FC7\u4EE5\u4E0B\u4EE3\u7801\u793A\u4F8B\u8BF4\u660E\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// master.js</span>
<span class="token keyword">const</span> fork <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fork<span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;net&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&#39;worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;server&#39;</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;worker process created, pid: %s ppid: %s&#39;</span><span class="token punctuation">,</span> worker<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u521B\u5EFA\u5B50\u8FDB\u7A0B\u4E4B\u540E\uFF0C\u4E3B\u8FDB\u7A0B\u9000\u51FA\uFF0C\u6B64\u65F6\u521B\u5EFA\u7684 worker \u8FDB\u7A0B\u4F1A\u6210\u4E3A\u5B64\u513F\u8FDB\u7A0B</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// worker.js</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;I am worker, pid: &#39;</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>pid <span class="token operator">+</span> <span class="token string">&#39;, ppid: &#39;</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>ppid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8BB0\u5F55\u5F53\u524D\u5DE5\u4F5C\u8FDB\u7A0B pid \u53CA\u7236\u8FDB\u7A0B ppid</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> worker<span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> sendHandle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">&#39;server&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        worker <span class="token operator">=</span> sendHandle<span class="token punctuation">;</span>
        worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            server<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A7\u5236\u53F0\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u8F93\u51FA\u5F53\u524D\u5DE5\u4F5C\u8FDB\u7A0B pid \u548C \u7236\u8FDB\u7A0B ppid</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>worker process created<span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">32971</span> <span class="token literal-property property">ppid</span><span class="token operator">:</span> <span class="token number">32970</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7531\u4E8E\u5728 master.js \u91CC\u9000\u51FA\u4E86\u7236\u8FDB\u7A0B\uFF0C\u6D3B\u52A8\u76D1\u89C6\u5668\u6240\u663E\u793A\u7684\u4E5F\u5C31\u53EA\u6709\u5DE5\u4F5C\u8FDB\u7A0B</p><p><img src="https://ask.qcloudimg.com/http-save/yehe-3057196/2o9udya025.jpeg?imageView2/2/w/1620" alt=""></p><p>\u518D\u6B21\u9A8C\u8BC1\uFF0C\u6253\u5F00\u63A7\u5236\u53F0\u8C03\u7528\u63A5\u53E3\uFF0C\u53EF\u4EE5\u770B\u5230\u5DE5\u4F5C\u8FDB\u7A0B 32971 \u5BF9\u5E94\u7684 ppid \u4E3A 1\uFF08\u4E3A init \u8FDB\u7A0B\uFF09\uFF0C\u6B64\u65F6\u5DF2\u7ECF\u6210\u4E3A\u4E86\u5B64\u513F\u8FDB\u7A0B</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl http://127.0.0.1:3000
I am worker, pid: 32971, ppid: 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5F71\u54CD" tabindex="-1"><a class="header-anchor" href="#\u5F71\u54CD" aria-hidden="true">#</a> \u5F71\u54CD</h3><p>init\u8FDB\u7A0B\u5C31\u50CF\u6C11\u653F\u5C40, \u4E13\u95E8\u8D1F\u8D23\u5B64\u513F\u8FDB\u7A0B\u7684\u5584\u540E\u5DE5\u4F5C, \u6BCF\u5F53\u51FA\u73B0\u4E00\u4E2A\u5B64\u513F\u8FDB\u7A0B\u7684\u65F6\u5019,\u5185\u6838\u4F1A\u628A\u5B64\u513F\u8FDB\u7A0B\u7684\u7236\u8FDB\u7A0B\u8BBE\u7F6E\u4E3Ainit, \u800Cinit\u8FDB\u7A0B\u4F1A\u5FAA\u73AF\u5730wait()\u5B83\u5DF2\u7ECF\u9000\u51FA\u7684\u5B50\u8FDB\u7A0B,\u8FD9\u6837, \u5F53\u5B64\u513F\u8FDB\u7A0B\u7ED3\u675F\u4E4B\u540E, init\u8FDB\u7A0B\u4F1A\u5904\u7406\u5B83\u7684\u5584\u540E\u5DE5\u4F5C, \u56E0\u6B64\u5B64\u513F\u8FDB\u7A0B\u6CA1\u6709\u4EC0\u4E48\u5371\u5BB3</p><h2 id="\u4EC0\u4E48\u662F\u50F5\u5C38\u8FDB\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u50F5\u5C38\u8FDB\u7A0B" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u50F5\u5C38\u8FDB\u7A0B</h2><p>\u4E00\u4E2A\u8FDB\u7A0B\u4F7F\u7528fork\u521B\u5EFA\u5B50\u8FDB\u7A0B\uFF0C\u5982\u679C\u5B50\u8FDB\u7A0B\u9000\u51FA\uFF0C\u800C\u7236\u8FDB\u7A0B\u5E76\u6CA1\u6709\u8C03\u7528wait\u6216waitpid\u83B7\u53D6\u5B50\u8FDB\u7A0B\u7684\u72B6\u6001\u4FE1\u606F\uFF0C\u90A3\u4E48\u5B50\u8FDB\u7A0B\u7684\u8FDB\u7A0B\u63CF\u8FF0\u7B26\u4ECD\u7136\u4FDD\u5B58\u5728\u7CFB\u7EDF\u4E2D\u3002\u8FD9\u79CD\u8FDB\u7A0B\u79F0\u4E4B\u4E3A\u50F5\u6B7B\u8FDB\u7A0B\u3002\u4EFB\u4F55\u4E00\u4E2A\u5B50\u8FDB\u7A0B(init\u9664\u5916)\u5728 <code>exit()</code> \u4E4B\u540E\uFF0C\u5E76\u975E\u9A6C\u4E0A\u5C31\u6D88\u5931\u6389\uFF0C\u800C\u662F\u7559\u4E0B\u4E00\u4E2A\u79F0\u4E3A\u50F5\u5C38\u8FDB\u7A0B(Zombie)\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u7B49\u5F85\u7236\u8FDB\u7A0B\u5904\u7406\u3002\u4E00\u65E6\u6709\u5F88\u591A\u53EA\u5904\u7406\u5C11\u91CF\u4EFB\u52A1\u7684\u5B50\u8FDB\u7A0B\u5B8C\u6210\u4EFB\u52A1\u540E\u5C31\u9000\u51FA\uFF0C\u7136\u540E\u7236\u8FDB\u7A0B\u53C8\u4E0D\u7BA1\u5B50\u8FDB\u7A0B\u7684\u9000\u51FA\uFF0C\u7136\u540E\u5C31\u4F1A\u4EA7\u751F\u5F88\u591A\u7684\u50F5\u6B7B\u8FDB\u7A0B\uFF0C\u8FD9\u6837\u4F1A\u5BF9\u7A0B\u5E8F\u4EA7\u751F\u4E00\u5B9A\u7684\u5371\u5BB3</p><h3 id="\u5F71\u54CD-1" tabindex="-1"><a class="header-anchor" href="#\u5F71\u54CD-1" aria-hidden="true">#</a> \u5F71\u54CD</h3><p>\u5B50\u8FDB\u7A0B\u4FDD\u5B58\u7684\u4FE1\u606F(\u8FDB\u7A0B\u53F7\u3001\u9000\u51FA\u72B6\u6001\u3001\u8FD0\u884C\u65F6\u95F4\u7B49)\u4E0D\u4F1A\u91CA\u653E, \u8FDB\u7A0B\u53F7\u5C31\u4F1A\u4E00\u76F4\u88AB\u5360\u7528, \u7CFB\u7EDF\u80FD\u591F\u4F7F\u7528\u7684\u8FDB\u7A0B\u53F7\u662F\u6709\u9650\u7684,\u5982\u679C\u4EA7\u751F\u5927\u91CF\u7684\u50F5\u5C38\u8FDB\u7A0B, \u53EF\u80FD\u4F1A\u5BFC\u81F4\u7CFB\u7EDF\u4E0D\u80FD\u4EA7\u751F\u65B0\u7684\u8FDB\u7A0B</p><p>\u4E25\u683C\u6765\u8BF4, \u50F5\u5C38\u8FDB\u7A0B\u5E76\u4E0D\u662F\u95EE\u9898\u7684\u6839\u6E90, \u6839\u6E90\u662F\u4EA7\u751F\u5927\u91CF\u50F5\u5C38\u8FDB\u7A0B\u7684\u7236\u8FDB\u7A0B, \u662F\u7236\u8FDB\u7A0B\u6CA1\u6709\u5728\u5B50\u8FDB\u7A0B <code>exit()</code> \u4E4B\u540E\u8FDB\u884C\u5904\u7406.\u5982\u679C\u901A\u8FC7 kill \u53D1\u9001 SIGTERM \u4FE1\u53F7(kill -15 pid)\u6216\u8005 SIGKILL \u4FE1\u53F7(kill -9 pid)\u6740\u6B7B\u7236\u8FDB\u7A0B, \u5219\u8BE5\u7236\u8FDB\u7A0B\u4EA7\u751F\u7684\u50F5\u5C38\u8FDB\u7A0B\u5C31\u4F1A\u53D8\u6210\u5B64\u513F\u8FDB\u7A0B, \u8FD9\u4E9B\u5B64\u513F\u8FDB\u7A0B\u4F1A\u88AB init \u8FDB\u7A0B\u63A5\u7BA1, init \u8FDB\u7A0B\u91CA\u653E\u8FD9\u4E9B\u5B64\u513F\u8FDB\u7A0B\u5360\u7528\u7684\u7CFB\u7EDF\u8D44\u6E90</p><h2 id="ipc-\u901A\u4FE1" tabindex="-1"><a class="header-anchor" href="#ipc-\u901A\u4FE1" aria-hidden="true">#</a> IPC \u901A\u4FE1</h2><p>\u4EC0\u4E48\u662F IPC \u901A\u4FE1\uFF0C\u5982\u4F55\u5EFA\u7ACB IPC \u901A\u4FE1\uFF1F\u4EC0\u4E48\u573A\u666F\u4E0B\u9700\u8981\u7528\u5230 IPC \u901A\u4FE1\uFF1F</p><p>IPC (Inter-process communication) \uFF0C\u5373\u8FDB\u7A0B\u95F4\u901A\u4FE1\u6280\u672F\uFF0C\u7531\u4E8E\u6BCF\u4E2A\u8FDB\u7A0B\u521B\u5EFA\u4E4B\u540E\u90FD\u6709\u81EA\u5DF1\u7684\u72EC\u7ACB\u5730\u5740\u7A7A\u95F4\uFF0C\u5B9E\u73B0 IPC \u7684\u76EE\u7684\u5C31\u662F\u4E3A\u4E86\u8FDB\u7A0B\u4E4B\u95F4\u8D44\u6E90\u5171\u4EAB\u8BBF\u95EE\uFF0C\u5B9E\u73B0 IPC \u7684\u65B9\u5F0F\u6709\u591A\u79CD\uFF1A\u7BA1\u9053\u3001\u6D88\u606F\u961F\u5217\u3001\u4FE1\u53F7\u91CF\u3001Domain Socket\uFF0CNode.js \u901A\u8FC7 <code>pipe</code>\u6765\u5B9E\u73B0\u3002</p><p>\u770B\u4E00\u4E0B Demo\uFF0C\u672A\u4F7F\u7528 IPC \u7684\u60C5\u51B5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// pipe.js</span>
<span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>spawn<span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;worker.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> child<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4E3B\u8FDB\u7A0Bid3243 \u5B50\u8FDB\u7A0B3244</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// worker.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;I am worker, PID: &#39;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A7\u5236\u53F0\u6267\u884C <code>node pipe.js</code>\uFF0C\u8F93\u51FA\u4E3B\u8FDB\u7A0B id\u3001\u5B50\u8FDB\u7A0B id\uFF0C\u4F46\u662F\u5B50\u8FDB\u7A0B <code>worker.js</code> \u7684\u4FE1\u606F\u5E76\u6CA1\u6709\u5728\u63A7\u5236\u53F0\u6253\u5370\uFF0C\u539F\u56E0\u662F\u65B0\u521B\u5EFA\u7684\u5B50\u8FDB\u7A0B\u6709\u81EA\u5DF1\u7684 <code>stdio</code> \u6D41</p><p>\u521B\u5EFA\u4E00\u4E2A\u7236\u8FDB\u7A0B\u548C\u5B50\u8FDB\u7A0B\u4E4B\u95F4\u4F20\u9012\u6D88\u606F\u7684 IPC \u901A\u9053\u5B9E\u73B0\u8F93\u51FA\u4FE1\u606F</p><p>\u4FEE\u6539 <code>pipe.js</code> \u8BA9\u5B50\u8FDB\u7A0B\u7684 <code>stdio</code> \u548C\u5F53\u524D\u8FDB\u7A0B\u7684 <code>stdio</code> \u4E4B\u95F4\u5EFA\u7ACB\u7BA1\u9053\u94FE\u63A5\uFF0C\u8FD8\u53EF\u4EE5\u901A\u8FC7 <code>spawn()</code> \u65B9\u6CD5\u7684 <code>stdio</code> \u9009\u9879\u5EFA\u7ACB IPC \u673A\u5236\uFF0C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>spawn<span class="token punctuation">;</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;worker.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> child<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u518D\u6B21\u9A8C\u8BC1\uFF0C\u63A7\u5236\u53F0\u6267\u884C <code>node pipe.js</code>\uFF0C<code>worker.js</code> \u7684\u4FE1\u606F\u4E5F\u6253\u5370\u4E86\u51FA\u6765</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ 42473 42474
I am worker, PID:  42474
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5173\u4E8E\u7236\u8FDB\u7A0B\u4E0E\u5B50\u8FDB\u7A0B\u662F\u5982\u4F55\u901A\u4FE1\u7684" tabindex="-1"><a class="header-anchor" href="#\u5173\u4E8E\u7236\u8FDB\u7A0B\u4E0E\u5B50\u8FDB\u7A0B\u662F\u5982\u4F55\u901A\u4FE1\u7684" aria-hidden="true">#</a> \u5173\u4E8E\u7236\u8FDB\u7A0B\u4E0E\u5B50\u8FDB\u7A0B\u662F\u5982\u4F55\u901A\u4FE1\u7684</h3><p>\u7236\u8FDB\u7A0B\u5728\u521B\u5EFA\u5B50\u8FDB\u7A0B\u4E4B\u524D\u4F1A\u5148\u53BB\u521B\u5EFA IPC \u901A\u9053\u5E76\u4E00\u76F4\u76D1\u542C\u8BE5\u901A\u9053\uFF0C\u4E4B\u540E\u5F00\u59CB\u521B\u5EFA\u5B50\u8FDB\u7A0B\u5E76\u901A\u8FC7\u73AF\u5883\u53D8\u91CF\uFF08NODECHANNELFD\uFF09\u7684\u65B9\u5F0F\u5C06 IPC \u901A\u9053\u7684\u6587\u4EF6\u63CF\u8FF0\u7B26\u4F20\u9012\u7ED9\u5B50\u8FDB\u7A0B\uFF0C\u5B50\u8FDB\u7A0B\u542F\u52A8\u65F6\u6839\u636E\u4F20\u9012\u7684\u6587\u4EF6\u63CF\u8FF0\u7B26\u53BB\u94FE\u63A5 IPC \u901A\u9053\uFF0C\u4ECE\u800C\u5EFA\u7ACB\u7236\u5B50\u8FDB\u7A0B\u4E4B\u95F4\u7684\u901A\u4FE1\u673A\u5236</p><h2 id="node\u4E3A\u4EC0\u4E48\u662F\u5355\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#node\u4E3A\u4EC0\u4E48\u662F\u5355\u7EBF\u7A0B" aria-hidden="true">#</a> Node\u4E3A\u4EC0\u4E48\u662F\u5355\u7EBF\u7A0B</h2><p>Javascript \u4E3A\u4EC0\u4E48\u662F\u5355\u7EBF\u7A0B\uFF1F\u8FD9\u4E2A\u95EE\u9898\u9700\u8981\u4ECE\u6D4F\u89C8\u5668\u8BF4\u8D77\uFF0C\u5728\u6D4F\u89C8\u5668\u73AF\u5883\u4E2D\u5BF9\u4E8E DOM \u7684\u64CD\u4F5C\uFF0C\u8BD5\u60F3\u5982\u679C\u591A\u4E2A\u7EBF\u7A0B\u6765\u5BF9\u540C\u4E00\u4E2A DOM \u64CD\u4F5C\u662F\u4E0D\u662F\u5C31\u4E71\u4E86\u5462\uFF0C\u90A3\u4E5F\u5C31\u610F\u5473\u7740\u5BF9\u4E8EDOM\u7684\u64CD\u4F5C\u53EA\u80FD\u662F\u5355\u7EBF\u7A0B\uFF0C\u907F\u514D DOM \u6E32\u67D3\u51B2\u7A81\u3002\u5728\u6D4F\u89C8\u5668\u73AF\u5883\u4E2D UI \u6E32\u67D3\u7EBF\u7A0B\u548C JS \u6267\u884C\u5F15\u64CE\u662F\u4E92\u65A5\u7684\uFF0C\u4E00\u65B9\u5728\u6267\u884C\u65F6\u90FD\u4F1A\u5BFC\u81F4\u53E6\u4E00\u65B9\u88AB\u6302\u8D77\uFF0C\u8FD9\u662F\u7531 JS \u5F15\u64CE\u6240\u51B3\u5B9A\u7684</p><h2 id="\u5982\u4F55\u8BA9\u4E00\u4E2A-js-\u6587\u4EF6\u5728-linux-\u4E0B\u6210\u4E3A\u4E00\u4E2A\u53EF\u6267\u884C\u547D\u4EE4\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u8BA9\u4E00\u4E2A-js-\u6587\u4EF6\u5728-linux-\u4E0B\u6210\u4E3A\u4E00\u4E2A\u53EF\u6267\u884C\u547D\u4EE4\u7A0B\u5E8F" aria-hidden="true">#</a> \u5982\u4F55\u8BA9\u4E00\u4E2A js \u6587\u4EF6\u5728 Linux \u4E0B\u6210\u4E3A\u4E00\u4E2A\u53EF\u6267\u884C\u547D\u4EE4\u7A0B\u5E8F</h2><ol><li><p>\u65B0\u5EFA hello.js \u6587\u4EF6\uFF0C\u5934\u90E8\u987B\u52A0\u4E0A <code>#!/usr/bin/env node</code>\uFF0C\u8868\u793A\u5F53\u524D\u811A\u672C\u4F7F\u7528 Node.js \u8FDB\u884C\u89E3\u6790</p></li><li><p>\u8D4B\u4E88\u6587\u4EF6\u53EF\u6267\u884C\u6743\u9650 <code>chmod +x chmod +x /\${dir}/hello.js</code>\uFF0C\u76EE\u5F55\u81EA\u5B9A\u4E49</p></li><li><p>\u5728 <code>/usr/local/bin</code> \u76EE\u5F55\u4E0B\u521B\u5EFA\u4E00\u4E2A\u8F6F\u94FE\u6587\u4EF6 <code>sudo ln-s/\${dir}/hello.js/usr/local/bin/hello</code>\uFF0C\u6587\u4EF6\u540D\u5C31\u662F\u6211\u4EEC\u5728\u7EC8\u7AEF\u4F7F\u7528\u7684\u540D\u5B57</p></li><li><p>\u7EC8\u7AEF\u6267\u884C hello \u76F8\u5F53\u4E8E\u8F93\u5165 <code>node hello.js</code></p></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#!/usr/bin/env node

console.log(&#39;hello world!&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7EC8\u7AEF\u6D4B\u8BD5</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ hello
hello world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8FDB\u7A0B\u7684\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\u662F\u4EC0\u4E48-\u6709\u4EC0\u4E48\u4F5C\u7528" tabindex="-1"><a class="header-anchor" href="#\u8FDB\u7A0B\u7684\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\u662F\u4EC0\u4E48-\u6709\u4EC0\u4E48\u4F5C\u7528" aria-hidden="true">#</a> \u8FDB\u7A0B\u7684\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\u662F\u4EC0\u4E48? \u6709\u4EC0\u4E48\u4F5C\u7528?</h2><p>\u8FDB\u7A0B\u7684\u5F53\u524D\u5DE5\u4F5C\u76EE\u5F55\u53EF\u4EE5\u901A\u8FC7 <code>process.cwd()</code> \u547D\u4EE4\u83B7\u53D6\uFF0C\u9ED8\u8BA4\u4E3A\u5F53\u524D\u542F\u52A8\u7684\u76EE\u5F55\uFF0C\u5982\u679C\u662F\u521B\u5EFA\u5B50\u8FDB\u7A0B\u5219\u7EE7\u627F\u4E8E\u7236\u8FDB\u7A0B\u7684\u76EE\u5F55\uFF0C\u53EF\u901A\u8FC7 <code>process.chdir()</code> \u547D\u4EE4\u91CD\u7F6E\uFF0C\u4F8B\u5982\u901A\u8FC7 <code>spawn</code> \u547D\u4EE4\u521B\u5EFA\u7684\u5B50\u8FDB\u7A0B\u53EF\u4EE5\u6307\u5B9A <code>cwd</code> \u9009\u9879\u8BBE\u7F6E\u5B50\u8FDB\u7A0B\u7684\u5DE5\u4F5C\u76EE\u5F55\u3002</p><p>\u6709\u4EC0\u4E48\u4F5C\u7528\uFF1F\u4F8B\u5982\uFF0C\u901A\u8FC7 fs \u8BFB\u53D6\u6587\u4EF6\uFF0C\u5982\u679C\u8BBE\u7F6E\u4E3A\u76F8\u5BF9\u8DEF\u5F84\u5219\u76F8\u5BF9\u4E8E\u5F53\u524D\u8FDB\u7A0B\u542F\u52A8\u7684\u76EE\u5F55\u8FDB\u884C\u67E5\u627E\uFF0C\u6240\u4EE5\uFF0C\u542F\u52A8\u76EE\u5F55\u8BBE\u7F6E\u6709\u8BEF\u7684\u60C5\u51B5\u4E0B\u5C06\u65E0\u6CD5\u5F97\u5230\u6B63\u786E\u7684\u7ED3\u679C\u3002\u8FD8\u6709\u4E00\u79CD\u60C5\u51B5\u7A0B\u5E8F\u91CC\u5F15\u7528\u7B2C\u4E09\u65B9\u6A21\u5757\u4E5F\u662F\u6839\u636E\u5F53\u524D\u8FDB\u7A0B\u542F\u52A8\u7684\u76EE\u5F55\u6765\u8FDB\u884C\u67E5\u627E\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">&#39;/Users/may/Documents/test/&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6E\u5F53\u524D\u8FDB\u7A0B\u76EE\u5F55</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u83B7\u53D6\u5F53\u524D\u8FDB\u7A0B\u76EE\u5F55</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="console-log-\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65-\u5982\u4F55\u5B9E\u73B0\u4E00\u4E2A-console-log" tabindex="-1"><a class="header-anchor" href="#console-log-\u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65-\u5982\u4F55\u5B9E\u73B0\u4E00\u4E2A-console-log" aria-hidden="true">#</a> console.log \u662F\u540C\u6B65\u8FD8\u662F\u5F02\u6B65? \u5982\u4F55\u5B9E\u73B0\u4E00\u4E2A console.log\uFF1F</h3><p><code>console.log</code> \u5185\u90E8\u5B9E\u73B0\u662F <code>process.stdout</code>\uFF0C\u5C06\u8F93\u5165\u7684\u5185\u5BB9\u6253\u5370\u5230 stdout\uFF0C\u5F02\u6B65\u540C\u6B65\u53D6\u51B3\u4E8E stdout \u8FDE\u63A5\u7684\u6570\u636E\u6D41\u7684\u7C7B\u578B\uFF08\u9700\u8981\u5199\u5165\u7684\u4F4D\u7F6E\uFF09\u4EE5\u53CA\u4E0D\u540C\u7684\u64CD\u4F5C\u7CFB\u7EDF\u3002</p><ul><li><p>\u6587\u4EF6\uFF1A\u5728 Windows \u548C POSIX \u4E0A\u662F\u540C\u6B65\u7684\uFF1B</p></li><li><p>TTY\uFF08\u7EC8\u7AEF\uFF09\uFF1A\u5728 Windows \u4E0A\u662F\u5F02\u6B65\u7684\uFF0C\u5728 POSIX \u4E0A\u662F\u540C\u6B65\uFF1B</p></li><li><p>\u7BA1\u9053\uFF08\u548C socket\uFF09\uFF1A\u5728 Windows \u4E0A\u662F\u540C\u6B65\u7684\uFF0C\u5728 POSIX \u4E0A\u662F\u5F02\u6B65\u7684\uFF1B</p></li></ul><p>\u9020\u6210\u8FD9\u79CD\u5DEE\u5F02\u7684\u539F\u56E0\u662F\u56E0\u4E3A\u4E00\u4E9B\u5386\u53F2\u9057\u7559\u95EE\u9898\uFF0C\u4E0D\u8FC7\u8FD9\u4E2A\u95EE\u9898\u5E76\u4E0D\u4F1A\u5F71\u54CD\u6B63\u5E38\u7684\u8F93\u51FA\u7ED3\u679C\u3002</p>`,64);function v(m,h){const a=i("ExternalLinkIcon");return t(),e("div",null,[u,n("blockquote",null,[n("p",null,[n("a",r,[d,o(a)])])]),k])}var g=p(l,[["render",v],["__file","\u5431\u4E0D\u5431.html.vue"]]);export{g as default};
