(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{629:function(t,s,a){"use strict";a.r(s);var n=a(53),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"构建优化方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建优化方案"}},[t._v("#")]),t._v(" 构建优化方案")]),t._v(" "),a("p",[t._v("Webapck构建优化主要从两个角度出发：打包速度方面的优化和开发效率方面的优化")]),t._v(" "),a("h2",{attrs:{id:"打包速度方面的优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包速度方面的优化"}},[t._v("#")]),t._v(" 打包速度方面的优化")]),t._v(" "),a("h3",{attrs:{id:"缩小搜索范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缩小搜索范围"}},[t._v("#")]),t._v(" 缩小搜索范围")]),t._v(" "),a("p",[t._v("Loader 对文件的转换非常的耗时，我们可以缩小需要转化的文件目标范围来提高构建速度")]),t._v(" "),a("p",[a("strong",[t._v("缩小"),a("code",[t._v("Loader")]),t._v("应用范围")])]),t._v(" "),a("p",[t._v("配置 "),a("code",[t._v("Loader")]),t._v(" 时合理得使用 "),a("code",[t._v("test")]),t._v("、 "),a("code",[t._v("exclude")]),t._v("、"),a("code",[t._v("include")]),t._v(" 属性，优化要使用 Loader 的文件，尽可能少的让文件被Loader处理")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果项目源码中只有JS文件，就不要写成/\\.jsx?$/，以提升正则表达式的性能")]),t._v("\n                use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader?cacheDirectory'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// label-loader支持缓存转换出的结果，通过cacheDirectory来启动")]),t._v("\n                include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只对项目根目录下的src目录中的文件采用babel-loader")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("优化 "),a("code",[t._v("resolve.modules")]),t._v(" 配置")])]),t._v(" "),a("p",[a("code",[t._v("resolve.modules")]),t._v(" 作用：配置 Webpack 去哪个目录寻找第三方模块，Webpack 默认会在当前项目根目录的"),a("code",[t._v("node_modules")]),t._v(" 下寻找第三方模块，如果当前 "),a("code",[t._v("node_modules")]),t._v(" 没有找到对应的模块则去上一级目录下的"),a("code",[t._v("node_modules")]),t._v("中找，以此类推。")]),t._v(" "),a("p",[t._v("在实际的开发使用场景，我们并不需要一层层地寻找，因此我们可以指定第三方模块的目录，减少 Webpack 的寻找，配置如下")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  dirname表示当前工作目录，也就是项目根目录")]),t._v("\n        modules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("优化 "),a("code",[t._v("resolve.extensions")]),t._v(" 配置")])]),t._v(" "),a("p",[t._v("默认情况下，Webpack 寻找没有带后缀的文件时，会自动带上后缀去寻找，默认是通过 "),a("code",[t._v("resolve.extension")]),t._v(" 配置的后缀列表按顺序去寻找，默认是：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("extensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("因为我们可以根据以下情况去优化 "),a("code",[t._v("resolve.extensions")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("没使用到的后缀名不列表入 "),a("code",[t._v("resolve.extensions")]),t._v(" 中")])]),t._v(" "),a("li",[a("p",[t._v("高频后缀名放在前面")])]),t._v(" "),a("li",[a("p",[t._v("在引入文件时，不要忽略后缀名，将后缀名书完整，避免让 Webpack 自己去匹配")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    extensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("优化 "),a("code",[t._v("resolve.noParse")]),t._v(" 配置")])]),t._v(" "),a("p",[t._v("对于没有模块化的文件，能过这个配置让 Webpack 忽略对这些文件的递归解析，以此提高构建性能。比如 "),a("code",[t._v("JQuery")]),t._v("、"),a("code",[t._v("ChartJs")]),t._v(" 等没用采用模块化的方式，让 Webpack 解析这些文件即耗时又没有意义")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    noParse"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("react\\.min\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[a("strong",[t._v("优化resolve.mainFields配置")])]),t._v(" "),a("p",[a("code",[t._v("resolve.mainFileds")]),t._v(" 作用：配置第三方模块使用哪个入口文件")]),t._v(" "),a("p",[t._v("在安装第三模块时都有一个 "),a("code",[t._v("package.json")]),t._v(" 文件来描述这个模块的入口文件，可是有的模块根据环境配置多个入口文件")]),t._v(" "),a("p",[a("code",[t._v("resolve.mainFileds")]),t._v(" 的默认值和当前的 "),a("code",[t._v("target")]),t._v(" 配置有关系，对应的关系如下")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("当 "),a("code",[t._v("tartget")]),t._v(" 为 "),a("code",[t._v("web")]),t._v(" 或者 "),a("code",[t._v("webworker")]),t._v(" 时，值是 "),a("code",[t._v('["brower", "module", "main"]')])])]),t._v(" "),a("li",[a("p",[t._v("当 "),a("code",[t._v("target")]),t._v(" 为其它情况时，值是 "),a("code",[t._v('[ "module", "main"]')])])])]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("target")]),t._v(" 等于 "),a("code",[t._v("web")]),t._v(" 为例，Webpack 会先采用第三方模块中的 "),a("code",[t._v("brower")]),t._v(" 字段去寻找模块，如果不存在，则从"),a("code",[t._v("module")]),t._v(" 中寻找，其次再从 "),a("code",[t._v("main")]),t._v(" 中寻找。")]),t._v(" "),a("p",[t._v("为了减少搜索步骤，我们明确第三方模块的入口字段")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mainFields"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("优化resolve.alias配置")])]),t._v(" "),a("p",[a("code",[t._v("resolve.alias")]),t._v(" 作用：通过别名将原来导入第三方模块的路径修改为新的路径")]),t._v(" "),a("p",[t._v("有些第三方模块安装时，会有多套代码，比如 "),a("code",[t._v("React")]),t._v(" 有个 "),a("code",[t._v("dist")]),t._v(" 目录，是将所有代码打包好的放在一个单独的文件中，这个文件没有被模块化，可以直接引入执行")]),t._v(" "),a("p",[t._v("另一个是 "),a("code",[t._v("lib")]),t._v(" 目录，是一套采用 CommonJs 规范的模块化代码，以 "),a("code",[t._v("package.json")]),t._v(" 中指定的入口文件 "),a("code",[t._v("react.js")]),t._v(" 为模块的入口")]),t._v(" "),a("p",[t._v("默认情况下，Webpack 引入 "),a("code",[t._v("lib")]),t._v(" 目录下的文件时，会递归解析和处理这些文件，这会是一个耗时的操作。这时可以通过"),a("code",[t._v("resolve.alias")]),t._v(" 来配置使用单独的完整的 "),a("code",[t._v("dist")]),t._v(" 下的文件，减少搜索时间")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./node_modules/react/dist/react.min.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("但是，使用这种优化虽然可以减少搜索，但是会引入模块中没用到的代码，这不利于 "),a("code",[t._v("Tree-Sharking")]),t._v(" 使用，比如在使得 "),a("code",[t._v("lodash")]),t._v(" 时，我们可能只用到部分功能，如果使用这个配置优化，将会把所有包括没用到的也引用项目当中")]),t._v(" "),a("h3",{attrs:{id:"认识dllplugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#认识dllplugin"}},[t._v("#")]),t._v(" 认识DllPlugin")]),t._v(" "),a("p",[t._v("对于比较常用又不常更新的模块可以使用 DllPlugin 插件将其进行打包，项目中直接引这些库，不需要进行对这些模块做编译打包处理，如 "),a("code",[t._v("react")]),t._v("、"),a("code",[t._v("react-dom")]),t._v("，所以只要不升级这些模块的版本，动态链接库就不用重新编译。")]),t._v(" "),a("p",[t._v("使用 DllPlugin，需要完成以下几件事情")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("将网页依赖的基础模块抽离出来，打到一个个单独的动态链接库中。在一个动态链接库可以包含多个模块")])]),t._v(" "),a("li",[a("p",[t._v("将需要导入的模块存在于动态链接库时，不需要重新打包，而是从动态链接库直接导入")])]),t._v(" "),a("li",[a("p",[t._v("页面依赖的所有动态链接库都需要被加载")])])]),t._v(" "),a("h4",{attrs:{id:"webpack中使用dll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack中使用dll"}},[t._v("#")]),t._v(" Webpack中使用dll")]),t._v(" "),a("p",[t._v("Webpack中使用 "),a("code",[t._v("dll")]),t._v(" 需要用到两个插件： "),a("code",[t._v("DllPlugin")]),t._v("，"),a("code",[t._v("DllReferencePlugin")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("DllPlugin 插件：用于打包一个个单独的动态链接库文件。")])]),t._v(" "),a("li",[a("p",[t._v("DllReferencePlugin 插件：用于在主要的配置文件中引入 DllPlugin 插件打包好的动态链接库文件")])])]),t._v(" "),a("p",[t._v("以 React 项目为例，为其接入 DllPlugin。最终构建出的目录结构：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" polyfill"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" polyfill"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mainfest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" react"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" react"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mainifest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n")])])]),a("p",[t._v("其中包含两个动态链接库文件")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("polyfill.dll.js")]),t._v(" ：里面包含项目所有依赖的 "),a("code",[t._v("polyfill")]),t._v(",例如 "),a("code",[t._v("Promise")]),t._v("、"),a("code",[t._v("fetch")]),t._v(" 等 "),a("code",[t._v("Api")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("react.dll.js")]),t._v("：里面包含 React 的基础运行环境，即 "),a("code",[t._v("react")]),t._v(" 和 "),a("code",[t._v("react-dom")]),t._v(" 模块")])])]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("react.dll.js")]),t._v(" 文件为例，其文件内容大致如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _dll_react "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("modules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ......")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_require__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ID为0的模块对应的代码")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("，\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_require__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ID为1的模块对应的代码")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .....")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("可见，一个动态链接库包含了大量模块的代码，这些模块被存放在一个数组里，用数组的索引号作为 ID，并且通过 "),a("code",[t._v("__dll_react_")]),t._v(" 变量将自己暴露在全局中，即可以通过 "),a("code",[t._v("window.__dll_react")]),t._v(" 访问到其中包含的模块。")]),t._v(" "),a("p",[t._v("其中 "),a("code",[t._v("polyfill.mainifest.json")]),t._v(" 和 "),a("code",[t._v("react.mainfest.json")]),t._v(" 文件也是由 DllPlugin 生成的，用于描述在动态链接库文件中包含哪些模块")]),t._v(" "),a("p",[a("code",[t._v("main.js")]),t._v(" 文件是被编译出来的执行入口文件，在遇到其依赖的模块在 "),a("code",[t._v("dll.js")]),t._v(" 文件中时，会直接通过 "),a("code",[t._v("dll.js")]),t._v(" 文件暴露的全局变量获取打包在 "),a("code",[t._v("dll.js")]),t._v(" 文件中的模块，所以在 "),a("code",[t._v("index.html")]),t._v(" 文件中需要将依赖的两个 "),a("code",[t._v("dll.js")]),t._v(" 文件加载进去。\n此时 "),a("code",[t._v("index.html")]),t._v(" 内容如下：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Title"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--导入依赖的动态链接库--\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("sciprt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./dist/polyfill.dll.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("sciprt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("sciprt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./dist/react.dll.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("sciprt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--导入执行的入口文件--\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("sciprt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./dist/main.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("sciprt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])]),a("h4",{attrs:{id:"webapck配置dll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webapck配置dll"}},[t._v("#")]),t._v(" webapck配置dll")]),t._v(" "),a("p",[t._v("动态链接库文件相关的文件需要由一份独立的构建输出，用于主构建使用。新建一个 Webpack 配置文 件"),a("code",[t._v("webpack_dll.deploy.config.js")]),t._v(" 专门构建他们。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" DllPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack/lib/DllPlugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JavaScript执行文件")]),t._v("\n    entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将React相关的模块放到一个单独的动态链接库中")]),t._v("\n      react"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将项目需要所有的polyfill放到一个单独的动态链接库中")]),t._v("\n      polyfill"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'core-js/fn/object/assign'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'core-js/fn/promise'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'whatwg-fetch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出的动态链接库的文件名称，[name]代表当前动态链接库的名称")]),t._v("\n      filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].dll.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将输出的文件都放到dist目录下")]),t._v("\n      path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置动态链接库全局变量名，对于react就是_dll_react")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加上前缀_dll是为了防止与其它全局变量冲突")]),t._v("\n      library"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_dill_[name]'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接入DllPlugin")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DllPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态链接库的全局变量名称，需要和output.library中的保持一致")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 该字段的值也就是输出mainfest.json文件中name字段的值")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 例如在react_mainfest.jon中就有"name"："_dii_react"')]),t._v("\n        name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_dll_[name]'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 描述动态链接库的mainfest.json文件输出时的文件名称")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].mainfest.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h4",{attrs:{id:"使用动态链接库文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用动态链接库文件"}},[t._v("#")]),t._v(" 使用动态链接库文件")]),t._v(" "),a("p",[t._v("构建出的动态链接库文件用于其他地方使用，在这里用在执行入口使用。")]),t._v(" "),a("p",[t._v("用于输出 "),a("code",[t._v("main.js")]),t._v(" 的主 Webpack 配置文件的内容如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rquire")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" DllReferencePlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack/lib/DllReferencePlugin.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义入口Chunk")]),t._v("\n      main"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./main.js'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出文件的名称")]),t._v("\n      filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 项目源码使用了ES6和JSX语法，需要使用babel-loader转换")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 告诉 Webpack使用了哪些链接库")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DllReferencePlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 描述react动态链接库的文件内容")]),t._v("\n        mainfest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/react.mainfest.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 告诉 Webpack使用了哪些链接库")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DllReferencePlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 描述polyfill动态链接库的文件内容")]),t._v("\n        mainfest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/polyfill.mainfest.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    devtool"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'source-map'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("注意：")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("webapck_dll.deploy.config.js")]),t._v(" 文件中，DllPlugin 中的 "),a("code",[t._v("name")]),t._v(" 参数必须和 "),a("code",[t._v("output.library")]),t._v(" 中的保持一致。原因在于 DllPlugin 中的 "),a("code",[t._v("name")]),t._v(" 参数会影响输出"),a("code",[t._v("mainfest.json")]),t._v(" 文件中的name字段的值。而在 "),a("code",[t._v("webapck.deploy.config.js")]),t._v(" 文件中，"),a("code",[t._v("DllReferencePlugin")]),t._v(" 会去 "),a("code",[t._v("mainfest.json")]),t._v(" 文件中读取 "),a("code",[t._v("name")]),t._v(" 字段的值，将值的内容作为在全局变量中获取动态链接库的内容时的全局变量名")]),t._v(" "),a("h4",{attrs:{id:"执行构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行构建"}},[t._v("#")]),t._v(" 执行构建")]),t._v(" "),a("p",[t._v("执行构建需要注意的是，需要先将动态链接库相关的文件编译出来，因为主 Webpack 配置文件定义的 "),a("code",[t._v("DllReferencePlugin")]),t._v(" 依赖这些文件。")]),t._v(" "),a("p",[t._v("执行构建的流程如下")]),t._v(" "),a("ul",[a("li",[t._v("如果动态链接还没编译出来，需要选将它们编译出来。执行命令行")])]),t._v(" "),a("p",[a("code",[t._v("webapck --config webpack_dll.deploy.config.js")])]),t._v(" "),a("ul",[a("li",[t._v("在确保动态链接库存在时，才能正常编译入口的文件")])]),t._v(" "),a("h2",{attrs:{id:"开启多进程任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启多进程任务"}},[t._v("#")]),t._v(" 开启多进程任务")]),t._v(" "),a("p",[t._v("Webpack 构建过程就是对文件进行解析和转换，所以构建是谁的读写和计算密集型的。运行在 Node.js 之后的 Webpack 是单线程模型的，也就是说 Webpack 需要一个一个地处理任务，不能同时处理多个任务。")]),t._v(" "),a("p",[t._v("开启多进程任务后能让 Webpack 在同一时刻处理多个任务，发挥多核 CPU 电脑的功能，他将任务分到给多个子进程去并发执行，子进程处理完后再将结果发送给主进程。")]),t._v(" "),a("h3",{attrs:{id:"使用happypack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用happypack"}},[t._v("#")]),t._v(" 使用HappyPack")]),t._v(" "),a("p",[t._v("HappyPack 的作用就是开启多进程来对文件进行解析和转换")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ExtractTextPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'extract-text-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HappyPack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将js文件的处理交给id为babel的happypack实例")]),t._v("\n          use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack/loader?id=babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 排除node_modules下的目录，因为node_modeles目录下的文件采用了ES5语法，没必要再通过Babel去转换")]),t._v("\n          exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.css")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将css文件的处理交给id为babel的happypack实例")]),t._v("\n          use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExtranctTextPlugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("extract")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack/loader?id=css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HappyPack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义唯一标识符id")]),t._v("\n        id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义这个HappyPack使用哪个loader，用法和Loader配置一样")]),t._v("\n        loaders"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader?cacheDirectory'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HappyPack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loaders"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExtractTextPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].css'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("以上配置做了以下几件事情：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在 Loader 配置，将文件的处理将给 "),a("code",[t._v("happypack/loader")]),t._v(" ，使用时后面紧跟的 "),a("code",[t._v("querystring?id=bable")]),t._v(" 表示使用哪个 HappyPack 实例")])]),t._v(" "),a("li",[a("p",[t._v("在 "),a("code",[t._v("Plugin")]),t._v(" 配置中，添加了两个 "),a("code",[t._v("HappyPack")]),t._v(" 实例，分别配置了不同的 "),a("code",[t._v("loaders")]),t._v("，用于告诉 "),a("code",[t._v("happypack/loader")]),t._v(" 如何处理 "),a("code",[t._v(".js")]),t._v(" 和 "),a("code",[t._v(".css")]),t._v(" 文件。"),a("code",[t._v("id")]),t._v(" 属性的值和上面 "),a("code",[t._v("querystring")]),t._v(" 的 "),a("code",[t._v("?id=bable")]),t._v(" 对应")])])]),t._v(" "),a("p",[t._v("在实例 HappyPack 时，除了可以传入 "),a("code",[t._v("id")]),t._v(" 和 "),a("code",[t._v("loaders")]),t._v(" 外还支持以下属性")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("threads")]),t._v("：代表开启几个子进程去处理这一类的文件，默认是 "),a("code",[t._v("3")]),t._v(" 个，必须是整数")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("verbose")]),t._v("：是否允许 HappyPack 输出日志，默认开户")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("threadPool")]),t._v("：代表共享进程池，即多个 HappyPay 实例都使用同一个共享进程池的子进程去处理任务，以防止资源占用太多，相关代码如下")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ExtractTextPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'extract-text-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HappyPack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" happyThreadPool "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HappyPack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ThreadPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("size"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将js文件的处理交给id为babel的happypack实例")]),t._v("\n          use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack/loader?id=babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 排除node_modules下的目录，因为node_modeles目录下的文件采用了ES5语法，没必要再通过Babel去转换")]),t._v("\n          exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.css")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将css文件的处理交给id为babel的happypack实例")]),t._v("\n          use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExtranctTextPlugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("extract")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack/loader?id=css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HappyPack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义唯一标识符id")]),t._v("\n        id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义这个HappyPack使用哪个loader，用法和Loader配置一样")]),t._v("\n        loaders"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader?cacheDirectory'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用共享进程池中的子进程去处理任务")]),t._v("\n        threadPool"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" happyThreadPool\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HappyPack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loaders"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用共享进程池中的子进程去处理任务")]),t._v("\n        threadPool"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" happyThreadPool\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExtractTextPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[name].css'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("接入 HappyPack 后，需要为项目安装新的依赖：")]),t._v(" "),a("p",[a("code",[t._v("npm i -D HappyPack")])]),t._v(" "),a("p",[t._v("安装成功后重新执行构建，如果有看到由 HappyPack 输出的日志说明 HappyPack 配置生效了")]),t._v(" "),a("h4",{attrs:{id:"happypack原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#happypack原理"}},[t._v("#")]),t._v(" HappyPack原理")]),t._v(" "),a("p",[t._v("每通过 "),a("code",[t._v("new HappyPack")]),t._v(" 实例化一个 HappyPack，并定义该实例使用哪些 Loader 去转换一类文件，并且可以指定如何为这类转换操作分配进程。")]),t._v(" "),a("p",[t._v("核心调度器的逻辑代码在主进程中，也就是运行 Webpack 的进程中，核心调度器会将一个个任务分配给当前空闲的子进程中，子进程处理完后将结果发送给核心调度器，它们之间的数据交换是通过进程间的通信 API 完成的。")]),t._v(" "),a("p",[t._v("核心调度器收到来自子进程处理完毕的结果后，会通知 Webpack 该文件已处理完毕。")]),t._v(" "),a("h3",{attrs:{id:"thread-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thread-loader"}},[t._v("#")]),t._v(" thread-loader")]),t._v(" "),a("p",[t._v("作用同 HappyPack，也是将您的 "),a("code",[t._v("loader")]),t._v(" 放置在一个 "),a("code",[t._v("worker")]),t._v(" 池里面运行，以达到多线程构建。\n把这个 "),a("code",[t._v("loader")]),t._v(" 放置在其他 "),a("code",[t._v("loader")]),t._v(" 之前， 放置在这个 "),a("code",[t._v("loader")]),t._v(" 之后的 "),a("code",[t._v("loader")]),t._v(" 就会在一个单独的 "),a("code",[t._v("worker")]),t._v(" 池( "),a("code",[t._v("worker pool")]),t._v(" )中运行")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue.deploy.config.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thread-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的高开销的loader放置在此 (e.g babel-loader)")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"terser-webpack-plugin开启多进程压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#terser-webpack-plugin开启多进程压缩"}},[t._v("#")]),t._v(" terser-webpack-plugin开启多进程压缩")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UglifyJSPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cache"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开启缓存")]),t._v("\n    parallel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开启进程并行压缩")]),t._v("\n    include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\/includes")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缩小压缩文件范围")]),t._v("\n    exclude"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\/excludes")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缩小压缩文件范围")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("也可以使用"),a("code",[t._v("webpack-paralle-uglify-plugin")]),t._v("插件")]),t._v(" "),a("h3",{attrs:{id:"缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[t._v("#")]),t._v(" 缓存")]),t._v(" "),a("p",[t._v("充分利用缓存提升二次构建速度")]),t._v(" "),a("p",[a("strong",[t._v("babel-loader 开启缓存")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                cacheDirectory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("terser-webpack-plugin")]),t._v(" 开启缓存")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("cache-loader")]),t._v(" 或者 "),a("code",[t._v("hard-source-webpack-plugin")])]),t._v(" "),a("h2",{attrs:{id:"开发效率优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发效率优化"}},[t._v("#")]),t._v(" 开发效率优化")]),t._v(" "),a("h3",{attrs:{id:"文件监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件监听"}},[t._v("#")]),t._v(" 文件监听")]),t._v(" "),a("p",[t._v("文件监听是发现源码文件发生变化时，自动重新编译出新的输出文件")]),t._v(" "),a("p",[t._v("Webpack 官方提供了两个大模块，一个核心的 webpack，另一个是 webpack-dev-server。而文件监听功能是 Webpack 提供的")]),t._v(" "),a("p",[t._v("文件监听的相关配置：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开启监听模式，默认是false")]),t._v("\n    watch"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 前提是要watch为true，要不然没意义")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听模式运行时的参数")]),t._v("\n    watchOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不监听的文件或文件夹，支持正则匹配")]),t._v("\n        ignored"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("node_modules")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听到变化后等300ms再去执行，截流")]),t._v("\n        aggregateTimeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断文件是否发生变化是通过不断询问系统指定文件有没有更新实现的")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默默每秒询问1000次")]),t._v("\n        poll"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Webpack 开启文件监听有两种方式")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("配置文件中设置 "),a("code",[t._v("watch: true")])])]),t._v(" "),a("li",[a("p",[t._v("在执行启动Webpack的命令时带上 "),a("code",[t._v("--watch")]),t._v(" 参数，完整的命令是 "),a("code",[t._v("webapck --watch")])])])]),t._v(" "),a("h4",{attrs:{id:"文件监听的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件监听的原理"}},[t._v("#")]),t._v(" 文件监听的原理")]),t._v(" "),a("p",[t._v("在 Webpack 中监听一个文件是否发生变化的原理，是定时获取这个文件最后更新时间，每次都存下最新的更新时间，如果发现当前时间获取的和最后一次保存的编辑时间不一致，就认为该发生了变化 。配置项中的 "),a("code",[t._v("watchOptions.poll")]),t._v(" 用于控制定时检查的周期，具体含义是每秒检查多少次。")]),t._v(" "),a("h4",{attrs:{id:"怎么确定要监听的文件列表呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么确定要监听的文件列表呢"}},[t._v("#")]),t._v(" 怎么确定要监听的文件列表呢？")]),t._v(" "),a("p",[t._v("在默认情况下，Webpack 会从配置的 Entry 文件出发，递归解析 "),a("code",[t._v("Entry")]),t._v(" 文件所依赖的文件，将这些文件加入到监听列表中。")]),t._v(" "),a("p",[t._v("由于保存文件的路径和最后的编辑时间需要占用内存，定时检查、周期检查需要占用 CPU 及文件 I/O，所以最好减少需要监听的文件数量和降低检查频率。")]),t._v(" "),a("h4",{attrs:{id:"优化文件监听的性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化文件监听的性能"}},[t._v("#")]),t._v(" 优化文件监听的性能")]),t._v(" "),a("p",[t._v("根据前面对文件监听的原理介绍，我们可以做以下优化：")]),t._v(" "),a("ul",[a("li",[t._v("需要监听的文件列表是根据 "),a("code",[t._v("Entry")]),t._v(" 配置的入口文件递归得将引用到的文件加入到监听列表中，其中将包含很多的 "),a("code",[t._v("node_modules")]),t._v(" 中的模块，一般情况下我们不会修改 "),a("code",[t._v("node_moduels")]),t._v(" 里的文件，所以我们可以忽略这个文件的监听，相关配置如下：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  watchOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不监听node_module中的文件")]),t._v("\n   ignored"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("，\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("配置截流，"),a("code",[t._v("watchOptions.aggregateTimeout")]),t._v(" 的值越大越好，因为这能降低重新构建的频率")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("watchOptions.pool")]),t._v(" 的值越小越好，因为这能降低检查的频率")])])]),t._v(" "),a("p",[t._v("后面这种方式的优化，负作用是监听模式的反应和灵敏度降低了")]),t._v(" "),a("h2",{attrs:{id:"自动刷新浏览器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动刷新浏览器"}},[t._v("#")]),t._v(" 自动刷新浏览器")]),t._v(" "),a("p",[t._v("监听到文件的变化后，下一步就是刷新浏览器，Webpack 模块负责监听文件，"),a("code",[t._v("webapck-dev-server")]),t._v(" 负责刷新浏览器。使用 "),a("code",[t._v("webpack-dev-server")]),t._v(" 模块去启动 "),a("code",[t._v("webpack")]),t._v(" 模块时，"),a("code",[t._v("webpack")]),t._v(" 模块的监听模式默认会被开启。当 "),a("code",[t._v("webpack")]),t._v(" 模块监听到文件变化时，会通过 "),a("code",[t._v("webpack-dev-server")]),t._v(" 模块")]),t._v(" "),a("h3",{attrs:{id:"自动刷新的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动刷新的原理"}},[t._v("#")]),t._v(" 自动刷新的原理")]),t._v(" "),a("p",[t._v("控制浏览器刷新有如下三种方式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("借助浏览器扩展去通过浏览器提供的接口刷新，Webstorm IDE的 LiveEdit 功能就是这样实现的")])]),t._v(" "),a("li",[a("p",[t._v("向要开发的网页中注入代理客户端代码，通过代理客户端去刷新整个页面")])]),t._v(" "),a("li",[a("p",[t._v("将要开发的网页装进一个 "),a("code",[t._v("iframe")]),t._v(" 中，通过刷新 "),a("code",[t._v("iframe")]),t._v(" 去看到最新效果")])])]),t._v(" "),a("p",[a("code",[t._v("DevServer")]),t._v(" 支持 第2 和 第3种方法，第2种 是 "),a("code",[t._v("DevServer")]),t._v(" 默认采用的刷新方法。")]),t._v(" "),a("p",[t._v("通过 DevServer 启动构建")]),t._v(" "),a("p",[t._v("用浏览器调试工具，可以发现由代理客户端向 DevServer 发起的 "),a("code",[t._v("WebSocket")]),t._v(" 连接")]),t._v(" "),a("h4",{attrs:{id:"优化自动刷新的性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化自动刷新的性能"}},[t._v("#")]),t._v(" 优化自动刷新的性能")]),t._v(" "),a("p",[t._v("在使用 "),a("code",[t._v("devServer.inline")]),t._v(" 配置项时，它用来控制是否向 "),a("code",[t._v("Chunk")]),t._v(" 中注入代理客户端，默认会注入。\n事实上，在开启 "),a("code",[t._v("Inline")]),t._v(" 时，"),a("code",[t._v("DevServer")]),t._v(" 会向每个输出的 "),a("code",[t._v("Chunk")]),t._v(" 中都注入代理客户端的代码，当我们需要输出多个 "),a("code",[t._v("Chunk")]),t._v(" 时，就会导致构建缓慢。")]),t._v(" "),a("p",[t._v("其实要完成自动刷新 ，一个页面只需要一个代理客户端，"),a("code",[t._v("DevServer")]),t._v(" 之所有这么粗暴得给每个输出的 "),a("code",[t._v("Chunk")]),t._v(" 注入代理客户端代码，是因为它不知道页面依赖哪几个 "),a("code",[t._v("Chunk")]),t._v("，所以索性全部都注入一个代理客户端。网页只要依赖了其中任何一个 "),a("code",[t._v("Chunk")]),t._v("，代理客户端就被注入网页中。")]),t._v(" "),a("p",[t._v("这里的优化思路是关闭不够优雅的 "),a("code",[t._v("Inline")]),t._v(" 模式，只注入一个代理客户端。为了关闭 "),a("code",[t._v("inline")]),t._v(" 模式，\n在启动 "),a("code",[t._v("DevServer")]),t._v(" 时可以通过执行命令 "),a("code",[t._v("webpack-dev-server --inline false")]),t._v(" (也可以在配置文件中设置)")]),t._v(" "),a("p",[t._v("关闭 "),a("code",[t._v("inline")]),t._v(" 模式后和前面的不同在于：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("入口网址变成了 "),a("code",[t._v("http://localhost:8080/webpack-dev-server")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("bundle.js")]),t._v(" 中不再包含代理客户端的代码。")])]),t._v(" "),a("li",[a("p",[t._v("查看页面的源代码我们发现，我们要开发的网页被放进了一个 "),a("code",[t._v("iframe")]),t._v(" 中，编辑源码后，"),a("code",[t._v("iframe")]),t._v(" 会被自动刷新。")])])]),t._v(" "),a("p",[t._v("如果不想用 "),a("code",[t._v("iframe")]),t._v(" 的方式去自动刷新网页，但同时想让网页保持自动刷新的功能，则需要手动在网页中注入代理客户端代码，向 "),a("code",[t._v("index.html")]),t._v(" 中插入以下标签：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("注入DevServer提供的代理客户端脚本，这个服务是DevServer内置的"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8080/webpack-dev-server.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h3",{attrs:{id:"模块热替换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块热替换"}},[t._v("#")]),t._v(" 模块热替换")]),t._v(" "),a("p",[t._v("模块热更新技术可以在不刷整个网页的情况下做到起灵敏实时预览。原理在一个源码发生变化时，只需要重新编辑发生变化的的模块，再用新输出的模块替换掉浏览器中对应的模块。")]),t._v(" "),a("p",[t._v("模块热更新的优点如下：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("实时预览反应更快，等待时间更短")])]),t._v(" "),a("li",[a("p",[t._v("不刷新浏览器时能保留当前网页的运行状态，例如如果网页使用 Redux 做数据状态管理，那么模块热更新能做到代码更新时 Redux 中的数据操持不变")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为每个入口注客户端代码")]),t._v("\n      main"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack-dev-server/client?http://localhost:8080/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack/hot/dev-server'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/main.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 告诉DevServer要开启模块热替换模式")]),t._v("\n      hot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("， "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 会自动引入 HotModuleReplacement")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在启动时，命令行带上 "),a("code",[t._v("--hot")]),t._v("，其实就是自动完成以上配置")]),t._v(" "),a("p",[t._v("为了让使用者在使用模块热替换功能时能灵活地控制老模块被替换时的逻辑，Webpack 允许在源码上定义一些代码去做相应的处理")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" render "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AppComponent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./main.css'")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("AppComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只有当开启了模块热替换时，module.hot才存在")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// module.hot.accept函数的第一个参数指出当前文件接收哪些子模块的替换，这里表示只接受'./AppComponent'这个子模块")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第二个参数表示模块更新时要执行的逻辑")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("accept")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./AppComponent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("AppComponent"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("其中 "),a("code",[t._v("module.hot")]),t._v(" 是当前开启模块热替换后全局注入的 "),a("code",[t._v("api")]),t._v(" ，用于控制模块热替换的逻辑。")]),t._v(" "),a("h4",{attrs:{id:"为什么编辑main-js时还是刷新整个页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么编辑main-js时还是刷新整个页面"}},[t._v("#")]),t._v(" 为什么编辑"),a("code",[t._v("main.js")]),t._v("时还是刷新整个页面")]),t._v(" "),a("p",[t._v("其原因当块更新，更新事件会一层一层向上传递，也就是当 "),a("code",[t._v("./AppComponent")]),t._v(" 更新时，会传递到了 "),a("code",[t._v("main.js")]),t._v(" 中，直到有某层接收了当前变化的模块，这里被 "),a("code",[t._v("main.js")]),t._v(" 中定义的 "),a("code",[t._v("accept")]),t._v(" 函数接收了 ，然后就会执行我们定义的 "),a("code",[t._v("callback")]),t._v(" 函数，如果事件一直往上拋，到了最外层都没有文件接收它，则会直接刷新页面。")]),t._v(" "),a("p",[t._v("那为什么我们没定义接收 CSS 的地方，可修改 CSS 文件时，并不是刷新页面，而是触发模块热更新呢？")]),t._v(" "),a("p",[t._v("原因在于 "),a("code",[t._v("style-loader")]),t._v(" 会注入用于接收 CSS 的代码")]),t._v(" "),a("h3",{attrs:{id:"优化模块热替换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化模块热替换"}},[t._v("#")]),t._v(" 优化模块热替换")]),t._v(" "),a("p",[t._v("在发生模块热替换时，我们会在浏览器的控制台中看到一些输出信息，其中有 "),a("code",[t._v("Updated modules：[数字]")]),t._v("的信息输出，这个 "),a("code",[t._v("[数字]")]),t._v(" 表示 "),a("code",[t._v("ID")]),t._v(" 为几的模块被替换了，这对开发者不是很友好，因为开发都不知道"),a("code",[t._v("ID")]),t._v(" 和模块之间的对应关系，最好是模块名字代替这个 "),a("code",[t._v("ID")]),t._v(" 输出。Webpack 内置的 "),a("code",[t._v("NameModulesPlugin")]),t._v(" 插件可以解决这个问题，修改 "),a("code",[t._v("Webpack")]),t._v(" 配置文件接入该插件：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" NameModeulesPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack/lib/NameModulesPlugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示出被替换模块的名称")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NameModeulesPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("重新构建后，我们就能发现输出的日志发生了变化")]),t._v(" "),a("p",[t._v("除此之外，模块热替换还面临和自动刷新一样的性能问题，因为它们都需要监听文件的变化和注入客户端。优化模块热替换的构建性能的思路和之前优化自动更新的思路类似：监听更少的文件，忽略 "),a("code",[t._v("node_mosules")]),t._v(" 目录下的文件。")]),t._v(" "),a("p",[t._v("但是其中提到的关闭默认的 "),a("code",[t._v("inline")]),t._v(" 模式且手动注入代理客户端的优化方法，不能用于使用模块热替换的情况，原因在于模块热替换的运行依赖在每个 "),a("code",[t._v("Chunk")]),t._v(" 中都包含代理客户端的代码。")]),t._v(" "),a("h2",{attrs:{id:"输出分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出分析"}},[t._v("#")]),t._v(" 输出分析")]),t._v(" "),a("p",[t._v("对输出进行分析，我们可以更好得对症下药")]),t._v(" "),a("p",[t._v("在启动 Webpack 时支持如下两个参数")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("--profile")]),t._v("： 记录构建过程中的耗时信息")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("--json")]),t._v("：以 JSON 的格式输出构建结果 ，最后只输出一个 "),a("code",[t._v(".json")]),t._v(" 文件输出，这个文件中包括所有构建相关的信息")])])]),t._v(" "),a("p",[t._v("在启动 Webpack 时带上以上两个参数，启动命令如下：")]),t._v(" "),a("p",[a("code",[t._v("webpack --profile --json > stats.json")])]),t._v(" "),a("p",[t._v("我们会发现项目中多出了一个 "),a("code",[t._v("stats.json")]),t._v(" 文件，这个 "),a("code",[t._v("stats.json")]),t._v("文 件是为后面介绍的可视化分析工具使用的")]),t._v(" "),a("p",[a("code",[t._v("webpack --profile --json")]),t._v(" 会输出字符串形式的JSON，"),a("code",[t._v("> stats.json")]),t._v(" 是UNIX/Linux系统上的管道命令，其含义是将 "),a("code",[t._v("webpack --profile --json")]),t._v(" 输出的内容通过管道输出到 "),a("code",[t._v("stats.json")]),t._v(" 文件中")]),t._v(" "),a("h3",{attrs:{id:"官方的可视化分析工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#官方的可视化分析工具"}},[t._v("#")]),t._v(" 官方的可视化分析工具")]),t._v(" "),a("p",[t._v("Webpack 官方提供了一个可视化分析工具 [Webpack Analyse(http://webpack.github.io/analyse/)] (http://webpack.github.io/analyse/)，它是一个在线的 Web 应用")]),t._v(" "),a("p",[t._v("根据提示将之前生成的 "),a("code",[t._v("stats.json")]),t._v(" 上传到网站中，网站就会自动输出一些信息")]),t._v(" "),a("p",[t._v("该主页被分为如下6大板块。")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("Modules")]),t._v("：展示的所有模块，每个模块对应一个文件，并且包含所有模块之间的依赖关系图、模块路径、模块ID、模块所属的 "),a("code",[t._v("Chunk")]),t._v("、模块的大小")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Chunks")]),t._v("：性需求 所有代码块，在一个代码块中包含多个模块，并且包含代码块的ID、名称、大小、每个代码块包含的模块数量 ，以及代码之间的依赖关系图")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Assets")]),t._v("：展示所有输出的文件资源，包括 "),a("code",[t._v(".js")]),t._v("、"),a("code",[t._v(".css")]),t._v("、图片等，并且包含文件的名称、大小以及该文件来自哪个代码块")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Warnings")]),t._v("：展示构建过程中出现的所有警告信息")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Errors")]),t._v("：展示构建过程中出现 的所有错误信息")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Hints")]),t._v("：展示处理每个模块所耗费的时间")])])]),t._v(" "),a("h3",{attrs:{id:"webpack-bundle-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-bundle-analyzer"}},[t._v("#")]),t._v(" webpack-bundle-analyzer")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.npmjs.com/package/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack-bundle-analyzer(https://www.npmjs.com/package/webpack-bundle-analyzer)"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("接入 "),a("code",[t._v("webpack-bundle-analyzer")]),t._v(" 的方法很简单")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("安装 "),a("code",[t._v("webpack-bundle-analyzer")]),t._v(" 到全局，执行命令"),a("code",[t._v("npm i -g webpack-bundle-analyzer")])])]),t._v(" "),a("li",[a("p",[t._v("按照上面提到的方法生成 "),a("code",[t._v("stats.json")])])]),t._v(" "),a("li",[a("p",[t._v("在项目根目录执行 "),a("code",[t._v("webpack-bundle-analyzer")]),t._v(" 后，浏览器会打开对应的网页并展现以上效果")])])]),t._v(" "),a("p",[t._v("从网页中我们可以以下信息：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("打包出的文件中都包含了什么")])]),t._v(" "),a("li",[a("p",[t._v("每个文件的尺寸在总体中的占比，我们一眼看出哪些文件的尺寸大小")])]),t._v(" "),a("li",[a("p",[t._v("模块之间的包含关系")])]),t._v(" "),a("li",[a("p",[t._v("每个文件的Gzip后的大小")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);