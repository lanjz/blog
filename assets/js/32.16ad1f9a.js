(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{486:function(t,s,a){t.exports=a.p+"assets/img/esmodule.a993b2bc.png"},629:function(t,s,a){"use strict";a.r(s);var e=a(54),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"vite"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vite"}},[t._v("#")]),t._v(" Vite")]),t._v(" "),e("p",[t._v("Vite 快的原因？")]),t._v(" "),e("p",[t._v("Vite 以 原生ESM 方式提供源码。这实际上是让浏览器接管了打包程序的部分工作：Vite 只需要在浏览器请求源码时进行转换并按需提供源码。根据情景动态导入代码，即只在当前屏幕上实际使用时才会被处理。")]),t._v(" "),e("h2",{attrs:{id:"原生esm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原生esm"}},[t._v("#")]),t._v(" 原生ESM")]),t._v(" "),e("p",[t._v("先来个例子：")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--index.html--\x3e")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/src/main.js"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token script"}}),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" doSomeThing "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./utils.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomeThing")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// utils.js")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomeThing")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'doSomeThing'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("浏览器打后控制台能正常输出了 "),e("code",[t._v("doSomeThing")])]),t._v(" "),e("p",[t._v("控制台 network 的信息如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(486),alt:""}})]),t._v(" "),e("p",[t._v("可以发现对于 "),e("code",[t._v("main.js")]),t._v(" 中的 "),e("code",[t._v('import { doSomeThing } from "./utils.js"')])]),t._v(" "),e("p",[t._v("浏览器会发起了一个 "),e("code",[t._v("get")]),t._v("请求，下载 "),e("code",[t._v("utils.js")]),t._v(" 文件并获取其中导出的模块并执行")]),t._v(" "),e("h3",{attrs:{id:"vite-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vite-app"}},[t._v("#")]),t._v(" vite-app")]),t._v(" "),e("p",[t._v("回头看下使用 "),e("code",[t._v("vite-app")]),t._v(" 创建的项目，浏览器是如果何加载的")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createApp "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./App.vue'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("我们能 get 到以下几点信息：")]),t._v(" "),e("p",[t._v("首先加载："),e("code",[t._v("http://localhost:3000/src/main.js")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createApp "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/node_modules/.vite/vue.js?v=80d8618d'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/src/App.vue'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("可以看到源码中的 "),e("code",[t._v("import { createApp } from 'vue'")]),t._v(" 变成了 "),e("code",[t._v("import { createApp } from '/node_modules/.vite/vue.js?v=80d8618d'")])]),t._v(" "),e("p",[t._v("这是为了让浏览器把资源路径定位到 "),e("code",[t._v("node_modules")]),t._v(" 中，准确下载到对应的模块")]),t._v(" "),e("p",[t._v("之后加载："),e("code",[t._v("http://localhost:3000/node_modules/.vite/vue.js")])]),t._v(" "),e("p",[t._v("获取 "),e("code",[t._v("createApp")]),t._v(" 这个方法")]),t._v(" "),e("p",[t._v("之后再加载： "),e("code",[t._v("http://localhost:3000/src/App.vue")])]),t._v(" "),e("p",[t._v("获取 App")]),t._v(" "),e("p",[t._v("然后使用 "),e("code",[t._v("createApp")]),t._v(" 创建应用并挂载节点")]),t._v(" "),e("p",[t._v("vite 利用 ES module，把 “构建 vue 应用” 这个本来需要通过 webpack 打包后才能执行的代码直接放在浏览器里执行，这么做是为了：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("去掉打包步骤")])]),t._v(" "),e("li",[e("p",[t._v("实现按需加载")])])]),t._v(" "),e("h3",{attrs:{id:"去掉打包步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#去掉打包步骤"}},[t._v("#")]),t._v(" 去掉打包步骤")]),t._v(" "),e("p",[t._v("打包的概念是开发者利用打包工具以一定规则读取模块的代码，就将对这些模块进行翻译转换，组成形成 bundle，以便在不支持模块化的浏览器里使用。webpack 的运行就离不开打包这个环节")]),t._v(" "),e("p",[t._v("先回顾一下 Webpack 的运行流程：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("[初始化参数]：从配置文件和 Shell 语句中读取与合并参数，得出最终的参数")])]),t._v(" "),e("li",[e("p",[t._v("[开始编译]：用上一步得到的参数初始化 Compiler 对象，加载所有配置的插件，执行对象的 run 方法开始执行编译")])]),t._v(" "),e("li",[e("p",[t._v("[确定入口]：根据配置中的 entry 找出所有的入口文件")])]),t._v(" "),e("li",[e("p",[t._v("[编译模块]：从入口文件出发，调用所有配置的 Loader 对模块进行翻译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理")])]),t._v(" "),e("li",[e("p",[t._v("[完成模块编译]：在经过第4步使用 Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系")])]),t._v(" "),e("li",[e("p",[t._v("[输出资源]：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会")])]),t._v(" "),e("li",[e("p",[t._v("[输出完成]：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统")])])]),t._v(" "),e("p",[t._v("在 webpack 的启动和和每次热更新的过程中，模块的编译都需要花费很多的时间")]),t._v(" "),e("p",[t._v("vite 利用浏览器原生支持模块化导入这一特性，省略了对模块的编译和组装工作，所以打包这一步就可以省略了")]),t._v(" "),e("h3",{attrs:{id:"实现按需打包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现按需打包"}},[t._v("#")]),t._v(" 实现按需打包")]),t._v(" "),e("p",[t._v("前面说到，webpack 会将各模块提前打包进 bundle 里，在不进行任何的处理的情况，webpack 会将所以的模块打包在一起——不管这个模块的代码是否有被执行到，所以往往一个 bundle 文件会很大，并且随着项目越来越大打包后的 bundle 也越来越大")]),t._v(" "),e("p",[t._v("为了解决这个问题，开发者会使用 "),e("code",[t._v("import()")]),t._v(" 的方式将模块进行分离，实现按需模块（ 但被分离的模块依然需要提前编译和打包)，又或者使用 teaserPlugin 进行代码压缩或 tree shaking 等方式尽力得去减小代码体积，然而这些方式都不如 vite 的优雅，vite 可以只在某个模块被 "),e("code",[t._v("import")]),t._v(" 时才去引入它，而且不需要提前打包")]),t._v(" "),e("h2",{attrs:{id:"vite-启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vite-启动"}},[t._v("#")]),t._v(" vite 启动")]),t._v(" "),e("p",[t._v("跟 webpack 类似 vite 启动时也会创建一个本地服务")]),t._v(" "),e("p",[t._v("声明 script 标签类型为 module")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),t._v(" src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/src/main.js"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("p",[t._v("浏览器向服务器发起GET")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求main.js文件：")]),t._v("\nhttp"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("main"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /src/main.js:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createApp "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" App "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./App.vue'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("请求到main.js文件，检测内部含有import引入的包，会对内部的 import 引用发起 HTTP 请求获取模块的内容文件")]),t._v(" "),e("p",[t._v("劫持浏览器的http请求，在后端进行相应的处理将项目中使用的文件通过简单的分解与整合，然后再返回给浏览器(整个过程没有对文件进行打包编译)")]),t._v(" "),e("h2",{attrs:{id:"vs-webpack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vs-webpack"}},[t._v("#")]),t._v(" VS Webpack")]),t._v(" "),e("p",[t._v("vite是直接启动开发服务器，请求哪个模块再对该模块进行实时编译。\n由于现代浏览器本身就支持ES Module，会自动向依赖的Module发出请求。vite充分利用这一点，将开发环境下的模块文件，就作为浏览器要执行的文件，而不是像webpack那样进行打包合并。\n由于vite在启动的时候不需要打包，也就意味着不需要分析模块的依赖、不需要编译，因此启动速度非常快。当浏览器请求某个模块时，再根据需要对模块内容进行编译。这种按需动态编译的方式，极大的缩减了编译时间，项目越复杂、模块越多，vite的优势越明显。\n在HMR方面，当改动了一个模块后，仅需让浏览器重新请求该模块即可，不像webpack那样需要把该模块的相关依赖模块全部编译一次，效率更高。\n当需要打包到生产环境时，vite使用传统的rollup进行打包，因此，vite的主要优势在开发阶段。另外，由于vite利用的是ES Module，因此在代码中不可以使用CommonJS")]),t._v(" "),e("h3",{attrs:{id:"打包原理比较"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#打包原理比较"}},[t._v("#")]),t._v(" 打包原理比较")]),t._v(" "),e("p",[e("strong",[t._v("webpack")])]),t._v(" "),e("p",[t._v("过程：识别入口->逐层识别依赖->分析/转换/编译/输出代码->打包后的代码")]),t._v(" "),e("p",[t._v("原理：逐级递归识别依赖，构建依赖图谱->转化AST语法树->处理代码->转换为浏览器可识别的代码")]),t._v(" "),e("p",[e("strong",[t._v("Vite")])]),t._v(" "),e("p",[t._v("开发阶段直接省去上停的打包过程，直接基于浏览器原生 ES module，利用浏览器解析 imports，服务器端按需编译返回")]),t._v(" "),e("p",[t._v("webpack会先打包，然后启动开发服务器，请求服务器时直接给予打包结果")]),t._v(" "),e("p",[t._v("https://jishuin.proginn.com/p/763bfbd29d7f")]),t._v(" "),e("p",[t._v("https://bbs.huaweicloud.com/blogs/271090")])])}),[],!1,null,null,null);s.default=n.exports}}]);