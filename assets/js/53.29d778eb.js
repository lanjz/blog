(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{565:function(t,s,a){t.exports=a.p+"assets/img/sors_1.25a44b85.png"},770:function(t,s,a){"use strict";a.r(s);var n=a(55),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),n("p",[n("strong",[t._v("一个源的定义")])]),t._v(" "),n("p",[t._v("如果两个页面的协议，端口（如果有指定）和域名都相同，则两个页面具有相同的源。\n举个例子：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("下表给出了相对http://a.lanjz.com/dir/page.html同源检测的示例: \nURL                                         结果          原因\nhttp://a.lanjz.com/dir2/other.html            成功     协议，端口（如果有指定）和域名都相同\nhttp://a.lanjz.com/dir/inner/another.html     成功    协议，端口（如果有指定）和域名都相同 \nhttps://a.lanjz.com/secure.html               失败    不同协议 ( https和http )\nhttp://a.lanjz.com:81/dir/etc.html            失败    不同端口 ( 81和80)\nhttp://a.opq.com/dir/other.html             失败    不同域名 ( lanjz和opq)\n")])])]),n("p",[n("strong",[t._v("同源策略")])]),t._v(" "),n("p",[t._v("同源策略是浏览器的一个安全功能，不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源")]),t._v(" "),n("h2",{attrs:{id:"跨域请求的解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域请求的解决方案"}},[t._v("#")]),t._v(" 跨域请求的解决方案")]),t._v(" "),n("h3",{attrs:{id:"基于jsonp实现的跨域请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于jsonp实现的跨域请求"}},[t._v("#")]),t._v(" 基于jsonp实现的跨域请求")]),t._v(" "),n("p",[t._v("跨域资源的引入是可以的，如嵌入到页面中的"),n("code",[t._v("script")]),t._v("，"),n("code",[t._v("img")]),t._v("，"),n("code",[t._v("link")]),t._v("，"),n("code",[t._v("iframe")]),t._v("等。")]),t._v(" "),n("p",[n("code",[t._v("jsonp")]),t._v("的原理就是利用"),n("code",[t._v("<script>")]),t._v("标签没有跨域限制，通过"),n("code",[t._v("<script>")]),t._v("标签"),n("code",[t._v("src")]),t._v("属性，发送带有"),n("code",[t._v("callback")]),t._v("参数的"),n("code",[t._v("GET")]),t._v("请求，服务端将接口返回数据拼凑到"),n("code",[t._v("callback")]),t._v("函数中，返回给浏览器，浏览器解析执行，从而前端拿到"),n("code",[t._v("callback")]),t._v("函数返回的数据")]),t._v(" "),n("p",[n("strong",[t._v("例子")])]),t._v(" "),n("p",[t._v("服务端：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" urllib "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" port "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10011")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jifeng'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'company'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'taobao'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nhttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" urllib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//console.log(params.query.callback);")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" str "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'('")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("')'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//jsonp")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//普通的json")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("     \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'server is listening on port '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("strong",[t._v("前端JS")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/javascript'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数")]),t._v("\n    script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.localhost:10011?user=admin&callback=handleCallback'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 回调执行函数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[n("strong",[t._v("JSONP的缺点：")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("具有局限性， 仅支持get方法")])]),t._v(" "),n("li",[n("p",[t._v("不安全，可能会遭受XSS攻击")])])]),t._v(" "),n("h3",{attrs:{id:"form表单提交"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#form表单提交"}},[t._v("#")]),t._v(" form表单提交")]),t._v(" "),n("p",[n("code",[t._v("ajax")]),t._v("跨域是因为浏览需要保护用户的隐私而给JS设定的限制，"),n("code",[t._v("form")]),t._v("表单提交会刷新页面，原页面的脚本无法获取新页面的内容，所以浏览器认为是安全的")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.localhost:10011"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("submit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("提交"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("h3",{attrs:{id:"cors-cross-origin-resource-sharing"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cors-cross-origin-resource-sharing"}},[t._v("#")]),t._v(" CORS(Cross-origin resource sharing)")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Access"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nAccess"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Credentials"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nAccess"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Expose"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FooBar\nContent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" text"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" charset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])])]),n("p",[t._v("服务器设置"),n("code",[t._v("Access-Control-Allow-Origin：允许跨域的域名")])]),t._v(" "),n("p",[t._v("该字段是必须的。它的值要么是请求时"),n("code",[t._v("Origin")]),t._v("字段的值，要么是一个"),n("code",[t._v("*")]),t._v("，表示接受任意域名的请求。")]),t._v(" "),n("p",[t._v("服务器还有其它配置")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("服务器设置"),n("code",[t._v("Access-Control-Allow-Credentials")])]),t._v(" "),n("p",[t._v("正常跨域请求是不允许携带Cookie的，如果需要带Cookie还需要进行以下配置")]),t._v(" "),n("p",[t._v("该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下值为"),n("code",[t._v("false")]),t._v("，Cookie不包括在CORS请求之中\n设为"),n("code",[t._v("true")]),t._v("后，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。")]),t._v(" "),n("p",[t._v("服务器设置之后，前端请求还需要配置"),n("code",[t._v("withCredentials")]),t._v("属性")])]),t._v(" "),n("li",[n("p",[t._v("服务器设置"),n("code",[t._v("Access-Control-Expose-Headers")])]),t._v(" "),n("p",[t._v("CORS请求时，"),n("code",[t._v("XMLHttpRequest")]),t._v("对象的"),n("code",[t._v("getResponseHeader()")]),t._v("方法只能拿到6个基本字段："),n("code",[t._v("Cache-Control")]),t._v("、"),n("code",[t._v("Content-Language")]),t._v("、"),n("code",[t._v("Content-Type")]),t._v("、"),n("code",[t._v("Expires")]),t._v("、"),n("code",[t._v("Last-Modified")]),t._v("、"),n("code",[t._v("Pragma")]),t._v("。如果想拿到其他字段，就必须在"),n("code",[t._v("Access-Control-Expose-Headers")]),t._v("里面指定。\n上面的例子指定，"),n("code",[t._v("getResponseHeader('FooBar')")]),t._v("可以返回"),n("code",[t._v("FooBar")]),t._v("字段的值")])])]),t._v(" "),n("h3",{attrs:{id:"修改document-domain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改document-domain"}},[t._v("#")]),t._v(" 修改document.domain")]),t._v(" "),n("p",[t._v("这个解决方案只适用于主域，协议，端口相同，子域不同的跨域应用场景。其他情况不能使用")]),t._v(" "),n("p",[t._v("比如在："),n("code",[t._v("aaa.com")]),t._v("的一个网页"),n("code",[t._v("a.html")]),t._v("里面利用"),n("code",[t._v("iframe")]),t._v("引入了一个"),n("code",[t._v("bbb.com")]),t._v("里的一个网页"),n("code",[t._v("b.html")]),t._v("。\n这时在"),n("code",[t._v("a.html")]),t._v("里面可以看到"),n("code",[t._v("b.html")]),t._v("里的内容，但是却不能利用javascript来操作它。因为这两个页面属于不同的域")]),t._v(" "),n("p",[t._v("如果在"),n("code",[t._v("a.html")]),t._v("里引入"),n("code",[t._v("aaa.com")]),t._v("里的另一个网页，是不会有这个问题的，因为域相等")]),t._v(" "),n("p",[t._v("有另一种情况，两个子域名："),n("code",[t._v("aaa.xxx.com")]),t._v(" 和 "),n("code",[t._v("bbb.xxx.com")]),t._v("，"),n("code",[t._v("aaa.xxx.com")]),t._v("里的一个网页("),n("code",[t._v("a.html")]),t._v(")引入了"),n("code",[t._v("bbb.xxx.com")]),t._v(" 里的一个网页 "),n("code",[t._v("b.html")]),t._v("，这时"),n("code",[t._v("a.html")]),t._v("里同样是不能操作"),n("code",[t._v("b.html")]),t._v("里面的内容的。因为"),n("code",[t._v("document.domain")]),t._v("不一样（一个是"),n("code",[t._v("aaa.xxx.com")]),t._v("，另一个是"),n("code",[t._v("bbb.xxx.com")]),t._v("）")]),t._v(" "),n("p",[t._v("这时我们就可以通过Javascript将两个页面的"),n("code",[t._v("domain")]),t._v("改成一样的，需要在"),n("code",[t._v("a.html")]),t._v("里与"),n("code",[t._v("b.html")]),t._v("里都加入代码如下:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx.com"')]),t._v("\n")])])]),n("p",[t._v('这样这两个页面就可以互相操作了。也就是实现了同一基础域名之间的"跨域"')]),t._v(" "),n("h3",{attrs:{id:"利用服务器代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#利用服务器代理"}},[t._v("#")]),t._v(" 利用服务器代理")]),t._v(" "),n("p",[t._v("跨域是浏览器给的限制，所以平时开发时可以利用"),n("code",[t._v("node")]),t._v("加一层代理转发接口的方式来解决跨域问题，Webpack也提供了相关的配置：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" domain "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://i.chuangliang.com/"')]),t._v("\n\ndevServer"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" domain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ws"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        changeOrigin"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cookieDomainRewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pathRewrite"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^/api'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onProxyReq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onProxyReq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("proxyReq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("代理请求===")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("proxyReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("h2",{attrs:{id:"http响应首部字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http响应首部字段"}},[t._v("#")]),t._v(" HTTP响应首部字段")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("Accept-Control-Allow-Origin")]),t._v("： 用于设置允许访问该资源的外部URL")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Accept-Control-Expose-Headers")]),t._v("：对跨域访问在跨域访问时，"),n("code",[t._v("XMLHttpRequest对象的getResponseHeader()")]),t._v("方法只能拿到一些最基本的响应头，"),n("code",[t._v("Cache-Control")]),t._v("、"),n("code",[t._v("Content-Language")]),t._v("、"),n("code",[t._v("Content-Type")]),t._v("、"),n("code",[t._v("Expires")]),t._v("、"),n("code",[t._v("Last-Modified、Pragma")]),t._v("，如果要访问其他头，则需要服务器设置本响应头。")])])]),t._v(" "),n("p",[n("code",[t._v("Access-Control-Expose-Headers")]),t._v(" 头让服务器把允许浏览器访问的头放入白名单，例如：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header\n")])])]),n("ul",[n("li",[n("p",[n("code",[t._v("Access-Control-Max-Age")]),t._v("：指定了"),n("code",[t._v("preflight")]),t._v("请求的结果能够被缓存多久")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Access-Control-Allow-Credentials")]),t._v("：该字段可选。它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为true，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Access-Control-Allow-Methods")]),t._v("：首部字段用于预检请求的响应。其指明了实际请求所允许使用的 HTTP 方法。")])])]),t._v(" "),n("h2",{attrs:{id:"http请求头部字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http请求头部字段"}},[t._v("#")]),t._v(" HTTP请求头部字段")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("origin")]),t._v("：发起请求的源站URL，不包含路径")]),t._v(" "),n("p",[t._v("注意：无论是否跨域请求，"),n("code",[t._v("origin")]),t._v("都会被发送")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Accept-Control-Request-Method")]),t._v("：用于预检请求，将实际所请求的方法告诉服务器")]),t._v(" "),n("p",[t._v("在项目中如果是跨域请求时，我们发现同一个请求有两次发送，第一次是"),n("code",[t._v("options")]),t._v("，第二次才是真正的请求。第一次请求就是预检请求，请求头中会带上"),n("code",[t._v("Accept-Control-Request-Method")]),t._v("，值是我们真正要请求的方法")])])]),t._v(" "),n("h2",{attrs:{id:"预检请求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预检请求"}},[t._v("#")]),t._v(" 预检请求")]),t._v(" "),n("p",[t._v("对于非简单请求如"),n("code",[t._v("POST")]),t._v(","),n("code",[t._v("PUT")]),t._v("或"),n("code",[t._v("DELETE")]),t._v('，在发这些类型的请求之前会先发送一个"预检"请求, 请求方法是'),n("code",[t._v("OPTIONS")])]),t._v(" "),n("p",[t._v("浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。\n只有得到肯定答复，浏览器才会发出正式的"),n("code",[t._v("XMLHttpRequest")]),t._v("请求，否则就报错")]),t._v(" "),n("p",[t._v("一般预检请求都包含以下几个头部：")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("Origin")]),t._v(": 表示请求来自哪个源")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Access-Control-Request-Method")]),t._v(": 用来列出浏览器的CORS请求会用到哪些HTTP方法")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Access-Control-Request-Headers")]),t._v(": 浏览器CORS请求会额外发送的头信息字段")])])]),t._v(" "),n("p",[t._v("服务器在收到浏览器的预检请求之后，会根据头信息的三个字段来进行判断，如果返回的头信息在中有 "),n("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 这个字段就是允许跨域请求，如果没有，就是不同意这个预检请求，就会报错。")]),t._v(" "),n("p",[t._v("服务器回应的CORS的字段如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("Access-Control-Allow-Origin: http://api.bob.com  // 允许跨域的源地址\nAccess-Control-Allow-Methods: GET, POST, PUT // 服务器支持的所有跨域请求的方法\nAccess-Control-Allow-Headers: X-Custom-Header  // 服务器支持的所有头信息字段\nAccess-Control-Allow-Credentials: true   // 表示是否允许发送Cookie\nAccess-Control-Max-Age: 1728000  // 用来指定本次预检请求的有效期，单位为秒\n")])])]),n("h3",{attrs:{id:"减少options请求次数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#减少options请求次数"}},[t._v("#")]),t._v(" 减少OPTIONS请求次数：")]),t._v(" "),n("p",[t._v("OPTIONS请求次数过多就会损耗页面加载的性能，降低用户体验度。所以尽量要减少 OPTIONS 请求次数，可以后端在请求的返回头部添加："),n("code",[t._v("Access-Control-Max-Age：number")]),t._v("。它表示预检请求的返回结果可以被缓存多久，单位是秒。该字段只对完全一样的URL的缓存设置生效，所以设置了缓存时间，在这个时间范围内，再次发送请求就不需要进行预检请求了。")]),t._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("跨域资源共享 CORS 详解"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"q-a"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#q-a"}},[t._v("#")]),t._v(" Q&A")]),t._v(" "),n("h3",{attrs:{id:"正向代理和反向代理的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正向代理和反向代理的区别"}},[t._v("#")]),t._v(" 正向代理和反向代理的区别")]),t._v(" "),n("p",[n("strong",[t._v("正向代理：")])]),t._v(" "),n("p",[t._v("客户端想获得一个服务器的数据，但是因为种种原因无法直接获取。于是客户端设置了一个代理服务器，并且指定目标服务器，之后代理服务器向目标服务器转交请求并将获得的内容发送给客户端。这样本质上起到了对真实服务器隐藏真实客户端的目的。实现正向代理需要修改客户端，比如修改浏览器配置。")]),t._v(" "),n("p",[t._v("比如翻墙工具")]),t._v(" "),n("p",[n("strong",[t._v("反向代理：")])]),t._v(" "),n("p",[t._v("服务器为了能够将工作负载分不到多个服务器来提高网站性能 (负载均衡)等目的，当其受到请求后，会首先根据转发规则来确定请求应该被转发到哪个服务器上，然后将请求转发到对应的真实服务器上。这样本质上起到了对客户端隐藏真实服务器的作用。\n一般使用反向代理后，需要通过修改 DNS 让域名解析到代理服务器 IP，这时浏览器无法察觉到真正服务器的存在，当然也就不需要修改配置了。")]),t._v(" "),n("p",[t._v("两者区别如图示：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(565),alt:""}})]),t._v(" "),n("p",[t._v("代理的结构是一样的，都是 "),n("code",[t._v("client-proxy-server")]),t._v(" 的结构，它们主要的区别就在于中间这个 "),n("code",[t._v("proxy")]),t._v(" 是哪一方设置的。在正向代理中，"),n("code",[t._v("proxy")]),t._v(" 是 client 设置的，用来隐藏 client；而在反向代理中，"),n("code",[t._v("proxy")]),t._v(" 是 server 设置的，用来隐藏 server。")])])}),[],!1,null,null,null);s.default=e.exports}}]);