import{_ as t,r as o,o as l,c,b as n,d as s,a as e,e as p}from"./app-QMonxybV.js";const i="/lanjz/assets/other-PEIVidZ5.png",r={},u=p(`<h1 id="构建优化方案" tabindex="-1"><a class="header-anchor" href="#构建优化方案" aria-hidden="true">#</a> 构建优化方案</h1><h2 id="webpack-能做什么" tabindex="-1"><a class="header-anchor" href="#webpack-能做什么" aria-hidden="true">#</a> webpack 能做什么</h2><p>在整理 Webpack 能做什么之前，先捊一下 Webpack 本身已经做了什么？</p><ul><li><p>让开发者可以使用模块化的形式组织项目</p></li><li><p>实现项目组件化</p></li><li><p>可以使用新的 JS 语法</p></li><li><p>预处理样式、图片等资源</p></li><li><p>模块热更新</p></li><li><p>集成 terserPlugin，压缩代码、Tree Shaking、Scope Hoisting</p></li></ul><p>回到正题 Webpack 构建优化主要从两个角度出发：</p><ul><li><p>构建速度方面的优化</p></li><li><p>开发效率方面的优化</p></li></ul><h2 id="打包速度方面的优化" tabindex="-1"><a class="header-anchor" href="#打包速度方面的优化" aria-hidden="true">#</a> 打包速度方面的优化</h2><h3 id="缩小搜索范围" tabindex="-1"><a class="header-anchor" href="#缩小搜索范围" aria-hidden="true">#</a> 缩小搜索范围</h3><p>webpack工作本身就是一个不断检索文件、转换文件的过程， 所以其中包含大量的检索工作</p><p><strong>缩小<code>Loader</code>应用范围</strong></p><p>配置 <code>Loader</code> 时合理得使用 <code>test</code>、 <code>exclude</code>、<code>include</code> 属性，优化要使用 Loader 的文件，尽可能少的让文件被Loader处理</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//如果项目源码中只有JS文件，就不要写成/\\.jsx?$/，以提升正则表达式的性能</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-loader?cacheDirectory&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// label-loader支持缓存转换出的结果，通过cacheDirectory来启动</span>
                <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 只对项目根目录下的src目录中的文件采用babel-loader</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优化 <code>resolve.modules</code> 配置</strong></p><p><code>resolve.modules</code> 作用：配置 Webpack 去哪个目录寻找第三方模块，Webpack 默认会在当前项目根目录的<code>node_modules</code> 下寻找第三方模块，如果当前 <code>node_modules</code> 没有找到对应的模块则去上一级目录下的<code>node_modules</code>中找，以此类推。</p><p>在实际的开发使用场景，我们并不需要一层层地寻找，因此我们可以指定第三方模块的目录，减少 Webpack 的寻找，配置如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//  dirname表示当前工作目录，也就是项目根目录</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优化 <code>resolve.extensions</code> 配置</strong></p><p>默认情况下，Webpack 寻找没有带后缀的文件时，会自动带上后缀去寻找，默认是通过 <code>resolve.extension</code> 配置的后缀列表按顺序去寻找，默认是：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.json&#39;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>因为我们可以根据以下情况去优化 <code>resolve.extensions</code></p><ul><li><p>没使用到的后缀名不列表入 <code>resolve.extensions</code> 中</p></li><li><p>高频后缀名放在前面</p></li><li><p>在引入文件时，不要忽略后缀名，将后缀名书完整，避免让 Webpack 自己去匹配</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;js&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优化 <code>resolve.noParse</code> 配置</strong></p><p>对于没有模块化的文件，通过这个配置让 Webpack 忽略对这些文件的递归解析，以此提高构建性能。比如 <code>JQuery</code>、<code>lodash</code> 等没用采用模块化的方式，让 Webpack 解析这些文件即耗时又没有意义</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token string">&#39;/jquery|lodash/&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优化resolve.alias配置</strong></p><p><code>resolve.alias</code> 作用：通过别名将原来导入第三方模块的路径修改为新的路径</p><p>有些第三方模块安装时，会有多套代码，比如 <code>React</code> 有个 <code>dist</code> 目录，是将所有代码打包好的放在一个单独的文件中，这个文件没有被模块化，可以直接引入执行</p><p>另一个是 <code>lib</code> 目录，是一套采用 CommonJs 规范的模块化代码，以 <code>package.json</code> 中指定的入口文件 <code>react.js</code> 为模块的入口</p><p>默认情况下，Webpack 引入 <code>lib</code> 目录下的文件时，会递归解析和处理这些文件，这会是一个耗时的操作。这时可以通过<code>resolve.alias</code> 来配置使用单独的完整的 <code>dist</code> 下的文件，减少搜索时间</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;react&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./node_modules/react/dist/react.min.js&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是，使用这种优化虽然可以减少搜索，但是会引入模块中没用到的代码，这不利于 <code>Tree-Sharking</code> 使用，比如在使得 <code>lodash</code> 时，我们可能只用到部分功能，如果使用这个配置优化，将会把所有包括没用到的也引用项目当中</p><h3 id="预编译" tabindex="-1"><a class="header-anchor" href="#预编译" aria-hidden="true">#</a> 预编译</h3><p>对于比较常用又不常更新的模块可以先将其进行打包，然后在项目中直接引这些库，省去 webpack 对这些模块的编译处理。DllPlugin 就是这么一个插件</p><h4 id="认识dllplugin" tabindex="-1"><a class="header-anchor" href="#认识dllplugin" aria-hidden="true">#</a> 认识DllPlugin</h4><p>对于比较常用又不常更新的模块可以使用 DllPlugin 插件将其进行打包，项目中直接引这些库，不需要进行对这些模块做编译打包处理，如 <code>react</code>、<code>react-dom</code>，所以只要不升级这些模块的版本，动态链接库就不用重新编译。</p><p>使用 DllPlugin，需要完成以下几件事情</p><ul><li><p>将网页依赖的基础模块抽离出来，打到一个个单独的动态链接库中。在一个动态链接库可以包含多个模块</p></li><li><p>将需要导入的模块存在于动态链接库时，不需要重新打包，而是从动态链接库直接导入</p></li><li><p>页面依赖的所有动态链接库都需要被加载</p></li></ul><p><strong>Webpack中使用dll</strong></p><p>Webpack中使用 <code>dll</code> 需要用到两个插件： <code>DllPlugin</code>，<code>DllReferencePlugin</code></p><ul><li><p>DllPlugin 插件：用于打包一个个单独的动态链接库文件。</p></li><li><p>DllReferencePlugin 插件：用于在主要的配置文件中引入 DllPlugin 插件打包好的动态链接库文件</p></li></ul><p>以 React 项目为例，为其接入 DllPlugin。最终构建出的目录结构：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">|</span><span class="token operator">--</span> main<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> polyfill<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> polyfill<span class="token punctuation">.</span>mainfest<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> react<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">--</span> react<span class="token punctuation">.</span>mainifest<span class="token punctuation">.</span>json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中包含两个动态链接库文件</p><ul><li><p><code>polyfill.dll.js</code> ：里面包含项目所有依赖的 <code>polyfill</code>,例如 <code>Promise</code>、<code>fetch</code> 等 <code>Api</code></p></li><li><p><code>react.dll.js</code>：里面包含 React 的基础运行环境，即 <code>react</code> 和 <code>react-dom</code> 模块</p></li></ul><p>以 <code>react.dll.js</code> 文件为例，其文件内容大致如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> _dll_react <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ......</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ID为0的模块对应的代码</span>
  <span class="token punctuation">}</span>，
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ID为1的模块对应的代码</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// .....</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可见，一个动态链接库包含了大量模块的代码，这些模块被存放在一个数组里，用数组的索引号作为 ID，并且通过 <code>__dll_react_</code> 变量将自己暴露在全局中，即可以通过 <code>window.__dll_react</code> 访问到其中包含的模块。</p><p>其中 <code>polyfill.mainifest.json</code> 和 <code>react.mainfest.json</code> 文件也是由 DllPlugin 生成的，用于描述在动态链接库文件中包含哪些模块</p><p><code>main.js</code> 文件是被编译出来的执行入口文件，在遇到其依赖的模块在 <code>dll.js</code> 文件中时，会直接通过 <code>dll.js</code> 文件暴露的全局变量获取打包在 <code>dll.js</code> 文件中的模块，所以在 <code>index.html</code> 文件中需要将依赖的两个 <code>dll.js</code> 文件加载进去。 此时 <code>index.html</code> 内容如下：</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--导入依赖的动态链接库--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sciprt</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dist/polyfill.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sciprt</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sciprt</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dist/react.dll.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sciprt</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--导入执行的入口文件--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sciprt</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dist/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sciprt</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>webpack打包生成dll</strong></p><p>动态链接库文件相关的文件需要由一份独立的构建输出，用于主构建使用。新建一个 Webpack 配置文 件<code>webpack_dll.deploy.config.js</code> 专门构建他们。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> DllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/DllPlugin&#39;</span><span class="token punctuation">)</span>
  modules<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// JavaScript执行文件</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 将React相关的模块放到一个单独的动态链接库中</span>
      <span class="token literal-property property">react</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 将项目需要所有的polyfill放到一个单独的动态链接库中</span>
      <span class="token literal-property property">polyfill</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;core-js/fn/object/assign&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;core-js/fn/promise&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;whatwg-fetch&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 输出的动态链接库的文件名称，[name]代表当前动态链接库的名称</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].dll.js&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 将输出的文件都放到dist目录下</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 设置动态链接库全局变量名，对于react就是_dll_react</span>
      <span class="token comment">// 加上前缀_dll是为了防止与其它全局变量冲突</span>
      <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&#39;_dill_[name]&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token comment">// 接入DllPlugin</span>
      <span class="token keyword">new</span> <span class="token class-name">DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 动态链接库的全局变量名称，需要和output.library中的保持一致</span>
        <span class="token comment">// 该字段的值也就是输出mainfest.json文件中name字段的值</span>
        <span class="token comment">// 例如在react_mainfest.jon中就有&quot;name&quot;：&quot;_dii_react&quot;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;_dll_[name]&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// 描述动态链接库的mainfest.json文件输出时的文件名称</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;[name].mainfest.json&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后生成dll文件 <code>webapck --config webpack_dll.deploy.config.js</code></p><p><strong>主配置使用动态链接库文件</strong></p><p>用于输出 <code>main.js</code> 的主 Webpack 配置文件的内容如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> DllReferencePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/DllReferencePlugin.js&#39;</span><span class="token punctuation">)</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 定义入口Chunk</span>
      <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">&#39;./main.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token comment">// 输出文件的名称</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// 项目源码使用了ES6和JSX语法，需要使用babel-loader转换</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 告诉 Webpack使用了哪些链接库</span>
      <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 描述react动态链接库的文件内容</span>
        <span class="token literal-property property">mainfest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/react.mainfest.json&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 告诉 Webpack使用了哪些链接库</span>
      <span class="token keyword">new</span> <span class="token class-name">DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 描述polyfill动态链接库的文件内容</span>
        <span class="token literal-property property">mainfest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/polyfill.mainfest.json&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&#39;source-map&#39;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><p>在 <code>webapck_dll.deploy.config.js</code> 文件中，DllPlugin 中的 <code>name</code> 参数必须和 <code>output.library</code> 中的保持一致。原因在于 DllPlugin 中的 <code>name</code> 参数会影响输出<code>mainfest.json</code> 文件中的name字段的值。而在 <code>webapck.deploy.config.js</code> 文件中，<code>DllReferencePlugin</code> 会去 <code>mainfest.json</code> 文件中读取 <code>name</code> 字段的值，将值的内容作为在全局变量中获取动态链接库的内容时的全局变量名</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Webpack 中配置 dll 的过程相比其它插件的使用真的相当繁琐，所以可以使用 autodll-webpack-plugin 这个插件自动帮我们做 dll 的配置工作</p></div><p><strong>其实这么看来 DllPlugin 不就是缓存嘛？</strong></p><p><strong>但是在 Webpack4之后， 已经渐渐不使用 dllPlugin了</strong></p><ul><li><p>一方面主要是因为一方面配置繁琐，维护成本高；</p></li><li><p>另一方面 Webpack 4 之后在打包性能已经做了多大的优化，也有更多优化选择</p></li></ul><h4 id="hardsourcewebpackplugin" tabindex="-1"><a class="header-anchor" href="#hardsourcewebpackplugin" aria-hidden="true">#</a> HardSourceWebpackPlugin</h4><p>HardSourceWebpackPlugin 为模块提供中间缓存，缓存默认的存放路径是: <code>node_modules/.cache/hard-source</code></p><p>首先安装依赖:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>npm install hard-source-webpack-plugin -D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改 webpack 的配置：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">var</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hard-source-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Webpack5 好像内置了</p><h3 id="缓存" tabindex="-1"><a class="header-anchor" href="#缓存" aria-hidden="true">#</a> 缓存</h3><p>充分利用缓存提升二次构建速度</p><h4 id="babel-loader-开启缓存" tabindex="-1"><a class="header-anchor" href="#babel-loader-开启缓存" aria-hidden="true">#</a> babel-loader 开启缓存</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cache-loader" tabindex="-1"><a class="header-anchor" href="#cache-loader" aria-hidden="true">#</a> cache-loader</h4><p>缓存 Loader 编译的结果，可以避免重新编译.</p><p>编译结果默认保存在 <code>node_modueles/.cache/cache-loader</code> 目录下</p><p>cache-loader 工作分两个阶段：pitch 和 loader</p><ul><li><p>pitch 阶段的处理流程是：cache-loader -&gt; other-loader</p></li><li><p>loader 阶段的处理流程是：other-loader -&gt; cache-loade</p></li></ul><p>pitch 阶段根据当前正在处理的文件，读取 .cache 目录中对应的 cache 文件，对比 mtime(基于目标文件最后修改时间) 判断是否可以复用</p><p>loader 阶段依赖 pitch 阶段的判断，如果 pitch 阶段判断当前文件的缓存失效了，loader 阶段就要重新生成缓存</p><p>cache-loader 的配置很简单，放在其他 loader 之前即可。修改Webpack 的配置如下:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.ext$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&#39;cache-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token operator">...</span>loaders
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="hard-source-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#hard-source-webpack-plugin" aria-hidden="true">#</a> hard-source-webpack-plugin</h4><p>HardSourceWebpackPlugin 为模块提供了中间缓存</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>yarn add <span class="token operator">-</span><span class="token constant">D</span> hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

<span class="token comment">// webpack.config.js</span>
<span class="token keyword">var</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hard-source-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token comment">// ...</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="terserwebpackpluginn" tabindex="-1"><a class="header-anchor" href="#terserwebpackpluginn" aria-hidden="true">#</a> TerserWebpackPluginn</h4><p>该插件用于压缩 JavaScript，开启缓存功能可以提升二次的压缩效果</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 其它配置</span>
            <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token comment">// 其它配置</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="开启多进程任务" tabindex="-1"><a class="header-anchor" href="#开启多进程任务" aria-hidden="true">#</a> 开启多进程任务</h3><p>Webpack 构建过程就是对文件进行解析和转换，所以构建是谁的读写和计算密集型的。运行在 Node.js 之后的 Webpack 是单线程模型的，也就是说 Webpack 需要一个一个地处理任务，不能同时处理多个任务。</p><p>开启多进程任务后能让 Webpack 在同一时刻处理多个任务，发挥多核 CPU 电脑的功能，他将任务分到给多个子进程去并发执行，子进程处理完后再将结果发送给主进程。</p><h4 id="使用happypack" tabindex="-1"><a class="header-anchor" href="#使用happypack" aria-hidden="true">#</a> 使用HappyPack</h4><p>HappyPack 的作用就是开启多进程来对文件进行解析和转换</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;extract-text-webpack-plugin&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;happypack&#39;</span><span class="token punctuation">)</span>
  
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token comment">// 将js文件的处理交给id为babel的happypack实例</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;happypack/loader?id=babel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token comment">// 排除node_modules下的目录，因为node_modeles目录下的文件采用了ES5语法，没必要再通过Babel去转换</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token comment">// 将css文件的处理交给id为babel的happypack实例</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> ExtranctTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;happypack/loader?id=css&#39;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 定义唯一标识符id</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;babel&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// 定义这个HappyPack使用哪个loader，用法和Loader配置一样</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-loader?cacheDirectory&#39;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;css&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].css&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上配置做了以下几件事情：</p><ul><li><p>在 Loader 配置，将文件的处理将给 <code>happypack/loader</code> ，使用时后面紧跟的 <code>querystring?id=bable</code> 表示使用哪个 HappyPack 实例</p></li><li><p>在 <code>Plugin</code> 配置中，添加了两个 <code>HappyPack</code> 实例，分别配置了不同的 <code>loaders</code>，用于告诉 <code>happypack/loader</code> 如何处理 <code>.js</code> 和 <code>.css</code> 文件。<code>id</code> 属性的值和上面 <code>querystring</code> 的 <code>?id=bable</code> 对应</p></li></ul><p>在实例 HappyPack 时，除了可以传入 <code>id</code> 和 <code>loaders</code> 外还支持以下属性</p><ul><li><p><code>threads</code>：代表开启几个子进程去处理这一类的文件，默认是 <code>3</code> 个，必须是整数</p></li><li><p><code>verbose</code>：是否允许 HappyPack 输出日志，默认开户</p></li><li><p><code>threadPool</code>：代表共享进程池，即多个 HappyPay 实例都使用同一个共享进程池的子进程去处理任务，以防止资源占用太多，相关代码如下</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;extract-text-webpack-plugin&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;happypack&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span> HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token comment">// 将js文件的处理交给id为babel的happypack实例</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;happypack/loader?id=babel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token comment">// 排除node_modules下的目录，因为node_modeles目录下的文件采用了ES5语法，没必要再通过Babel去转换</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token comment">// 将css文件的处理交给id为babel的happypack实例</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> ExtranctTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;happypack/loader?id=css&#39;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 定义唯一标识符id</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;babel&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// 定义这个HappyPack使用哪个loader，用法和Loader配置一样</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-loader?cacheDirectory&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 使用共享进程池中的子进程去处理任务</span>
        <span class="token literal-property property">threadPool</span><span class="token operator">:</span> happyThreadPool
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;css&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 使用共享进程池中的子进程去处理任务</span>
        <span class="token literal-property property">threadPool</span><span class="token operator">:</span> happyThreadPool
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].css&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接入 HappyPack 后，需要为项目安装新的依赖：</p><p><code>npm i -D HappyPack</code></p><p>安装成功后重新执行构建，如果有看到由 HappyPack 输出的日志说明 HappyPack 配置生效了</p><p><strong>HappyPack原理</strong></p><p>每通过 <code>new HappyPack</code> 实例化一个 HappyPack，并定义该实例使用哪些 Loader 去转换一类文件，并且可以指定如何为这类转换操作分配进程。</p><p>核心调度器的逻辑代码在主进程中，也就是运行 Webpack 的进程中，核心调度器会将一个个任务分配给当前空闲的子进程中，子进程处理完后将结果发送给核心调度器，它们之间的数据交换是通过进程间的通信 API 完成的。</p><p>核心调度器收到来自子进程处理完毕的结果后，会通知 Webpack 该文件已处理完毕。</p><h4 id="thread-loader" tabindex="-1"><a class="header-anchor" href="#thread-loader" aria-hidden="true">#</a> thread-loader</h4><p>作用同 HappyPack，也是将您的 <code>loader</code> 放置在一个 <code>worker</code> 池里面运行，以达到多线程构建。 把这个 <code>loader</code> 放置在其他 <code>loader</code> 之前， 放置在这个 <code>loader</code> 之后的 <code>loader</code> 就会在一个单独的 <code>worker</code> 池( <code>worker pool</code> )中运行</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vue.deploy.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token comment">// 你的高开销的loader放置在此 (e.g babel-loader)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="terser-webpack-plugin开启多进程压缩" tabindex="-1"><a class="header-anchor" href="#terser-webpack-plugin开启多进程压缩" aria-hidden="true">#</a> terser-webpack-plugin开启多进程压缩</h4><p>从 webpack 4 开始 内置了 TerserPlugin 压缩JS</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;terser-webpack-plugin&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">paraller</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 多进程</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用<code>webpack-paralle-uglify-plugin</code>插件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">UglifyJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启缓存</span>
    <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启进程并行压缩</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\/includes</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 缩小压缩文件范围</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\/excludes</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 缩小压缩文件范围</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="其它更高效的编译工具" tabindex="-1"><a class="header-anchor" href="#其它更高效的编译工具" aria-hidden="true">#</a> 其它更高效的编译工具</h2><p><img src="`+i+`" alt=""></p><ul><li><p>esbuild-loader 代替 babel-loader</p><p>要提醒的是esbuild-loader 只能编译到 es2015</p></li><li><p>babel-loader 代替 terser-webpack-plugin</p><p>需要额外注意的是使用 esbuild 压缩后的体积会比使用 terser 的大一点</p></li></ul><h2 id="开发效率优化" tabindex="-1"><a class="header-anchor" href="#开发效率优化" aria-hidden="true">#</a> 开发效率优化</h2><h3 id="文件自动监听" tabindex="-1"><a class="header-anchor" href="#文件自动监听" aria-hidden="true">#</a> 文件自动监听</h3><p>文件监听是发现源码文件发生变化时，自动重新编译出新的输出文件</p><p>文件监听的相关配置：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启监听模式，默认是false</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 前提是要watch为true，要不然没意义</span>
    <span class="token comment">// 监听模式运行时的参数</span>
    <span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不监听的文件或文件夹，支持正则匹配</span>
        <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 监听到变化后等300ms再去执行，截流</span>
        <span class="token literal-property property">aggregateTimeout</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
        <span class="token comment">// 判断文件是否发生变化是通过不断询问系统指定文件有没有更新实现的</span>
        <span class="token comment">// 默默每秒询问1000次</span>
        <span class="token literal-property property">poll</span><span class="token operator">:</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Webpack 开启文件监听有两种方式</p><ol><li><p>配置文件中设置 <code>watch: true</code></p></li><li><p>在执行启动Webpack的命令时带上 <code>--watch</code> 参数，完整的命令是 <code>webapck --watch</code></p></li></ol><h4 id="文件监听的原理" tabindex="-1"><a class="header-anchor" href="#文件监听的原理" aria-hidden="true">#</a> 文件监听的原理</h4><p>在 Webpack 中监听一个文件是否发生变化的原理，是定时获取这个文件最后更新时间，每次都存下最新的更新时间，如果发现当前时间获取的和最后一次保存的编辑时间不一致，就认为该发生了变化 。配置项中的 <code>watchOptions.poll</code> 用于控制定时检查的周期，具体含义是每秒检查多少次。</p><p><strong>怎么确定要监听的文件列表呢？</strong></p><p>在默认情况下，Webpack 会从配置的 Entry 文件出发，递归解析 <code>Entry</code> 文件所依赖的文件，将这些文件加入到监听列表中。</p><p>由于保存文件的路径和最后的编辑时间需要占用内存，定时检查、周期检查需要占用 CPU 及文件 I/O，所以最好减少需要监听的文件数量和降低检查频率。</p><p><strong>优化文件监听的性能</strong></p><p>根据前面对文件监听的原理介绍，我们可以做以下优化：</p><ul><li>需要监听的文件列表是根据 <code>Entry</code> 配置的入口文件递归得将引用到的文件加入到监听列表中，其中将包含很多的 <code>node_modules</code> 中的模块，一般情况下我们不会修改 <code>node_moduels</code> 里的文件，所以我们可以忽略这个文件的监听，相关配置如下：</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不监听node_module中的文件</span>
   <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token operator">/</span>node_modules<span class="token operator">/</span>，
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>配置截流，<code>watchOptions.aggregateTimeout</code> 的值越大越好，因为这能降低重新构建的频率</p></li><li><p><code>watchOptions.pool</code> 的值越小越好，因为这能降低检查的频率</p></li></ul><p>后面这种方式的优化，负作用是监听模式的反应和灵敏度降低了</p><p><strong>自动刷新浏览器</strong></p><p>监听到文件的变化后，下一步就是刷新浏览器，Webpack 模块负责监听文件，<code>webapck-dev-server</code> 负责刷新浏览器。使用 <code>webpack-dev-server</code> 模块去启动 <code>webpack</code> 模块时，<code>webpack</code> 模块的监听模式默认会被开启。当 <code>webpack</code> 模块监听到文件变化时，会通过 <code>webpack-dev-server</code> 模块</p><h3 id="模块热替换" tabindex="-1"><a class="header-anchor" href="#模块热替换" aria-hidden="true">#</a> 模块热替换</h3><p>模块热更新技术可以在不刷整个网页的情况下做到起灵敏实时预览。原理在一个源码发生变化时，只需要重新编辑发生变化的的模块，再用新输出的模块替换掉浏览器中对应的模块。</p><p>模块热更新的优点如下：</p><ul><li><p>实时预览反应更快，等待时间更短</p></li><li><p>不刷新浏览器时能保留当前网页的运行状态，例如如果网页使用 Redux 做数据状态管理，那么模块热更新能做到代码更新时 Redux 中的数据操持不变</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 为每个入口注客户端代码</span>
      <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;webpack-dev-server/client?http://localhost:8080/&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;webpack/hot/dev-server&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./src/main.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 告诉DevServer要开启模块热替换模式</span>
      <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span>， <span class="token comment">// 会自动引入 HotModuleReplacement</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者在启动时，命令行带上 <code>--hot</code>，其实就是自动完成以上配置</p><h2 id="输出分析" tabindex="-1"><a class="header-anchor" href="#输出分析" aria-hidden="true">#</a> 输出分析</h2><p>对输出进行分析，我们可以更好得对症下药</p><p>在启动 Webpack 时支持如下两个参数</p><ul><li><p><code>--profile</code>： 记录构建过程中的耗时信息</p></li><li><p><code>--json</code>：以 JSON 的格式输出构建结果 ，最后只输出一个 <code>.json</code> 文件输出，这个文件中包括所有构建相关的信息</p></li></ul><p>在启动 Webpack 时带上以上两个参数，启动命令如下：</p><p><code>webpack --profile --json &gt; stats.json</code></p><p>我们会发现项目中多出了一个 <code>stats.json</code> 文件，这个 <code>stats.json</code>文 件是为后面介绍的可视化分析工具使用的</p><p><code>webpack --profile --json</code> 会输出字符串形式的JSON，<code>&gt; stats.json</code> 是UNIX/Linux系统上的管道命令，其含义是将 <code>webpack --profile --json</code> 输出的内容通过管道输出到 <code>stats.json</code> 文件中</p><h3 id="官方的可视化分析工具" tabindex="-1"><a class="header-anchor" href="#官方的可视化分析工具" aria-hidden="true">#</a> 官方的可视化分析工具</h3>`,154),d={href:"http://webpack.github.io/analyse/",target:"_blank",rel:"noopener noreferrer"},k=p('<p>根据提示将之前生成的 <code>stats.json</code> 上传到网站中，网站就会自动输出一些信息</p><p>该主页被分为如下6大板块。</p><ul><li><p><code>Modules</code>：展示的所有模块，每个模块对应一个文件，并且包含所有模块之间的依赖关系图、模块路径、模块ID、模块所属的 <code>Chunk</code>、模块的大小</p></li><li><p><code>Chunks</code>：性需求 所有代码块，在一个代码块中包含多个模块，并且包含代码块的ID、名称、大小、每个代码块包含的模块数量 ，以及代码之间的依赖关系图</p></li><li><p><code>Assets</code>：展示所有输出的文件资源，包括 <code>.js</code>、<code>.css</code>、图片等，并且包含文件的名称、大小以及该文件来自哪个代码块</p></li><li><p><code>Warnings</code>：展示构建过程中出现的所有警告信息</p></li><li><p><code>Errors</code>：展示构建过程中出现 的所有错误信息</p></li><li><p><code>Hints</code>：展示处理每个模块所耗费的时间</p></li></ul><h3 id="webpack-bundle-analyzer" tabindex="-1"><a class="header-anchor" href="#webpack-bundle-analyzer" aria-hidden="true">#</a> webpack-bundle-analyzer</h3>',4),v={href:"https://www.npmjs.com/package/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"},m=p(`<p>接入 <code>webpack-bundle-analyzer</code> 的方法很简单</p><ul><li><p>安装 <code>webpack-bundle-analyzer</code> 到全局，执行命令<code>npm i -g webpack-bundle-analyzer</code></p></li><li><p>按照上面提到的方法生成 <code>stats.json</code></p></li><li><p>在项目根目录执行 <code>webpack-bundle-analyzer</code> 后，浏览器会打开对应的网页并展现以上效果</p></li></ul><p>从网页中我们可以以下信息：</p><ul><li><p>打包出的文件中都包含了什么</p></li><li><p>每个文件的尺寸在总体中的占比，我们一眼看出哪些文件的尺寸大小</p></li><li><p>模块之间的包含关系</p></li><li><p>每个文件的Gzip后的大小</p></li></ul><h3 id="speed-measure-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#speed-measure-webpack-plugin" aria-hidden="true">#</a> speed-measure-webpack-plugin</h3><p>speed-measure-webpack-plugin 插件可以测量各个插件和 loader 所花费的时间</p><h3 id="scope-hoisting" tabindex="-1"><a class="header-anchor" href="#scope-hoisting" aria-hidden="true">#</a> Scope Hoisting</h3><p>Scope Hoisting从webpack3开始增加的一个新功能 功能是对作用域进行提升，并且让webpack打包后的代码更小、运行更快 默认情况下webpack打包会有很多的函数作用域，包括一些(比如最外层的)IIFE</p><p>无论是从最开始的代码运行，还是加载一个模块，都需要执行一系列的函数; Scope Hoisting可以将可以合并到一个模块中的函数，全部合并到一个模块中来运行, 从而节省不必要函数调用时的性能消耗 webpack在运行Scope Hoisting的时候，其实是依赖的对ES Module的静态分析， 所以在webpack中推荐所有的模块引入和使用使用ES Module的方式来进行使用</p><p>使用Scope Hoisting非常的简单，webpack已经内置了对应的模块:</p><p>在production模式下，默认这个模块就会启用 在development模式下，我们需要自己来打开该模块</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>plugins: [
  new webpack.optimize.ModuleConcatenationPlugin()
]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="减少打包工作" tabindex="-1"><a class="header-anchor" href="#减少打包工作" aria-hidden="true">#</a> 减少打包工作</h2>`,13),b=n("li",null,[n("p",null,"根据情况是否要使用 JS source map ？"),n("ul",null,[n("li",null,[n("p",null,"webpack 通过 devtool 设置")]),n("li",null,[n("p",null,"vue-cli 可以通过 productionSourceMap 属性进行配置")])])],-1),g=n("p",null,"是否要启用 CSS sourceMap ？",-1),h={href:"https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%B2%BE%E8%AE%B2-%E5%AE%8C/03%20%20%E6%9E%84%E5%BB%BA%E6%8F%90%E9%80%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%20SourceMap%EF%BC%9F.md",target:"_blank",rel:"noopener noreferrer"},y=n("ul",null,[n("li",null,[n("p",null,"webpack 通过对应 css(less..)-loader 进行配置(options: { sourceMap: true, })")]),n("li",null,[n("p",null,"vue-cli 通过 css.sourceMap属性进行配置")])],-1),x=n("li",null,[n("p",null,"生产环境是否要开启 eslint ？"),n("ul",null,[n("li",null,"vue-cli 通过 lintOnSave属性进行配置")])],-1),w=n("li",null,[n("p",null,"使用 更少/更小 的库")],-1),j=n("li",null,[n("p",null,"移除不使用的代码")],-1),_=n("li",null,[n("p",null,"使用 CDN 来引入资源")],-1),f=n("h2",{id:"使用最新的-webpack-版本",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#使用最新的-webpack-版本","aria-hidden":"true"},"#"),s(" 使用最新的 Webpack 版本")],-1),P=n("p",null,[n("strong",null,"webpack5 性能相关的更新：")],-1),E=n("p",null,"增加持久化存储能力，提升构建性能（核心）",-1),W=n("p",null,"提升算法能力来改进长期缓存（降低产物资源的缓存失效率）",-1),q=n("p",null,"提升 Tree Shaking 能力降低产物大小和代码生成逻辑",-1);function D(S,H){const a=o("ExternalLinkIcon");return l(),c("div",null,[u,n("p",null,[s("Webpack 官方提供了一个可视化分析工具 "),n("a",d,[s("Webpack Analyse(http://webpack.github.io/analyse/)"),e(a)]),s("，它是一个在线的 Web 应用")]),k,n("p",null,[n("a",v,[s("webpack-bundle-analyzer(https://www.npmjs.com/package/webpack-bundle-analyzer)"),e(a)])]),m,n("ul",null,[b,n("li",null,[g,n("p",null,[n("a",h,[s("构建提速：如何正确使用 SourceMap？"),e(a)])]),y]),x,w,j,_]),f,P,E,W,q])}const B=t(r,[["render",D],["__file","构建优化方案.html.vue"]]);export{B as default};
